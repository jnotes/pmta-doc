<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>PMTA UsersGuide</title>
  <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style>
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  
  <!-- UG-head.html
       CSS for shaded code blocks, scaled images, and sidebar.
       For collapsible TOC, add 'id="mymenu" class="filetree"' to TOC's first '<ul>'.
       See http://www.dynamicdrive.com/dynamicindex1/treeview/index.htm for more info.
       For sidebar, add
         '<div class="sidenav" style="width:25%">' before TOC,
         '</div><div style="margin-left:25%; padding: 8px;">' after TOC, and
         '</div>' at end of body.
    -->
  <style type="text/css">
    pre {background-color: lavender; padding: 4px; display: block;}
    img {max-width: 100%;}
    table, th, td {border: 1px solid black; border-collapse: collapse;}
    code {font-size: 1.13em;}
      
    .sidenav {
        height: 95%;
        width: 0;
        position: fixed;
        overflow-x: auto;
        transition: 0.5s;
        padding-top: 2px;
      }
  </style>
  
  <link rel="stylesheet" href="jquery/jquery.treeview.css" />
  <script type="text/javascript" src="jquery/jquery-1.2.6.min.js"></script>
  <script type="text/javascript" src="jquery/jquery.treeview.js"></script>
    
  <script>
    $(document).ready(function(){
      $("#mymenu").treeview({
        collapsed: true
      });
    });
  </script>
</head>
<body>
<div class="sidenav" style="width:25%">
<p><strong>TABLE OF CONTENTS</strong></p>
<nav id="TOC">
<ul id="mymenu" class="filetree">
<li><a href="#introduction"><span class="toc-section-number">1</span> Introduction</a><ul>
<li><a href="#general-description-and-basic-functionality"><span class="toc-section-number">1.1</span> General Description and Basic Functionality</a></li>
<li><a href="#minimum-requirements"><span class="toc-section-number">1.2</span> Minimum Requirements</a></li>
<li><a href="#supported-interfaces"><span class="toc-section-number">1.3</span> Supported interfaces</a></li>
<li><a href="#monitoringmanagement-tools-summary"><span class="toc-section-number">1.4</span> Monitoring/Management Tools Summary</a></li>
</ul></li>
<li><a href="#powermta-installation"><span class="toc-section-number">2</span> PowerMTA Installation</a><ul>
<li><a href="#installing-on-microsoft-windows"><span class="toc-section-number">2.1</span> Installing on Microsoft Windows</a></li>
<li><a href="#installing-on-linux"><span class="toc-section-number">2.2</span> Installing on Linux</a></li>
<li><a href="#initial-configuration"><span class="toc-section-number">2.3</span> Initial Configuration</a></li>
<li><a href="#uninstalling"><span class="toc-section-number">2.4</span> Uninstalling</a></li>
<li><a href="#running-powermta-on-a-virtual-server"><span class="toc-section-number">2.5</span> Running PowerMTA on a Virtual Server</a></li>
</ul></li>
<li><a href="#powermta-configuration"><span class="toc-section-number">3</span> PowerMTA Configuration</a><ul>
<li><a href="#working-with-the-configuration-file"><span class="toc-section-number">3.1</span> Working with the configuration file</a></li>
<li><a href="#syntax-definitions"><span class="toc-section-number">3.2</span> Syntax definitions</a></li>
<li><a href="#configuration-directives"><span class="toc-section-number">3.3</span> Configuration Directives</a><ul>
<li><a href="#global-directives"><span class="toc-section-number">3.3.1</span> Global Directives</a><ul>
<li><a href="#total-max-smtp-out"><span class="toc-section-number">3.3.1.1</span> total-max-smtp-out</a></li>
<li><a href="#total-max-smtp-in"><span class="toc-section-number">3.3.1.2</span> total-max-smtp-in</a></li>
<li><a href="#postmaster"><span class="toc-section-number">3.3.1.3</span> postmaster</a></li>
<li><a href="#spool"><span class="toc-section-number">3.3.1.4</span> spool</a></li>
<li><a href="#spool-delete-corrupted"><span class="toc-section-number">3.3.1.5</span> spool-delete-corrupted</a></li>
<li><a href="#spool-min-free-space"><span class="toc-section-number">3.3.1.6</span> spool-min-free-space</a></li>
<li><a href="#spool-max-recipients"><span class="toc-section-number">3.3.1.7</span> spool-max-recipients</a></li>
<li><a href="#run-as-root"><span class="toc-section-number">3.3.1.8</span> run-as-root</a></li>
<li><a href="#smtp-server-tls-certificate"><span class="toc-section-number">3.3.1.9</span> smtp-server-tls-certificate</a></li>
<li><a href="#smtp-server-tls-ca-file"><span class="toc-section-number">3.3.1.10</span> smtp-server-tls-ca-file</a></li>
<li><a href="#smtp-server-tls-allow-sslv3"><span class="toc-section-number">3.3.1.11</span> smtp-server-tls-allow-sslv3</a></li>
<li><a href="#smtp-server-tls-allow-tlsv1"><span class="toc-section-number">3.3.1.12</span> smtp-server-tls-allow-tlsv1</a></li>
<li><a href="#smtp-server-tls-allow-tlsv11"><span class="toc-section-number">3.3.1.13</span> smtp-server-tls-allow-tlsv1.1</a></li>
<li><a href="#smtp-server-tls-allow-tlsv12"><span class="toc-section-number">3.3.1.14</span> smtp-server-tls-allow-tlsv1.2</a></li>
<li><a href="#smtp-server-tls-ciphers"><span class="toc-section-number">3.3.1.15</span> smtp-server-tls-ciphers</a></li>
<li><a href="#smtp-source-host"><span class="toc-section-number">3.3.1.16</span> smtp-source-host</a></li>
<li><a href="#alias"><span class="toc-section-number">3.3.1.17</span> alias</a></li>
<li><a href="#smtp-ip"><span class="toc-section-number">3.3.1.18</span> smtp-ip</a></li>
<li><a href="#smtp-port"><span class="toc-section-number">3.3.1.19</span> smtp-port</a></li>
<li><a href="#smtp-listener"><span class="toc-section-number">3.3.1.20</span> smtp-listener</a></li>
<li><a href="#custom-dsn-from-header"><span class="toc-section-number">3.3.1.21</span> custom-dsn-from-header</a></li>
<li><a href="#smtp-await-slot"><span class="toc-section-number">3.3.1.22</span> smtp-await-slot</a></li>
<li><a href="#host-id"><span class="toc-section-number">3.3.1.23</span> host-id</a></li>
<li><a href="#domain-suffix"><span class="toc-section-number">3.3.1.24</span> domain-suffix</a></li>
<li><a href="#host-name"><span class="toc-section-number">3.3.1.25</span> host-name</a></li>
<li><a href="#name-server"><span class="toc-section-number">3.3.1.26</span> name-server</a></li>
<li><a href="#thread-min-priority-thread-max-priority"><span class="toc-section-number">3.3.1.27</span> thread-min-priority, thread-max-priority</a></li>
<li><a href="#thread-reuse"><span class="toc-section-number">3.3.1.28</span> thread-reuse</a></li>
<li><a href="#mailmerge-expands-undefined-variables"><span class="toc-section-number">3.3.1.29</span> mailmerge-expands-undefined-variables</a></li>
<li><a href="#pmc-acct-min-free-space"><span class="toc-section-number">3.3.1.30</span> pmc-acct-min-free-space</a></li>
<li><a href="#include"><span class="toc-section-number">3.3.1.31</span> include</a></li>
<li><a href="#relaying-control-directives"><span class="toc-section-number">3.3.1.32</span> Relaying Control Directives</a><ul>
<li><a href="#always-allow-relaying"><span class="toc-section-number">3.3.1.32.1</span> always-allow-relaying</a></li>
<li><a href="#relay-domain"><span class="toc-section-number">3.3.1.32.2</span> relay-domain</a></li>
<li><a href="#relay-address"><span class="toc-section-number">3.3.1.32.3</span> relay-address</a></li>
<li><a href="#relay-debug"><span class="toc-section-number">3.3.1.32.4</span> relay-debug</a></li>
</ul></li>
<li><a href="#general-queueing-and-delivery-directives"><span class="toc-section-number">3.3.1.33</span> General Queueing and Delivery Directives</a><ul>
<li><a href="#domain-key"><span class="toc-section-number">3.3.1.33.1</span> domain-key</a></li>
<li><a href="#invalid-virtual-mta-fallback"><span class="toc-section-number">3.3.1.33.2</span> invalid-virtual-mta-fallback</a></li>
<li><a href="#include-headers-from"><span class="toc-section-number">3.3.1.33.3</span> include-headers-from</a></li>
<li><a href="#domain-macro"><span class="toc-section-number">3.3.1.33.4</span> domain-macro</a></li>
</ul></li>
<li><a href="#pickup-directives"><span class="toc-section-number">3.3.1.34</span> Pickup Directives</a><ul>
<li><a href="#pickup"><span class="toc-section-number">3.3.1.34.1</span> pickup</a></li>
<li><a href="#pickup-retry-interval"><span class="toc-section-number">3.3.1.34.2</span> pickup-retry-interval</a></li>
<li><a href="#pickup-remove-dot"><span class="toc-section-number">3.3.1.34.3</span> pickup-remove-dot</a></li>
</ul></li>
<li><a href="#dummy-smtp-blackholing-directives"><span class="toc-section-number">3.3.1.35</span> Dummy SMTP ("blackholing") Directives</a><ul>
<li><a href="#dummy-smtp-ip"><span class="toc-section-number">3.3.1.35.1</span> dummy-smtp-ip</a></li>
<li><a href="#dummy-smtp-port"><span class="toc-section-number">3.3.1.35.2</span> dummy-smtp-port</a></li>
<li><a href="#dummy-smtp-await-slot"><span class="toc-section-number">3.3.1.35.3</span> dummy-smtp-await-slot</a></li>
<li><a href="#dummy-smtp-has-chunking"><span class="toc-section-number">3.3.1.35.4</span> dummy-smtp-has-chunking</a></li>
<li><a href="#dummy-smtp-has-pipelining"><span class="toc-section-number">3.3.1.35.5</span> dummy-smtp-has-pipelining</a></li>
<li><a href="#dummy-smtp-has-verp"><span class="toc-section-number">3.3.1.35.6</span> dummy-smtp-has-verp</a></li>
<li><a href="#dummy-smtp-latency"><span class="toc-section-number">3.3.1.35.7</span> dummy-smtp-latency</a></li>
<li><a href="#dummy-smtp-update-stats"><span class="toc-section-number">3.3.1.35.8</span> dummy-smtp-update-stats</a></li>
</ul></li>
<li><a href="#web-based-monitor-directives"><span class="toc-section-number">3.3.1.36</span> Web-Based Monitor Directives</a><ul>
<li><a href="#http-mgmt-port"><span class="toc-section-number">3.3.1.36.1</span> http-mgmt-port</a></li>
<li><a href="#http-redirect-to-https"><span class="toc-section-number">3.3.1.36.2</span> http-redirect-to-https</a></li>
<li><a href="#http-access"><span class="toc-section-number">3.3.1.36.3</span> http-access</a></li>
<li><a href="#http-csrf-protection"><span class="toc-section-number">3.3.1.36.4</span> http-csrf-protection</a></li>
<li><a href="#http-api-key"><span class="toc-section-number">3.3.1.36.5</span> http-api-key</a></li>
<li><a href="#http-strict-transport-security-max-age"><span class="toc-section-number">3.3.1.36.6</span> http-strict-transport-security-max-age</a></li>
<li><a href="#http-mgmt-source--no-http-mgmt-source"><span class="toc-section-number">3.3.1.36.7</span> http-mgmt-source &amp; no-http-mgmt-source</a></li>
<li><a href="#http-tls-allow-sslv3"><span class="toc-section-number">3.3.1.36.8</span> http-tls-allow-sslv3</a></li>
<li><a href="#http-tls-allow-tlsv1"><span class="toc-section-number">3.3.1.36.9</span> http-tls-allow-tlsv1</a></li>
<li><a href="#http-tls-allow-tlsv11"><span class="toc-section-number">3.3.1.36.10</span> http-tls-allow-tlsv1.1</a></li>
<li><a href="#http-tls-allow-tlsv12"><span class="toc-section-number">3.3.1.36.11</span> http-tls-allow-tlsv1.2</a></li>
<li><a href="#http-tls-ciphers"><span class="toc-section-number">3.3.1.36.12</span> http-tls-ciphers</a></li>
<li><a href="#http-tls-ca-file"><span class="toc-section-number">3.3.1.36.13</span> http-tls-ca-file</a></li>
<li><a href="#http-log-tls"><span class="toc-section-number">3.3.1.36.14</span> http-log-tls</a></li>
<li><a href="#http-log-data"><span class="toc-section-number">3.3.1.36.15</span> http-log-data</a></li>
<li><a href="#http-log-requests"><span class="toc-section-number">3.3.1.36.16</span> http-log-requests</a></li>
<li><a href="#http-default-max-items"><span class="toc-section-number">3.3.1.36.17</span> http-default-max-items</a></li>
<li><a href="#http-default-sort-order"><span class="toc-section-number">3.3.1.36.18</span> http-default-sort-order</a></li>
</ul></li>
<li><a href="#logging-directives"><span class="toc-section-number">3.3.1.37</span> Logging Directives</a><ul>
<li><a href="#log-auto-rotation"><span class="toc-section-number">3.3.1.37.1</span> log-auto-rotation</a></li>
<li><a href="#log-file"><span class="toc-section-number">3.3.1.37.2</span> log-file</a></li>
<li><a href="#log-rotate"><span class="toc-section-number">3.3.1.37.3</span> log-rotate</a></li>
<li><a href="#log-file-world-readable"><span class="toc-section-number">3.3.1.37.4</span> log-file-world-readable</a></li>
</ul></li>
<li><a href="#mx-and-ip-connection-limit-directives"><span class="toc-section-number">3.3.1.38</span> MX and IP Connection Limit Directives</a><ul>
<li><a href="#mx-connection-limit"><span class="toc-section-number">3.3.1.38.1</span> mx-connection-limit</a></li>
<li><a href="#ip-connection-limit"><span class="toc-section-number">3.3.1.38.2</span> ip-connection-limit</a></li>
</ul></li>
<li><a href="#use-proxy"><span class="toc-section-number">3.3.1.39</span> use-proxy</a></li>
</ul></li>
<li><a href="#spool-directives"><span class="toc-section-number">3.3.2</span> &lt;spool&gt; Directives</a><ul>
<li><a href="#delete-file-holders"><span class="toc-section-number">3.3.2.1</span> delete-file-holders</a></li>
<li><a href="#deliver-only"><span class="toc-section-number">3.3.2.2</span> deliver-only</a></li>
<li><a href="#priority"><span class="toc-section-number">3.3.2.3</span> priority</a></li>
<li><a href="#min-free-space"><span class="toc-section-number">3.3.2.4</span> min-free-space</a></li>
</ul></li>
<li><a href="#bounce-processor-directives"><span class="toc-section-number">3.3.3</span> &lt;bounce-processor&gt; Directives</a><ul>
<li><a href="#deliver-unmatched-email"><span class="toc-section-number">3.3.3.1</span> deliver-unmatched-email</a></li>
<li><a href="#deliver-matched-email"><span class="toc-section-number">3.3.3.2</span> deliver-matched-email</a></li>
<li><a href="#deliver-email"><span class="toc-section-number">3.3.3.3</span> deliver-email</a></li>
<li><a href="#forward-unmatched-to"><span class="toc-section-number">3.3.3.4</span> forward-unmatched-to</a></li>
<li><a href="#forward-errors-to"><span class="toc-section-number">3.3.3.5</span> forward-errors-to</a></li>
</ul></li>
<li><a href="#feedback-loop-processor-directives"><span class="toc-section-number">3.3.4</span> &lt;feedback-loop-processor&gt; Directives</a><ul>
<li><a href="#deliver-unmatched-email-1"><span class="toc-section-number">3.3.4.1</span> deliver-unmatched-email</a></li>
<li><a href="#deliver-matched-email-1"><span class="toc-section-number">3.3.4.2</span> deliver-matched-email</a></li>
<li><a href="#deliver-email-1"><span class="toc-section-number">3.3.4.3</span> deliver-email</a></li>
<li><a href="#forward-unmatched-to-1"><span class="toc-section-number">3.3.4.4</span> forward-unmatched-to</a></li>
<li><a href="#forward-errors-to-1"><span class="toc-section-number">3.3.4.5</span> forward-errors-to</a></li>
</ul></li>
<li><a href="#address-list-directives"><span class="toc-section-number">3.3.5</span> &lt;address-list&gt; Directives</a><ul>
<li><a href="#address"><span class="toc-section-number">3.3.5.1</span> address</a></li>
<li><a href="#address-file"><span class="toc-section-number">3.3.5.2</span> address-file</a></li>
<li><a href="#domain"><span class="toc-section-number">3.3.5.3</span> domain</a></li>
</ul></li>
<li><a href="#email-patterns-directives"><span class="toc-section-number">3.3.6</span> &lt;email-patterns&gt; Directives</a><ul>
<li><a href="#body-pattern-file"><span class="toc-section-number">3.3.6.1</span> body-pattern-file</a></li>
<li><a href="#log-match-info"><span class="toc-section-number">3.3.6.2</span> log-match-info</a></li>
</ul></li>
<li><a href="#source-directives"><span class="toc-section-number">3.3.7</span> &lt;source&gt; Directives</a><ul>
<li><a href="#add-date-header"><span class="toc-section-number">3.3.7.1</span> add-date-header</a></li>
<li><a href="#date-header-time"><span class="toc-section-number">3.3.7.2</span> date-header-time</a></li>
<li><a href="#bcc"><span class="toc-section-number">3.3.7.3</span> bcc</a></li>
<li><a href="#add-message-id-header"><span class="toc-section-number">3.3.7.4</span> add-message-id-header</a></li>
<li><a href="#add-received-header"><span class="toc-section-number">3.3.7.5</span> add-received-header</a></li>
<li><a href="#allow-auth"><span class="toc-section-number">3.3.7.6</span> allow-auth</a></li>
<li><a href="#smtp-max-auth-failure-rate"><span class="toc-section-number">3.3.7.7</span> smtp-max-auth-failure-rate</a></li>
<li><a href="#remove-header"><span class="toc-section-number">3.3.7.8</span> remove-header</a></li>
<li><a href="#require-auth"><span class="toc-section-number">3.3.7.9</span> require-auth</a></li>
<li><a href="#allow-mailmerge"><span class="toc-section-number">3.3.7.10</span> allow-mailmerge</a></li>
<li><a href="#allow-unencrypted-plain-auth"><span class="toc-section-number">3.3.7.11</span> allow-unencrypted-plain-auth</a></li>
<li><a href="#allow-starttls"><span class="toc-section-number">3.3.7.12</span> allow-starttls</a></li>
<li><a href="#require-starttls-before-auth"><span class="toc-section-number">3.3.7.13</span> require-starttls-before-auth</a></li>
<li><a href="#broken-auth-clients"><span class="toc-section-number">3.3.7.14</span> broken-auth-clients</a></li>
<li><a href="#verp-default"><span class="toc-section-number">3.3.7.15</span> verp-default</a></li>
<li><a href="#check-dkim-inbound"><span class="toc-section-number">3.3.7.16</span> check-dkim-inbound</a></li>
<li><a href="#trace-dkim-check"><span class="toc-section-number">3.3.7.17</span> trace-dkim-check</a></li>
<li><a href="#trace-spf-check"><span class="toc-section-number">3.3.7.18</span> trace-spf-check</a></li>
<li><a href="#check-spf-inbound"><span class="toc-section-number">3.3.7.19</span> check-spf-inbound</a></li>
<li><a href="#check-spf-inbound-best-guess"><span class="toc-section-number">3.3.7.20</span> check-spf-inbound-best-guess</a></li>
<li><a href="#check-spf-inbound-max-void-lookups"><span class="toc-section-number">3.3.7.21</span> check-spf-inbound-max-void-lookups</a></li>
<li><a href="#check-iprev-inbound"><span class="toc-section-number">3.3.7.22</span> check-iprev-inbound</a></li>
<li><a href="#trace-iprev-check"><span class="toc-section-number">3.3.7.23</span> trace-iprev-check</a></li>
<li><a href="#reject-iprev-check-temperror"><span class="toc-section-number">3.3.7.24</span> reject-iprev-check-temperror</a></li>
<li><a href="#reject-iprev-check-permerror"><span class="toc-section-number">3.3.7.25</span> reject-iprev-check-permerror</a></li>
<li><a href="#reject-iprev-check-fail"><span class="toc-section-number">3.3.7.26</span> reject-iprev-check-fail</a></li>
<li><a href="#suppress-local-dsn"><span class="toc-section-number">3.3.7.27</span> suppress-local-dsn</a></li>
<li><a href="#dsn-return-default"><span class="toc-section-number">3.3.7.28</span> dsn-return-default</a></li>
<li><a href="#default-virtual-mta"><span class="toc-section-number">3.3.7.29</span> default-virtual-mta</a></li>
<li><a href="#log-tls"><span class="toc-section-number">3.3.7.30</span> log-tls</a></li>
<li><a href="#reject-invalid-virtual-mta"><span class="toc-section-number">3.3.7.31</span> reject-invalid-virtual-mta</a></li>
<li><a href="#disconnect-on-transient-error"><span class="toc-section-number">3.3.7.32</span> disconnect-on-transient-error</a></li>
<li><a href="#hide-message-source"><span class="toc-section-number">3.3.7.33</span> hide-message-source</a></li>
<li><a href="#max-message-size"><span class="toc-section-number">3.3.7.34</span> max-message-size</a></li>
<li><a href="#max-message-hops"><span class="toc-section-number">3.3.7.35</span> max-message-hops</a></li>
<li><a href="#max-rcpt-per-message"><span class="toc-section-number">3.3.7.36</span> max-rcpt-per-message</a></li>
<li><a href="#too-many-rcpts-fails-message"><span class="toc-section-number">3.3.7.37</span> too-many-rcpts-fails-message</a></li>
<li><a href="#suppression-lists"><span class="toc-section-number">3.3.7.38</span> suppression-lists</a></li>
<li><a href="#pattern-list"><span class="toc-section-number">3.3.7.39</span> pattern-list</a></li>
<li><a href="#process-x-envid"><span class="toc-section-number">3.3.7.40</span> process-x-envid</a></li>
<li><a href="#process-x-dkim-options"><span class="toc-section-number">3.3.7.41</span> process-x-dkim-options</a></li>
<li><a href="#process-x-dkim-key"><span class="toc-section-number">3.3.7.42</span> process-x-dkim-key</a></li>
<li><a href="#retain-x-dkim-key"><span class="toc-section-number">3.3.7.43</span> retain-x-dkim-key</a></li>
<li><a href="#jobid-prefix"><span class="toc-section-number">3.3.7.44</span> jobid-prefix</a></li>
<li><a href="#process-x-job"><span class="toc-section-number">3.3.7.45</span> process-x-job</a></li>
<li><a href="#jobid-header"><span class="toc-section-number">3.3.7.46</span> jobid-header</a></li>
<li><a href="#retain-x-job"><span class="toc-section-number">3.3.7.47</span> retain-x-job</a></li>
<li><a href="#process-x-virtual-mta"><span class="toc-section-number">3.3.7.48</span> process-x-virtual-mta</a></li>
<li><a href="#retain-x-virtual-mta"><span class="toc-section-number">3.3.7.49</span> retain-x-virtual-mta</a></li>
<li><a href="#add-x-virtual-mta-header"><span class="toc-section-number">3.3.7.50</span> add-x-virtual-mta-header</a></li>
<li><a href="#source-group"><span class="toc-section-number">3.3.7.51</span> source-group</a></li>
<li><a href="#smtp-data-timeout"><span class="toc-section-number">3.3.7.52</span> smtp-data-timeout</a></li>
<li><a href="#smtp-command-timeout"><span class="toc-section-number">3.3.7.53</span> smtp-command-timeout</a></li>
<li><a href="#process-x-schedule"><span class="toc-section-number">3.3.7.54</span> process-x-schedule</a></li>
<li><a href="#retain-x-schedule"><span class="toc-section-number">3.3.7.55</span> retain-x-schedule</a></li>
<li><a href="#retain-x-dkim-options"><span class="toc-section-number">3.3.7.56</span> retain-x-dkim-options</a></li>
<li><a href="#allow-chunking"><span class="toc-section-number">3.3.7.57</span> allow-chunking</a></li>
<li><a href="#allow-smtputf8"><span class="toc-section-number">3.3.7.58</span> allow-smtputf8</a></li>
<li><a href="#smtp-service"><span class="toc-section-number">3.3.7.59</span> smtp-service</a></li>
<li><a href="#log-connections"><span class="toc-section-number">3.3.7.60</span> log-connections</a></li>
<li><a href="#log-commands"><span class="toc-section-number">3.3.7.61</span> log-commands</a></li>
<li><a href="#log-data"><span class="toc-section-number">3.3.7.62</span> log-data</a></li>
<li><a href="#allow-empty-x-virtual-mta"><span class="toc-section-number">3.3.7.63</span> allow-empty-x-virtual-mta</a></li>
<li><a href="#accept-invalid-recipients"><span class="toc-section-number">3.3.7.64</span> accept-invalid-recipients</a></li>
<li><a href="#reject-spf-check-temperror"><span class="toc-section-number">3.3.7.65</span> reject-spf-check-temperror</a></li>
<li><a href="#reject-spf-check-permerror"><span class="toc-section-number">3.3.7.66</span> reject-spf-check-permerror</a></li>
<li><a href="#reject-spf-check-fail"><span class="toc-section-number">3.3.7.67</span> reject-spf-check-fail</a></li>
<li><a href="#always-allow-api-submission"><span class="toc-section-number">3.3.7.68</span> always-allow-api-submission</a></li>
<li><a href="#auto-qualify-domain"><span class="toc-section-number">3.3.7.69</span> auto-qualify-domain</a></li>
<li><a href="#include-1"><span class="toc-section-number">3.3.7.70</span> include</a></li>
</ul></li>
<li><a href="#smtp-user-directives"><span class="toc-section-number">3.3.8</span> &lt;smtp-user&gt; Directives</a><ul>
<li><a href="#password"><span class="toc-section-number">3.3.8.1</span> password</a></li>
<li><a href="#authentication-method"><span class="toc-section-number">3.3.8.2</span> authentication-method</a></li>
<li><a href="#tls-certificate"><span class="toc-section-number">3.3.8.3</span> tls-certificate</a></li>
<li><a href="#source"><span class="toc-section-number">3.3.8.4</span> source</a></li>
</ul></li>
<li><a href="#source-group-directives"><span class="toc-section-number">3.3.9</span> &lt;source-group&gt; Directives</a><ul>
<li><a href="#max-smtp-in"><span class="toc-section-number">3.3.9.1</span> max-smtp-in</a></li>
<li><a href="#reserved-smtp-in"><span class="toc-section-number">3.3.9.2</span> reserved-smtp-in</a></li>
</ul></li>
<li><a href="#domain-directives"><span class="toc-section-number">3.3.10</span> &lt;domain&gt; Directives</a><ul>
<li><a href="#max-errors-per-connection"><span class="toc-section-number">3.3.10.1</span> max-errors-per-connection</a></li>
<li><a href="#check-spf-outbound"><span class="toc-section-number">3.3.10.2</span> check-spf-outbound</a></li>
<li><a href="#dsn-format"><span class="toc-section-number">3.3.10.3</span> dsn-format</a></li>
<li><a href="#log-resolution"><span class="toc-section-number">3.3.10.4</span> log-resolution</a></li>
<li><a href="#log-transfer-failures"><span class="toc-section-number">3.3.10.5</span> log-transfer-failures</a></li>
<li><a href="#log-resolution-1"><span class="toc-section-number">3.3.10.6</span> log-resolution</a></li>
<li><a href="#log-disabled-ips"><span class="toc-section-number">3.3.10.7</span> log-disabled-ips</a></li>
<li><a href="#max-events-recorded"><span class="toc-section-number">3.3.10.8</span> max-events-recorded</a></li>
<li><a href="#disable-acct-records"><span class="toc-section-number">3.3.10.9</span> disable-acct-records</a></li>
<li><a href="#deliver-local-dsn"><span class="toc-section-number">3.3.10.10</span> deliver-local-dsn</a></li>
<li><a href="#bounce-after"><span class="toc-section-number">3.3.10.11</span> bounce-after</a></li>
<li><a href="#bcc-upon-delivery"><span class="toc-section-number">3.3.10.12</span> bcc-upon-delivery</a></li>
<li><a href="#allow-priority-interruption"><span class="toc-section-number">3.3.10.13</span> allow-priority-interruption</a></li>
<li><a href="#allow-priority-interruption-during-transfer"><span class="toc-section-number">3.3.10.14</span> allow-priority-interruption-during-transfer</a></li>
<li><a href="#queue-priority"><span class="toc-section-number">3.3.10.15</span> queue-priority</a></li>
<li><a href="#track-recipient-events"><span class="toc-section-number">3.3.10.16</span> track-recipient-events</a></li>
<li><a href="#delivery-priority"><span class="toc-section-number">3.3.10.17</span> delivery-priority</a></li>
<li><a href="#notify-of-delay-every"><span class="toc-section-number">3.3.10.18</span> notify-of-delay-every</a></li>
<li><a href="#dkim-sign"><span class="toc-section-number">3.3.10.19</span> dkim-sign</a></li>
<li><a href="#dkim-add-body-limit"><span class="toc-section-number">3.3.10.20</span> dkim-add-body-limit</a></li>
<li><a href="#dkim-add-timestamp"><span class="toc-section-number">3.3.10.21</span> dkim-add-timestamp</a></li>
<li><a href="#dkim-algorithm"><span class="toc-section-number">3.3.10.22</span> dkim-algorithm</a></li>
<li><a href="#dkim-body-canon"><span class="toc-section-number">3.3.10.23</span> dkim-body-canon</a></li>
<li><a href="#dkim-headers-canon"><span class="toc-section-number">3.3.10.24</span> dkim-headers-canon</a></li>
<li><a href="#dkim-expire-after"><span class="toc-section-number">3.3.10.25</span> dkim-expire-after</a></li>
<li><a href="#dkim-query-method"><span class="toc-section-number">3.3.10.26</span> dkim-query-method</a></li>
<li><a href="#dkim-headers"><span class="toc-section-number">3.3.10.27</span> dkim-headers</a></li>
<li><a href="#dkim-identity"><span class="toc-section-number">3.3.10.28</span> dkim-identity</a></li>
<li><a href="#dkim-identity-fallback"><span class="toc-section-number">3.3.10.29</span> dkim-identity-fallback</a></li>
<li><a href="#dkim-disallow-adding-headers"><span class="toc-section-number">3.3.10.30</span> dkim-disallow-adding-headers</a></li>
<li><a href="#queue-to"><span class="toc-section-number">3.3.10.31</span> queue-to</a></li>
<li><a href="#source-ip-max-msg-rate"><span class="toc-section-number">3.3.10.32</span> source-ip-max-msg-rate</a></li>
<li><a href="#max-msg-rate"><span class="toc-section-number">3.3.10.33</span> max-msg-rate</a></li>
<li><a href="#backoff-max-msg-rate"><span class="toc-section-number">3.3.10.34</span> backoff-max-msg-rate</a></li>
<li><a href="#max-msg-per-hour"><span class="toc-section-number">3.3.10.35</span> max-msg-per-hour</a></li>
<li><a href="#backoff-max-msg-per-hour"><span class="toc-section-number">3.3.10.36</span> backoff-max-msg-per-hour</a></li>
<li><a href="#max-data-volume-rate"><span class="toc-section-number">3.3.10.37</span> max-data-volume-rate</a></li>
<li><a href="#backoff-max-data-volume-rate"><span class="toc-section-number">3.3.10.38</span> backoff-max-data-volume-rate</a></li>
<li><a href="#retry-after"><span class="toc-section-number">3.3.10.39</span> retry-after</a></li>
<li><a href="#backoff-retry-after"><span class="toc-section-number">3.3.10.40</span> backoff-retry-after</a></li>
<li><a href="#retry-recipients-after"><span class="toc-section-number">3.3.10.41</span> retry-recipients-after</a></li>
<li><a href="#backoff-notify"><span class="toc-section-number">3.3.10.42</span> backoff-notify</a></li>
<li><a href="#disabled-source-ip-notify"><span class="toc-section-number">3.3.10.43</span> disabled-source-ip-notify</a></li>
<li><a href="#backoff-to-normal-after"><span class="toc-section-number">3.3.10.44</span> backoff-to-normal-after</a></li>
<li><a href="#backoff-to-normal-after-delivery"><span class="toc-section-number">3.3.10.45</span> backoff-to-normal-after-delivery</a></li>
<li><a href="#backoff-upon-all-sources-disabled"><span class="toc-section-number">3.3.10.46</span> backoff-upon-all-sources-disabled</a></li>
<li><a href="#reenable-source-ip-after"><span class="toc-section-number">3.3.10.47</span> reenable-source-ip-after</a></li>
<li><a href="#max-cold-virtual-mta-msg"><span class="toc-section-number">3.3.10.48</span> max-cold-virtual-mta-msg</a></li>
<li><a href="#reroute-to-virtual-mta"><span class="toc-section-number">3.3.10.49</span> reroute-to-virtual-mta</a></li>
<li><a href="#backoff-reroute-to-virtual-mta"><span class="toc-section-number">3.3.10.50</span> backoff-reroute-to-virtual-mta</a></li>
<li><a href="#type"><span class="toc-section-number">3.3.10.51</span> type</a></li>
<li><a href="#allow-cancel-during-transfer"><span class="toc-section-number">3.3.10.52</span> allow-cancel-during-transfer</a></li>
<li><a href="#auth-username"><span class="toc-section-number">3.3.10.53</span> auth-username</a></li>
<li><a href="#smtp-data-termination-timeout"><span class="toc-section-number">3.3.10.54</span> smtp-data-termination-timeout</a></li>
<li><a href="#auth-password"><span class="toc-section-number">3.3.10.55</span> auth-password</a></li>
<li><a href="#use-unencrypted-plain-auth"><span class="toc-section-number">3.3.10.56</span> use-unencrypted-plain-auth</a></li>
<li><a href="#smtp-553-means-invalid-mailbox"><span class="toc-section-number">3.3.10.57</span> smtp-553-means-invalid-mailbox</a></li>
<li><a href="#smtp-421-means-mx-unavailable"><span class="toc-section-number">3.3.10.58</span> smtp-421-means-mx-unavailable</a></li>
<li><a href="#replace-smtp-421-service-response"><span class="toc-section-number">3.3.10.59</span> replace-smtp-421-service-response</a></li>
<li><a href="#bounce-upon-no-mx"><span class="toc-section-number">3.3.10.60</span> bounce-upon-no-mx</a></li>
<li><a href="#bounce-upon-5xx-greeting"><span class="toc-section-number">3.3.10.61</span> bounce-upon-5xx-greeting</a></li>
<li><a href="#bounce-upon-pix-transfer-failure"><span class="toc-section-number">3.3.10.62</span> bounce-upon-pix-transfer-failure</a></li>
<li><a href="#bounce-upon-transfer-failure"><span class="toc-section-number">3.3.10.63</span> bounce-upon-transfer-failure</a></li>
<li><a href="#connect-timeout"><span class="toc-section-number">3.3.10.64</span> connect-timeout</a></li>
<li><a href="#smtp-greeting-timeout"><span class="toc-section-number">3.3.10.65</span> smtp-greeting-timeout</a></li>
<li><a href="#data-send-timeout"><span class="toc-section-number">3.3.10.66</span> data-send-timeout</a></li>
<li><a href="#ignore-8bitmime"><span class="toc-section-number">3.3.10.67</span> ignore-8bitmime</a></li>
<li><a href="#ignore-chunking"><span class="toc-section-number">3.3.10.68</span> ignore-chunking</a></li>
<li><a href="#ignore-pipelining"><span class="toc-section-number">3.3.10.69</span> ignore-pipelining</a></li>
<li><a href="#ignore-dsn"><span class="toc-section-number">3.3.10.70</span> ignore-dsn</a></li>
<li><a href="#max-msg-per-connection"><span class="toc-section-number">3.3.10.71</span> max-msg-per-connection</a></li>
<li><a href="#max-rcpt-per-transaction"><span class="toc-section-number">3.3.10.72</span> max-rcpt-per-transaction</a></li>
<li><a href="#max-rcpt-per-message-1"><span class="toc-section-number">3.3.10.73</span> max-rcpt-per-message</a></li>
<li><a href="#max-smtp-out"><span class="toc-section-number">3.3.10.74</span> max-smtp-out</a></li>
<li><a href="#backoff-max-smtp-out"><span class="toc-section-number">3.3.10.75</span> backoff-max-smtp-out</a></li>
<li><a href="#max-smtp-out-per-source-ip"><span class="toc-section-number">3.3.10.76</span> max-smtp-out-per-source-ip</a></li>
<li><a href="#source-ip-max-smtp-out"><span class="toc-section-number">3.3.10.77</span> source-ip-max-smtp-out</a></li>
<li><a href="#smtp-out-rampup-interval"><span class="toc-section-number">3.3.10.78</span> smtp-out-rampup-interval</a></li>
<li><a href="#max-connect-rate"><span class="toc-section-number">3.3.10.79</span> max-connect-rate</a></li>
<li><a href="#source-ip-max-connect-rate"><span class="toc-section-number">3.3.10.80</span> source-ip-max-connect-rate</a></li>
<li><a href="#connection-idle-timeout"><span class="toc-section-number">3.3.10.81</span> connection-idle-timeout</a></li>
<li><a href="#source-ip-max-msg-rate-1"><span class="toc-section-number">3.3.10.82</span> source-ip-max-msg-rate</a></li>
<li><a href="#source-ip-max-data-volume-rate"><span class="toc-section-number">3.3.10.83</span> source-ip-max-data-volume-rate</a></li>
<li><a href="#backoff-max-connect-rate"><span class="toc-section-number">3.3.10.84</span> backoff-max-connect-rate</a></li>
<li><a href="#retry-upon-new-mail"><span class="toc-section-number">3.3.10.85</span> retry-upon-new-mail</a></li>
<li><a href="#pix-bug-workaround"><span class="toc-section-number">3.3.10.86</span> pix-bug-workaround</a></li>
<li><a href="#route"><span class="toc-section-number">3.3.10.87</span> route</a></li>
<li><a href="#default-smtp-port"><span class="toc-section-number">3.3.10.88</span> default-smtp-port</a></li>
<li><a href="#smtp-hosts"><span class="toc-section-number">3.3.10.89</span> smtp-hosts</a></li>
<li><a href="#smtp-pattern-list"><span class="toc-section-number">3.3.10.90</span> smtp-pattern-list</a></li>
<li><a href="#assume-delivery-upon-data-termination-timeout"><span class="toc-section-number">3.3.10.91</span> assume-delivery-upon-data-termination-timeout</a></li>
<li><a href="#disable-mx-rollup"><span class="toc-section-number">3.3.10.92</span> disable-mx-rollup</a></li>
<li><a href="#include-2"><span class="toc-section-number">3.3.10.93</span> include</a></li>
<li><a href="#ssltls-directives"><span class="toc-section-number">3.3.10.94</span> SSL/TLS Directives</a><ul>
<li><a href="#use-starttls"><span class="toc-section-number">3.3.10.94.1</span> use-starttls</a></li>
<li><a href="#require-starttls"><span class="toc-section-number">3.3.10.94.2</span> require-starttls</a></li>
<li><a href="#use-dane"><span class="toc-section-number">3.3.10.94.3</span> use-dane</a></li>
<li><a href="#reuse-ssl-session"><span class="toc-section-number">3.3.10.94.4</span> reuse-ssl-session</a></li>
<li><a href="#smtp-tls-allow-tlsv1"><span class="toc-section-number">3.3.10.94.5</span> smtp-tls-allow-tlsv1</a></li>
<li><a href="#smtp-tls-allow-tlsv11"><span class="toc-section-number">3.3.10.94.6</span> smtp-tls-allow-tlsv1.1</a></li>
<li><a href="#smtp-tls-allow-tlsv12"><span class="toc-section-number">3.3.10.94.7</span> smtp-tls-allow-tlsv1.2</a></li>
<li><a href="#smtp-tls-allow-sslv3"><span class="toc-section-number">3.3.10.94.8</span> smtp-tls-allow-sslv3</a></li>
<li><a href="#smtp-tls-ca-file-directive"><span class="toc-section-number">3.3.10.94.9</span> smtp-tls-ca-file directive</a></li>
<li><a href="#smtp-tls-ciphers"><span class="toc-section-number">3.3.10.94.10</span> smtp-tls-ciphers</a></li>
<li><a href="#log-tls-1"><span class="toc-section-number">3.3.10.94.11</span> log-tls</a></li>
</ul></li>
<li><a href="#discard-delivery-directives"><span class="toc-section-number">3.3.10.95</span> Discard Delivery Directives</a><ul>
<li><a href="#discard-as-bounce"><span class="toc-section-number">3.3.10.95.1</span> discard-as-bounce</a></li>
</ul></li>
<li><a href="#file-delivery-directives"><span class="toc-section-number">3.3.10.96</span> File Delivery Directives</a><ul>
<li><a href="#file-format"><span class="toc-section-number">3.3.10.96.1</span> file-format</a></li>
<li><a href="#file-destination"><span class="toc-section-number">3.3.10.96.2</span> file-destination</a></li>
</ul></li>
<li><a href="#pipe-delivery-directives"><span class="toc-section-number">3.3.10.97</span> Pipe Delivery Directives</a><ul>
<li><a href="#command"><span class="toc-section-number">3.3.10.97.1</span> command</a></li>
<li><a href="#macro-variables-preserve-case"><span class="toc-section-number">3.3.10.97.2</span> macro-variables-preserve-case</a></li>
</ul></li>
<li><a href="#http-delivery-directives"><span class="toc-section-number">3.3.10.98</span> HTTP Delivery Directives</a><ul>
<li><a href="#http-delivery-url"><span class="toc-section-number">3.3.10.98.1</span> http-delivery-url</a></li>
<li><a href="#http-delivery-extra-headers"><span class="toc-section-number">3.3.10.98.2</span> http-delivery-extra-headers</a></li>
</ul></li>
<li><a href="#sparkpost-traffic-redirection-support"><span class="toc-section-number">3.3.10.99</span> SparkPost Traffic Redirection Support</a><ul>
<li><a href="#add-x-msys-api-header"><span class="toc-section-number">3.3.10.99.1</span> add-x-msys-api-header</a></li>
<li><a href="#sparkpost-sandbox"><span class="toc-section-number">3.3.10.99.2</span> sparkpost-sandbox</a></li>
<li><a href="#sparkpost-ip-pool"><span class="toc-section-number">3.3.10.99.3</span> sparkpost-ip-pool</a></li>
</ul></li>
</ul></li>
<li><a href="#acct-file-directives"><span class="toc-section-number">3.3.11</span> &lt;acct-file&gt; Directives</a><ul>
<li><a href="#delete-after"><span class="toc-section-number">3.3.11.1</span> delete-after</a></li>
<li><a href="#move-to"><span class="toc-section-number">3.3.11.2</span> move-to</a></li>
<li><a href="#move-interval"><span class="toc-section-number">3.3.11.3</span> move-interval</a></li>
<li><a href="#max-size"><span class="toc-section-number">3.3.11.4</span> max-size</a></li>
<li><a href="#queue-filter"><span class="toc-section-number">3.3.11.5</span> queue-filter</a></li>
<li><a href="#retry-interval"><span class="toc-section-number">3.3.11.6</span> retry-interval</a></li>
<li><a href="#iso-times"><span class="toc-section-number">3.3.11.7</span> iso-times</a></li>
<li><a href="#user-string"><span class="toc-section-number">3.3.11.8</span> user-string</a></li>
<li><a href="#write-timeout"><span class="toc-section-number">3.3.11.9</span> write-timeout</a></li>
<li><a href="#map-header-to-field"><span class="toc-section-number">3.3.11.10</span> map-header-to-field</a></li>
<li><a href="#records"><span class="toc-section-number">3.3.11.11</span> records</a></li>
<li><a href="#record-fields"><span class="toc-section-number">3.3.11.12</span> record-fields</a></li>
<li><a href="#world-readable"><span class="toc-section-number">3.3.11.13</span> world-readable</a></li>
<li><a href="#count-moved-records"><span class="toc-section-number">3.3.11.14</span> count-moved-records</a></li>
<li><a href="#sync"><span class="toc-section-number">3.3.11.15</span> sync</a></li>
<li><a href="#privacy-policy"><span class="toc-section-number">3.3.11.16</span> privacy-policy</a></li>
</ul></li>
<li><a href="#virtual-mta-directives"><span class="toc-section-number">3.3.12</span> &lt;virtual-mta&gt; Directives</a><ul>
<li><a href="#use-proxy-1"><span class="toc-section-number">3.3.12.1</span> use-proxy</a></li>
<li><a href="#max-smtp-msg-rate"><span class="toc-section-number">3.3.12.2</span> max-smtp-msg-rate</a></li>
<li><a href="#max-smtp-data-volume-rate"><span class="toc-section-number">3.3.12.3</span> max-smtp-data-volume-rate</a></li>
<li><a href="#cold-virtual-mta"><span class="toc-section-number">3.3.12.4</span> cold-virtual-mta</a></li>
<li><a href="#host-name-1"><span class="toc-section-number">3.3.12.5</span> host-name</a></li>
<li><a href="#domain-key-1"><span class="toc-section-number">3.3.12.6</span> domain-key</a></li>
<li><a href="#include-headers-from-1"><span class="toc-section-number">3.3.12.7</span> include-headers-from</a></li>
<li><a href="#max-smtp-out-1"><span class="toc-section-number">3.3.12.8</span> max-smtp-out</a></li>
<li><a href="#rewrite-list"><span class="toc-section-number">3.3.12.9</span> rewrite-list</a></li>
<li><a href="#include-3"><span class="toc-section-number">3.3.12.10</span> include</a></li>
</ul></li>
<li><a href="#virtual-mta-pool-directives"><span class="toc-section-number">3.3.13</span> &lt;virtual-mta-pool&gt; Directives</a><ul>
<li><a href="#virtual-mta"><span class="toc-section-number">3.3.13.1</span> virtual-mta</a></li>
<li><a href="#domain-1"><span class="toc-section-number">3.3.13.2</span> domain</a></li>
<li><a href="#domain-key-2"><span class="toc-section-number">3.3.13.3</span> domain-key</a></li>
<li><a href="#include-headers-from-2"><span class="toc-section-number">3.3.13.4</span> include-headers-from</a></li>
<li><a href="#max-smtp-msg-rate-1"><span class="toc-section-number">3.3.13.5</span> max-smtp-msg-rate</a></li>
<li><a href="#max-smtp-out-2"><span class="toc-section-number">3.3.13.6</span> max-smtp-out</a></li>
<li><a href="#rewrite-list-1"><span class="toc-section-number">3.3.13.7</span> rewrite-list</a></li>
<li><a href="#max-smtp-data-volume-rate-1"><span class="toc-section-number">3.3.13.8</span> max-smtp-data-volume-rate</a></li>
</ul></li>
<li><a href="#pattern-list-directives"><span class="toc-section-number">3.3.14</span> &lt;pattern-list&gt; Directives</a><ul>
<li><a href="#header"><span class="toc-section-number">3.3.14.1</span> header</a></li>
<li><a href="#mail-from"><span class="toc-section-number">3.3.14.2</span> mail-from</a></li>
<li><a href="#rcpt-to"><span class="toc-section-number">3.3.14.3</span> rcpt-to</a></li>
<li><a href="#nested-pattern-list-support"><span class="toc-section-number">3.3.14.4</span> Nested pattern-list support</a></li>
</ul></li>
<li><a href="#smtp-pattern-list-directives"><span class="toc-section-number">3.3.15</span> &lt;smtp-pattern-list&gt; Directives</a><ul>
<li><a href="#include-4"><span class="toc-section-number">3.3.15.1</span> include</a></li>
</ul></li>
<li><a href="#dns-directives"><span class="toc-section-number">3.3.16</span> &lt;dns&gt; Directives</a><ul>
<li><a href="#precached-domains-file"><span class="toc-section-number">3.3.16.1</span> precached-domains-file</a></li>
<li><a href="#precached-refresh-interval"><span class="toc-section-number">3.3.16.2</span> precached-refresh-interval</a></li>
<li><a href="#precached-max-domains"><span class="toc-section-number">3.3.16.3</span> precached-max-domains</a></li>
</ul></li>
<li><a href="#smtp-listener-directives"><span class="toc-section-number">3.3.17</span> &lt;smtp-listener&gt; Directives</a><ul>
<li><a href="#await-slot"><span class="toc-section-number">3.3.17.1</span> await-slot</a></li>
<li><a href="#immediate-tls"><span class="toc-section-number">3.3.17.2</span> immediate-tls</a></li>
<li><a href="#source-1"><span class="toc-section-number">3.3.17.3</span> source</a></li>
<li><a href="#tls-certificate-1"><span class="toc-section-number">3.3.17.4</span> tls-certificate</a></li>
<li><a href="#tls-allow-tlsv12"><span class="toc-section-number">3.3.17.5</span> tls-allow-tlsv1.2</a></li>
<li><a href="#tls-allow-tlsv11"><span class="toc-section-number">3.3.17.6</span> tls-allow-tlsv1.1</a></li>
<li><a href="#tls-allow-tlsv1"><span class="toc-section-number">3.3.17.7</span> tls-allow-tlsv1</a></li>
<li><a href="#tls-allow-sslv3"><span class="toc-section-number">3.3.17.8</span> tls-allow-sslv3</a></li>
<li><a href="#tls-ciphers"><span class="toc-section-number">3.3.17.9</span> tls-ciphers</a></li>
<li><a href="#tls-ca-file"><span class="toc-section-number">3.3.17.10</span> tls-ca-file</a></li>
</ul></li>
<li><a href="#rewrite-list-directives"><span class="toc-section-number">3.3.18</span> &lt;rewrite-list&gt; Directives</a><ul>
<li><a href="#mail-from-1"><span class="toc-section-number">3.3.18.1</span> mail-from</a></li>
<li><a href="#from-domain"><span class="toc-section-number">3.3.18.2</span> from-domain</a></li>
</ul></li>
<li><a href="#domain-key-list-directives"><span class="toc-section-number">3.3.19</span> &lt;domain-key-list&gt; Directives</a><ul>
<li><a href="#domain-key-3"><span class="toc-section-number">3.3.19.1</span> domain-key</a></li>
</ul></li>
<li><a href="#transmissions-api-directives"><span class="toc-section-number">3.3.20</span> &lt;transmissions-api&gt; Directives</a><ul>
<li><a href="#log-requests"><span class="toc-section-number">3.3.20.1</span> log-requests</a><ul>
<li><a href="#api-key"><span class="toc-section-number">3.3.20.1.1</span> api-key</a></li>
<li><a href="#log-data-1"><span class="toc-section-number">3.3.20.1.2</span> log-data</a></li>
<li><a href="#log-tls-2"><span class="toc-section-number">3.3.20.1.3</span> log-tls</a></li>
</ul></li>
</ul></li>
<li><a href="#transmissions-api-listener-directives"><span class="toc-section-number">3.3.21</span> &lt;transmissions-api-listener&gt; Directives</a><ul>
<li><a href="#tls-certificate-2"><span class="toc-section-number">3.3.21.1</span> tls-certificate</a></li>
<li><a href="#tls-allow-tlsv12-1"><span class="toc-section-number">3.3.21.2</span> tls-allow-tlsv1.2</a></li>
<li><a href="#tls-allow-tlsv11-1"><span class="toc-section-number">3.3.21.3</span> tls-allow-tlsv1.1</a></li>
<li><a href="#tls-allow-tlsv1-1"><span class="toc-section-number">3.3.21.4</span> tls-allow-tlsv1</a></li>
<li><a href="#tls-allow-sslv3-1"><span class="toc-section-number">3.3.21.5</span> tls-allow-sslv3</a></li>
<li><a href="#tls-ciphers-1"><span class="toc-section-number">3.3.21.6</span> tls-ciphers</a></li>
<li><a href="#tls-ca-file-1"><span class="toc-section-number">3.3.21.7</span> tls-ca-file</a></li>
</ul></li>
</ul></li>
</ul></li>
<li><a href="#powermta-management"><span class="toc-section-number">4</span> PowerMTA Management</a><ul>
<li><a href="#management"><span class="toc-section-number">4.1</span> Management</a><ul>
<li><a href="#monitoring"><span class="toc-section-number">4.1.1</span> Monitoring</a></li>
<li><a href="#logging-and-accounting"><span class="toc-section-number">4.1.2</span> Logging and Accounting</a></li>
<li><a href="#powermta-startup-and-shutdown"><span class="toc-section-number">4.1.3</span> PowerMTA Startup and Shutdown</a></li>
</ul></li>
<li><a href="#troubleshooting"><span class="toc-section-number">4.2</span> Troubleshooting</a><ul>
<li><a href="#troubleshooting-startup-problems"><span class="toc-section-number">4.2.1</span> Troubleshooting Startup Problems</a></li>
<li><a href="#troubleshooting-email-delivery-problems"><span class="toc-section-number">4.2.2</span> Troubleshooting Email Delivery Problems</a></li>
<li><a href="#troubleshooting-dns-name-resolution-problems"><span class="toc-section-number">4.2.3</span> Troubleshooting DNS Name Resolution Problems</a></li>
<li><a href="#troubleshooting-email-receptionsmtp-feeding-problems"><span class="toc-section-number">4.2.4</span> Troubleshooting Email Reception/SMTP Feeding Problems</a></li>
<li><a href="#in-case-of-a-crash"><span class="toc-section-number">4.2.5</span> In Case of a Crash</a></li>
<li><a href="#if-all-else-fails"><span class="toc-section-number">4.2.6</span> If All Else Fails</a></li>
</ul></li>
</ul></li>
<li><a href="#web-based-monitoring"><span class="toc-section-number">5</span> Web-Based Monitoring</a><ul>
<li><a href="#overview"><span class="toc-section-number">5.1</span> Overview</a></li>
<li><a href="#home-display"><span class="toc-section-number">5.2</span> Home Display</a></li>
<li><a href="#status-monitor-display"><span class="toc-section-number">5.3</span> Status Monitor Display</a></li>
<li><a href="#queues-display"><span class="toc-section-number">5.4</span> Queues Display</a></li>
<li><a href="#queues-view-options"><span class="toc-section-number">5.5</span> Queues View Options</a></li>
<li><a href="#domains-display"><span class="toc-section-number">5.6</span> Domains Display</a></li>
<li><a href="#domains-view-options"><span class="toc-section-number">5.7</span> Domains View Options</a></li>
<li><a href="#configuration-page"><span class="toc-section-number">5.8</span> Configuration Page</a></li>
<li><a href="#license-page"><span class="toc-section-number">5.9</span> License Page</a></li>
<li><a href="#common-last-errors"><span class="toc-section-number">5.10</span> Common "Last Error"s</a></li>
<li><a href="#virtualmtas-display"><span class="toc-section-number">5.11</span> VirtualMTAs Display</a></li>
<li><a href="#jobs-display"><span class="toc-section-number">5.12</span> Jobs Display</a></li>
<li><a href="#logs-display"><span class="toc-section-number">5.13</span> Logs Display</a></li>
<li><a href="#listing-of-local-ips"><span class="toc-section-number">5.14</span> Listing of local IPs</a></li>
<li><a href="#listing-of-emails-in-queue"><span class="toc-section-number">5.15</span> Listing of emails in queue</a></li>
</ul></li>
<li><a href="#command-line-tool"><span class="toc-section-number">6</span> Command Line Tool</a><ul>
<li><a href="#overview-1"><span class="toc-section-number">6.1</span> Overview</a></li>
<li><a href="#command-output-formats"><span class="toc-section-number">6.2</span> Command Output Formats</a><ul>
<li><a href="#sample-command-outputs"><span class="toc-section-number">6.2.1</span> Sample Command Outputs</a></li>
</ul></li>
<li><a href="#command-reference"><span class="toc-section-number">6.3</span> Command Reference</a><ul>
<li><a href="#clear-dnscache"><span class="toc-section-number">6.3.1</span> <code>clear dnscache</code></a></li>
<li><a href="#check-mfrom"><span class="toc-section-number">6.3.2</span> <code>check mfrom</code></a></li>
<li><a href="#check-spf"><span class="toc-section-number">6.3.3</span> <code>check spf</code></a></li>
<li><a href="#reload"><span class="toc-section-number">6.3.4</span> <code>reload</code></a></li>
<li><a href="#reset-counters"><span class="toc-section-number">6.3.5</span> <code>reset counters</code></a></li>
<li><a href="#reset-status"><span class="toc-section-number">6.3.6</span> <code>reset status</code></a></li>
<li><a href="#resolve"><span class="toc-section-number">6.3.7</span> <code>resolve</code></a></li>
<li><a href="#rotate-acct"><span class="toc-section-number">6.3.8</span> <code>rotate acct</code></a></li>
<li><a href="#rotate-log"><span class="toc-section-number">6.3.9</span> <code>rotate log</code></a></li>
<li><a href="#schedule"><span class="toc-section-number">6.3.10</span> <code>schedule</code></a></li>
<li><a href="#set-queue"><span class="toc-section-number">6.3.11</span> <code>set queue</code></a></li>
<li><a href="#show-domains"><span class="toc-section-number">6.3.12</span> <code>show domains</code></a></li>
<li><a href="#show-queues"><span class="toc-section-number">6.3.13</span> <code>show queues</code></a></li>
<li><a href="#show-jobs"><span class="toc-section-number">6.3.14</span> <code>show jobs</code></a></li>
<li><a href="#show-settings"><span class="toc-section-number">6.3.15</span> <code>show settings</code></a></li>
<li><a href="#show-status"><span class="toc-section-number">6.3.16</span> <code>show status</code></a></li>
<li><a href="#show-topdomains"><span class="toc-section-number">6.3.17</span> <code>show topdomains</code></a></li>
<li><a href="#show-topqueues"><span class="toc-section-number">6.3.18</span> <code>show topqueues</code></a></li>
<li><a href="#show-version"><span class="toc-section-number">6.3.19</span> <code>show version</code></a></li>
<li><a href="#show-vmtas"><span class="toc-section-number">6.3.20</span> <code>show vmtas</code></a></li>
<li><a href="#trace"><span class="toc-section-number">6.3.21</span> <code>trace</code></a></li>
<li><a href="#delete"><span class="toc-section-number">6.3.22</span> <code>delete</code></a></li>
<li><a href="#pause-queue"><span class="toc-section-number">6.3.23</span> <code>pause queue</code></a></li>
<li><a href="#pause-job"><span class="toc-section-number">6.3.24</span> <code>pause job</code></a></li>
<li><a href="#resume-queue"><span class="toc-section-number">6.3.25</span> <code>resume queue</code></a></li>
<li><a href="#resume-job"><span class="toc-section-number">6.3.26</span> <code>resume job</code></a></li>
<li><a href="#list"><span class="toc-section-number">6.3.27</span> <code>list</code></a></li>
<li><a href="#show-license"><span class="toc-section-number">6.3.28</span> <code>show license</code></a></li>
<li><a href="#deregister"><span class="toc-section-number">6.3.29</span> <code>deregister</code></a></li>
<li><a href="#digest"><span class="toc-section-number">6.3.30</span> <code>digest</code></a></li>
<li><a href="#register"><span class="toc-section-number">6.3.31</span> <code>register</code></a></li>
<li><a href="#show-registration"><span class="toc-section-number">6.3.32</span> <code>show registration</code></a></li>
<li><a href="#disable-source"><span class="toc-section-number">6.3.33</span> <code>disable source</code></a></li>
<li><a href="#enable-source"><span class="toc-section-number">6.3.34</span> <code>enable source</code></a></li>
<li><a href="#show-disabled-sources"><span class="toc-section-number">6.3.35</span> <code>show disabled sources</code></a></li>
<li><a href="#show-precache"><span class="toc-section-number">6.3.36</span> <code>show precache</code></a></li>
<li><a href="#set-priority"><span class="toc-section-number">6.3.37</span> <code>set priority</code></a></li>
<li><a href="#test-config"><span class="toc-section-number">6.3.38</span> <code>test config</code></a></li>
</ul></li>
</ul></li>
<li><a href="#application-programming-interfaces"><span class="toc-section-number">7</span> Application Programming Interfaces</a><ul>
<li><a href="#submission-apis"><span class="toc-section-number">7.1</span> Submission APIs</a><ul>
<li><a href="#requirements"><span class="toc-section-number">7.1.1</span> Requirements</a></li>
<li><a href="#perl-submission-api"><span class="toc-section-number">7.1.2</span> Perl Submission API</a></li>
<li><a href="#java-submission-api"><span class="toc-section-number">7.1.3</span> Java Submission API</a></li>
<li><a href="#c-submission-api"><span class="toc-section-number">7.1.4</span> C++ Submission API</a><ul>
<li><a href="#connectionconnection"><span class="toc-section-number">7.1.4.1</span> Connection::Connection</a></li>
<li><a href="#connectionsubmit"><span class="toc-section-number">7.1.4.2</span> Connection::submit</a></li>
<li><a href="#messagemessage"><span class="toc-section-number">7.1.4.3</span> Message::Message</a></li>
<li><a href="#messagesetverp"><span class="toc-section-number">7.1.4.4</span> Message::setVerp</a></li>
<li><a href="#messagesetreturntype"><span class="toc-section-number">7.1.4.5</span> Message::setReturnType</a></li>
<li><a href="#messagesetenvelopeid"><span class="toc-section-number">7.1.4.6</span> Message::setEnvelopeId</a></li>
<li><a href="#messagesetvirtualmta"><span class="toc-section-number">7.1.4.7</span> Message::setVirtualMta</a></li>
<li><a href="#messagesetjobid"><span class="toc-section-number">7.1.4.8</span> Message::setJobId</a></li>
<li><a href="#messageaddrecipient"><span class="toc-section-number">7.1.4.9</span> Message::addRecipient</a></li>
<li><a href="#messagesetencoding"><span class="toc-section-number">7.1.4.10</span> Message::setEncoding</a></li>
<li><a href="#messagebeginpart"><span class="toc-section-number">7.1.4.11</span> Message::beginPart</a></li>
<li><a href="#messageadddata"><span class="toc-section-number">7.1.4.12</span> Message::addData</a></li>
<li><a href="#messageadddata-1"><span class="toc-section-number">7.1.4.13</span> Message::addData</a></li>
<li><a href="#messageaddmergedata"><span class="toc-section-number">7.1.4.14</span> Message::addMergeData</a></li>
<li><a href="#messageaddmergedata-1"><span class="toc-section-number">7.1.4.15</span> Message::addMergeData</a></li>
<li><a href="#messageadddateheader"><span class="toc-section-number">7.1.4.16</span> Message::addDateHeader</a></li>
<li><a href="#recipientrecipient"><span class="toc-section-number">7.1.4.17</span> Recipient::Recipient</a></li>
<li><a href="#recipientsetnotify"><span class="toc-section-number">7.1.4.18</span> Recipient::setNotify</a></li>
<li><a href="#recipientdefinevariable"><span class="toc-section-number">7.1.4.19</span> Recipient::defineVariable</a></li>
</ul></li>
<li><a href="#c-submission-api-1"><span class="toc-section-number">7.1.5</span> C Submission API</a><ul>
<li><a href="#pmtaconnalloc"><span class="toc-section-number">7.1.5.1</span> PmtaConnAlloc</a></li>
<li><a href="#pmtaconnconnect"><span class="toc-section-number">7.1.5.2</span> PmtaConnConnect</a></li>
<li><a href="#pmtaconnconnectremote"><span class="toc-section-number">7.1.5.3</span> PmtaConnConnectRemote</a></li>
<li><a href="#pmtaconnconnectremoteauth"><span class="toc-section-number">7.1.5.4</span> PmtaConnConnectRemoteAuth</a></li>
<li><a href="#pmtaconnsubmit"><span class="toc-section-number">7.1.5.5</span> PmtaConnSubmit</a></li>
<li><a href="#pmtaconnfree"><span class="toc-section-number">7.1.5.6</span> PmtaConnFree</a></li>
<li><a href="#pmtaconngetlasterror"><span class="toc-section-number">7.1.5.7</span> PmtaConnGetLastError</a></li>
<li><a href="#pmtaconngetlasterrortype"><span class="toc-section-number">7.1.5.8</span> PmtaConnGetLastErrorType</a></li>
<li><a href="#pmtamsgalloc"><span class="toc-section-number">7.1.5.9</span> PmtaMsgAlloc</a></li>
<li><a href="#pmtamsginit"><span class="toc-section-number">7.1.5.10</span> PmtaMsgInit</a></li>
<li><a href="#pmtamsgfree"><span class="toc-section-number">7.1.5.11</span> PmtaMsgFree</a></li>
<li><a href="#pmtamsgsetverp"><span class="toc-section-number">7.1.5.12</span> PmtaMsgSetVerp</a></li>
<li><a href="#pmtamsgsetreturntype"><span class="toc-section-number">7.1.5.13</span> PmtaMsgSetReturnType</a></li>
<li><a href="#pmtamsgsetenvelopeid"><span class="toc-section-number">7.1.5.14</span> PmtaMsgSetEnvelopeId</a></li>
<li><a href="#pmtamsgsetvirtualmta"><span class="toc-section-number">7.1.5.15</span> PmtaMsgSetVirtualMta</a></li>
<li><a href="#pmtamsgsetjobid"><span class="toc-section-number">7.1.5.16</span> PmtaMsgSetJobId</a></li>
<li><a href="#pmtamsgaddrecipient"><span class="toc-section-number">7.1.5.17</span> PmtaMsgAddRecipient</a></li>
<li><a href="#pmtamsgsetencoding"><span class="toc-section-number">7.1.5.18</span> PmtaMsgSetEncoding</a></li>
<li><a href="#pmtamsgbeginpart"><span class="toc-section-number">7.1.5.19</span> PmtaMsgBeginPart</a></li>
<li><a href="#pmtamsgadddata"><span class="toc-section-number">7.1.5.20</span> PmtaMsgAddData</a></li>
<li><a href="#pmtamsgaddmergedata"><span class="toc-section-number">7.1.5.21</span> PmtaMsgAddMergeData</a></li>
<li><a href="#pmtamsgaddstring"><span class="toc-section-number">7.1.5.22</span> PmtaMsgAddString</a></li>
<li><a href="#pmtamsgaddmergestring"><span class="toc-section-number">7.1.5.23</span> PmtaMsgAddMergeString</a></li>
<li><a href="#pmtamsgadddateheader"><span class="toc-section-number">7.1.5.24</span> PmtaMsgAddDateHeader</a></li>
<li><a href="#pmtamsggetlasterror"><span class="toc-section-number">7.1.5.25</span> PmtaMsgGetLastError</a></li>
<li><a href="#pmtamsggetlasterrortype"><span class="toc-section-number">7.1.5.26</span> PmtaMsgGetLastErrorType</a></li>
<li><a href="#pmtarcptalloc"><span class="toc-section-number">7.1.5.27</span> PmtaRcptAlloc</a></li>
<li><a href="#pmtarcptinit"><span class="toc-section-number">7.1.5.28</span> PmtaRcptInit</a></li>
<li><a href="#pmtarcptfree"><span class="toc-section-number">7.1.5.29</span> PmtaRcptFree</a></li>
<li><a href="#pmtarcptsetnotify"><span class="toc-section-number">7.1.5.30</span> PmtaRcptSetNotify</a></li>
<li><a href="#pmtarcptdefinevariable"><span class="toc-section-number">7.1.5.31</span> PmtaRcptDefineVariable</a></li>
<li><a href="#pmtarcptgetlasterror"><span class="toc-section-number">7.1.5.32</span> PmtaRcptGetLastError</a></li>
<li><a href="#pmtarcptgetlasterrortype"><span class="toc-section-number">7.1.5.33</span> PmtaRcptGetLastErrorType</a></li>
</ul></li>
<li><a href="#net-submission-api"><span class="toc-section-number">7.1.6</span> .NET Submission API</a></li>
</ul></li>
<li><a href="#pickup-directory"><span class="toc-section-number">7.2</span> Pickup Directory</a><ul>
<li><a href="#bsmtp-files"><span class="toc-section-number">7.2.1</span> BSMTP files</a></li>
</ul></li>
<li><a href="#pipe-delivery"><span class="toc-section-number">7.3</span> Pipe Delivery</a><ul>
<li><a href="#delivering-mail-to-local-users"><span class="toc-section-number">7.3.1</span> Delivering mail to local users</a></li>
<li><a href="#pipe-delivery-programs-included-with-powermta"><span class="toc-section-number">7.3.2</span> Pipe Delivery Programs Included With PowerMTA</a></li>
<li><a href="#accessing-files-created-by-the-sample-applications"><span class="toc-section-number">7.3.3</span> Accessing Files Created By The Sample Applications</a></li>
<li><a href="#writing-your-own-pipe-delivery-programs"><span class="toc-section-number">7.3.4</span> Writing Your Own Pipe Delivery Programs</a></li>
</ul></li>
</ul></li>
<li><a href="#virtualmta-support"><span class="toc-section-number">8</span> VirtualMTA Support</a><ul>
<li><a href="#overview-2"><span class="toc-section-number">8.1</span> Overview</a></li>
<li><a href="#virtualmta-definitions"><span class="toc-section-number">8.2</span> VirtualMTA Definitions</a></li>
<li><a href="#virtualmta-pools"><span class="toc-section-number">8.3</span> VirtualMTA Pools</a></li>
<li><a href="#selecting-a-virtualmta-or-virtualmta-pool"><span class="toc-section-number">8.4</span> Selecting a VirtualMTA or VirtualMTA Pool</a><ul>
<li><a href="#selecting-a-virtualmta-with-a-x-virtual-mta-header"><span class="toc-section-number">8.4.1</span> Selecting a VirtualMTA with a X-virtual-MTA Header</a></li>
<li><a href="#selecting-a-virtualmta-by-regular-expression-matching"><span class="toc-section-number">8.4.2</span> Selecting a VirtualMTA by Regular Expression Matching</a></li>
<li><a href="#selecting-a-virtualmta-by-the-ip-addressport-receiving-connections"><span class="toc-section-number">8.4.3</span> Selecting a VirtualMTA by the IP Address/Port Receiving Connections</a></li>
<li><a href="#selecting-a-virtualmta-by-the-source-ip-address"><span class="toc-section-number">8.4.4</span> Selecting a VirtualMTA by the Source IP Address</a></li>
<li><a href="#selecting-a-virtualmta-by-a-virtualmta-ip-address"><span class="toc-section-number">8.4.5</span> Selecting a VirtualMTA by a VirtualMTA IP address</a></li>
</ul></li>
<li><a href="#changing-virtualmtas-on-the-fly"><span class="toc-section-number">8.5</span> Changing VirtualMTAs on the Fly</a><ul>
<li><a href="#changing-a-virtualmta"><span class="toc-section-number">8.5.1</span> Changing a VirtualMTA</a></li>
<li><a href="#canceling-a-virtualmta"><span class="toc-section-number">8.5.2</span> Canceling a VirtualMTA</a></li>
</ul></li>
</ul></li>
<li><a href="#mailmerge-support"><span class="toc-section-number">9</span> Mailmerge Support</a><ul>
<li><a href="#overview-3"><span class="toc-section-number">9.1</span> Overview</a></li>
<li><a href="#benefits"><span class="toc-section-number">9.2</span> Benefits</a></li>
<li><a href="#configuration-requirements"><span class="toc-section-number">9.3</span> Configuration Requirements</a></li>
<li><a href="#creating-mailmerge-messages"><span class="toc-section-number">9.4</span> Creating Mailmerge Messages</a><ul>
<li><a href="#message-template-and-mailmerge-variables"><span class="toc-section-number">9.4.1</span> Message Template and Mailmerge Variables</a></li>
<li><a href="#reserved-variables"><span class="toc-section-number">9.4.2</span> Reserved Variables</a></li>
<li><a href="#merge-parts"><span class="toc-section-number">9.4.3</span> Merge Parts</a></li>
</ul></li>
<li><a href="#submitting-mailmerge-messages"><span class="toc-section-number">9.5</span> Submitting Mailmerge Messages</a><ul>
<li><a href="#api-submission"><span class="toc-section-number">9.5.1</span> API Submission</a></li>
<li><a href="#mailmerge-smtp-extensions"><span class="toc-section-number">9.5.2</span> Mailmerge SMTP extensions</a><ul>
<li><a href="#xmrg"><span class="toc-section-number">9.5.2.1</span> XMRG</a></li>
<li><a href="#xdfn"><span class="toc-section-number">9.5.2.2</span> XDFN</a></li>
<li><a href="#xprt"><span class="toc-section-number">9.5.2.3</span> XPRT</a></li>
</ul></li>
<li><a href="#pickup-directory-submission"><span class="toc-section-number">9.5.3</span> Pickup Directory Submission</a></li>
<li><a href="#the-xack-smtp-extension"><span class="toc-section-number">9.5.4</span> The XACK SMTP extension</a></li>
</ul></li>
</ul></li>
<li><a href="#advanced-features"><span class="toc-section-number">10</span> Advanced Features</a><ul>
<li><a href="#sparkpost-signals"><span class="toc-section-number">10.1</span> SparkPost Signals</a><ul>
<li><a href="#optional-data-loading-support"><span class="toc-section-number">10.1.1</span> Optional Data Loading Support</a></li>
<li><a href="#sparkpost-subaccounts"><span class="toc-section-number">10.1.2</span> SparkPost Subaccounts</a></li>
<li><a href="#sample-use-cases-for-optional-loading-of-signals-data"><span class="toc-section-number">10.1.3</span> Sample Use Cases for Optional Loading of Signals Data</a><ul>
<li><a href="#use-case-1-disable-signals-completely"><span class="toc-section-number">10.1.3.1</span> Use Case #1. Disable Signals completely.</a></li>
<li><a href="#use-case-2-use-signals-to-track-every-email-delivered-out-of-powermta"><span class="toc-section-number">10.1.3.2</span> Use Case #2. Use Signals to track every email delivered out of PowerMTA.</a></li>
<li><a href="#use-case-3-dedicated-vmtas-per-message-stream"><span class="toc-section-number">10.1.3.3</span> Use Case #3. Dedicated VMTAs per message stream.</a></li>
<li><a href="#use-case-4-dedicated-vmtas-per-message-stream-with-subaccounts"><span class="toc-section-number">10.1.3.4</span> Use Case #4. Dedicated VMTAs per message stream, with subaccounts.</a></li>
<li><a href="#use-case-5-use-of-vmta-pools"><span class="toc-section-number">10.1.3.5</span> Use Case #5. Use of VMTA pools.</a></li>
<li><a href="#use-case-6-use-of-shared-vmtas"><span class="toc-section-number">10.1.3.6</span> Use Case #6. Use of shared VMTAs.</a></li>
<li><a href="#use-case-7-use-of-shared-vmtas-wildcard-support"><span class="toc-section-number">10.1.3.7</span> Use Case #7: Use of shared VMTAs (wildcard support)</a></li>
<li><a href="#use-case-8-global-level-configuration"><span class="toc-section-number">10.1.3.8</span> Use Case #8: Global level configuration.</a></li>
<li><a href="#use-case-9-global-level-configuration-example-2"><span class="toc-section-number">10.1.3.9</span> Use Case #9: Global level configuration, example #2.</a></li>
</ul></li>
<li><a href="#configuration-directives-1"><span class="toc-section-number">10.1.4</span> Configuration Directives</a><ul>
<li><a href="#global-directives-1"><span class="toc-section-number">10.1.4.1</span> Global Directives</a><ul>
<li><a href="#enable-signals"><span class="toc-section-number">10.1.4.1.1</span> enable-signals</a></li>
</ul></li>
<li><a href="#signals-directives"><span class="toc-section-number">10.1.4.2</span> &lt;signals&gt; Directives</a><ul>
<li><a href="#api-key-1"><span class="toc-section-number">10.1.4.2.1</span> api-key</a></li>
<li><a href="#upload-url"><span class="toc-section-number">10.1.4.2.2</span> upload-url</a></li>
<li><a href="#engagement-tracking"><span class="toc-section-number">10.1.4.2.3</span> engagement-tracking</a></li>
<li><a href="#custom-message-id-header"><span class="toc-section-number">10.1.4.2.4</span> custom-message-id-header</a></li>
<li><a href="#process-x-sp-subaccount-id"><span class="toc-section-number">10.1.4.2.5</span> process-x-sp-subaccount-id</a></li>
<li><a href="#retain-x-sp-subaccount-id"><span class="toc-section-number">10.1.4.2.6</span> retain-x-sp-subaccount-id</a></li>
<li><a href="#log-verbose"><span class="toc-section-number">10.1.4.2.7</span> log-verbose</a></li>
<li><a href="#min-free-space-1"><span class="toc-section-number">10.1.4.2.8</span> min-free-space</a></li>
<li><a href="#privacy-policy-1"><span class="toc-section-number">10.1.4.2.9</span> privacy-policy</a></li>
</ul></li>
<li><a href="#signals-filter-directives"><span class="toc-section-number">10.1.4.3</span> &lt;signals-filter&gt; Directives</a><ul>
<li><a href="#sender-or-from"><span class="toc-section-number">10.1.4.3.1</span> sender-or-from</a></li>
</ul></li>
</ul></li>
<li><a href="#summary-report-display"><span class="toc-section-number">10.1.5</span> Summary Report Display</a></li>
<li><a href="#bounce-report-display"><span class="toc-section-number">10.1.6</span> Bounce Report Display</a></li>
<li><a href="#signals-overview-display"><span class="toc-section-number">10.1.7</span> Signals Overview Display</a></li>
<li><a href="#spam-traps-display"><span class="toc-section-number">10.1.8</span> Spam Traps Display</a></li>
</ul></li>
<li><a href="#haproxy-protocol-for-outbound-traffic"><span class="toc-section-number">10.2</span> HAProxy Protocol for outbound traffic</a><ul>
<li><a href="#directives"><span class="toc-section-number">10.2.1</span> Directives</a><ul>
<li><a href="#proxy"><span class="toc-section-number">10.2.1.1</span> proxy</a><ul>
<li><a href="#server"><span class="toc-section-number">10.2.1.1.1</span> server</a></li>
<li><a href="#client"><span class="toc-section-number">10.2.1.1.2</span> client</a></li>
</ul></li>
</ul></li>
</ul></li>
<li><a href="#sender-reputation-monitoring"><span class="toc-section-number">10.3</span> Sender Reputation Monitoring</a><ul>
<li><a href="#overview-4"><span class="toc-section-number">10.3.1</span> Overview</a></li>
<li><a href="#implementation"><span class="toc-section-number">10.3.2</span> Implementation</a></li>
<li><a href="#supporting-commands"><span class="toc-section-number">10.3.3</span> Supporting commands</a></li>
</ul></li>
<li><a href="#smtp-auth-support"><span class="toc-section-number">10.4</span> SMTP AUTH support</a><ul>
<li><a href="#overview-5"><span class="toc-section-number">10.4.1</span> Overview</a></li>
<li><a href="#implementation-for-inbound-connections"><span class="toc-section-number">10.4.2</span> Implementation for Inbound Connections</a></li>
<li><a href="#implementation-for-outbound-connections"><span class="toc-section-number">10.4.3</span> Implementation for Outbound Connections</a></li>
</ul></li>
<li><a href="#automated-authentication"><span class="toc-section-number">10.5</span> Automated Authentication</a></li>
<li><a href="#dkim-support"><span class="toc-section-number">10.6</span> DKIM support</a><ul>
<li><a href="#overview-6"><span class="toc-section-number">10.6.1</span> Overview</a></li>
<li><a href="#powermta-dkim-implementation"><span class="toc-section-number">10.6.2</span> PowerMTA DKIM Implementation</a></li>
<li><a href="#passing-dkim-signing-options-in-a-header"><span class="toc-section-number">10.6.3</span> Passing DKIM signing options in a header</a></li>
<li><a href="#second-dkim-signing-support"><span class="toc-section-number">10.6.4</span> Second DKIM signing support</a></li>
<li><a href="#ability-to-dkim-sign-with-the-private-key-given-in-the-message"><span class="toc-section-number">10.6.5</span> Ability to DKIM sign with the private key given in the message</a></li>
</ul></li>
<li><a href="#warming-of-ips-with-cold-virtualmta"><span class="toc-section-number">10.7</span> Warming of IPs with Cold VirtualMTA</a><ul>
<li><a href="#overview-7"><span class="toc-section-number">10.7.1</span> Overview</a></li>
</ul></li>
<li><a href="#use-of-bounce-category-patterns"><span class="toc-section-number">10.8</span> Use of Bounce Category Patterns</a><ul>
<li><a href="#overview-8"><span class="toc-section-number">10.8.1</span> Overview</a></li>
</ul></li>
<li><a href="#combining-several-domains-into-one-queue"><span class="toc-section-number">10.9</span> Combining several domains into one queue</a><ul>
<li><a href="#overview-9"><span class="toc-section-number">10.9.1</span> Overview</a></li>
</ul></li>
<li><a href="#setting-recipient-priority"><span class="toc-section-number">10.10</span> Setting recipient priority</a><ul>
<li><a href="#overview-10"><span class="toc-section-number">10.10.1</span> Overview</a></li>
</ul></li>
<li><a href="#snmp-support"><span class="toc-section-number">10.11</span> SNMP Support</a><ul>
<li><a href="#overview-11"><span class="toc-section-number">10.11.1</span> Overview</a></li>
</ul></li>
<li><a href="#high-availability-configuration"><span class="toc-section-number">10.12</span> High Availability Configuration</a></li>
<li><a href="#precached-domains-support"><span class="toc-section-number">10.13</span> Precached domains support</a></li>
<li><a href="#scheduled-delivery-control"><span class="toc-section-number">10.14</span> Scheduled Delivery Control</a></li>
<li><a href="#custom-retry-intervals"><span class="toc-section-number">10.15</span> Custom retry intervals</a></li>
<li><a href="#address-suppression-lists"><span class="toc-section-number">10.16</span> Address Suppression Lists</a></li>
<li><a href="#mx-rollup-list"><span class="toc-section-number">10.17</span> MX Rollup List</a></li>
<li><a href="#recipient-events"><span class="toc-section-number">10.18</span> Recipient Events</a></li>
<li><a href="#http-transmissions-api"><span class="toc-section-number">10.19</span> HTTP Transmissions API</a><ul>
<li><a href="#setup"><span class="toc-section-number">10.19.1</span> Setup</a></li>
<li><a href="#creating-a-certificate"><span class="toc-section-number">10.19.2</span> Creating a certificate</a></li>
<li><a href="#api-keys"><span class="toc-section-number">10.19.3</span> API Keys</a></li>
<li><a href="#submitting-messages-to-pmta-using-the-transmissions-api"><span class="toc-section-number">10.19.4</span> Submitting messages to PMTA using the Transmissions API</a></li>
<li><a href="#responses"><span class="toc-section-number">10.19.5</span> Responses</a></li>
<li><a href="#errors"><span class="toc-section-number">10.19.6</span> Errors</a></li>
<li><a href="#list-of-http-errors-returned-by-the-api"><span class="toc-section-number">10.19.7</span> List of HTTP errors returned by the API</a></li>
</ul></li>
<li><a href="#http-delivery-webhooks"><span class="toc-section-number">10.20</span> HTTP Delivery Webhooks.</a><ul>
<li><a href="#example-configuration"><span class="toc-section-number">10.20.1</span> Example Configuration</a></li>
<li><a href="#delivery-request-format"><span class="toc-section-number">10.20.2</span> Delivery request format</a></li>
<li><a href="#sample-http-delivery-webhook"><span class="toc-section-number">10.20.3</span> Sample HTTP Delivery Webhook</a></li>
</ul></li>
<li><a href="#dane"><span class="toc-section-number">10.21</span> DANE</a></li>
</ul></li>
<li><a href="#accounting-files-and-statistics"><span class="toc-section-number">11</span> Accounting Files and Statistics</a><ul>
<li><a href="#introduction-1"><span class="toc-section-number">11.1</span> Introduction</a></li>
<li><a href="#the-accounting-file"><span class="toc-section-number">11.2</span> The Accounting File</a><ul>
<li><a href="#accounting-records"><span class="toc-section-number">11.2.1</span> Accounting records</a></li>
<li><a href="#successful-delivered-records"><span class="toc-section-number">11.2.2</span> "Successful delivered" Records</a></li>
<li><a href="#bounced-records"><span class="toc-section-number">11.2.3</span> Bounced Records</a></li>
<li><a href="#transient-error-records"><span class="toc-section-number">11.2.4</span> Transient error Records</a></li>
<li><a href="#transient-queue-records"><span class="toc-section-number">11.2.5</span> Transient Queue Records</a></li>
<li><a href="#received-records"><span class="toc-section-number">11.2.6</span> Received Records</a></li>
<li><a href="#remote-bounce--remote-status-records"><span class="toc-section-number">11.2.7</span> Remote Bounce &amp; Remote Status Records</a></li>
<li><a href="#feedback-loop-records"><span class="toc-section-number">11.2.8</span> Feedback Loop Records</a></li>
<li><a href="#encoding"><span class="toc-section-number">11.2.9</span> Encoding</a></li>
</ul></li>
<li><a href="#configuring-the-accounting-file"><span class="toc-section-number">11.3</span> Configuring the accounting file</a><ul>
<li><a href="#examples"><span class="toc-section-number">11.3.1</span> Examples</a></li>
</ul></li>
<li><a href="#the-pmtastats-accounting-statistics-application"><span class="toc-section-number">11.4</span> The <code>pmtastats</code> Accounting Statistics Application</a><ul>
<li><a href="#pmtastats-options"><span class="toc-section-number">11.4.1</span> <code>pmtastats</code> Options</a></li>
<li><a href="#pmtastats-report-breakdown"><span class="toc-section-number">11.4.2</span> <code>pmtastats</code> Report Breakdown</a><ul>
<li><a href="#time-frame"><span class="toc-section-number">11.4.2.1</span> Time Frame</a></li>
<li><a href="#bounce-categories"><span class="toc-section-number">11.4.2.2</span> Bounce Categories</a></li>
<li><a href="#delivery-times"><span class="toc-section-number">11.4.2.3</span> Delivery Times</a></li>
<li><a href="#message-counts"><span class="toc-section-number">11.4.2.4</span> Message Counts</a></li>
<li><a href="#top-bounce"><span class="toc-section-number">11.4.2.5</span> Top Bounce</a></li>
<li><a href="#top-domains"><span class="toc-section-number">11.4.2.6</span> Top Domains</a></li>
<li><a href="#top-rates"><span class="toc-section-number">11.4.2.7</span> Top Rates</a></li>
<li><a href="#vmta-summary"><span class="toc-section-number">11.4.2.8</span> VMTA Summary</a></li>
<li><a href="#vmta-time-breakdown"><span class="toc-section-number">11.4.2.9</span> VMTA Time Breakdown</a></li>
<li><a href="#vmta-top-bounces"><span class="toc-section-number">11.4.2.10</span> VMTA Top Bounces</a></li>
</ul></li>
</ul></li>
<li><a href="#the-acctfind-accounting-reporting-application"><span class="toc-section-number">11.5</span> The <code>acctfind</code> Accounting Reporting Application</a><ul>
<li><a href="#examples-1"><span class="toc-section-number">11.5.1</span> Examples</a></li>
</ul></li>
<li><a href="#bounce-categories-1"><span class="toc-section-number">11.6</span> Bounce Categories</a></li>
</ul></li>
<li><a href="#processing-inbound-email"><span class="toc-section-number">12</span> Processing Inbound email</a><ul>
<li><a href="#introduction-2"><span class="toc-section-number">12.1</span> Introduction</a></li>
<li><a href="#relaying"><span class="toc-section-number">12.2</span> Relaying</a></li>
<li><a href="#deliver-to-file"><span class="toc-section-number">12.3</span> Deliver to File</a></li>
<li><a href="#discarding"><span class="toc-section-number">12.4</span> Discarding</a></li>
<li><a href="#delivering-to-local-application-pipe"><span class="toc-section-number">12.5</span> Delivering to local application (pipe)</a></li>
<li><a href="#processing-asynchronous-remote-bounces-and-remote-status-reports"><span class="toc-section-number">12.6</span> Processing Asynchronous (Remote) Bounces and remote status reports</a></li>
<li><a href="#processing-feedback-loop-emails"><span class="toc-section-number">12.7</span> Processing Feedback Loop Emails</a><ul>
<li><a href="#hotmail-feedback-loop-emails"><span class="toc-section-number">12.7.1</span> Hotmail Feedback Loop Emails</a></li>
</ul></li>
<li><a href="#tracking-a-campaign-in-powermta-with-a-jobid"><span class="toc-section-number">12.8</span> Tracking a campaign in PowerMTA with a JobID</a></li>
<li><a href="#aliases--forwarding"><span class="toc-section-number">12.9</span> Aliases / Forwarding</a></li>
<li><a href="#handling-non-standard-dsnfbl-reports"><span class="toc-section-number">12.10</span> Handling non-standard DSN/FBL reports</a></li>
</ul></li>
<li><a href="#acknowledgments"><span class="toc-section-number">13</span> Acknowledgments</a></li>
<li><a href="#directives-index"><span class="toc-section-number">14</span> Directives index</a></li>
</ul>
</nav>
</div>

<div style="margin-left:25%; padding: 8px;">
<p><img src="media/PowerMTALogo.png" /></p>
<p><strong>SparkPost, Inc.</strong></p>
<p><strong>PowerMTA v5.0</strong></p>
<p><strong>User's Guide</strong></p>
<p>Copyright  1999-2019, Port25 Solutions, Inc. All Rights Reserved. PowerMTA is a trademark of Port25 Solutions, Inc. All other brands and names are property of their respective owners.</p>
<h1 id="introduction"><span class="header-section-number">1</span> Introduction</h1>
<h2 id="general-description-and-basic-functionality"><span class="header-section-number">1.1</span> General Description and Basic Functionality</h2>
<p>PowerMTA is specialized, high performance Message Transfer Agent (MTA) software that intelligently and efficiently delivers large volumes of email, allowing for maximum delivery and response. While all-purpose MTAs in use today perform a whole variety of tasks including delivering email, these general solutions fall short both in regards to scalability and relevant feature sets, negatively affecting delivery rates and subsequent ROI. In contrast, PowerMTA was developed for this particular task, helping legitimate, permission based email marketers, publishers, and service providers overcome the business and technology challenges of email message delivery.</p>
<p>PowerMTA's basic functionality consists of receiving inbound or outbound messages via either standard email protocols (SMTP) or programming interfaces, routing them based on either name services (DNS) or pre-configured information and delivering them using SMTP or locally to a program.</p>
<h2 id="minimum-requirements"><span class="header-section-number">1.2</span> Minimum Requirements</h2>
<p>PowerMTA currently runs on:</p>
<ul>
<li><p>Microsoft Windows 2008/2012/2016/2019 on Intel and compatible processors</p></li>
<li><p>Red Hat Enterprise Linux 6.0 or later on Intel and compatible processors (32 and 64 bit)</p></li>
<li><p>Debian based Linux on Intel and compatible processors (32 and 64 bit)</p></li>
</ul>
<p>Prerequisites:</p>
<ul>
<li><p>a name server (DNS), not necessarily on the same host,</p></li>
<li><p>a static IP address and a domain name,</p></li>
<li><p>a license activation key (LAK) from SparkPost support,</p></li>
<li><p>minimum hardware requirements, depending on the size of the workload and mail queues, and the desired throughput rate.</p></li>
<li><p>NTP (Network Time Protocol)  Clock must be synced to internet time server</p></li>
</ul>
<p>Contact SparkPost if you need hardware recommendations for your specific workload and throughput requirements.</p>
<h2 id="supported-interfaces"><span class="header-section-number">1.3</span> Supported interfaces</h2>
<p>PowerMTA supports the following submission and delivery interfaces:</p>
<ul>
<li><p>Submission via standard (extended) SMTP</p></li>
<li><p>Submission via C/C++ API</p></li>
<li><p>Submission via .NET API</p></li>
<li><p>Submission via Perl API</p></li>
<li><p>Submission via Java API</p></li>
<li><p>Submission via "pickup" directory</p></li>
<li><p>Delivery via standard (extended) SMTP</p></li>
<li><p>Delivery to a local program</p></li>
</ul>
<p>and will be supporting others in the future. Unless otherwise noted, these interfaces are available on all supported operating systems. You will find detailed information about the submission APIs <a href="#submission-apis">here</a>. Sample applications for the various APIs are also distributed along with PowerMTA.</p>
<h2 id="monitoringmanagement-tools-summary"><span class="header-section-number">1.4</span> Monitoring/Management Tools Summary</h2>
<p>PowerMTA was designed to require only minimal configuration and very little management. However, for those who want to actively monitor and manage, a variety of flexible tools are available to do just that, both on a manual or automated basis. Full details and examples are provided in this Guide, but here is a quick list of the resources available:</p>
<ul>
<li><p>a built-in web-based monitor that allows you to view in real time what is currently taking place within PowerMTA. This monitor also includes a view and top level break down of the current mail queues, a view and breakdown of each VirtualMTA queue, a view of each job/campaign in the queue, as well as the last error received for each domain.</p></li>
<li><p>a command line tool supporting a variety of monitoring and management commands, with four output formats (text, XML, JSON and DOM-style), which allow for easy integration into existing monitoring infrastructures or custom parsing and monitoring applications.</p></li>
<li><p>detailed logging, both for incoming and outgoing connections, configurable both globally and for specific destination domains.</p></li>
<li><p>detailed accounting data in CSV format on each successful and unsuccessful transfer/delivery that can be post processed for delivery verification/accountability, for performance and throughput analysis, etc.</p></li>
<li><p>a powerful accounting file search and reporting tool, allowing one to search for records in the accounting file and then to produce a custom output based on specific fields in the matching records.</p></li>
<li><p>an accounting statistics application for extracting the most commonly needed information for monitoring and capacity planning.</p></li>
<li><p>the <a href="#sparkpost-signals">SparkPost Signals</a> service that analyzes your email sending and response data to help you identify potential problems.</p></li>
</ul>
<h1 id="powermta-installation"><span class="header-section-number">2</span> PowerMTA Installation</h1>
<p>If you are upgrading to a newer version of PowerMTA, please make sure that you have obtained a compatible PowerMTA license for the new version that you are installing. For instance, if you are upgrading from 4.5 to 5.0, you should ensure that a valid 5.0 license also exists in PowerMTA's license file before attempting to upgrade. If your license has the "SupportExpires" field in it, please ensure that the current date is not past the "SupportExpires" date. The pre-install checks will fail the installation process if a compatible license for the version you are installing is not found.</p>
<h2 id="installing-on-microsoft-windows"><span class="header-section-number">2.1</span> Installing on Microsoft Windows</h2>
<p>How to install:</p>
<ol>
<li><p>Download the kit.</p></li>
<li><p>Log in as Administrator.</p></li>
<li><p>Open a command prompt as an administrator (right click and select <em>"Run as Administrator"</em>).</p></li>
<li><p>Run the PMTA MSI from within this window.</p></li>
<li><p>If you are installing PowerMTA for the first time or upgrading from a different version, copy the license key received from SparkPost to a file named <code>license.dat</code> in the directory where PowerMTA was installed (e.g., <code>C:\pmta\license.dat</code>). Please ensure that the file is stored as ASCII, <em>not</em> in Unicode.</p></li>
<li><p>Check that the configuration (e.g., <code>C:\pmta\config.dat</code>) suits your needs; the file can be edited with any ASCII-editor such as Notepad. See <a href="#initial-configuration">Initial Configuration</a> for details.</p></li>
<li><p>Start the mailer from the Services item in the Control Panel or by typing <code>net start pmta</code> in a Command Prompt window.</p></li>
<li><p>If you have an anti-virus and/or indexing service, they should not scan or handle the spool files, accounting files, or log files (to prevent file locking issues with PowerMTA).</p></li>
</ol>
<h2 id="installing-on-linux"><span class="header-section-number">2.2</span> Installing on Linux</h2>
<p>How to install:</p>
<ol>
<li><p>Download the kit.</p></li>
<li><p>Log in as root.</p></li>
<li><p>If installing for the first time, optionally create a group called pmta. Membership to this group authorizes non-root users to execute PowerMTA commands and access the submission APIs. The group is created automatically by the installation procedures, but creating it manually allows you to also choose its numeric ID.</p></li>
<li><p>Install the package (substituting the file name as appropriate):</p>
<pre><code># rpm -Uvh PowerMTA-4.*.rpm
</code></pre>
<p>Or on Debian:</p>
<pre><code># dpkg -i PowerMTA-4.*.deb
</code></pre></li>
<li><p>If installing for the first time or upgrading from a different version of PowerMTA, copy the license key received from SparkPost:</p>
<pre><code># cp mykey.txt /etc/pmta/license
</code></pre></li>
<li><p>Check that the initial configuration (<code>/etc/pmta/config</code>) suits your needs, as described <a href="#initial-configuration">below</a>.</p></li>
<li><p>Start the mailer (only necessary immediately after the install: it will be started automatically upon system startup):</p>
<pre><code># /etc/rc.d/init.d/pmta start
</code></pre></li>
<li><p>Optionally, install <code>gdb</code>, which PowerMTA can use in order to obtain useful debugging information.</p></li>
</ol>
<h2 id="initial-configuration"><span class="header-section-number">2.3</span> Initial Configuration</h2>
<p>There are only two things that <em>must</em> be manually defined in the configuration file, in addition to the supplied default entries, in order to have PowerMTA up and running: the postmaster address(es) and the relaying control configuration.</p>
<p>Besides being the traditional address for which external parties can reach the maintainer of the mail server, the postmaster address is used by PowerMTA and its watchdog monitoring facility, <code>pmtawatch</code>, to send crash reports and other information to upon successful automatic restart of the mailer (after a crash).</p>
<p>For security reasons, PowerMTA does not allow external relaying by default; the default configuration only allows messages to be submitted from the local <code>127.0.0.1</code> IP address. In order to submit messages for delivery from a different host, you will need to enter its IP address(es) into the configuration file by creating one or more source entries and specifying the <code>always-allow-relaying</code> directive.</p>
<p>Note that the <code>relay-domain</code> and <code>relay-address</code> directives in the configuration file are really only useful when PowerMTA is used to handle inbound traffic. These allow you to specify the recipient domains or email addresses of messages which PowerMTA is to accept from any sources. When configuring PowerMTA for outbound, you want it to accept email from your feeders for all domains by using <code>always-allow-relaying</code>.</p>
<p>See <a href="#powermta-configuration">PowerMTA Configuration</a> for detailed information on the configuration file.</p>
<h2 id="uninstalling"><span class="header-section-number">2.4</span> Uninstalling</h2>
<p>On each platform PowerMTA is installed with the platform's standard packaging software. You can uninstall PowerMTA using the platform's existing uninstall option:</p>
<ul>
<li><p>On Windows, open the Control Panel, click "Programs", click "Uninstall or change a program", select the PowerMTA item, and click on "Uninstall" or "Uninstall/Change" at the top of the program list. After confirming that you would like to proceed, that will initiate the uninstall process.</p></li>
<li><p>On Linux, log in as root and execute <code>rpm -e PowerMTA</code> or <code>dpkg -r PowerMTA</code></p></li>
</ul>
<p>Any configuration, logging, accounting, and message files found in PowerMTA's directories will not be automatically removed, and neither will the directories themselves. On Linux the uninstall software will display a list of the remaining files and the commands you need to execute to remove them. On Windows, you can simply remove the complete directory tree into which you had installed PowerMTA.</p>
<h2 id="running-powermta-on-a-virtual-server"><span class="header-section-number">2.5</span> Running PowerMTA on a Virtual Server</h2>
<p>While this is technically possible, it is not a recommended setup unless the virtual server has adequate hardware and the virtual server software is configured correctly. The sharing of resources on a misconfigured virtual machine may create an environment under load that could cause PowerMTA to become unresponsive.</p>
<p>If PowerMTA is going to be run on VMware, please take the following steps to ensure that PowerMTA gets the needed resources:</p>
<ul>
<li><p>Open your vSphere client</p></li>
<li><p>Right click on the PowerMTA server and select "Edit Settings"</p></li>
<li><p>Select the Resources tab</p></li>
<li><p>Change the shares value for CPU/Memory/Disk to the following values:</p>
<pre><code>CPU = 1000000
Memory = 1000000
Disk = 4000
</code></pre></li>
<li><p>For CPU, Memory, and Disk also make sure the "Unlimited" checkbox is checked for each in the same section</p></li>
<li><p>Restart the PowerMTA server</p></li>
</ul>
<p>These can be changed again later if needed or the settings can be turned down to find the optimal setting, but we have found that this helps ensure PowerMTA runs properly in a virtual environment.</p>
<h1 id="powermta-configuration"><span class="header-section-number">3</span> PowerMTA Configuration</h1>
<h2 id="working-with-the-configuration-file"><span class="header-section-number">3.1</span> Working with the configuration file</h2>
<p>PowerMTA's configuration files are simple UTF-8 encoded text files that can edited by most editors, such as Notepad, vim and Emacs. Most settings are entered one per line and are formed by a keyword on the left identifying a directive and a value on the right, as in the example below:</p>
<pre><code>host-id 5
</code></pre>
<p>Certain directives, like those applying to a specific destination domain, are grouped based on what they apply to:</p>
<pre><code>&lt;domain test.port25.com&gt; # &#39;test&#39; host
    smtp-hosts [127.0.0.1]:11111
    log-commands yes
&lt;/domain&gt;
</code></pre>
<p>As indicated in the examples above, comments can be introduced by prefixing the comment with a hash mark "#". Like other file formats using the hash mark for comments, PowerMTA ignores the "#" and any characters following it until the end of the line.</p>
<p>Since the files are UTF-8 encoded, internationalized domain names and email addresses can be entered directly:</p>
<pre><code>&lt;domain bcher.de&gt;
    ...
&lt;/domain&gt;
</code></pre>
<p>PowerMTA reads the configuration upon startup. After making changes, you must either execute the <code>pmta reload</code> command or restart PowerMTA. Reloading the configuration is more efficient. Most configuration changes can be reloaded, but changes to some directives require PowerMTA to be restarted; this is indicated in each such directive.</p>
<p>PowerMTA supports the ability to remotely modify/upload a configuration file via the web monitor (and thus via HTTP). To push the configuration programmatically, one needs to issue a HTTP POST, passing the configuration file in the field named "file" to the URL <a href="http://127.0.0.1:8080/configFile">http://127.0.0.1:8080/configFile</a>. One also needs to be authorized for <code>admin</code> access via the <code>http-access</code> directive.</p>
<h2 id="syntax-definitions"><span class="header-section-number">3.2</span> Syntax definitions</h2>
<p><strong>BOOLEAN</strong></p>
<p>Valid values are <code>yes</code>, <code>no</code>, <code>true</code>, or <code>false</code>.</p>
<p><strong>DOMAIN pattern</strong></p>
<p>Domain patterns are used to match domain names in various parts of PowerMTA and can be specified in one of the following formats:</p>
<ul>
<li><p><strong>*</strong> - Matches all domains.</p></li>
<li><p><em><strong>domain</strong></em> - A single, fully qualified domain name. Matches that specific domain only.</p></li>
<li><p><em><strong>*.domain</strong></em> - Matches any subdomains of <em>domain</em>, but <em>not</em> the domain itself.</p></li>
<li><p><em><strong>[*.]domain</strong></em> - Matches <em>domain</em> as well as its subdomains.</p></li>
<li><p><strong>[<em>ip</em>/<em>mask</em>]</strong> - CIDR format, matches domains in the dotted decimal format, like [127.0.0.1]. The actual IP address in the domain must match the given CIDR specification (<em>ip</em> prefix and (optional) <em>mask</em> number of significant bits). [0/0] matches all domains in dotted decimal format.</p></li>
</ul>
<p><strong>REGEX</strong></p>
<p>A perl-compatible regular expression (PCRE). For more information, please refer to the <a href="http://perldoc.perl.org/perlre.html">Perl documentation</a> or the <a href="http://www.pcre.org">PCRE library package</a>.</p>
<p><strong>Examples:</strong></p>
<pre><code>/^\s*eval/
/unknown user/
/^421 .* too many errors/
</code></pre>
<p><strong>TIME-INTERVAL</strong></p>
<p>A string like <code>1w2d12h</code> or <code>300s</code> where <code>w</code> is weeks, <code>d</code> is days, <code>h</code> is hours, <code>m</code> is minutes, and <code>s</code> is seconds.</p>
<h2 id="configuration-directives"><span class="header-section-number">3.3</span> Configuration Directives</h2>
<h3 id="global-directives"><span class="header-section-number">3.3.1</span> Global Directives</h3>
<p>These directives are "global" and affect PowerMTA as a whole.</p>
<h4 id="total-max-smtp-out"><span class="header-section-number">3.3.1.1</span> total-max-smtp-out</h4>
<p>Used to configure the limit on the number of simultaneous outbound connections that PowerMTA can make at any point in time.</p>
<p>Standard PowerMTA license is always limited to 200 simultaneous outbound connections. Any <code>total-max-smtp-out</code> setting above 200 is ignored by PowerMTA.</p>
<p>Enterprise PowerMTA license defaults to 1200 simultaneous outbound connections. There is no upper limit on the <code>total-max-smtp-out</code> setting when running with an Enterprise PowerMTA license.</p>
<p><strong>Note: While PowerMTA does not enforce any upper limit on the setting for this directive, please note that the limit is still subject to the hardware and OS limits on the machine that PowerMTA is installed on. For best results, it is recommended that <code>total-max-smtp-out</code> should not be set to a number higher than 7500. Please consult your OS and hardware manuals for arriving at the best value for this limit on the system that PowerMTA has been installed on.</strong></p>
<p>For the per-queue version of this directive, see <a href="#max-smtp-out">max-smtp-out</a>.</p>
<p>For the per-Virtual MTA version of this directive, see <a href="#max-smtp-out-1">max-smtp-out</a>.</p>
<p><strong>Default:</strong> <code>1200</code> for Enterprise license, <code>200</code> for Standard license.</p>
<p><strong>Example:</strong></p>
<pre><code>total-max-smtp-out 5000
</code></pre>
<hr />
<h4 id="total-max-smtp-in"><span class="header-section-number">3.3.1.2</span> total-max-smtp-in</h4>
<p>Used to configure the limit on the number of simultaneous inbound connections that PowerMTA should support at any point in time.</p>
<p><strong>Note: While PowerMTA does not enforce any upper limit on the setting for this directive, please note that the limit is still subject to the hardware and OS limits on the machine that PowerMTA is installed on. The best value for this limit depends on the number of connections that you expect will be made to PowerMTA by your submissions applications that submit messages to PowerMTA. We recommend that the limit should not be set above the default limit of 100 in practice. Please consult your OS and hardware manuals for arriving at the best value for this limit on the system that PowerMTA has been installed on.</strong></p>
<p><strong>Default:</strong> <code>100</code></p>
<p><strong>Example:</strong></p>
<pre><code>total-max-smtp-in 110
</code></pre>
<hr />
<h4 id="postmaster"><span class="header-section-number">3.3.1.3</span> postmaster</h4>
<p>Specifies an email address for the person responsible for PowerMTA's operation. This should <em>always</em> be specified because it is used by the internal watchdog facility for crash and LAK expiry notifications. Messages sent to the local postmaster and abuse addresses are also by default forwarded to the given addresses. You can specify more than one address by entering <code>postmaster</code> multiple times.</p>
<p><strong>Example:</strong></p>
<pre><code>postmaster you@your.domain
postmaster you@your.domain.at.home
</code></pre>
<hr />
<h4 id="spool"><span class="header-section-number">3.3.1.4</span> spool</h4>
<p>Specifies a directory for the message spool, where PowerMTA stores the message files while queued for delivery. While at least one spool directory is required, additional entries can be added for greater performance, for example by distributing the I/O load over several disks.</p>
<p><strong>Deprecated</strong> Use <code>&lt;spool&gt;</code> instead.</p>
<p><strong>Example:</strong></p>
<pre><code>spool c:\pmta\spool
</code></pre>
<hr />
<h4 id="spool-delete-corrupted"><span class="header-section-number">3.3.1.5</span> spool-delete-corrupted</h4>
<p>Determines whether PowerMTA should delete any message files in the spool found to contain encoding errors, such as those caused by disk data corruption. If set to <code>false</code>, corrupted spool files, if any, are ignored and remain on disk.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>spool-delete-corrupted true
</code></pre>
<hr />
<h4 id="spool-min-free-space"><span class="header-section-number">3.3.1.6</span> spool-min-free-space</h4>
<p>Instructs PowerMTA to stop accepting email into a spool directory if the space available on its file system falls below the amount specified. When available disk space increases above that level, messages are accepted again.</p>
<p>On Unix, this is based on the space available to non-<code>root</code> users.</p>
<p><strong>Deprecated</strong> Use <code>min-free-space</code> within <code>&lt;spool&gt;</code> instead.</p>
<p><strong>Syntax:</strong></p>
<pre><code>spool-min-free-space N
</code></pre>
<p>where <code>N</code> is a positive integer specifying a size in MB.</p>
<p><strong>Default:</strong> <code>0</code></p>
<p><strong>Example:</strong></p>
<pre><code>spool-min-free-space 100 # MB
</code></pre>
<hr />
<h4 id="spool-max-recipients"><span class="header-section-number">3.3.1.7</span> spool-max-recipients</h4>
<p>Specifies the maximum number of recipients to allow across all spool directories, to help prevent overwhelming PowerMTA with more messages than it has the resources to handle. When this limit is reached, feeding new messages into PowerMTA fails with a transient error message.</p>
<p>If set to <code>auto</code>, the maximum number is determined automatically based on system resources.</p>
<p><strong>Syntax:</strong></p>
<pre><code>spool-max-recipients { N | auto }
</code></pre>
<p>where <code>N</code> is a positive integer representing the maximum number of recipients allowed.</p>
<p><strong>Default:</strong> <code>auto</code></p>
<p><strong>Example:</strong></p>
<pre><code>spool-max-recipients 10000000
</code></pre>
<hr />
<h4 id="run-as-root"><span class="header-section-number">3.3.1.8</span> run-as-root</h4>
<p>Specifies whether PowerMTA should run as <code>root</code> or as user <code>pmta</code>. (Only supported on Unix.) You may want to not run PowerMTA as root for security reasons.</p>
<p><strong>Note: This option requires a restart of PowerMTA service whenever changed.</strong></p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>run-as-root false
</code></pre>
<hr />
<h4 id="smtp-server-tls-certificate"><span class="header-section-number">3.3.1.9</span> smtp-server-tls-certificate</h4>
<p>Specifies the X.509 certificate that PowerMTA should present when TLS is started on inbound SMTP connections (e.g., when <code>STARTTLS</code> is used). The certificate must be in PEM format.</p>
<p><strong>Syntax:</strong></p>
<pre><code>smtp-server-tls-certificate FILENAME PASSWORD
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>smtp-server-tls-certificate /etc/pmta/yourcert.pem SkJkemI0zffkez
</code></pre>
<hr />
<h4 id="smtp-server-tls-ca-file"><span class="header-section-number">3.3.1.10</span> smtp-server-tls-ca-file</h4>
<p>Specifies a "CA file" containing Certification Authority certificates to allow verifying any certificates presented by clients on inbound SMTP connections. The certificates must be in PEM format.</p>
<p><strong>Example:</strong></p>
<pre><code>smtp-server-tls-ca-file /etc/pmta/certchain.pem
</code></pre>
<hr />
<h4 id="smtp-server-tls-allow-sslv3"><span class="header-section-number">3.3.1.11</span> smtp-server-tls-allow-sslv3</h4>
<p>Allows PowerMTA to use SSLv3 when accepting a secure connection from a client during STARTTLS.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>smtp-server-tls-allow-sslv3 false
</code></pre>
<hr />
<h4 id="smtp-server-tls-allow-tlsv1"><span class="header-section-number">3.3.1.12</span> smtp-server-tls-allow-tlsv1</h4>
<p>Allows PowerMTA to use TLSv1 when accepting a secure connection from a client during STARTTLS.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>smtp-server-tls-allow-tlsv1 true
</code></pre>
<hr />
<h4 id="smtp-server-tls-allow-tlsv11"><span class="header-section-number">3.3.1.13</span> smtp-server-tls-allow-tlsv1.1</h4>
<p>Allows PowerMTA to use TLSv1.1 when accepting a secure connection from a client during STARTTLS.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>smtp-server-tls-allow-tlsv1.1 false
</code></pre>
<hr />
<h4 id="smtp-server-tls-allow-tlsv12"><span class="header-section-number">3.3.1.14</span> smtp-server-tls-allow-tlsv1.2</h4>
<p>Allows PowerMTA to use TLSv1.2 when accepting a secure connection from a client during STARTTLS.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>smtp-server-tls-allow-tlsv1.2 false
</code></pre>
<hr />
<h4 id="smtp-server-tls-ciphers"><span class="header-section-number">3.3.1.15</span> smtp-server-tls-ciphers</h4>
<p>Specifies the ciphers that PowerMTA is allowed to use when negotiating a TLS session with a client during STARTTLS. Please see documentation for OpenSSL command 'ciphers' for valid cipher names that can be used with this.</p>
<p><strong>Default:</strong> <code>HIGH:!ADH:@STRENGTH</code></p>
<p><strong>Example:</strong></p>
<pre><code>smtp-server-tls-ciphers HIGH:!ADH:@STRENGTH
</code></pre>
<hr />
<h4 id="smtp-source-host"><span class="header-section-number">3.3.1.16</span> smtp-source-host</h4>
<p>On a multi-homed host, this directive specifies an IP address (or IP address range) and host-name from which PowerMTA is to initiate outgoing SMTP connections. You can enter this directive several times and/or specify a CIDR IP address range along with the host name, instructing PowerMTA to use the various source IP addresses in round-robin fashion. All local IP addresses matching the IP range specified are added to the list of source IP addresses, except for 127.0.0.1, which is automatically excluded since it can't be used to connect to remote hosts.</p>
<p>When specified within a VirtualMTA, this directive overrides the global source IPs for connections established to send messages through that VirtualMTA.</p>
<p><strong>Syntax:</strong></p>
<pre><code>smtp-source-host CIDR HOST-NAME
smtp-source-host IP HOST-NAME
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>smtp-source-host 10/8    baz.quux.com
smtp-source-host 1.2.3.4 foo.bar.com
</code></pre>
<h4 id="alias"><span class="header-section-number">3.3.1.17</span> alias</h4>
<p>This directive allows a list of email addresses to be defined for which PowerMTA should forward messages to different addresses. For example, if a message is received by PowerMTA for <code>example@domain1abc.com</code>, then forward the message on to <code>support@port25.com</code>. See <a href="#aliases-/-forwarding">Aliases / Forwarding</a> for more information.</p>
<p><strong>Syntax:</strong></p>
<pre><code>alias SOURCE TARGET
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>alias example@domain1abc.com support@port25.com
</code></pre>
<hr />
<h4 id="smtp-ip"><span class="header-section-number">3.3.1.18</span> smtp-ip</h4>
<p><strong>Deprecated</strong> Use <code>smtp-listener</code> instead.</p>
<hr />
<h4 id="smtp-port"><span class="header-section-number">3.3.1.19</span> smtp-port</h4>
<p><strong>Deprecated</strong> Use <code>smtp-listener</code> instead.</p>
<hr />
<h4 id="smtp-listener"><span class="header-section-number">3.3.1.20</span> smtp-listener</h4>
<p>Specifies an IP address and port to listen for incoming SMTP connections. Multiple <code>smtp-listener</code> entries can be specified in a configuration file, each of which specifying a different IP address and/or port. <code>0.0.0.0</code> may be used more than once to set multiple ports for all IP addresses on the system. A CIDR IP address range can also be specified. If any <code>smtp-listener</code> directives are specified, PowerMTA ignores the <code>smtp-ip</code> and <code>smtp-port</code> directives. However, if no <code>smtp-listener</code> directives are specified, one listener is implicitly started for <code>0.0.0.0:25</code>.</p>
<p><code>smtp-listener</code> accepts an optional <code>source=</code> parameter which allows you to specify a <code>&lt;source&gt;</code> entry with settings to override those obtained from the normal matching by source IP address.</p>
<p><strong>Syntax:</strong></p>
<pre><code>smtp-listener CIDR:PORT [source=SOURCE-NAME]
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>smtp-listener 1.2.3.4:25 source=mta1
smtp-listener 0.0.0.0:26

&lt;source mta1&gt;
    default-virtual-mta mta1
&lt;/source&gt;

&lt;source 10.0.0.0/8&gt;
    allow-mailmerge yes
    always-allow-relaying yes
&lt;/source&gt;
&lt;source 0/0&gt;
    allow-mailmerge no
    always-allow-relaying no
&lt;/source&gt;
</code></pre>
<p>In the example above, VirtualMTA mta1 is selected by default for any messages received through 1.2.3.4. Permission for relaying and for using the mailmerge extensions are granted to connections coming from 10.*, whether they connect to 1.2.3.4 or not.</p>
<p><strong>Warning</strong> If you specify <code>always-allow-relaying</code> on a source selected from a smtp-listener directive, anybody who can connect to the given IP address will be allowed to relay. In doing so, you might be creating an "open SMTP relay".</p>
<hr />
<h4 id="custom-dsn-from-header"><span class="header-section-number">3.3.1.21</span> custom-dsn-from-header</h4>
<p>Used to configure the content of <code>From</code> header in DSN reports generated by PowerMTA.</p>
<p><strong>Example:</strong></p>
<pre><code>custom-dsn-from-header &quot;Postmaster &lt;foobar@there.com&gt;&quot;
</code></pre>
<hr />
<h4 id="smtp-await-slot"><span class="header-section-number">3.3.1.22</span> smtp-await-slot</h4>
<p>Specifies whether PowerMTA should wait for a new connection slot when a new (incoming) SMTP connection request is received but no more slots are available. If set to false, PowerMTA responds with a 421 greeting, indicating that the service is not available, and closes the connection.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>smtp-await-slot true
</code></pre>
<hr />
<h4 id="host-id"><span class="header-section-number">3.3.1.23</span> host-id</h4>
<p>When using <code>add-message-id-header</code>, <code>host-id</code> specifies a per server unique identifier that helps prevent the same message ID from being used on two separate instances of PowerMTA (multiple servers).</p>
<p><strong>Default:</strong> <code>0</code></p>
<p><strong>Example:</strong></p>
<pre><code>host-id 5
</code></pre>
<hr />
<h4 id="domain-suffix"><span class="header-section-number">3.3.1.24</span> domain-suffix</h4>
<p>Specifies the domain name to append when an email address is received whose domain is not fully qualified.</p>
<p><strong>Example:</strong></p>
<pre><code>domain-suffix bounce.port25.com
</code></pre>
<hr />
<h4 id="host-name"><span class="header-section-number">3.3.1.25</span> host-name</h4>
<p>This directive specifies a (fully qualified) host name for the local host. If the machine on which PowerMTA is running is known under several names, these should all be listed by adding various host-name directives. The first name specified is picked as the "main" name and is used for the SMTP greeting messages, EHLO/HELO commands, etc. When specified within a VirtualMTA, this directive overrides the global host name for messages sent through that VirtualMTA. When used, this directive behaves like <code>relay-domain</code>, meaning that it will accept all messages for the defined domain.</p>
<p><strong>Example:</strong></p>
<pre><code>host-name mail.foo.com
</code></pre>
<hr />
<h4 id="name-server"><span class="header-section-number">3.3.1.26</span> name-server</h4>
<p>This directive specifies the IP address of a name server (DNS server) for PowerMTA to use. If none is entered, PowerMTA uses the name servers configured in the operating system. If more than one <code>name-server</code> is defined, PowerMTA will round robin through all defined name servers in a load balancing fashion.</p>
<p><strong>Example:</strong></p>
<pre><code>name-server 10.1.2.3
name-server 8.8.8.8
</code></pre>
<hr />
<h4 id="thread-min-priority-thread-max-priority"><span class="header-section-number">3.3.1.27</span> thread-min-priority, thread-max-priority</h4>
<p><strong>Unix specific directive</strong>. Specifies range of process priorities to use for the various threads within PowerMTA. Normally these directives should be left at their defaults, however it may be necessary to weight process priorities differently when PowerMTA shares a host with other server software. <code>thread-min-priority</code> specifies the "slower" priority and <code>thread-max-priority</code> specifies the "faster" priority.</p>
<p><strong>Default:</strong> <code>15</code> for <code>thread-min-priority</code> <code>0</code> for <code>thread-max-priority</code></p>
<p><strong>Example:</strong></p>
<pre><code>thread-min-priority  5
thread-max-priority  50
</code></pre>
<hr />
<h4 id="thread-reuse"><span class="header-section-number">3.3.1.28</span> thread-reuse</h4>
<p>Normally, once a thread is finished with its work (like, for example, handling a connection), PowerMTA retains it for later reuse. Setting this directive to false causes PowerMTA to discard threads as soon as they are no longer needed, avoiding certain external problems such as slowing down the top command on Linux. However, this costs some performance and also prevents PowerMTA from working around a bug in glibc versions prior to 2.2.2 that severely reduces the amount of virtual memory available, possibly causing PowerMTA to crash if the queue grows very large.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>thread-reuse false
</code></pre>
<hr />
<h4 id="mailmerge-expands-undefined-variables"><span class="header-section-number">3.3.1.29</span> mailmerge-expands-undefined-variables</h4>
<p>When set to "false", mail merge inserts like "[foo]" remain as "[foo]" in the message if the "foo" variable isn't defined, rather than getting expanded to the empty string.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>mailmerge-expands-undefined-variables false
</code></pre>
<hr />
<h4 id="pmc-acct-min-free-space"><span class="header-section-number">3.3.1.30</span> pmc-acct-min-free-space</h4>
<p>If you use PowerMTA's companion product, the PowerMTA Management Console (PMC), this directive controls when to start deleting old CSV files written for the PMC. If the amount of free space on the disk drops below this number, PowerMTA will start to delete the oldest PMC accounting files in order to make space for new accounting files.</p>
<p>If the PMC runs properly, you should not see accounting files building up on PowerMTA's side, but if there is a problem (e.g., PMC machine down or too busy, firewall rules preventing the PMC to connect to PowerMTA, or PMC just turned off but not properly de-registered from PowerMTA), this directive can limit the amount of disk space PowerMTA uses. When PowerMTA runs out of disk space and discards accounting files, that data is lost forever, and you'll see "holes" in the PMC's reports.</p>
<p><strong>Default:</strong> <code>unlimited</code></p>
<p><strong>Example:</strong></p>
<pre><code>pmc-acct-min-free-space 5G
</code></pre>
<hr />
<h4 id="include"><span class="header-section-number">3.3.1.31</span> include</h4>
<p>This directive can be used at global level to specify an additional configuration file to process. This can be used, for example, to facilitate maintenance of the configuration files across multiple hosts, by storing those settings which differ from host to host in a separate file and including it from the main (common) file. Wildcards may be used. An include may be used at global level and within <code>&lt;source&gt;</code>, <code>&lt;domain&gt;</code>, <code>&lt;virtual-mta&gt;</code> or <code>&lt;smtp-pattern-list&gt;</code> tag.</p>
<p><strong>Example:</strong></p>
<pre><code>include /etc/pmta/vmtas.txt
</code></pre>
<hr />
<h4 id="relaying-control-directives"><span class="header-section-number">3.3.1.32</span> Relaying Control Directives</h4>
<h5 id="always-allow-relaying"><span class="header-section-number">3.3.1.32.1</span> always-allow-relaying</h5>
<p>Specifies whether SMTP senders from the given source should be allowed to relay email through PowerMTA, even if the recipients are not for one of the relay-domains. Typically you should enable this in the source entries of "internal" hosts feeding PowerMTA through SMTP.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>always-allow-relaying false
</code></pre>
<hr />
<h5 id="relay-domain"><span class="header-section-number">3.3.1.32.2</span> relay-domain</h5>
<p>Recipient domain name (or pattern) for which PowerMTA will accept email. Any host is allowed to relay email for these domains, independent of its source IP address. This directive may be specified more than once.</p>
<p>This directive is mostly useful for handling inbound email. When setting up PowerMTA for relaying inbound email to some other host, you should enter the corresponding domain name(s) into the relay domains list. Conversely, if in your installation PowerMTA is handling outbound email only, there is no need to configure any relay domains.</p>
<p><strong>Syntax:</strong></p>
<pre><code>relay-domain DOMAIN
</code></pre>
<p>where <code>DOMAIN</code> is a domain name pattern.</p>
<p><strong>Default:</strong> local domains</p>
<p><strong>Example:</strong></p>
<pre><code># allow relaying of mail to some.domain
relay-domain some.domain
</code></pre>
<hr />
<h5 id="relay-address"><span class="header-section-number">3.3.1.32.3</span> relay-address</h5>
<p>Recipient address for which PowerMTA will accept email. Any host is allowed to relay email to these addresses, independent of its source IP address. This directive may be specified more than once.</p>
<p>This directive is mostly useful for handling inbound email such as setting up PowerMTA for relaying inbound email to some other host. Conversely, if in your installation PowerMTA is handling outbound email only, there is no need to configure any relay addresses.</p>
<p><strong>Syntax:</strong></p>
<pre><code>relay-address { EMAIL-ADDRESS | REGEX }
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>relay-address bounce@bounce.yourdomain.com
relay-address /@foo(bar)?\.com$/
</code></pre>
<hr />
<h5 id="relay-debug"><span class="header-section-number">3.3.1.32.4</span> relay-debug</h5>
<p>Specifies that relaying control is to be performed in "debugging" mode. Normally, recipients to which relaying is not allowed are rejected with persistent (5XX) SMTP error codes, causing immediate bounces. In debugging mode, a transient (4XX) error is returned instead to the sending mailer, allowing it to continue trying to deliver to that recipient. This directive comes handy when making changes to the relaying control configuration since it gives you a chance to review the log for any unintended rejections and correct the configuration before messages are bounced.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>relay-debug true
</code></pre>
<hr />
<h4 id="general-queueing-and-delivery-directives"><span class="header-section-number">3.3.1.33</span> General Queueing and Delivery Directives</h4>
<hr />
<h5 id="domain-key"><span class="header-section-number">3.3.1.33.1</span> domain-key</h5>
<p>Specifies a domain key to use for signing messages delivered through the given VirtualMTA or for any messages if configured at the global level. You can specify multiple domain-key entries. PowerMTA determines the key to use by going through the keys sequentially and picking the first key whose domain either equals or is a parent of the message's <em>sending domain</em>. If there are matching domain keys at both the global level and the VirtualMTA level, the VirtualMTA's domain keys take precedence. The sending domain is that of the Sender header, or, if Sender is not present, of the From header. If no keys match the sending domain, the message is not signed. The wildcard <code>*</code> may be used in place of a domain. This will cause all messages to be signed using the sending domain (extracted from the headers). We recommend that all wildcard entries be placed last when multiple domain-key entries are specified, as a wildcard will be matched before a non-wildcard entry. For more information on how to set up DKIM, please see <a href="#powermta-dkim-implementation">PowerMTA DKIM Implementation</a>.</p>
<p><strong>Syntax:</strong></p>
<pre><code>domain-key SELECTOR,{DOMAIN|*},FILENAME
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>domain-key m,mail.port25.com,c:\pmta\m.pem
domain-key base,*,c:\pmta\base.pem
</code></pre>
<hr />
<h5 id="invalid-virtual-mta-fallback"><span class="header-section-number">3.3.1.33.2</span> invalid-virtual-mta-fallback</h5>
<p>Specifies a fallback VirtualMTA to select for messages for which an invalid (non-existent) VirtualMTA was selected. By using this directive, you prevent PowerMTA from bouncing messages for which an invalid VirtualMTA was selected. Instead, the messages are delivered from the fallback VirtualMTA. This directive only works when feeding PowerMTA. It does not work with <code>reroute-to-virtual-mta</code> or <code>backoff-reroute-to-virtual-mta</code>.</p>
<p><strong>Syntax:</strong></p>
<pre><code>invalid-virtual-mta-fallback VMTA-NAME
</code></pre>
<p><strong>Note:</strong> To prevent PowerMTA from bouncing the messages to an invalid (non-existent) VirtualMTA, explicitly set <code>reject-invalid-virtual-mta</code> to false in the corresponding source scope (the default is true).</p>
<hr />
<h5 id="include-headers-from"><span class="header-section-number">3.3.1.33.3</span> include-headers-from</h5>
<p>Specifies the name of a file containing RFC2822-formatted headers to insert in all messages delivered from a VirtualMTA. The headers are inserted immediately after the Received header added by PowerMTA. When used globally, all VirtualMTAs will inherit the settings. If a VirtualMTA already has the directive defined, both settings will be used.</p>
<p><strong>Syntax:</strong></p>
<pre><code>include-headers-from FILENAME
</code></pre>
<hr />
<h5 id="domain-macro"><span class="header-section-number">3.3.1.33.4</span> domain-macro</h5>
<p>Specifies the variable and bindings for domain macro expansion. Only letters, numbers, and the underscore are supported when naming a domain-macro. See <a href="#domain-directives">&lt;domain&gt; Directives</a> for more information on usage.</p>
<p><strong>Syntax:</strong></p>
<pre><code>domain-macro MACRO-NAME DOMAIN-LIST
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>domain-macro rollupDomains yahoo.com,gmail.com,hotmail.com

domain-macro tld .com,.co.uk,.co.in
</code></pre>
<hr />
<h4 id="pickup-directives"><span class="header-section-number">3.3.1.34</span> Pickup Directives</h4>
<h5 id="pickup"><span class="header-section-number">3.3.1.34.1</span> pickup</h5>
<p>This directive specifies the path to a "pickup directory" from which PowerMTA processes email submissions, as well as the path to a corresponding "bad mail" directory to which improperly formatted messages are moved. See <a href="#pickup-directory">Pickup Directory</a> for more information. Only one pickup directory is supported.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pickup PICKUP-DIRECTORY BAD-FILE-DIRECTORY
</code></pre>
<p><strong>Example:</strong> (Windows)</p>
<pre><code>pickup c:\Inetpub\Mailroot\Pickup c:\Inetpub\Mailroot\BadMail
</code></pre>
<p><strong>Example:</strong> (Unix)</p>
<pre><code>pickup /opt/pickup/new  /opt/pickup/badfiles
</code></pre>
<hr />
<h5 id="pickup-retry-interval"><span class="header-section-number">3.3.1.34.2</span> pickup-retry-interval</h5>
<p><strong>Deprecated</strong></p>
<hr />
<h5 id="pickup-remove-dot"><span class="header-section-number">3.3.1.34.3</span> pickup-remove-dot</h5>
<p>When using SMTP feeding and a line starts with a period, that period needs to be escaped by adding a second period. When using a pickup file, the period does not need to be escaped. If the feeding application is adding two periods to a pickup file this directive may be set to true to allow the second period to be removed for proper formatting of emails.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>pickup-remove-dot yes
</code></pre>
<hr />
<h4 id="dummy-smtp-blackholing-directives"><span class="header-section-number">3.3.1.35</span> Dummy SMTP ("blackholing") Directives</h4>
<h5 id="dummy-smtp-ip"><span class="header-section-number">3.3.1.35.1</span> dummy-smtp-ip</h5>
<p>Specifies the IP address on which PowerMTA is to listen for incoming connections that are to be handled as "dummy" SMTP connections.</p>
<p><strong>Example:</strong></p>
<pre><code>dummy-smtp-ip 127.0.0.1
</code></pre>
<hr />
<h5 id="dummy-smtp-port"><span class="header-section-number">3.3.1.35.2</span> dummy-smtp-port</h5>
<p>Specifies the TCP port on which PowerMTA is to listen for incoming connections that are to be handled as "dummy" SMTP connections.</p>
<p><strong>Default:</strong> <code>0</code>, meaning disabled.</p>
<p><strong>Example:</strong></p>
<pre><code>dummy-smtp-port 2525
</code></pre>
<hr />
<h5 id="dummy-smtp-await-slot"><span class="header-section-number">3.3.1.35.3</span> dummy-smtp-await-slot</h5>
<p>Specifies whether PowerMTA should wait for a new connection slot when a new dummy SMTP connection request is received but no more slots are available. If set to false, PowerMTA responds with a 421 greeting, indicating that the service is not available, and closes the connection.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>dummy-smtp-await-slot true
</code></pre>
<hr />
<h5 id="dummy-smtp-has-chunking"><span class="header-section-number">3.3.1.35.4</span> dummy-smtp-has-chunking</h5>
<p>Specifies whether dummy SMTP connections are to support the CHUNKING SMTP extension.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>dummy-smtp-has-chunking true
</code></pre>
<hr />
<h5 id="dummy-smtp-has-pipelining"><span class="header-section-number">3.3.1.35.5</span> dummy-smtp-has-pipelining</h5>
<p>Specifies whether dummy SMTP connections are to support the PIPELINING SMTP extension.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>dummy-smtp-has-pipelining true
</code></pre>
<hr />
<h5 id="dummy-smtp-has-verp"><span class="header-section-number">3.3.1.35.6</span> dummy-smtp-has-verp</h5>
<p>Specifies whether dummy SMTP connections are to support the VERP SMTP extension.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>dummy-smtp-has-verp true
</code></pre>
<hr />
<h5 id="dummy-smtp-latency"><span class="header-section-number">3.3.1.35.7</span> dummy-smtp-latency</h5>
<p>Specifies the network latency, in milliseconds, to be simulated in dummy SMTP connections.</p>
<p><strong>Default:</strong> <code>0</code></p>
<p><strong>Example:</strong></p>
<pre><code>dummy-smtp-latency 100
</code></pre>
<hr />
<h5 id="dummy-smtp-update-stats"><span class="header-section-number">3.3.1.35.8</span> dummy-smtp-update-stats</h5>
<p>Specifies whether dummy SMTP connections should update the traffic statistics displayed by e.g. the web-based Status Monitor.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>dummy-smtp-update-stats false
</code></pre>
<hr />
<h4 id="web-based-monitor-directives"><span class="header-section-number">3.3.1.36</span> Web-Based Monitor Directives</h4>
<h5 id="http-mgmt-port"><span class="header-section-number">3.3.1.36.1</span> http-mgmt-port</h5>
<p>Specifies the TCP port number for the web-based monitor. Since there is no standard port for this application, other software running on the same host may already be using that port. In this case, change the port to a different port number. If <code>http-mgmt-port</code> is set to 0, no web-based monitor is started.</p>
<p>Changing this directive requires a restart of the pmtahttp service.</p>
<p><strong>Default:</strong> <code>8080</code></p>
<p><strong>Example:</strong></p>
<pre><code>http-mgmt-port 8888
</code></pre>
<hr />
<h5 id="http-redirect-to-https"><span class="header-section-number">3.3.1.36.2</span> http-redirect-to-https</h5>
<p>Specifies whether plain HTTP connections to the web monitor are disabled. If this directive is set to <code>true</code>, the web monitor will only accept HTTPS connections, and any incoming HTTP connections are redirected to HTTPS.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>http-redirect-to-https true
</code></pre>
<p><strong>NOTE:</strong> The <code>default</code> value is <code>false</code> in PowerMTA 4.5 whereas it is <code>true</code> in 5.0. So, <code>http-redirect-to-https</code> has to be explicitly set to <code>false</code> in 5.0 to disable automatic redirecting to https.</p>
<hr />
<h5 id="http-access"><span class="header-section-number">3.3.1.36.3</span> http-access</h5>
<p>Specifies the level of access given to the web monitor, depending on the IP address from where the request originated.</p>
<p>The keyword after the CIDR gives the level of access: <code>none</code>, <code>monitor</code> (read-only), <code>operator</code> (monitor level plus view configuration and run commands) or <code>admin</code> (operator level plus edit config).</p>
<p>Admin access is intended for things that actually modify PowerMTA's state (configuration, LAK, queues, etc.).</p>
<p>To restrict access to logs, <code>monitor</code> access level can be qualified with <code>deny-logs</code>.</p>
<p>The directive can be specified several times and builds an access list in which IP addresses are matched in the order in which they are specified in the configuration file (i.e, from the top of the config file to the bottom).</p>
<p>Please see the pmtahttp.log file for errors relating to use of this directive. The pmtahttp.log file should indicate the IP address of any attempted accesses.</p>
<p><strong>Syntax:</strong></p>
<pre><code>http-access CIDR { monitor[,deny-logs] | operator | admin | none }
</code></pre>
<p><strong>Default:</strong> <code>none</code></p>
<p><strong>Example:</strong></p>
<pre><code># allow internal hosts access to the web-based monitor
http-access 10.0.0.0/8 monitor

# allow all IPs to the web-based monitor (use for testing only! This allows
# anyone in the world access to the web monitor!)
http-access 0/0 monitor
</code></pre>
<hr />
<h5 id="http-csrf-protection"><span class="header-section-number">3.3.1.36.4</span> http-csrf-protection</h5>
<p>This directive enables protection against Cross-Site Request Forgery attacks in the web monitor. When set to 'true', the web monitor disallows HTTP GET requests that can change PowerMTA's or the Web monitor's state, and requires that HTTP POST requests either include an API key (see <a href="#http-api-key">http-api-key</a>) or a CSRF token received from a previous GET call to the web monitor.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code># legacy application X requires mutable GET support
http-csrf-protection false
</code></pre>
<hr />
<h5 id="http-api-key"><span class="header-section-number">3.3.1.36.5</span> http-api-key</h5>
<p>This directive configures authentication keys for applications accessing the web monitor; it can be repeated to create multiple keys. Applications passing a valid key in the <code>X-API-Key</code> header are granted full (admin) access to the web monitor.</p>
<p><strong>Syntax:</strong></p>
<pre><code>http-api-key STRING
</code></pre>
<p>where <code>STRING</code> is a set of alphanumeric characters or the underscore character, and between 32 and 128 characters in length.</p>
<p><strong>Example:</strong></p>
<pre><code># application keys
http-api-key abcd_0123_abcd_0123_abcd_0123_ab # app X
http-api-key 5f6e7e426949e3a5e4ec38e747e71963 # app Y
</code></pre>
<hr />
<h5 id="http-strict-transport-security-max-age"><span class="header-section-number">3.3.1.36.6</span> http-strict-transport-security-max-age</h5>
<p>This directive can be used to configure the <code>max-age</code> value included in the <code>Strict-Transport-Security</code> returned in PowerMTA web monitor responses.</p>
<p><strong>Default:</strong> <code>0</code></p>
<p><strong>Example:</strong></p>
<pre><code>http-strict-transport-security-max-age 0
</code></pre>
<hr />
<h5 id="http-mgmt-source--no-http-mgmt-source"><span class="header-section-number">3.3.1.36.7</span> http-mgmt-source &amp; no-http-mgmt-source</h5>
<p><strong>Deprecated</strong> Use <code>http-access</code> instead.</p>
<hr />
<h5 id="http-tls-allow-sslv3"><span class="header-section-number">3.3.1.36.8</span> http-tls-allow-sslv3</h5>
<p>Allows PowerMTA web monitor to use SSLv3 when accepting a secure connection from a client.</p>
<p><strong>Example:</strong></p>
<pre><code>http-tls-allow-sslv3 false
</code></pre>
<p><strong>Default:</strong> <code>false</code></p>
<hr />
<h5 id="http-tls-allow-tlsv1"><span class="header-section-number">3.3.1.36.9</span> http-tls-allow-tlsv1</h5>
<p>Allows PowerMTA web monitor to use TLSv1 when accepting a secure connection from a client.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>http-tls-allow-tlsv1 false
</code></pre>
<hr />
<h5 id="http-tls-allow-tlsv11"><span class="header-section-number">3.3.1.36.10</span> http-tls-allow-tlsv1.1</h5>
<p>Allows PowerMTA web monitor to use TLSv1.1 when accepting a secure connection from a client.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>http-tls-allow-tlsv1.1 false
</code></pre>
<hr />
<h5 id="http-tls-allow-tlsv12"><span class="header-section-number">3.3.1.36.11</span> http-tls-allow-tlsv1.2</h5>
<p>Allows PowerMTA web monitor to use TLSv1.2 when accepting a secure connection from a client.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>http-tls-allow-tlsv1.2 false
</code></pre>
<hr />
<h5 id="http-tls-ciphers"><span class="header-section-number">3.3.1.36.12</span> http-tls-ciphers</h5>
<p>Specifies the ciphers that PowerMTA web monitor is allowed to use when negotiating a TLS session with remote client. Please see documentation for OpenSSL command <code>ciphers</code> for valid cipher names that can be used with this directive.</p>
<p><strong>Default:</strong> <code>"HIGH:!ADH:@STRENGTH"</code></p>
<p><strong>Example:</strong></p>
<pre><code>http-tls-ciphers HIGH:!ADH:@STRENGTH
</code></pre>
<hr />
<h5 id="http-tls-ca-file"><span class="header-section-number">3.3.1.36.13</span> http-tls-ca-file</h5>
<p>Specifies a "CA file" containing Certification Authority certificates to allow verifying any certificates presented by clients on inbound HTTP connections to the web monitor. The certificates must be in PEM format.</p>
<p><strong>Example:</strong></p>
<pre><code>http-tls-ca-file /etc/pmta/certchain.pem
</code></pre>
<hr />
<h5 id="http-log-tls"><span class="header-section-number">3.3.1.36.14</span> http-log-tls</h5>
<p>Specifies whether PowerMTA web monitor should log information during negotiation of a TLS session with the remote client.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>http-log-tls false
</code></pre>
<hr />
<h5 id="http-log-data"><span class="header-section-number">3.3.1.36.15</span> http-log-data</h5>
<p>Specifies whether web monitor data exchanges are logged or not. More verbose than <code>http-log-requests</code>.</p>
<p><strong>Default:</strong> <code>false</code></p>
<hr />
<h5 id="http-log-requests"><span class="header-section-number">3.3.1.36.16</span> http-log-requests</h5>
<p>Specifies whether web monitor data exchanges are logged or not.</p>
<p><strong>Default:</strong> <code>false</code></p>
<hr />
<h5 id="http-default-max-items"><span class="header-section-number">3.3.1.36.17</span> http-default-max-items</h5>
<p>Specifies the default maximum number of items to show in the "Top Queues", "Top Domains", "Top VirtualMTAs", "Top Jobs" pages and the "Top Domains" table in the home page.</p>
<p><strong>Default:</strong> <code>10</code></p>
<hr />
<h5 id="http-default-sort-order"><span class="header-section-number">3.3.1.36.18</span> http-default-sort-order</h5>
<p>Specifies the default sort order for items in the "Top Queues", "Top Domains", "Top VirtualMTAs", "Top Jobs" pages and the "Top Domains" table in the home page.</p>
<p>Set it to <code>name</code> to order the list alphabetically by name, <code>rcpt</code> to order the list by number of recipients in decreasing order, or <code>size</code> to order the list by volume/kbytes in decreasing order.</p>
<p><strong>Syntax:</strong></p>
<pre><code>http-default-sort-roder { rcpt | name | size }
</code></pre>
<p><strong>Default:</strong> <code>rcpt</code></p>
<hr />
<h4 id="logging-directives"><span class="header-section-number">3.3.1.37</span> Logging Directives</h4>
<h5 id="log-auto-rotation"><span class="header-section-number">3.3.1.37.1</span> log-auto-rotation</h5>
<p>Specifies whether the logging files are to be rotated automatically at midnight. See the <code>log-rotate</code> directive for more information on file rotation.</p>
<p><strong>Default:</strong> <code>true</code></p>
<hr />
<h5 id="log-file"><span class="header-section-number">3.3.1.37.2</span> log-file</h5>
<p>Specifies the name of PowerMTA's logging file. On Windows, it can be either specified with a path name relative to the installation directory or with an absolute path. On Unix it must always be specified as an absolute path. The <code>log-file</code> directive controls the location of the PowerMTA log file, the HTTP log file, and the SNMP log file.</p>
<p>This directive is required and must always be configured in PowerMTA's configuration file.</p>
<p><strong>Syntax:</strong></p>
<pre><code>log-file FILENAME
</code></pre>
<p><strong>Example:</strong> (Windows)</p>
<pre><code>log-file log\pmta.log
</code></pre>
<p><strong>Example:</strong> (Linux)</p>
<pre><code>log-file /var/log/pmta/pmta.log
</code></pre>
<hr />
<h5 id="log-rotate"><span class="header-section-number">3.3.1.37.3</span> log-rotate</h5>
<p>Specifies the number of files to keep when rotating the logging files. File rotation is a practical way of preventing files from growing too large and, at the same time, ensure that the most recent data is available in case it is needed. When the log files are rotated, PowerMTA renames the existing logging files, attaching a number to them, starting with 1 for the most recent file. On Unix, assuming a file named log, that's log.<em>N</em> -&gt; log.<em>N+1</em>, log -&gt; log.1 and on Windows (assuming log.txt), log-<em>N</em>.txt -&gt; log-<em>N+1</em>.txt, log.txt -&gt; log-1.txt. It then creates a new file (either log or log.txt) to which it continues writing logging information. The number passed includes the file currently being written to, so a value of 1 means only the current file is kept (but no older files), 2 means the current file plus one old file, and so on. A value of 0 disables rotation entirely.</p>
<p>To trigger manual rotation run the following command:</p>
<pre><code>pmta rotate log
</code></pre>
<p><strong>Default:</strong> <code>8</code></p>
<p><strong>Example:</strong></p>
<pre><code>log-rotate 8
</code></pre>
<hr />
<h5 id="log-file-world-readable"><span class="header-section-number">3.3.1.37.4</span> log-file-world-readable</h5>
<p>Setting this directive to <code>true</code> will allow anyone with access to the machine to read log files generated by PowerMTA.</p>
<p><strong>Default:</strong> <code>false</code></p>
<hr />
<h4 id="mx-and-ip-connection-limit-directives"><span class="header-section-number">3.3.1.38</span> MX and IP Connection Limit Directives</h4>
<h5 id="mx-connection-limit"><span class="header-section-number">3.3.1.38.1</span> mx-connection-limit</h5>
<p><strong>Note that the <a href="#mx-rollup-list">MX rollup</a> feature is a better way to enforce MX-level controls than the use of <code>mx-connection-limit</code> directive.</strong></p>
<p>Per-MX connection limits can be configured with this directive.</p>
<p>One can define a specific MX record to match on, or use wildcards to define multiple MX records, for example, <code>*.domain.com</code>, using the same conventions available within <code>&lt;domain&gt;</code> tags. The connection limit applies on a per source IP address basis (per IP address that PowerMTA will make connections from). If the wildcard is used, and multiple records are matched, the connection limit will apply per record matched, and not globally across all matches.</p>
<p>The global directive can be entered several times in the configuration file, once per line, forming a list of rules specifying the limits for the various MX records. It is important to note that MX-NAME matches the MX record for a domain, and not the recipient domain itself.</p>
<p>This directive is most useful when an ISP or hosting provider hosts hundreds of domains, but has one or few MX records for all of those domains. This directive allows you to limit the number of connections per MX, regardless of the number of recipient domains you are mailing to. Note again, that the connection limit applies on a per source IP address basis and not per VirtualMTA.</p>
<p><strong>Syntax:</strong></p>
<pre><code>mx-connection-limit MX-NAME N
</code></pre>
<p>where <code>MX-NAME</code> is the domain pattern that matches the MX(es) for whom the limit is being set and <code>N</code> is the number of simultaneous connections allowed to each MX in that group of MX(es).</p>
<p><strong>Example:</strong></p>
<pre><code>mx-connection-limit *.secureserver.net 20

mx-connection-limit *.aspmx.l.google.com 5
</code></pre>
<hr />
<h5 id="ip-connection-limit"><span class="header-section-number">3.3.1.38.2</span> ip-connection-limit</h5>
<p>Per-IP connection limits can be configured with this directive. The <code>IP</code> in this case refers to the IP address of the MX that PowerMTA is connecting to.</p>
<p>The directive is only permitted in global scope. The syntax for the directive is similar to <code>mx-connection-limit</code> directive, except that it is uses IP addresses (CIDR notation).</p>
<p><strong>Syntax:</strong></p>
<pre><code>ip-connection-limit CIDR N
</code></pre>
<p>where <code>CIDR</code> is the IP address specification of the destination, and <code>N</code> is the number of simultaneous connections allowed to each MX in the group of IP addresses that match the <code>CIDR</code>.</p>
<p><strong>Example:</strong></p>
<pre><code>ip-connection-limit 173.194/16    50

ip-connection-limit 104.47.2.33   1
</code></pre>
<hr />
<h4 id="use-proxy"><span class="header-section-number">3.3.1.39</span> use-proxy</h4>
<p>Specifies a comma separate list of proxy servers (see <a href="#proxy">proxy</a> for more details) that virtual MTAs can use when connecting to a remote destination.</p>
<p>When this directive is defined at global scope, its value is inherited by all the virtual MTAs in the system unless they override it specifically.</p>
<p>The proxy servers in the list are used in the order in which they are defined. The names in the list are strictly used for failover only - the second proxy on the list is used only if the connection to the first proxy fails, the third proxy is used only when connection to both first and second proxy have failed, and so on.</p>
<p>Every proxy server mentioned in this directive must be defined in the configuration with a <a href="#proxy">proxy</a> tag.</p>
<p><strong>Syntax:</strong></p>
<pre><code>use-proxy PROXY-SERVER-LIST
</code></pre>
<p><strong>Default:</strong> None</p>
<p><strong>Example:</strong></p>
<pre><code>

# global level
use-proxy mta-proxy-a


&lt;proxy mta-proxy-a&gt;
  server 10.1.2.3:5000
  client 16.70.55.233 client.hostname.com
&lt;/proxy&gt;

&lt;proxy mta-proxy-b&gt;
  server mta-proxy-b.internal.hostname.com:5000
  client 16.80.77.192  client2.hostname.com
&lt;/proxy&gt;


&lt;virtual-mta v1&gt;
  # inherits global &quot;use-proxy&quot;
&lt;/virtual-mta&gt;

&lt;virtual-mta v2&gt;
   # overrides global &quot;use-proxy&quot;
   use-proxy mta-proxy-b
&lt;/virtual-mta&gt;

</code></pre>
<hr />
<h3 id="spool-directives"><span class="header-section-number">3.3.2</span> &lt;spool&gt; Directives</h3>
<p>Each <code>&lt;spool&gt;</code> specifies a directory for the message spool, where PowerMTA stores the message files while queued for delivery. While at least one spool directory is required, additional entries can be added for greater performance, for example by distributing the I/O load over several disks.</p>
<p><strong>Syntax:</strong></p>
<pre><code>&lt;spool DIRECTORY&gt;
&lt;/spool&gt;
</code></pre>
<p><strong>Example:</strong> (Linux)</p>
<pre><code>&lt;spool /var/spool/pmta&gt;
    priority 50
    delete-file-holders false
&lt;/spool&gt;
</code></pre>
<p><strong>Example:</strong> (Windows)</p>
<pre><code>&lt;spool C:\pmta\spool&gt;
    priority 50
    delete-file-holders false
&lt;/spool&gt;
</code></pre>
<hr />
<h4 id="delete-file-holders"><span class="header-section-number">3.3.2.1</span> delete-file-holders</h4>
<p>Determines whether PowerMTA should delete any "file holders" (which are files temporarily left behind by PowerMTA in order to save on disk I/O) in the spool directory after a message has been delivered.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;spool /var/spool/pmta&gt;
    delete-file-holders true
&lt;/spool&gt;
</code></pre>
<hr />
<h4 id="deliver-only"><span class="header-section-number">3.3.2.2</span> deliver-only</h4>
<p>Indicates whether PowerMTA should only deliver messages from a spool directory, without writing new spool files to this directory.</p>
<p>This can be useful during failure recovery by allowing you to attach a spool directory from a failed server and having the messages in that directory be delivered without writing any new spool files to that directory.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;spool /var/spool/pmta&gt;
    deliver-only  true
&lt;/spool&gt;
</code></pre>
<hr />
<h4 id="priority"><span class="header-section-number">3.3.2.3</span> priority</h4>
<p>Sets the priority for a spool location, from 100 (highest) to 1 (lowest). Spools with higher priority are always used, unless they are full, at which point lower priority spool locations are considered. If two or more spools have same priority, the spools are selected in round-robin fashion.</p>
<p><strong>Syntax:</strong></p>
<pre><code>&lt;spool DIRECTORY&gt;
  priority N
&lt;/spool&gt;
</code></pre>
<p>where <code>N</code> is a positive integer between 1 and 100.</p>
<p><strong>Default:</strong> <code>1</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;spool /var/spool/pmta/primary&gt;
    priority 10
&lt;/spool&gt;

&lt;spool /var/spool/pmta/secondary&gt;
    priority 5
&lt;/spool&gt;
</code></pre>
<hr />
<h4 id="min-free-space"><span class="header-section-number">3.3.2.4</span> min-free-space</h4>
<p>Instructs PowerMTA to stop accepting email into the spool if the space available on the file system falls below the amount specified. When available disk space increases above that level, messages are accepted again.</p>
<p>On Unix, this is based on the space available to non-<code>root</code> users.</p>
<p><strong>Syntax:</strong></p>
<pre><code>min-free-space { N{b|k|m|g|t} | 0 }
</code></pre>
<p>where <code>N</code> is a positive integer followed by a size multiplier (<code>B</code> for byte, <code>K</code> for Kilobyte, <code>M</code> for Megabyte, <code>G</code> for Gigabyte or <code>T</code> for Terabyte).</p>
<p><strong>Default:</strong> <code>0</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;spool /var/spool/pmta&gt;
    min-free-space 1G
&lt;/spool&gt;
</code></pre>
<hr />
<h3 id="bounce-processor-directives"><span class="header-section-number">3.3.3</span> &lt;bounce-processor&gt; Directives</h3>
<p>The <code>&lt;bounce-processor&gt;</code> directive creates a bounce processor in PowerMTA. PowerMTA will then look for bounce emails when processing incoming messages. See <a href="#processing-asynchronous-remote-bounces-and-remote-status-reports">here</a> for more details on usage.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;bounce-processor&gt;
    deliver-unmatched-email yes            # default: yes
    deliver-matched-email yes              # default: no
    forward-unmatched-to auto-feedback@port25.com
    forward-errors-to auto-feedback@port25.com
    &lt;address-list&gt;
        domain domain.to.filter            # whole domain
        address /regex@domain.to.filter/   # regex
    &lt;/address-list&gt;
&lt;/bounce-processor&gt;
</code></pre>
<hr />
<h4 id="deliver-unmatched-email"><span class="header-section-number">3.3.3.1</span> deliver-unmatched-email</h4>
<p>Controls whether any emails that were not matched by the bounce processor should be delivered. If set to <code>false</code>, unmatched emails are discarded.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;bounce-processor&gt;
    deliver-unmatched-email false
&lt;/bounce-processor&gt;
</code></pre>
<hr />
<h4 id="deliver-matched-email"><span class="header-section-number">3.3.3.2</span> deliver-matched-email</h4>
<p>Determines whether any emails that were matched by the bounce processor should be delivered. If set to <code>false</code>, matched emails are discarded.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;bounce-processor&gt;
    deliver-matched-email true
&lt;/bounce-processor&gt;
</code></pre>
<hr />
<h4 id="deliver-email"><span class="header-section-number">3.3.3.3</span> deliver-email</h4>
<p><strong>Deprecated</strong> Use <code>deliver-matched-email</code>/<code>deliver-unmatched-email</code> instead.</p>
<hr />
<h4 id="forward-unmatched-to"><span class="header-section-number">3.3.3.4</span> forward-unmatched-to</h4>
<p>This directive allows for forwarding messages unmatched by the bounce processor to an external address.</p>
<p><strong>Syntax:</strong></p>
<pre><code>forward-unmatched-to EMAIL-ADDRESS
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;bounce-processor&gt;
    forward-unmatched-to  foo@port25.com
&lt;/bounce-processor&gt;
</code></pre>
<hr />
<h4 id="forward-errors-to"><span class="header-section-number">3.3.3.5</span> forward-errors-to</h4>
<p>This directive configures forwarding for messages that the bounce processor failed to parse.</p>
<p><strong>Syntax:</strong></p>
<pre><code>forward-errors-to EMAIL-ADDRESS
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;bounce-processor&gt;
    forward-errors-to  foo@port25.com
&lt;/bounce-processor&gt;
</code></pre>
<hr />
<h3 id="feedback-loop-processor-directives"><span class="header-section-number">3.3.4</span> &lt;feedback-loop-processor&gt; Directives</h3>
<p>The <code>&lt;feedback-loop-processor&gt;</code> directive creates a feedback loop processor in PowerMTA. PowerMTA will then look for FBL emails when processing incoming messages. See <a href="#processing-feedback-loop-emails">here</a> for more details on usage.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;feedback-loop-processor&gt;
    deliver-unmatched-email no         # default: yes
    deliver-matched-email yes          # default: no
    forward-unmatched-to auto-feedback@port25.com
    forward-errors-to auto-feedback@port25.com
    &lt;address-list&gt;
        address /fbl@fbl.yourdomain.com/
    &lt;/address-list&gt;
&lt;/feedback-loop-processor&gt;
</code></pre>
<hr />
<h4 id="deliver-unmatched-email-1"><span class="header-section-number">3.3.4.1</span> deliver-unmatched-email</h4>
<p>Controls whether any emails that were not matched by the feedback-loop processor should be delivered. If set to false, unmatched emails are discarded.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;feedback-loop-processor&gt;
    deliver-unmatched-email false
&lt;/feedback-loop-processor&gt;
</code></pre>
<hr />
<h4 id="deliver-matched-email-1"><span class="header-section-number">3.3.4.2</span> deliver-matched-email</h4>
<p>Determines whether any emails that were matched by the feedback-loop processor should be delivered. If set to false, matched emails are discarded.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;feedback-loop-processor&gt;
    deliver-matched-email true
&lt;/feedback-loop-processor&gt;
</code></pre>
<hr />
<h4 id="deliver-email-1"><span class="header-section-number">3.3.4.3</span> deliver-email</h4>
<p><strong>Deprecated</strong> Use <code>deliver-matched-email</code>/<code>deliver-unmatched-email</code> instead.</p>
<hr />
<h4 id="forward-unmatched-to-1"><span class="header-section-number">3.3.4.4</span> forward-unmatched-to</h4>
<p>This directive allows for forwarding messages unmatched by the feedback loop processor to an external address.</p>
<p><strong>Syntax:</strong></p>
<pre><code>forward-unmatched-to EMAIL-ADDRESS
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;feedback-loop-processor&gt;
    forward-unmatched-to  foo@port25.com
&lt;/feedback-loop-processor&gt;
</code></pre>
<hr />
<h4 id="forward-errors-to-1"><span class="header-section-number">3.3.4.5</span> forward-errors-to</h4>
<p>This directive configures forwarding for messages that the feedback loop processor failed to parse.</p>
<p><strong>Syntax:</strong></p>
<pre><code>forward-errors-to EMAIL-ADDRESS
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;feedback-loop-processor&gt;
    forward-errors-to  foo@port25.com
&lt;/feedback-loop-processor&gt;
</code></pre>
<hr />
<h3 id="address-list-directives"><span class="header-section-number">3.3.5</span> &lt;address-list&gt; Directives</h3>
<p>An <code>&lt;address-list&gt;</code> can be used to organize domains, or email addresses, or regular expressions into a single list. If the list is named, it can be used with directives such as <code>suppression-list</code>. Unnamed lists can be used in <code>&lt;alias&gt;</code>, <code>&lt;bounce-processor&gt;</code> and <code>&lt;feedback-loop-processor&gt;</code> tags.</p>
<p><strong>Example:</strong></p>
<pre><code># Named &lt;address-list&gt;
&lt;address-list foo&gt;
 domain foo.com
 address /^bounce@/
&lt;/address-list&gt;

# Unnamed &lt;address-list&gt; inside a &lt;bounce-processor&gt;
&lt;bounce-processor&gt;
  &lt;address-list foo&gt;
   domain foo.com
   address /^bounce@/
  &lt;/address-list&gt;
&lt;/bounce-processor&gt;
</code></pre>
<h4 id="address"><span class="header-section-number">3.3.5.1</span> address</h4>
<p>An email address, or a regular expression that matches an email address.</p>
<p><strong>Syntax:</strong></p>
<pre><code> address { EMAIL-ADDRESS | REGEX }
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;address-list foo&gt;
 address abc@xyz.com
 address /^bounce@/
&lt;/address-list&gt;
</code></pre>
<hr />
<h4 id="address-file"><span class="header-section-number">3.3.5.2</span> address-file</h4>
<p>Includes into the <code>&lt;address-list&gt;</code> all addresses in the file, where each line in the file is either the complete email address, or just the local part of an address.</p>
<p><strong>Syntax:</strong></p>
<pre><code> address-file FILENAME
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;address-list foo&gt;
 address-file /etc/pmta/suppression-address-list.txt
&lt;/address-list&gt;
</code></pre>
<p>where <code>/etc/pmta/suppression-address-list.txt</code> contains:</p>
<pre><code>foo
bar
baz@quux.com
</code></pre>
<hr />
<h4 id="domain"><span class="header-section-number">3.3.5.3</span> domain</h4>
<p>A domain name.</p>
<p><strong>Syntax:</strong></p>
<pre><code> domain DOMAIN
</code></pre>
<p>where <code>DOMAIN</code> is a complete domain name.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;address-list foo&gt;
    domain bounce.foo.com
    domain fbl.bar.com
&lt;/address-list&gt;
</code></pre>
<hr />
<h3 id="email-patterns-directives"><span class="header-section-number">3.3.6</span> &lt;email-patterns&gt; Directives</h3>
<p><code>&lt;email-pattern&gt;</code> directives can be used to configure regular expressions that will be matched against incoming remote bounces or feedback loop messages in order to extract useful information from them. This feature is useful when the remote MTA does not use standard DSN/ARF formats for remote bounces/feedback loop messages they return. See <a href="#handling-non-standard-dsn/fbl-reports">Handling non-standard DSN/FBL reports</a> for more details.</p>
<p><code>&lt;email-patterns&gt;</code> can only be used with <code>&lt;bounce-processor&gt;</code> and <code>&lt;feedback-loop-processor&gt;</code> tags.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;email-patterns&gt;
    body-pattern-file /etc/pmta/report-pattern.txt
    log-match-info true
&lt;/email-patterns&gt;
</code></pre>
<h4 id="body-pattern-file"><span class="header-section-number">3.3.6.1</span> body-pattern-file</h4>
<p>This directive allows you to configure a file that contains the pattern matching the body of a non-standard FBL/DSN bounce report. See <a href="#handling-non-standard-dsn/fbl-reports">Handling non-standard DSN/FBL reports</a> for more details.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;email-patterns&gt;
    body-pattern-file /etc/pmta/report-pattern.txt
&lt;/email-patterns&gt;
</code></pre>
<p>Sample content of the file <code>/etc/pmta/report-pattern.txt</code></p>
<pre><code>Email from (?&lt;dlvSourceIp&gt;[0-9\\.]+)
</code></pre>
<hr />
<h4 id="log-match-info"><span class="header-section-number">3.3.6.2</span> log-match-info</h4>
<p>If set to true, a message will be printed to log file with a summary about the info that was extracted from a remote bounce/feedback loop message that was matched, along with the name of the pattern that matched it. Useful for debugging <code>&lt;email-patterns&gt;</code> when you have multiple email patterns configured.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;email-patterns&gt;
    body-pattern-file /etc/pmta/report-pattern-1.txt
    body-pattern-file /etc/pmta/report-pattern-2.txt
    body-pattern-file /etc/pmta/report-pattern-3.txt
    body-pattern-file /etc/pmta/report-pattern-4.txt
    log-match-info true
&lt;/email-patterns&gt;
</code></pre>
<p>Sample log message when <code>log-match-info true</code> is set</p>
<pre><code>matched body-pattern defined in file:/etc/pmta/report-pattern-3.txt
</code></pre>
<hr />
<h3 id="source-directives"><span class="header-section-number">3.3.7</span> &lt;source&gt; Directives</h3>
<p>Directives entered within a <code>&lt;source&gt;</code> entry apply to SMTP connections from the given source. Per-source directives can be specified in two ways: by IP address and by name.</p>
<p>Each <code>&lt;source&gt;</code> entry to be applied by IP address specifies either an IP address in dotted decimal notation (like <code>10.0.0.1</code>), or a range of IP addresses in CIDR notation (like <code>10/8</code>).</p>
<p>A <code>&lt;source&gt;</code> entry to be applied by name specifies its name in the entry, like in <code>&lt;source S1&gt;</code>.</p>
<p>The example below shows entries for a specific IP, for a range of IPs in CIDR notation, and for the global <code>0/0</code> wildcard. More specific settings are used in favor of the more general if there is a conflict.</p>
<pre><code>&lt;source 10.0.0.5&gt; # matches 10.0.0.5 only
    allow-mailmerge yes
&lt;/source&gt;

&lt;source 10.0.0.0/8&gt; # matches 10.*
    always-allow-relaying yes
&lt;/source&gt;


&lt;source 0/0&gt; # matches all
    always-allow-relaying no
    allow-mailmerge no
&lt;/source&gt;
</code></pre>
<p>Note that PowerMTA merges ("inherits") settings in <code>source</code> entries like it does for the <code>domain</code> entries, allowing you to provide defaults in a more generic entry (such as <code>0/0</code>). After the inheritance, this is how PowerMTA sees the <code>&lt;source&gt;</code> settings:</p>
<pre><code>&lt;source 10.0.0.5&gt; # matches 10.0.0.5 only
    always-allow-relaying yes
    allow-mailmerge yes
&lt;/source&gt;

&lt;source 10.0.0.0/8&gt; # matches 10.*
    always-allow-relaying yes
    allow-mailmerge no
&lt;/source&gt;

&lt;source 0/0&gt; # matches all
    always-allow-relaying no
    allow-mailmerge no
&lt;/source&gt;
</code></pre>
<p>Named entries beginning with <code>{</code> are reserved and have special meaning: <code>&lt;source {pickup}&gt;</code> can be used to modify pickup directory handling and <code>&lt;source {auth}&gt;</code> can be used to specify defaults for any authenticated SMTP user.</p>
<p>Non-reserved named entries are used to override the settings obtained based on the source IP address. They apply only when specifically requested, like in the <code>source=...</code> parameter of the <code>smtp-listener</code> directive or <code>&lt;smtp-user&gt;</code>'s <code>source</code> directive.</p>
<h4 id="add-date-header"><span class="header-section-number">3.3.7.1</span> add-date-header</h4>
<p>Specifies whether PowerMTA should add a Date header if missing. If a Date header is present, it is not overridden unless using the override parameter.</p>
<p><strong>Note:</strong> Automatic addition of the Date header is not supported for mailmerge messages. When submitting mailmerge messages, you can use the <code>*date</code> variable to easily accomplish the same.</p>
<p><strong>Syntax:</strong></p>
<pre><code>add-date-header { no | yes | override }
</code></pre>
<p><strong>Default:</strong> <code>no</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
    add-date-header yes
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="date-header-time"><span class="header-section-number">3.3.7.2</span> date-header-time</h4>
<p>Specifies whether PowerMTA should set the Date header to the time the message was received and queued for delivery, or the time that the message was actually delivered. The directive <code>add-date-header</code> needs to be set to <code>yes</code> or <code>override</code> when using this directive.</p>
<p><strong>Syntax:</strong></p>
<pre><code>date-header-time { reception | delivery }
</code></pre>
<p><strong>Default:</strong> <code>reception</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
    add-date-header yes
    date-header-time delivery
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="bcc"><span class="header-section-number">3.3.7.3</span> bcc</h4>
<p>This directive takes an email address as a value, and if set, causes each message received from that source to be BCC'ed to the given email address. This can be used for creating a copy of every message for archival purposes.</p>
<p><strong>Syntax:</strong></p>
<pre><code>bcc EMAIL-ADDRESS
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
    bcc foo@bar.com
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="add-message-id-header"><span class="header-section-number">3.3.7.4</span> add-message-id-header</h4>
<p>Specifies whether PowerMTA should add a <code>Message-Id</code> header if missing. If a <code>Message-Id</code> header is present, it is not overridden.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
    add-message-id-header true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="add-received-header"><span class="header-section-number">3.3.7.5</span> add-received-header</h4>
<p>Specifies whether PowerMTA should add a <code>Received</code> header upon reception of an email.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
    add-received-header false
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="allow-auth"><span class="header-section-number">3.3.7.6</span> allow-auth</h4>
<p>Specifies whether PowerMTA should allow usage of the AUTH SMTP command.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
    allow-auth false
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="smtp-max-auth-failure-rate"><span class="header-section-number">3.3.7.7</span> smtp-max-auth-failure-rate</h4>
<p>Specifies after how many unsuccessful authentication attempts in the given time PowerMTA should refuse further authentication attempts from this source. This is used to defend against password-guessing attacks.</p>
<p>For example, setting the rate limit to <code>5/min</code> allows only five failed authentication attempts per minute.</p>
<p>Once a source is locked, users can only re-attempt authentication after the configured time period, counted from the time of the the first failed attempt. For example, if the max auth failure rate is set to <code>3/5m</code> and someone tries to authenticate unsuccessfully at 10:00, 10:01, and 10:02, authentication will be refused till 10:05.</p>
<p>If this directive is set to <code>unlimited</code> (the default) or 0, PowerMTA will not block the account on failed authentication attempts.</p>
<p>For this directive to be effective, you must enforce authentication with the <code>require-auth</code> directive.</p>
<p>See <a href="#max-msg-rate">max-msg-rate</a> for more examples on rate limit syntax that can be used with this directive.</p>
<p><strong>Syntax:</strong></p>
<pre><code>smtp-max-auth-failure-rate { unlimited | 0 | N/[M]{d|day|h|hr|m|min|s|sec} }
</code></pre>
<p>where "d" or "day" means per-day, "h" or "hr" means per-hour, "m" or "min" means per-minute and "s" or "sec" means per-second. <code>N</code> is required and must be non-zero, but <code>M</code> is optional. If <code>M</code> is not specified, it defaults to 1.</p>
<p><strong>Default:</strong> <code>unlimited</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
    smtp-max-auth-failure-rate 5/m
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="remove-header"><span class="header-section-number">3.3.7.8</span> remove-header</h4>
<p>Specifies a header that PowerMTA should remove from the incoming or outgoing message. The directive takes a comma separated list of headers if there is more than one header to be removed. The header is removed at delivery, not when the message is queued to disk. The directive may be used in a <code>&lt;source&gt;</code> or <code>&lt;domain&gt;</code>, but is not required to be defined in both.</p>
<p>Use empty string (<code>""</code>) to clear any inherited value.</p>
<p><strong>Syntax:</strong></p>
<pre><code>remove-header HEADER-LIST
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
    remove-header nameOfYourCustomHeader,nameOfOtherHeader
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="require-auth"><span class="header-section-number">3.3.7.9</span> require-auth</h4>
<p>Allows for requiring authentication before any emails are received via SMTP (local or not).</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
    require-auth true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="allow-mailmerge"><span class="header-section-number">3.3.7.10</span> allow-mailmerge</h4>
<p>Specifies whether PowerMTA should allow usage of the mailmerge SMTP extensions from the given source.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
    allow-mailmerge true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="allow-unencrypted-plain-auth"><span class="header-section-number">3.3.7.11</span> allow-unencrypted-plain-auth</h4>
<p>Specifies whether PowerMTA should allow usage of the PLAIN SASL authentication mechanism in unencrypted connections.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
     true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="allow-starttls"><span class="header-section-number">3.3.7.12</span> allow-starttls</h4>
<p>This directive controls whether PowerMTA supports the use of STARTTLS extension with clients that connect to it for submitting email.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
   allow-starttls true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="require-starttls-before-auth"><span class="header-section-number">3.3.7.13</span> require-starttls-before-auth</h4>
<p>Setting this directive to <code>true</code> will enforce the requirement that connecting clients must perform STARTTLS before issuing any AUTH commands during the session.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
    require-starttls-before-auth true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="broken-auth-clients"><span class="header-section-number">3.3.7.14</span> broken-auth-clients</h4>
<p>** Deprecated **</p>
<hr />
<h4 id="verp-default"><span class="header-section-number">3.3.7.15</span> verp-default</h4>
<p>If you enable VERP by setting <code>verp-default</code> to yes or true, PowerMTA will create a customized SMTP MAIL FROM address for the message based on the original SMTP MAIL FROM address and the RCPT TO addresses in the message. Since one can then identify the original RCPT TO address in this new encoded SMTP MAIL FROM address, this may make tracking bounces easier for you. The format is fixed, and can be see in the following example:</p>
<pre><code>Original SMTP MAIL FROM: jsmith@example.com
SMTP RCPT TO: jdoe@yahoo.com
VERPed SMTP MAIL FROM: jsmith-jdoe=yahoo.com@example.com
</code></pre>
<p><strong>Default:</strong> <code>no</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
   verp-default true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="check-dkim-inbound"><span class="header-section-number">3.3.7.16</span> check-dkim-inbound</h4>
<p>Specifies whether or not PowerMTA should enable checking DKIM signatures on inbound messages. If the message has DKIM signature header in it, PowerMTA will add an Authentication-Results header stating the results.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
   check-dkim-inbound true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="trace-dkim-check"><span class="header-section-number">3.3.7.17</span> trace-dkim-check</h4>
<p>Allows selecting whether the trace data (currently including all the DNS data looked up) is included in the Authentication-Results headers for the dkim check.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
   trace-dkim-check true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="trace-spf-check"><span class="header-section-number">3.3.7.18</span> trace-spf-check</h4>
<p>Requests inclusion of trace data (currently including all the DNS data looked up) for the SPF check in the Authentication-Results header.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
   trace-spf-check true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="check-spf-inbound"><span class="header-section-number">3.3.7.19</span> check-spf-inbound</h4>
<p>Specifies whether to perform an SPF check on inbound messages. PowerMTA adds an Authentication-Results header with the results of the test.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
   check-spf-inbound true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="check-spf-inbound-best-guess"><span class="header-section-number">3.3.7.20</span> check-spf-inbound-best-guess</h4>
<p><strong>Deprecated</strong> This directive is deprecated, do not use.</p>
<hr />
<h4 id="check-spf-inbound-max-void-lookups"><span class="header-section-number">3.3.7.21</span> check-spf-inbound-max-void-lookups</h4>
<p>Specifies the maximum number of void (empty or NXDOMAIN) responses to allow before failing the SPF check with permerror. A low number, such as 2, helps minimize certain denial-of-service attacks, but may also cause errors evaluating complicated SPF policies.</p>
<p><strong>Default:</strong> <code>2</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
   check-spf-inbound-max-void-lookups 5
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="check-iprev-inbound"><span class="header-section-number">3.3.7.22</span> check-iprev-inbound</h4>
<p>Determines if PowerMTA performs an inbound DNS PTR check on the IP and EHLO hostname used for the connection.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
   check-iprev-inbound true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="trace-iprev-check"><span class="header-section-number">3.3.7.23</span> trace-iprev-check</h4>
<p>Requests inclusion of trace data (currently including all the DNS data looked up) for the DNS PTR check in the Authentication-Results header.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
   trace-iprev-check true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="reject-iprev-check-temperror"><span class="header-section-number">3.3.7.24</span> reject-iprev-check-temperror</h4>
<p>If set to <code>true</code>, and DNS PTR check for a message returns a temp error (such as DNS lookup failure), PowerMTA will reject the message.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
   reject-iprev-check-temperror true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="reject-iprev-check-permerror"><span class="header-section-number">3.3.7.25</span> reject-iprev-check-permerror</h4>
<p>If set to <code>true</code>, and DNS PTR check for a message returns a perm error, PowerMTA will reject the message.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
   reject-iprev-check-permerror true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="reject-iprev-check-fail"><span class="header-section-number">3.3.7.26</span> reject-iprev-check-fail</h4>
<p>If set to <code>true</code>, and DNS PTR check for a message results in a failure, PowerMTA will reject the message.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
   reject-iprev-check-fail true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="suppress-local-dsn"><span class="header-section-number">3.3.7.27</span> suppress-local-dsn</h4>
<p>Disables the generation of DSN (bounce, delay or delivery) reports for messages received from this <code>&lt;source&gt;</code>.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
   suppress-local-dsn true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="dsn-return-default"><span class="header-section-number">3.3.7.28</span> dsn-return-default</h4>
<p>Specifies the default for the DSN RET parameter, i.e., whether the full message body or only its headers should be returned in a DSN delivery report. system specifies that the system default should be used. This directive is overridden by the use of "dsn-format plain-text".</p>
<p><strong>Syntax:</strong></p>
<pre><code>dsn-return-default { headers | full | system }
</code></pre>
<p><strong>Default:</strong> <code>system</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
   dsn-return-default headers
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="default-virtual-mta"><span class="header-section-number">3.3.7.29</span> default-virtual-mta</h4>
<p>Specifies the default VirtualMTA (or VirtualMTA pool) to select for all messages received from the source. This directive is used only when other higher priority methods of selecting a VirtualMTA (such as the use of <code>X-Virtual-Mta</code> header) are not applicable.</p>
<p>The special value <code>by-smtp-source-ip</code> can be used in place of a VirtualMTA name. When configured in this way, on an inbound SMTP connection PowerMTA will use as the default VirtualMTA whose "smtp-source-host" setting equals the destination IP address on the inbound connection.</p>
<p><strong>Syntax:</strong></p>
<pre><code>default-virtual-mta { VMTA-NAME | by-smtp-source-ip }
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 127.0.0.1&gt;
    default-virtual-mta mta1  # mta1 is a virtual MTA
&lt;/source&gt;

&lt;source 0/0&gt;
    default-virtual-mta by-smtp-source-ip
&lt;/source&gt;

</code></pre>
<hr />
<h4 id="log-tls"><span class="header-section-number">3.3.7.30</span> log-tls</h4>
<p>Specifies whether PowerMTA should log information about negotiation of a TLS session with the remote client during STARTTLS.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  log-tls true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="reject-invalid-virtual-mta"><span class="header-section-number">3.3.7.31</span> reject-invalid-virtual-mta</h4>
<p>Specifies that PowerMTA should reject messages when an invalid or null VirtualMTA is selected.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  reject-invalid-virtual-mta true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="disconnect-on-transient-error"><span class="header-section-number">3.3.7.32</span> disconnect-on-transient-error</h4>
<p>Specifies that PowerMTA should close connections instead of sending transient SMTP errors. This is useful in situations where the feeding software cannot process 4xx errors.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  disconnect-on-transient-error true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="hide-message-source"><span class="header-section-number">3.3.7.33</span> hide-message-source</h4>
<p>Specifies that PowerMTA should attempt to hide the source of the message while delivering email from this source. Currently, this just means that the name and IP address of the MTA from which PowerMTA received this message will not be included in the Received: header added. Hiding the message's source may be desirable, for example, for security purposes, to avoid revealing details from the internal network from which the message was submitted.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  hide-message-source true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="max-message-size"><span class="header-section-number">3.3.7.34</span> max-message-size</h4>
<p>Specifies the maximum size allowed in messages received through SMTP. If set to unlimited, no explicit limit is enforced.</p>
<p><strong>Syntax:</strong></p>
<pre><code>max-message-size { N{b|k|m|g|t} | 0 | unlimited }
</code></pre>
<p>where <code>N</code> is a positive integer followed by a size multiplier (<code>B</code> for byte, <code>K</code> for Kilobyte, <code>M</code> for Megabyte, <code>G</code> for Gigabyte or <code>T</code> for Terabyte).</p>
<p>An unsigned non-zero number is also accepted as the maximum size in bytes, but that syntax is deprecated.</p>
<p><strong>Default:</strong> <code>unlimited</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  max-message-size 40K
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="max-message-hops"><span class="header-section-number">3.3.7.35</span> max-message-hops</h4>
<p>Specifies the maximum number of "Received" headers that can be present in a message that PowerMTA accepts.</p>
<p><strong>Syntax:</strong></p>
<pre><code>max-message-hops N
</code></pre>
<p><strong>Default:</strong> <code>100</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  max-message-hops 50
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="max-rcpt-per-message"><span class="header-section-number">3.3.7.36</span> max-rcpt-per-message</h4>
<p>Specifies the maximum number of recipients accepted in each message. If set to zero or <code>unlimited</code>, no explicit limit is enforced.</p>
<p><strong>Syntax:</strong></p>
<pre><code>max-rcpt-per-message { N | unlimited }
</code></pre>
<p><strong>Default:</strong> <code>0</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  max-rcpt-per-message 10
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="too-many-rcpts-fails-message"><span class="header-section-number">3.3.7.37</span> too-many-rcpts-fails-message</h4>
<p>Specifies how PowerMTA should enforce the max-rcpt-per-message limit. If enabled and too many recipients are passed for a message, rather than reject the recipient(s) over the limit (RCPT SMTP command), PowerMTA rejects the entire message (DATA command).</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  too-many-rcpts-fails-message true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="suppression-lists"><span class="header-section-number">3.3.7.38</span> suppression-lists</h4>
<p>Specifies the suppression-list(s) to be used for suppressing addresses. Multiple lists may be specified, separating each list name with a comma. See <a href="#address-suppression-lists">Address Suppression Lists</a> for more information.</p>
<p><strong>Syntax:</strong></p>
<pre><code>suppression-lists SUPPRESSION-LIST-NAME
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;suppression-list foo&gt;
&lt;/suppression-list&gt;

&lt;source 0/0&gt;
  suppression-lists foo
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="pattern-list"><span class="header-section-number">3.3.7.39</span> pattern-list</h4>
<p>Specifies that messages received from the source are to be matched against the given pattern list. The pattern list referenced must precede the source definition in the configuration file. See <a href="#pattern-list-directives">&lt;pattern-list&gt; Directives</a> for more details.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pattern-list PATTERN-LIST-NAME
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;pattern-list foo&gt;
&lt;/pattern-list&gt;

&lt;source 0/0&gt;
  pattern-list foo
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="process-x-envid"><span class="header-section-number">3.3.7.40</span> process-x-envid</h4>
<p>Specifies whether PowerMTA should process x-envid headers. If set to true and one such header is included, PowerMTA will set the message's (DSN) envelope ID to the header's body, as well as remove the header from the message. If set to false, PowerMTA will ignore this header, leaving it in the message if present. While the envelope ID can be set by using the ENVID parameter in the SMTP MAIL command, this directive is useful when the software you use to submit the messages does not allow you to control it.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  process-x-envid true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="process-x-dkim-options"><span class="header-section-number">3.3.7.41</span> process-x-dkim-options</h4>
<p>Specifies whether PowerMTA should process x-dkim-options header. If set to true and one such header is included, PowerMTA will use any values in the header for signing messages with DKIM if DKIM signing is configured. If set to false, PowerMTA will ignore this header, leaving it in the message if present.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  process-x-dkim-options true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="process-x-dkim-key"><span class="header-section-number">3.3.7.42</span> process-x-dkim-key</h4>
<p>Specifies whether PowerMTA should process X-DKIM-Key headers. If set to true, PMTA will extract the private key specified in PEM format in the header X-DKIM-Key, use it for DKIM signing the message, and remove that header from the message prior to transmission. Note that if process-x-dkim-key isn't set, PowerMTA does not remove that header; you should test your setup to avoid leaking private keys. Also, this feature requires specifying the DKIM key selector (s=) in a X-DKIM-Options header and thus also enabling the per-source process-x-dkim-options directive.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  process-x-dkim-key true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="retain-x-dkim-key"><span class="header-section-number">3.3.7.43</span> retain-x-dkim-key</h4>
<p>Specifies whether PowerMTA should retain a processed x-dkim-key header in the message. If set to true, PowerMTA will keep the x-dkim-key header in the message when sending it on, otherwise that header will be removed. While this option is generally used in conjunction with the <code>process-x-dkim-key</code> option, they are completely independent of each other. Both directives can be set to false for example, in which case PowerMTA will ignore the header with regards to processing however still removing the header before delivery.</p>
<p><strong>Note: If this directive is set to <code>true</code>, the private key will be included in the email when PowerMTA delivers it. This is a security risk so it is strongly recommended to keep this directive set to <code>false</code>.</strong></p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  retain-x-dkim-key false
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="jobid-prefix"><span class="header-section-number">3.3.7.44</span> jobid-prefix</h4>
<p>Allows one to have PowerMTA add a custom prefix to the data supplied in the x-job: header in the message. A special reserved <code>{auth}</code> prefix has PowerMTA adding the actual authenticated user as the prefix, allowing for example, a relay service to more easily track messages sent through by PowerMTA by each authenticated user.</p>
<p><strong>Syntax:</strong></p>
<pre><code>jobid-prefix STRING
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  jobid-prefix customer1
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="process-x-job"><span class="header-section-number">3.3.7.45</span> process-x-job</h4>
<p>Specifies whether PowerMTA should process x-job headers. If set to true and one such header is included, PowerMTA will set the job ID for the message to the job ID given in the x-job header. The job ID must not include any non-printable or white space characters. A message is supposed to include at most one x-job header. If using Mailmerge, you must use the <code>*jobid</code> variable, and not the x-job header.</p>
<p>Sample header:</p>
<pre><code>x-job: abc123
</code></pre>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  process-x-job true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="jobid-header"><span class="header-section-number">3.3.7.46</span> jobid-header</h4>
<p>Allows setting an alternate header for which the message's jobId is set in place of using x-job. If other ways to set a jobId (such as x-job processing, if enabled, or <code>*jobId</code> mail merge variable) apply, they take precedence.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  jobid-header Campaign-Id
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="retain-x-job"><span class="header-section-number">3.3.7.47</span> retain-x-job</h4>
<p>Specifies whether PowerMTA should retain a processed x-job header in the message. If set to true, PowerMTA will keep the x-job header in the message when sending it on, otherwise that header will be removed. This option is only used if process-x-job is set to true and the message contains an x-job header.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  retain-x-job true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="process-x-virtual-mta"><span class="header-section-number">3.3.7.48</span> process-x-virtual-mta</h4>
<p>Specifies whether PowerMTA should process x-virtual-mta headers. If set to true and one such header is included, PowerMTA will select the VirtualMTA specified in the header's body for the message, as well as remove the header from the message. If set to false, PowerMTA will ignore this header, leaving it in the message if present. You should enable this directive for the source IP addresses from which you feed messages if you would like to use the x-virtual-mta header to select which VirtualMTA to use.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  process-x-virtual-mta true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="retain-x-virtual-mta"><span class="header-section-number">3.3.7.49</span> retain-x-virtual-mta</h4>
<p>Specifies whether PowerMTA should retain a processed x-virtual-mta header in the message. If set to true, PowerMTA will keep the x-virtual-mta header in the message when sending it on, otherwise that header will be removed. This option is only used if process-x-virtual-mta is set to true and the message contains an x-virtual-mta header.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  retain-x-virtual-mta true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="add-x-virtual-mta-header"><span class="header-section-number">3.3.7.50</span> add-x-virtual-mta-header</h4>
<p>Requests that an "X-Virtual-MTA" header be added to the message with the name of the Virtual MTA from which it was delivered, if no such header is already present.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  add-x-virtual-mta-header true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="source-group"><span class="header-section-number">3.3.7.51</span> source-group</h4>
<p>Specifies the name of a source group to associate the given source to, allowing linking sources to groups (and thus grouping sources). The directive allows for specifying certain source configuration items whose functionality require them to be grouped by name. The shared resources will be defined in the &lt;source-group&gt; tag.</p>
<p><strong>Syntax:</strong></p>
<pre><code>source-group SOURCE-GROUP-NAME
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;source-group localSources&gt;
    max-smtp-in 10
    reserved-smtp-in 5
&lt;/source-group&gt;

&lt;source 192.168.0.30&gt;
    smtp-service yes
    always-allow-relaying yes
    source-group localSources
&lt;/source&gt;

&lt;source 192.168.0.40&gt;
    smtp-service yes
    always-allow-relaying yes
    source-group localSources
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="smtp-data-timeout"><span class="header-section-number">3.3.7.52</span> smtp-data-timeout</h4>
<p>Specifies the amount of time that PowerMTA will wait for data from the remote end during data reception phase (after DATA/BDAT command) of the message. Applies to inbound connections only.</p>
<p><strong>Syntax:</strong></p>
<pre><code>smtp-data-timeout TIME-INTERVAL
</code></pre>
<p><strong>Default:</strong> <code>10m</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  smtp-data-timeout 5m
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="smtp-command-timeout"><span class="header-section-number">3.3.7.53</span> smtp-command-timeout</h4>
<p>Specifies the amount of time that PowerMTA will wait for data to be sent from a remote end during inbound SMTP command exchanges.</p>
<p><strong>Syntax:</strong></p>
<pre><code>smtp-command-timeout TIME-INTERVAL
</code></pre>
<p><strong>Default:</strong> <code>10m</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  smtp-command-timeout 5m
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="process-x-schedule"><span class="header-section-number">3.3.7.54</span> process-x-schedule</h4>
<p>Specifies whether PowerMTA should process the x-schedule header if included in the message. If set to true and one such header is included, PowerMTA will respect the schedule defined in the header, and only attempt to deliver messages per the schedule. If set to false, PowerMTA will ignore this header and attempt to deliver normally, without any time based schedule.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  process-x-schedule true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="retain-x-schedule"><span class="header-section-number">3.3.7.55</span> retain-x-schedule</h4>
<p>Specifies whether PowerMTA should leave the x-schedule header in the message when messages are delivered (when using PowerMTA's Schedule Delivery Control feature). While this option is generally used in conjunction with the process x-schedule header option, they are completely independent of each other. Both can be set to false for example, which has PowerMTA ignoring the header with regards to processing however still removing the header before delivery.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  retain-x-schedule true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="retain-x-dkim-options"><span class="header-section-number">3.3.7.56</span> retain-x-dkim-options</h4>
<p>Specifies whether PowerMTA should retain the x-dkim-options header when sending a message to a remote mail server.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  retain-x-dkim-options true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="allow-chunking"><span class="header-section-number">3.3.7.57</span> allow-chunking</h4>
<p>Specifies whether PowerMTA should allow usage of the CHUNKING SMTP extension (i.e., the BDAT command) on inbound connections from the source.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  allow-chunking true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="allow-smtputf8"><span class="header-section-number">3.3.7.58</span> allow-smtputf8</h4>
<p>Specifies whether one can submit internationalized email addresses per RFC6531 to PowerMTA from the connecting IP address. When set to yes (or true), PowerMTA will list "SMTPUTF8" in the list of extended SMTP commands supported for the connecting IP, allowing the submitter to use internationalized email addresses in the SMTP envelope. Note that if the remote gateway for the domain does not advertise support for SMTPUTF8, PowerMTA will subsequently bounce the message(s) for the recipient out of the queue.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  allow-smtputf8 true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="smtp-service"><span class="header-section-number">3.3.7.59</span> smtp-service</h4>
<p>Specifies whether to allow access to the SMTP service to connections from the given source. If set to false, PowerMTA issues a 5XX SMTP greeting like</p>
<pre><code>521 mta1.foo.com does not accept mail from you
</code></pre>
<p>instead of the regular one:</p>
<pre><code>220 mta1.foo.com (PowerMTA v5.0r1) ESMTP service ready
</code></pre>
<p>Note that since the default is to grant SMTP service, if you only wish to restrict service to specific sources you must specify that in the 0/0 entry, as in the example below.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 10.0.0.1&gt; # we feed from 10.0.0.1
    smtp-service yes
    always-allow-relaying yes # normally desirable for feeder sources
&lt;/source&gt;

&lt;source 0/0&gt;
    smtp-service no
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="log-connections"><span class="header-section-number">3.3.7.60</span> log-connections</h4>
<p>Instructs PowerMTA to write an entry in the log at the beginning and end of each connection.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code># log *all* incoming connections
&lt;source 0/0&gt;
  log-connections yes
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="log-commands"><span class="header-section-number">3.3.7.61</span> log-commands</h4>
<p>Instructs PowerMTA to log the full SMTP protocol exchanges between itself and the receiving or sending mailer. Since it displays at which point of the delivery process an error occurs, enabling this directive is generally the first and most useful step in debugging connectivity problems.</p>
<p>Sample Log output:</p>
<pre><code>2003-06-29 15:32:00 ( 20)starting aol.com
2003-06-29 15:32:00 ( 20)connecting to yh.mx.aol.com (205.188.157.1)
2003-06-29 15:32:00 ( 20)&gt;&gt;&gt; 220-rly-yh01.mx.aol.com ESMTP relay_in.5; Thu, 29 Jun 2003 09:27:58
-0400
2003-06-29 15:32:00 ( 20)&gt;&gt;&gt; 220-America Online (AOL) and its affiliated companies do not
2003-06-29 15:32:00 ( 20)&gt;&gt;&gt; 220- authorize the use of its proprietary computers and computer
2003-06-29 15:32:00 ( 20)&gt;&gt;&gt; 220- networks to accept, transmit, or distribute unsolicited bulk
2003-06-29 15:32:00 ( 20)&gt;&gt;&gt; 220 email sent from the internet.
2003-06-29 15:32:00 ( 20)&lt;&lt;&lt; EHLO hazmat.port25.com
2003-06-29 15:32:00 ( 20)&gt;&gt;&gt; 250-rly-yh01.mx.aol.com hazmat.port25.com
2003-06-29 15:32:00 ( 20)&gt;&gt;&gt; 250 HELP
...
</code></pre>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  log-commands true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="log-data"><span class="header-section-number">3.3.7.62</span> log-data</h4>
<p>This directive is useful for debugging protocol or interoperability problems between the mailers, for it logs every byte sent, both in ASCII and hexadecimal. This would help show things like whether your messages may be finishing its lines with just LF (line feeds) instead of the CRLF (carriage return, line feed) pair as prescribed by the standards, and the hex data allows you to identify non-printable characters (such as CR and LF) based on their hex codes.</p>
<p>Sample Log output:</p>
<pre><code>2003-06-29 09:53:59 ( 19)starting yahoo.com
2003-06-29 09:53:59 ( 19)connecting to mx1.mail.yahoo.com (128.11.68.155)
2003-06-29 09:54:04 ( 19)&gt;&gt;&gt; rd 53
2003-06-29 09:54:04 ( 19)3232302059536D7470206D7461313334 220 YSmtp mta134
2003-06-29 09:54:04 ( 19)2E6D61696C2E7961686F6F2E636F6D20 .mail.yahoo.com
2003-06-29 09:54:04 ( 19)45534D54502073657276696365207265 ESMTP service re
2003-06-29 09:54:04 ( 19)6164790D0A                       ady..
2003-06-29 09:54:04 ( 19)&lt;&lt;&lt; wr 24
2003-06-29 09:54:04 ( 19)45484C4F2068617A6D61742E706F7274 EHLO hazmat.port
2003-06-29 09:54:04 ( 19)32352E636F6D0D0A                 25.com..
2003-06-29 09:54:04 ( 19)&gt;&gt;&gt; rd 75
2003-06-29 09:54:04 ( 19)3235302D6D74613133342E6D61696C2E 250-mta134.mail.
2003-06-29 09:54:04 ( 19)7961686F6F2E636F6D0D0A3235302D38 yahoo.com..250-8
2003-06-29 09:54:04 ( 19)4249544D494D450D0A3235302D53495A BITMIME..250-SIZ
2003-06-29 09:54:04 ( 19)4520333134353732380D0A3235302050 E 3145728..250 P
2003-06-29 09:54:04 ( 19)4950454C494E494E470D0A           IPELINING..
2003-06-29 09:54:04 ( 19)&lt;&lt;&lt; wr 43
2003-06-29 09:54:04 ( 19)4D41494C2046524F4D3A3C696E666F40 MAIL FROM:&lt;info@
2003-06-29 09:54:04 ( 19)706F727432352E636F6D3E20424F4459 port25.com&gt; BODY
2003-06-29 09:54:04 ( 19)3D384249544D494D450D0A           =8BITMIME..
2003-06-29 09:54:04 ( 19)&gt;&gt;&gt; rd 33
2003-06-29 09:54:04 ( 19)3235302073656E646572203C696E666F 250 sender &lt;info
2003-06-29 09:54:04 ( 19)40706F727432352E636F6D3E206F6B0D @port25.com&gt; ok.
2003-06-29 09:54:04 ( 19)0A                               .
2003-06-29 09:54:04 ( 19)&lt;&lt;&lt; wr 29
...
</code></pre>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  log-data true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="allow-empty-x-virtual-mta"><span class="header-section-number">3.3.7.63</span> allow-empty-x-virtual-mta</h4>
<p>Specifies PowerMTA should allow an empty string value for the x-virtual-mta header. If set to yes and such a header is passed (for example, <code>x-virtual-mta: </code>), the message will be accepted and then queued to the {default} VirtualMTA.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  allow-empty-x-virtual-mta true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="accept-invalid-recipients"><span class="header-section-number">3.3.7.64</span> accept-invalid-recipients</h4>
<p>Allows feeding invalid recipients into PowerMTA (which are then immediately bounced). Invalid in this sense means syntactically illegal email addresses (i.e., me@there or you@yahoo..com), but not e.g., bad mailboxes (syntactically correct but non-existent email addresses). Pickup directory is not supported. For this functionality in a pickup file use XACK OFF/ON. See <a href="#bsmtp-files">BSMTP Files</a> for more information.</p>
<p>** Note that any such recipients (with syntax errors in their addresses) are immediately bounced and never delivered. This directive only prevents the rejections from happening within the session that the recipients were submitted in. **</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  accept-invalid-recipients true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="reject-spf-check-temperror"><span class="header-section-number">3.3.7.65</span> reject-spf-check-temperror</h4>
<p>Specifies whether to reject the MAIL command (with a 4xx error) in the SMTP protocol if the SPF check results in a temporary error, such as when unable to look up certain DNS records.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  reject-spf-check-temperror true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="reject-spf-check-permerror"><span class="header-section-number">3.3.7.66</span> reject-spf-check-permerror</h4>
<p>Specifies whether to reject the MAIL command (with a 5xx error) in the SMTP protocol if the SPF check results in a permanent error, such as when there is a syntax error in a SPF record.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  reject-spf-check-permerror true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="reject-spf-check-fail"><span class="header-section-number">3.3.7.67</span> reject-spf-check-fail</h4>
<p>Specifies whether to reject the MAIL command (with a 5xx error) in the SMTP protocol if the SPF check results in a failure, such as when email is being sent from an unauthorized IP address.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  reject-spf-check-fail true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="always-allow-api-submission"><span class="header-section-number">3.3.7.68</span> always-allow-api-submission</h4>
<p>This directive allows easily enabling all SMTP permissions and features required by our submission APIs. If set to "yes", this is currently equivalent to setting "allow-mailmerge yes". If set to "no", the other settings determine whether submission is allowed.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  always-allow-api-submission true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="auto-qualify-domain"><span class="header-section-number">3.3.7.69</span> auto-qualify-domain</h4>
<p>Specifies whether PowerMTA should automatically qualify the domain name in any email addresses received whose domain is not yet fully qualified. For example, if MAIL FROM:<a href="mailto:user@host">user@host</a> is received and the host running PowerMTA is named mail.foo.com, then that address is changed into <a href="mailto:user@host.foo.com">user@host.foo.com</a>. Automatic qualification is done by appending the <em>domain suffix</em>, which is also configurable.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
  auto-qualify-domain true
&lt;/source&gt;
</code></pre>
<hr />
<h4 id="include-1"><span class="header-section-number">3.3.7.70</span> include</h4>
<p>This directive specifies an additional configuration file to process. This can be used, for example, to facilitate maintenance of the configuration files across multiple hosts, by storing those settings which differ from host to host in a separate file and including it from the main (common) file. Wildcards may be used. An include may be used anywhere including in a <code>&lt;source&gt;</code>, <code>&lt;domain&gt;</code>, <code>&lt;virtual-mta&gt;</code> or <code>&lt;smtp-pattern-list&gt;</code> tag.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source 0/0&gt;
    include /etc/pmta/smtp-patterns.txt
&lt;/source&gt;
</code></pre>
<hr />
<h3 id="smtp-user-directives"><span class="header-section-number">3.3.8</span> &lt;smtp-user&gt; Directives</h3>
<p><code>&lt;smtp-user&gt;</code> directives can used to be configure credentials for users who are allowed to relay email through the system, regardless of the IP from which they are submitting the mail to PowerMTA. Authenticating users can be done either through the use of passwords, or through system logins(Linux only) or using certificates.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;smtp-user foo&gt;
    password barbaz
    authentication-method password
    source source-1
&lt;/smtp-user&gt;

&lt;smtp-user bar&gt;
    authentication-method certificate
    tls-certificate /etc/pmta/bar-cert.pem
    source source-2
&lt;/smtp-user&gt;
</code></pre>
<h4 id="password"><span class="header-section-number">3.3.8.1</span> password</h4>
<p>Specifies the password for the defined user in <code>&lt;smtp-user&gt;</code>. The <code>authentication-method</code> must be set to <code>password</code> for this directive to be effective.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;smtp-user foo&gt;
    password barbaz
    authentication-method password
&lt;/smtp-user&gt;
</code></pre>
<hr />
<h4 id="authentication-method"><span class="header-section-number">3.3.8.2</span> authentication-method</h4>
<p>Specifies how to authenticate a user logging in to PowerMTA via SMTP. Possible values are:</p>
<ul>
<li><strong>password</strong> - The user needs to enter the password as configured by the password directive.</li>
<li><strong>certificate</strong> - The user needs to send the TLS certificate configured by the tls-certificate directive. This requires a TLS connection, either by using STARTTLS in the SMTP dialog or by opening a TLS encrypted connection to PowerMTA. Make sure the submitting applications are configured to support this.</li>
<li><strong>system</strong> (Linux only) - PowerMTA will check the user's submitted password against the Linux system's user accounts.</li>
</ul>
<p><strong>Syntax:</strong></p>
<pre><code>authentication-method { password | system | certificate }
</code></pre>
<p><strong>Default:</strong> <code>password</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;smtp-user foo&gt;
    password barbaz
    authentication-method password
&lt;/smtp-user&gt;
</code></pre>
<hr />
<h4 id="tls-certificate"><span class="header-section-number">3.3.8.3</span> tls-certificate</h4>
<p>Specifies the file name containing the certificate the user needs to provide when authenticating to PowerMTA in the SMTP dialog. You can use PowerMTA's pmtakeytool that ships with PowerMTA to create a certificate. Another option is to use OpenSSL's command line tools. (Please see the OpenSSL documentation for details.)</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;smtp-user foo&gt;
    authentication-method certificate
    tls-certificate /etc/pmta/bar-cert.pem
&lt;/smtp-user&gt;
</code></pre>
<hr />
<h4 id="source"><span class="header-section-number">3.3.8.4</span> source</h4>
<p>Specifies the <code>&lt;source&gt;</code> to be used for the defined user in <code>&lt;smtp-user&gt;</code>.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;smtp-user foo&gt;
    authentication-method certificate
    tls-certificate /etc/pmta/bar-cert.pem
    source source-1
&lt;/smtp-user&gt;
</code></pre>
<hr />
<h3 id="source-group-directives"><span class="header-section-number">3.3.9</span> &lt;source-group&gt; Directives</h3>
<h4 id="max-smtp-in"><span class="header-section-number">3.3.9.1</span> max-smtp-in</h4>
<p>Specifies a limit for the number of incoming connections from that source group.</p>
<p><strong>Default:</strong> <code>unlimited</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source-group one&gt;
    max-smtp-in 1000
&lt;/source-group&gt;
</code></pre>
<hr />
<h4 id="reserved-smtp-in"><span class="header-section-number">3.3.9.2</span> reserved-smtp-in</h4>
<p>Specifies that a certain number of inbound connections are to be reserved to connections from the given source group.</p>
<p><strong>Default:</strong> <code>unlimited</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source-group one&gt;
    reserved-smtp-in 10
&lt;/source-group&gt;
</code></pre>
<hr />
<h3 id="domain-directives"><span class="header-section-number">3.3.10</span> &lt;domain&gt; Directives</h3>
<p>These directives are specified with a domain pattern and apply to all matching domains, such as in</p>
<pre><code>&lt;domain *.port25.com&gt;
    bounce-after 6d
&lt;/domain&gt;
</code></pre>
<p>Domain directives may be added in any order to the configuration file. When PowerMTA needs to determine what parameters to use for a specific domain, it uses the <em>best</em> matching (most specific) entry, regardless of the order domain directives are placed into the configuration file:</p>
<pre><code>&lt;domain discard.port25.com&gt; # matches &#39;discard&#39; only
    ...
&lt;/domain&gt;

&lt;domain *.port25.com&gt; # matches subdomains of port25.com
    ...
&lt;/domain&gt;

&lt;domain [*.]port25.com&gt; # matches port25.com and all subdomains
    ...
&lt;/domain&gt;

&lt;domain *&gt; # matches all domains
    ...
&lt;/domain&gt;
</code></pre>
<p>When PowerMTA reads the configuration file, it merges settings for related domains from more general to more specific domains, so you can provide defaults for all domains by specifying them for the <code>*</code> pseudo-domain or for a specific site by specifying them for the toplevel domain for the site.</p>
<p>In the following example, commands will be logged for all proper subdomains of port25.com (but not for port25.com itself) and undelivered messages to any address at port25.com will bounce after four days, except for messages to discard.port25.com, which will bounce after one hour.</p>
<pre><code>&lt;domain discard.port25.com&gt;
    bounce-after 1h
&lt;/domain&gt;

&lt;domain *.port25.com&gt;
    log-commands yes
&lt;/domain&gt;

&lt;domain [*.]port25.com&gt;
    bounce-after 4d
&lt;/domain&gt;

&lt;domain *&gt;
    bounce-after 4d
&lt;/domain&gt;
</code></pre>
<p>You can use domain macros to specify settings for multiple domains at once. For example, if you could use</p>
<pre><code>domain-macro topLevel com, de, co.uk

&lt;domain yahoo.$topLevel&gt;
    ...settings...
&lt;/domain&gt;
</code></pre>
<p>to configure settings that apply to <code>yahoo.com</code>, <code>yahoo.de</code> and <code>yahoo.co.uk</code>.</p>
<p>You can also use macros within macros:</p>
<pre><code>domain-macro com com, co.uk, com.br
domain-macro tld $com, org, net
</code></pre>
<p>In which case tld expands to com, co.uk, com.br, org and net. Any loops are detected and result in a configuration load or startup error.</p>
<p>Also, specifically listed domains always take precedence over expanded ones. For example, in</p>
<pre><code>&lt;domain aol.com&gt;
    max-smtp-out 100
&lt;/domain&gt;

domain-macro com com, co.uk

&lt;domain aol.$com&gt;
    max-smtp-out 50
&lt;/domain&gt;
</code></pre>
<p><code>aol.com</code> would have a limit of 100.</p>
<h4 id="max-errors-per-connection"><span class="header-section-number">3.3.10.1</span> max-errors-per-connection</h4>
<p>This directive tells PowerMTA to break a connection after a certain amount of recipient level errors. The default is unlimited, meaning that PowerMTA will not break a connection due to a number of recipient level errors.</p>
<p><strong>Default:</strong> <code>unlimited</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  max-errors-per-connection 10
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="check-spf-outbound"><span class="header-section-number">3.3.10.2</span> check-spf-outbound</h4>
<p>Specifies whether PowerMTA should perform an SPF check on outbound messages to ensure compliance. If enabled and the check returns a "Pass", message delivery continues; if instead it returns a "TempError", the message is retried. Otherwise, the message bounces. To use this feature, you must currently configure a specific smtp-source-host (either at the global or VirtualMTA level).</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  check-spf-outbound true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="dsn-format"><span class="header-section-number">3.3.10.3</span> dsn-format</h4>
<p>The default is "standard", which has PowerMTA send a DSN in the standard format. If set to "plain-text", the "message/delivery-status" portion of the DSN report is delivered instead of the full report. The portion is delivered within a mime-type of "text/plain", thus allowing this data to pass through (overzealous) email firewalls that strip all "attachments"</p>
<p><strong>Syntax:</strong></p>
<pre><code>dsn-format { standard | plain-text }
</code></pre>
<p><strong>Default:</strong> <code>standard</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  dsn-format plain-text
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="log-resolution"><span class="header-section-number">3.3.10.4</span> log-resolution</h4>
<p>Specifies that PowerMTA should log information on DNS (name and routing) lookups performed for the domain. This information is generally useful when debugging DNS-based connectivity problems (such as misconfigured DNS entries).</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  log-resolution true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="log-transfer-failures"><span class="header-section-number">3.3.10.5</span> log-transfer-failures</h4>
<p>Specifies whether PowerMTA should write a warning to the logging file when connections fail while transferring message's contents (headers and body). Setting this directive to true may help when diagnosing delivery problems, especially duplicate or partial deliveries.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  log-transfer-failures true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="log-resolution-1"><span class="header-section-number">3.3.10.6</span> log-resolution</h4>
<p>Specifies that PowerMTA should log information on DNS (name and routing) lookups performed for the domain. This information is generally useful when debugging DNS-based connectivity problems (such as misconfigured DNS entries).</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
   log-resolution true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="log-disabled-ips"><span class="header-section-number">3.3.10.7</span> log-disabled-ips</h4>
<p>Turns on logging to show when and which IPs were disabled.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  log-disabled-ips true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="max-events-recorded"><span class="header-section-number">3.3.10.8</span> max-events-recorded</h4>
<p>Specifies the number of <em>events</em> PowerMTA is to record about the given domain. These events are not written to the logging file, but just recorded in memory. They can be viewed using the pmta show domains and the pmta show topdomains commands, or via the web interface. While recording such events can be very useful when investigating delivery problems, may have have an impact on memory consumption. Currently only error events are recorded.</p>
<p><strong>Default:</strong> <code>10</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain port25.com&gt;
    max-events-recorded 3
&lt;/domain&gt;
</code></pre>
<p>At the command prompt:</p>
<pre><code>$ pmta show dom port25.com --errors
-----------------------------domain --#rcpt ---kbytes conn last error----------
port25.com 4 0.5 0 ETIMEDOUT connect...

2003-06-19 16:40:10 ETIMEDOUT connecting to mail.port25.com (193.96.192.241)
2003-06-19 16:40:10 ETIMEDOUT connecting to mail.port25.com (193.96.192.241)
2003-06-19 16:40:10 ETIMEDOUT connecting to mail.port25.com (193.96.192.241)

1 of 10 domains shown.
</code></pre>
<h4 id="disable-acct-records"><span class="header-section-number">3.3.10.9</span> disable-acct-records</h4>
<p>Allows one to disable the creation of one or more than one type of accounting file record on a per queue (domain / virtualMTA) basis. For example, there are times when a user wants PowerMTA to discard certain messages without creating an accounting file record for these messages when discarded. By default, PowerMTA would create a "d" (delivered ) record for this, since it was delivered to discard, however the creation of a delivered record can be disabled with this option.</p>
<p><strong>Syntax:</strong></p>
<pre><code>disable-acct-records TYPES
</code></pre>
<p>where <code>TYPES</code> can be one or more of <code>d,b,t,tq</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  disable-acct-records d,b,t,tq
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="deliver-local-dsn"><span class="header-section-number">3.3.10.10</span> deliver-local-dsn</h4>
<p>Specifies whether PowerMTA should generate DSN (bounce, delay or delivery) reports for messages received <strong>from</strong> the domain specified in this <code>&lt;domain&gt;</code>. Accounting records are still written normally, so this only affects the actual report emails.</p>
<p><strong>Deprecated</strong> Use <code>&lt;source&gt; suppress-local-dsn</code> instead.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain bounce.port25.com&gt;
    deliver-local-dsn no
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="bounce-after"><span class="header-section-number">3.3.10.11</span> bounce-after</h4>
<p>Determines the maximum amount of time PowerMTA will continue to try to deliver messages to the specified destination domain. Messages older than this time interval are bounced, i.e., a (non-)delivery report in DSN format will be sent back to the originator.</p>
<p><strong>Syntax:</strong></p>
<pre><code>bounce-after TIME-INTERVAL
</code></pre>
<p><strong>Default:</strong> <code>4d12h</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  bounce-after 1d
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="bcc-upon-delivery"><span class="header-section-number">3.3.10.12</span> bcc-upon-delivery</h4>
<p>Automatically BCC delivered emails to the given address.</p>
<p>Use empty string (<code>""</code>) to clear any inherited value.</p>
<p><strong>Syntax:</strong></p>
<pre><code>bcc-upon-delivery EMAIL-ADDRESS
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  bcc-upon-delivery foo@bar.com
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="allow-priority-interruption"><span class="header-section-number">3.3.10.13</span> allow-priority-interruption</h4>
<p>When set to "no", this directive prevents interruptions by higher priority queues.</p>
<p><strong>Default:</strong> <code>yes</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  allow-priority-interruption true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="allow-priority-interruption-during-transfer"><span class="header-section-number">3.3.10.14</span> allow-priority-interruption-during-transfer</h4>
<p>When set to 'no', the interruption is delayed until a connection is available. When set to 'yes', the interruption to an existing connection happens immediately. This directive applies to SMTP queues only.</p>
<p><strong>Default:</strong> <code>no</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  allow-priority-interruption-during-transfer true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="queue-priority"><span class="header-section-number">3.3.10.15</span> queue-priority</h4>
<p>When PowerMTA needs to deliver email for a queue but no connection slots are available, it looks for a queue with lower priority currently connected and interrupts as many connections as needed, starting with the lowest priority connections and working its way up. A queue's priority is set with a number between 0 (lowest) and 100 (highest); 50 by default.</p>
<p><strong>Default:</strong> <code>50</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  queue-priority 75
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="track-recipient-events"><span class="header-section-number">3.3.10.16</span> track-recipient-events</h4>
<p>Determines whether PowerMTA will keep track of the last 50 recipient delivery, bounce, and deferred events in memory.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  track-recipient-events true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="delivery-priority"><span class="header-section-number">3.3.10.17</span> delivery-priority</h4>
<p><strong>Deprecated</strong> use <code>queue-priority</code></p>
<hr />
<h4 id="notify-of-delay-every"><span class="header-section-number">3.3.10.18</span> notify-of-delay-every</h4>
<p>Sets how often PowerMTA checks to see if delay notification messages should be sent when using NOTIFY=DELAY option with RCPT TO command.</p>
<p><strong>Syntax:</strong></p>
<pre><code>notify-of-delay-every { TIME-INTERVAL | never }
</code></pre>
<p><strong>Default:</strong> <code>4h</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  notify-of-delay-every 1h
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="dkim-sign"><span class="header-section-number">3.3.10.19</span> dkim-sign</h4>
<p>Specifies whether or not PowerMTA should perform DKIM signing on messages destined for this domain. Domain keys must be configured for this directive to take effect. Please see the <code>domain-key</code> directive below for more information. Also accepts a special value: <code>if-x-dkim-options-present</code> as a way to enable DKIM signing only when an <code>X-DKIM-Options</code> header is present in the email. The directive continues to accept 'yes' and 'no' settings with their existing meaning.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  dkim-sign true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="dkim-add-body-limit"><span class="header-section-number">3.3.10.20</span> dkim-add-body-limit</h4>
<p>Specify whether to add an l= tag with the body length to the DKIM signature, limiting the signed portion of the body. This allows further content to be added at the bottom of the message without invalidating the signature.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  dkim-add-body-limit true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="dkim-add-timestamp"><span class="header-section-number">3.3.10.21</span> dkim-add-timestamp</h4>
<p>Specify whether to a timestamp to the DKIM signature.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  dkim-add-timestamp true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="dkim-algorithm"><span class="header-section-number">3.3.10.22</span> dkim-algorithm</h4>
<p>Specify which DKIM signing algorithm to use.</p>
<p><strong>Syntax:</strong></p>
<pre><code>dkim-algorithm { rsa-sha1 | rsa-sha256 }
</code></pre>
<p><strong>Default:</strong> <code>rsa-sha256</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  dkim-algorithm rsa-sha1
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="dkim-body-canon"><span class="header-section-number">3.3.10.23</span> dkim-body-canon</h4>
<p>Specify which DKIM canonicalization to apply to the message body.</p>
<p><strong>Syntax:</strong></p>
<pre><code>dkim-body-canon { simple | relaxed }
</code></pre>
<p><strong>Default:</strong> <code>relaxed</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  dkim-body-canon simple
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="dkim-headers-canon"><span class="header-section-number">3.3.10.24</span> dkim-headers-canon</h4>
<p>Specify which DKIM canonicalization to apply to the message headers.</p>
<p><strong>Syntax:</strong></p>
<pre><code>dkim-headers-canon { simple | relaxed }
</code></pre>
<p><strong>Default:</strong> <code>relaxed</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  dkim-headers-canon simple
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="dkim-expire-after"><span class="header-section-number">3.3.10.25</span> dkim-expire-after</h4>
<p>Requests that an x= tag be included in the DKIM signature to indicate when it expires.</p>
<p><strong>Syntax:</strong></p>
<pre><code>dkim-expire-after { TIME-INTERVAL | never }
</code></pre>
<p><strong>Default:</strong> <code>never</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  dkim-expire-after 1d
&lt;/domain&gt;

&lt;domain yahoo.com&gt;
  dkim-expire-after never
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="dkim-query-method"><span class="header-section-number">3.3.10.26</span> dkim-query-method</h4>
<p>Specifies the value of the <code>q=</code> tag in DKIM signatures.</p>
<p><strong>Syntax:</strong></p>
<pre><code>dkim-query-method STRING
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  dkim-query-method dns/txt
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="dkim-headers"><span class="header-section-number">3.3.10.27</span> dkim-headers</h4>
<p>Specifies the headers to be used for DKIM signing. The following headers will always be used if included in the message and cannot be removed:</p>
<ul>
<li>CC</li>
<li>List-Id</li>
<li>Resent-Date</li>
<li>Content-Description</li>
<li>List-Owner</li>
<li>Resent-From</li>
<li>Content-Id</li>
<li>List-Post</li>
<li>Resent-Message-ID</li>
<li>Content-Transfer-Encoding</li>
<li>List-Subscribe</li>
<li>Resent-Sender</li>
<li>Content-Type</li>
<li>List-Unsubscribe</li>
<li>Resent-To</li>
<li>Date</li>
<li>MIME-Version</li>
<li>Sender</li>
<li>From</li>
<li>Message-ID</li>
<li>Subject</li>
<li>In-Reply-To</li>
<li>References</li>
<li>To</li>
<li>List-Archive</li>
<li>Reply-To</li>
<li>List-Help</li>
<li>Resent-Cc</li>
</ul>
<p>RFC 4871 forbids signing the following headers:</p>
<ul>
<li>Bcc</li>
<li>Keywords</li>
<li>Return-Path</li>
<li>Comments</li>
<li>Received</li>
<li>DKIM-Signature</li>
<li>Resent-Bcc</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain yahoo.com&gt;
    dkim-headers foo                 # exact match one header
&lt;/domain&gt;

&lt;domain hotmail.com&gt;
    dkim-headers foo, bar, baz       # exact match many headers
&lt;/domain&gt;

&lt;domain gmail.com&gt;
    dkim-headers /foo/               # regular expression
&lt;/domain&gt;

&lt;domain aol.com&gt;
    dkim-headers /foo/, /bar/, /baz/ # many regular expressions
&lt;/domain&gt;

&lt;domain comcast.net&gt;
    dkim-headers foo, /bar/          # exact match and a regular expression
&lt;/domain&gt;

&lt;domain port25.com&gt;
    dkim-headers &quot;&quot;                  # no changes to default headers
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="dkim-identity"><span class="header-section-number">3.3.10.28</span> dkim-identity</h4>
<p>Specifies the domain or email address of the signing identity to be used when signing messages with DKIM. (Supported in the DKIM specification only). If defined, and the domain matches, or is a subdomain of the domain defined in the "domain-key" directive, the domain will be used in place of the Sender or From: header domain for signing and for subsequent key verification by the receiving gateways. This may be useful for those who are sending on behalf of another party, and do not have control of the other party's DNS record. A service provider for example, can sign mail using their own private key, use their own email address/domain as the signing identity, and have their own public key in their own DNS record for validation, all while having the From: header domain in the messages sent being the domain of their customer. The "dkim-identity" address will be seen in the i= parameter in the signature, while the d= parameter is set via the domain used in the "domain-key" directive and which has to match or be the parent domain in the dkim-identity directive. The directive also takes the keyword <code>strict-from</code> which requires an exact match for the From: header's domain to find a matching domain key for signing. Any sub-domain or the sender header will not be used.</p>
<p>In the above example, the "From:" or "Sender:" headers can be a different domain then "esp123.com", but it will be the domain "esp123.com" that will be used for the signing, and, the public key in the TXT record in DNS for the domain <code>key1._domainkey.esp123.com</code> will be the one checked for verification.</p>
<p><strong>Syntax:</strong></p>
<pre><code>dkim-identity { EMAIL-ADDRESS | DOMAIN | sender-or-from }
</code></pre>
<p><strong>Default:</strong> <code>sender-or-from</code></p>
<p><strong>Example:</strong></p>
<pre><code>domain-key key1,esp123.com,c:\pmta\m.pem

&lt;domain yahoo.com&gt;
    dkim-sign yes
    dkim-identity @esp123.com
&lt;/domain&gt;

&lt;domain hotmail.com&gt;
    dkim-sign yes
    dkim-identity sender-or-from
&lt;/domain&gt;

&lt;domain gmail.com&gt;
    dkim-sign yes
    dkim-identity email@esp123.com
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="dkim-identity-fallback"><span class="header-section-number">3.3.10.29</span> dkim-identity-fallback</h4>
<p>Specifies an alternative DKIM identity to use if the primary identity isn't usable (usually because no keys are matched). This allows PowerMTA to use the dkim key for the From or Sender header if available ( eg. domain-key directive), but if the key is not available, PowerMTA switches to using the dkim-identity-fallback for signing (i= specified email address in the signature). Requires the use of dkim-identity.</p>
<p><strong>Example:</strong></p>
<pre><code>domain-key key1,esp456.com,c:\pmta\m.pem
&lt;domain yahoo.com&gt;
    dkim-sign yes
    dkim-identity sender-or-from
    dkim-identity-fallback @esp456.com
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="dkim-disallow-adding-headers"><span class="header-section-number">3.3.10.30</span> dkim-disallow-adding-headers</h4>
<p>Primarily used to minimize DKIM replay attacks, it allows one to specify headers that invalidate the DKIM signature if the headers are added after the DKIM signing. The directive takes a comma separated list of headers to include an extra time in the signature's "h" tag. Any headers listed in this directive that are also present in the original message will be signed as well.</p>
<p><strong>Syntax:</strong></p>
<pre><code>dkim-disallow-adding-headers HEADER-LIST
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain yahoo.com&gt;
    dkim-disallow-adding-headers from,to,subject
&lt;/domain&gt;
</code></pre>
<h4 id="queue-to"><span class="header-section-number">3.3.10.31</span> queue-to</h4>
<p>Allows for grouping domains with the same MX record together. See <a href="#combining-several-domains-into-one-queue">here</a> for more information.</p>
<p>Use the empty string (<code>""</code>) to clear any inherited value.</p>
<hr />
<h4 id="source-ip-max-msg-rate"><span class="header-section-number">3.3.10.32</span> source-ip-max-msg-rate</h4>
<p>IP rate limiting allows for controlling the number of attempted recipients on a per-hour, per-minute and per-second basis for each IP address for each domain/VirtualMTA. Primarily used by sites that define multiple IPs in a single VirtualMTA, and that want to limit the attempted delivery rate for each IP address in the VirtualMTA to the respective domains.</p>
<p>See <a href="#max-msg-rate">max-msg-rate</a> for more examples on rate limit syntax that can be used with this directive.</p>
<p><strong>Syntax:</strong></p>
<pre><code>source-ip-max-msg-rate CIDR { unlimited | 0 | N/[M]{h|hr|m|min|s|sec} }
</code></pre>
<p>where "d" or "day" means per-day, "h" or "hr" means per-hour, "m" or "min" means per-minute and "s" or "sec" means per-second. <code>N</code> is required and must be non-zero, but <code>M</code> is optional. If <code>M</code> is not specified, it defaults to 1.</p>
<p><strong>Default:</strong> <code>unlimited</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain comcast.net&gt;
    source-ip-max-msg-rate 1.2.3.4 600/h
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="max-msg-rate"><span class="header-section-number">3.3.10.33</span> max-msg-rate</h4>
<p>Specifies <em>maximum</em> attempted recipients to this domain per time interval.</p>
<p>Both deliveries and attempted deliveries are counted towards the limit. The following error will be displayed in the web monitor when the rate limit is reached:</p>
<pre><code>message rate limit reached (based on max-msg-rate in configuration)
</code></pre>
<p>When using rate limiting, it is best to establish a baseline without rate limiting to ensure that the limits set are having a positive impact on deliverability.</p>
<p><strong>New in PowerMTA v5</strong> When specifying the rate limit, you can specific a multiple in the denominator as well. This makes it easier to configure rate limits for time intervals that may not be exact seconds, minutes, hours, or day boundaries. For example, setting the rate limit to <code>100/15m</code> states that the rate limit allows 100 events every 15 minutes. Setting the rate limit to <code>83/5s</code> allows 83 events every 5 seconds.</p>
<p><strong>Syntax:</strong></p>
<pre><code>max-msg-rate { unlimited | 0 | N/[M]{d|day|h|hr|m|min|s|sec} }
</code></pre>
<p>where "d" or "day" means per-day, "h" or "hr" means per-hour, "m" or "min" means per-minute and "s" or "sec" means per-second. <code>N</code> is required and must be non-zero, but <code>M</code> is optional. If <code>M</code> is not specified, it defaults to 1.</p>
<p><strong>Default:</strong> <code>unlimited</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain comcast.net&gt;
    max-msg-rate 83/10m
&lt;/domain&gt;

&lt;domain gmail.com&gt;
    max-msg-rate 500/h
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="backoff-max-msg-rate"><span class="header-section-number">3.3.10.34</span> backoff-max-msg-rate</h4>
<p>This directive has the same function as max-msg-rate, and applies instead of max-msg-rate while a queue is in backoff mode. Both deliveries and attempted deliveries are counted towards the limit. The following error will be displayed in the web monitor when the rate limit is reached: message rate limit reached (based on backoff-max-msg-rate in configuration) When using rate limiting, it is best to establish a baseline without rate limiting to ensure that the limits set are having a positive impact on deliverability.</p>
<p><strong>Syntax:</strong></p>
<pre><code>backoff-max-msg-rate { unlimited | 0 | N/[M]{d|day|h|hr|m|min|s|sec} }
</code></pre>
<p>where "d" or "day" means per-day, "h" or "hr" means per-hour, "m" or "min" means per-minute and "s" or "sec" means per-second. <code>N</code> is required and must be non-zero, but <code>M</code> is optional. If <code>M</code> is not specified, it defaults to 1.</p>
<p><strong>Default:</strong> If <code>max-msg-rate</code> is also configured for the same queue, the default is equal to the configured <code>max-msg-rate</code>. Else, it is <code>unlimited</code>.</p>
<p>See <a href="#max-msg-rate">max-msg-rate</a> for more examples on rate limit syntax that can be used with this directive.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  # backoff-max-msg-rate  is 600/h
  backoff-max-msg-rate 600/h
&lt;/domain&gt;

&lt;domain port25.com&gt;
  # backoff-max-msg-rate is unlimited
&lt;/domain&gt;

&lt;domain foo.com&gt;
  max-msg-rate 100/h

  # backoff-max-msg-rate defaults to 100/h

&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="max-msg-per-hour"><span class="header-section-number">3.3.10.35</span> max-msg-per-hour</h4>
<p><strong>Deprecated</strong> Use <code>max-msg-rate</code></p>
<hr />
<h4 id="backoff-max-msg-per-hour"><span class="header-section-number">3.3.10.36</span> backoff-max-msg-per-hour</h4>
<p><strong>Deprecated</strong> Use <code>backoff-max-msg-rate</code></p>
<hr />
<h4 id="max-data-volume-rate"><span class="header-section-number">3.3.10.37</span> max-data-volume-rate</h4>
<p>Specifies <em>maximum</em> amount of data that will be transferred to this domain in the given time interval.</p>
<p>Only the volume of data for successful deliveries are counted towards the limit. The following error will be displayed in the web monitor when the rate limit is reached:</p>
<pre><code>message rate limit reached (based on max-data-volume-rate in configuration)
</code></pre>
<p>Data size suffixes can be used to specify the volume of data to limit in the given time interval. For instance, setting the volume rate to <code>10g/2h</code> specifies that at most 10 Gigabytes of data will be transferred in a 2 hour time interval.</p>
<p><strong>New in PowerMTA v5</strong> When specifying the rate limit, you can specific a multiple in the denominator as well. This makes it easier to configure rate limits for time intervals that may not be exact seconds, minutes, hours, or day boundaries. For example, setting the rate limit to <code>100/15m</code> states that the rate limit allows 100 events every 15 minutes. Setting the rate limit to <code>83/5s</code> allows 83 events every 5 seconds.</p>
<p><strong>Syntax:</strong></p>
<pre><code>max-data-volume-rate { unlimited | 0 | N [{b|B|k|K|m|M|g|G|t|T}] /[X]{d|day|h|hr|m|min|s|sec} }
</code></pre>
<p>For the numerator, "b" or "B" means bytes, "k" or "K" means kilobytes, "m" or "M" means megabyte, "g" or "G" means gigabyte, "t" or "T" means terabyte. A number <code>N</code> must be specified in the numerator. If a data size suffix is not specified, it is assumed to mean bytes.</p>
<p>For the denominator, "d" or "day" means per-day, "h" or "hr" means per-hour, "m" or "min" means per-minute and "s" or "sec" means per-second. <code>X</code> is optional, but must be a number if specified. If <code>X</code> is not specified, it defaults to 1.</p>
<p><strong>Default:</strong> <code>unlimited</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
    # limit data volume to 1048576 bytes (or, 1 megabyte) every 1 hour
    max-data-volume-rate 1048576/1h
&lt;/domain&gt;

&lt;domain aol.com&gt;
    # limit data volume to 1024 kilobytes (or, 1 megabyte) every 15 seconds
    max-data-volume-rate 1024K/15s
&lt;/domain&gt;

&lt;domain comcast.net&gt;
    # limit data volume to 12 megabytes every 1 minute
    max-data-volume-rate 12M/m
&lt;/domain&gt;

&lt;domain yahoo.com&gt;
    # limit data volume to 2 gigabytes every 10 hours
    max-data-volume-rate 2g/10h
&lt;/domain&gt;

&lt;domain gmail.com&gt;
    # limit data volume to 1 terabyte every 7 days
    max-data-volume-rate 1T/7d
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="backoff-max-data-volume-rate"><span class="header-section-number">3.3.10.38</span> backoff-max-data-volume-rate</h4>
<p>This directive has the same function as <code>max-data-volume-rate</code>, and applies instead of <code>max-data-volume-rate</code> while a queue is in backoff mode.</p>
<p>The following error will be displayed in the web monitor when the rate limit is reached: message rate limit reached (based on backoff-max-data-volume-rate in configuration)</p>
<p><strong>Syntax:</strong></p>
<pre><code>backoff-max-data-volume-rate { unlimited | 0 | N [{b|B|k|K|m|M|g|G|t|T}] /[X]{d|day|h|hr|m|min|s|sec} }
</code></pre>
<p>For the numerator, "b" or "B" means bytes, "k" or "K" means kilobytes, "m" or "M" means megabyte, "g" or "G" means gigabyte, "t" or "T" means terabyte. A number <code>N</code> must be specified in the numerator. If a data size suffix is not specified, it is assumed to mean bytes.</p>
<p>For the denominator, "d" or "day" means per-day, "h" or "hr" means per-hour, "m" or "min" means per-minute and "s" or "sec" means per-second. <code>X</code> is optional, but must be a number if specified. If <code>X</code> is not specified, it defaults to 1.</p>
<p><strong>Default:</strong> If <code>max-data-volume-rate</code> is also configured for the same queue, the default is equal to the configured <code>max-data-volume-rate</code>. Else, it is <code>unlimited</code>.</p>
<p>See <a href="#max-data-volume-rate">max-data-volume-rate</a> for more examples on rate limit syntax that can be used with this directive.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  # backoff-max-msg-rate  is 600/h
  backoff-max-msg-rate 600/h
&lt;/domain&gt;

&lt;domain port25.com&gt;
  # backoff-max-msg-rate is unlimited
&lt;/domain&gt;

&lt;domain foo.com&gt;
  max-msg-rate 100/h

  # backoff-max-msg-rate defaults to 100/h

&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="retry-after"><span class="header-section-number">3.3.10.39</span> retry-after</h4>
<p>Specifies the retry interval or intervals for the domain/virtualMTA once the domain/virtualMTA is put in retry mode. The directive is a time interval(s), takes a single interval or comma separated list of intervals, with each having a number along with "d" for days, "h" for hours, "m" for minutes, or "s" for seconds, with no spaces between the parameters.</p>
<p><strong>Syntax:</strong></p>
<pre><code>retry-after TIME-INTERVAL-LIST
</code></pre>
<p><strong>Default:</strong> <code>10m</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain example.com&gt;
    retry-after 10m,10m,10m,10m,10m,1h,1h,1h,4h,4h,12h
&lt;/domain&gt;
</code></pre>
<p>In the above example, PowerMTA would try every 10 minutes for the first 5 tries, every hour for the next three tries, every 4 hours for the next two tries, then every 12 hours until the message is bounced. If during any of the retry intervals an email is delivered then the retry-after period is reset and starts again at the first retry interval. The feature is meant to protect against using resources to continually try and email to a dead domain, like example.com.</p>
<hr />
<h4 id="backoff-retry-after"><span class="header-section-number">3.3.10.40</span> backoff-retry-after</h4>
<p>This directive has the same function as retry-after, and applies instead of retry-after while a queue is in backoff mode.</p>
<p><strong>Syntax:</strong></p>
<pre><code>backoff-retry-after TIME-INTERVAL-LIST
</code></pre>
<p><strong>Default:</strong> <code>1h</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  backoff-retry-after 2h
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="retry-recipients-after"><span class="header-section-number">3.3.10.41</span> retry-recipients-after</h4>
<p>Specifies the minimum time interval to wait before retrying delivery for a recipient that previously received a 4XX (temp error) from the receiving gateway. Even if the domain/VirtualMTA is retried as per its retry-after setting, individual recipients do not get retried until the retry-recipients-after has elapsed.</p>
<p><strong>Syntax:</strong></p>
<pre><code>retry-recipients-after TIME-INTERVAL
</code></pre>
<p><strong>Default:</strong> <code>10m</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  retry-recipients-after 10m
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="backoff-notify"><span class="header-section-number">3.3.10.42</span> backoff-notify</h4>
<p>Specifies email addresses to notify when any of the queues for the given domain enters or leaves backoff mode. Multiple addresses may be specified in a comma separated list.</p>
<p>Use empty string (<code>""</code>) to clear any inherited value.</p>
<p><strong>Syntax:</strong></p>
<pre><code>backoff-notify EMAIL-ADDRESS-LIST
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain *&gt;
    backoff-notify two@host.domain,one@host.domain
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="disabled-source-ip-notify"><span class="header-section-number">3.3.10.43</span> disabled-source-ip-notify</h4>
<p>A comma separated list of email addresses that will be notified when a source IP is disabled, either via a command or through an smtp-pattern-list match, and when a source IP is enabled back again.</p>
<p>Use empty string (<code>""</code>) to clear any inherited value.</p>
<p><strong>Syntax:</strong></p>
<pre><code>disabled-source-ip-notify EMAIL-ADDRESS-LIST
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain *&gt;
    disabled-source-ip-notify two@host.domain,one@host.domain
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="backoff-to-normal-after"><span class="header-section-number">3.3.10.44</span> backoff-to-normal-after</h4>
<p>Specifies a time interval after which a queue automatically goes back to normal mode. Example:</p>
<p><strong>Syntax:</strong></p>
<pre><code>backoff-to-normal-after { TIME-INTERVAL | never }
</code></pre>
<p><strong>Default:</strong> <code>never</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
    backoff-to-normal-after 6h
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="backoff-to-normal-after-delivery"><span class="header-section-number">3.3.10.45</span> backoff-to-normal-after-delivery</h4>
<p>If enabled, this puts a queue back into normal mode after a successful delivery.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  backoff-to-normal-after-delivery true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="backoff-upon-all-sources-disabled"><span class="header-section-number">3.3.10.46</span> backoff-upon-all-sources-disabled</h4>
<p>If enabled, switches a queue into backoff mode when all source IPs become disabled, whether via command line command or when using the <code>&lt;smtp-pattern-list&gt;</code> function disable-source-ip. Note: SparkPost recommends using the backoff-to-normal-after directive in conjunction with this directive, since PowerMTA does not automatically put a queue back into normal mode when an IP address reverts back to being enabled.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  backoff-upon-all-sources-disabled true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="reenable-source-ip-after"><span class="header-section-number">3.3.10.47</span> reenable-source-ip-after</h4>
<p>Sets the interval of time for when an IP disabled with the &lt;smtp-pattern-list&gt; function disable-source-ip is to be re-enabled, when no reenable-after= option is defined in the pattern action. This directive is ignored however when the disable-source-ip actions are defined with the accompanying reenable-after= option.</p>
<p><strong>Syntax:</strong></p>
<pre><code>reenable-source-ip-after { TIME-INTERVAL | never }
</code></pre>
<p><strong>Default:</strong> <code>never</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  reenable-source-ip-after 1h
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="max-cold-virtual-mta-msg"><span class="header-section-number">3.3.10.48</span> max-cold-virtual-mta-msg</h4>
<p>A per-domain "max-cold-virtual-mta-msg N/day", default of 0, specifies how many messages go to the "foo-cold" vmta when VirtualMTA "foo" is selected. Re-selection occurs at message reception and over SMTP only. The value specified is the first X messages for that domain. The defined amount is set for delivery upon injection.</p>
<p><strong>Note: When MX rollup rules are also active in the configuration, PowerMTA will use the <code>max-cold-virtual-mta-msg</code> setting from the rollup queue instead of the individual queues that got rolled up.</strong></p>
<p>Please note that this setting is per domain, so 1000 emails will go to yahoo, 1000 will go to hotmail, etc. Auto increments are supported in the following manner:</p>
<pre><code>&lt;domain yahoo.com&gt;
    max-cold-virtual-mta-msg 1/day,2/day,3/day,4/day
&lt;/domain&gt;
</code></pre>
<p>In the example above, all cold vmtas will have 1 as their first day's limit for yahoo.com, 2 as the limit for second day to yahoo.com and so on. There is no restriction on the number of per-day limits that can be configured. The last limit value will continue to be used as the per-day limit after all the preceding limits have been used.</p>
<p><strong>Syntax:</strong></p>
<pre><code>max-cold-virtual-mta-msg DAILY-LIMITS
</code></pre>
<p>where <code>DAILY-LIMITS</code> is a list of one or more rates of the form <code>N/{d|day}</code></p>
<p><strong>Default:</strong> <code>0/d</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;virtual-mta vmta1&gt;
    smtp-source-host 1.2.3.4 vmta1.example.com
    cold-virtual-mta vmta2
    &lt;domain *&gt;
        max-cold-virtual-mta-msg 1000/day
    &lt;/domain&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta vmta2&gt;
    smtp-source-host 5.6.7.8 vmta2.example.com
    &lt;domain *&gt;
        max-msg-rate 100/h
    &lt;/domain&gt;
&lt;/virtual-mta&gt;
</code></pre>
<hr />
<h4 id="reroute-to-virtual-mta"><span class="header-section-number">3.3.10.49</span> reroute-to-virtual-mta</h4>
<p>Specifies that PowerMTA should reroute messages to the given VirtualMTA. This can be set globally.</p>
<p>A reroute to a VirtualMTA pool is not supported.</p>
<p>Use empty string (<code>""</code>) to clear any inherited value.</p>
<p><strong>Syntax:</strong></p>
<pre><code>reroute-to-virtual-mta VMTA-NAME
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;virtual-mta vmta1&gt;
    ...
&lt;/virtual-mta&gt;

&lt;virtual-mta vmta2&gt;
    ...
&lt;/virtual-mta&gt;

&lt;domain aol.com&gt;
    reroute-to-virtual-mta vmta2
&lt;/domain&gt;
</code></pre>
<p>Or, it may also make sense to use this directive on a per VirtualMTA basis:</p>
<pre><code>&lt;virtual-mta vmta1&gt;
    ...
    &lt;domain aol.com&gt;
        reroute-to-virtual-mta vmta2
    &lt;/domain&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta vmta2&gt;
    ...
&lt;/virtual-mta&gt;
</code></pre>
<hr />
<h4 id="backoff-reroute-to-virtual-mta"><span class="header-section-number">3.3.10.50</span> backoff-reroute-to-virtual-mta</h4>
<p>Specifies that PowerMTA should reroute messages to the given VirtualMTA in case the queue enters backoff mode. For example, if messages are queued for example.port25.com/vmta1 and that queue enters backoff mode while backoff-reroute-to-virtual-mta is set to vmta2, all of its messages would be rerouted to the queue example.port25.com/vmta2. New messages entering the queue are also rerouted, as long as the queue remains in backoff mode.</p>
<p>Use empty string (<code>""</code>) to clear any inherited value.</p>
<p>It may also make sense to use this directive on a per VirtualMTA basis:</p>
<pre><code>&lt;virtual-mta vmta1&gt;
    ...
    &lt;domain *&gt;
        backoff-reroute-to-virtual-mta vmta2
    &lt;/domain&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta vmta2&gt;
    ...
&lt;/virtual-mta&gt;
</code></pre>
<p><strong>WARNING:</strong> PowerMTA performs full loop detection on this directive. If a loop is detected, messages are left in the last queue in the loop, and an error is written to the log file. A reroute from one VirtualMTA to itself is silently ignored, and a reroute to a VirtualMTA pool is not supported.</p>
<p><strong>Syntax:</strong></p>
<pre><code>backoff-reroute-to-virtual-mta VMTA-NAME
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;virtual-mta vmta1&gt;
&lt;/virtual-mta&gt;

&lt;domain *&gt;
    backoff-reroute-to-virtual-mta vmta1
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="type"><span class="header-section-number">3.3.10.51</span> type</h4>
<p>Determines whether email for this domain is to be delivered over SMTP, through the pipe delivery API, to a file, or discarded. The default type for a queue is <code>smtp</code>, which means email from the queue is delivered over SMTP. The other choices are</p>
<ol>
<li><code>file</code>, in which case, the queue writes its messages to files.</li>
<li><code>pipe</code>, in which case the queue delivers its messages to a pipe program.</li>
<li><code>discard</code> in which case, the queue discards the email writing the corresponding accounting record</li>
<li><code>http-delivery</code>, in which case, the queue will deliver its messages to a HTTP(S) endpoint as a JSON object.</li>
</ol>
<p><strong>Note: Change from one type of queue to another with messages in the given queue requires a restart of PowerMTA.</strong></p>
<p><strong>Syntax:</strong></p>
<pre><code>type { smtp | pipe | file | discard | http-delivery }
</code></pre>
<p><strong>Default:</strong> <code>smtp</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
    type file
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="allow-cancel-during-transfer"><span class="header-section-number">3.3.10.52</span> allow-cancel-during-transfer</h4>
<p>Specifies whether PowerMTA should allow connections to this domain to be canceled (e.g., in order to shut down PowerMTA) while a message's contents (headers and body) are being transferred. Some mailers have been known to still deliver messages if the connection breaks before they are fully received, lastly causing partial and duplicate messages to be delivered as PowerMTA retries delivering. Setting this directive to false prevents PowerMTA from Canceling connections while messages are being transferred on it, but also possibly causes PowerMTA to take longer to shut down.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  allow-cancel-during-transfer true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="auth-username"><span class="header-section-number">3.3.10.53</span> auth-username</h4>
<p>Specifies the user name to use when authenticating to the remote mailer. Authentication is attempted if the AUTH extension as well as a SASL authentication mechanism supported by PowerMTA are available at the remote mailer, and either auth-username or auth-password have non-empty values.</p>
<p>Use empty string (<code>""</code>) to clear any inherited value.</p>
<p>PowerMTA currently only supports the <code>CRAM-MD5</code>, <code>LOGIN</code>, and <code>PLAIN</code> authentication mechanisms.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  auth-username foo
  auth-password 43rusdfdsi
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="smtp-data-termination-timeout"><span class="header-section-number">3.3.10.54</span> smtp-data-termination-timeout</h4>
<p>Allows for setting the amount of time that PowerMTA will wait for the final "250 ok" response after sending the message body. Setting this value too low is likely to cause duplicates.</p>
<p><strong>Syntax:</strong></p>
<pre><code>smtp-data-termination-timeout TIME-INTERVAL
</code></pre>
<p><strong>Default:</strong> <code>10m</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  smtp-data-termination-timeout 5m
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="auth-password"><span class="header-section-number">3.3.10.55</span> auth-password</h4>
<p>Specifies the password to use when authenticating to the remote mailer. Please see the auth-username directive above for more information. auth-password cannot contain a # as it will be interpreted as the start of comments.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  auth-password password
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="use-unencrypted-plain-auth"><span class="header-section-number">3.3.10.56</span> use-unencrypted-plain-auth</h4>
<p>Specifies whether PowerMTA should use PLAIN and/or LOGIN for authentication in case the connection is not encrypted (i.e., if STARTTLS is not being used).</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  use-unencrypted-plain-auth true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="smtp-553-means-invalid-mailbox"><span class="header-section-number">3.3.10.57</span> smtp-553-means-invalid-mailbox</h4>
<p>Instructs PowerMTA whether to consider a 553 reply to a RCPT command as an 5.1.1 (invalid mailbox) error when enhanced status code is not returned by the remote gateway.</p>
<p><strong>Default:</strong> <code>yes</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  smtp-553-means-invalid-mailbox true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="smtp-421-means-mx-unavailable"><span class="header-section-number">3.3.10.58</span> smtp-421-means-mx-unavailable</h4>
<p>If set to yes, PowerMTA will immediately break the connection upon receiving a 421 error and subsequently attempt a new connection to the next MX record listed in DNS. The default setting of no will cause PowerMTA to reset the connection and then reuse the same connection for additional recipients.</p>
<p><strong>Default:</strong> <code>no</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  smtp-421-means-mx-unavailable true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="replace-smtp-421-service-response"><span class="header-section-number">3.3.10.59</span> replace-smtp-421-service-response</h4>
<p>When enabled, this replaces the SMTP response after the 421 code and after any enhanced status code with "service unavailable", thus preventing any email addresses, etc. that may be included in that response from being used in bounces. The original message is still passed in for pattern matching, so that these continue to work normally.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  replace-smtp-421-service-response true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="bounce-upon-no-mx"><span class="header-section-number">3.3.10.60</span> bounce-upon-no-mx</h4>
<p>If set to "true" and no MX record(s) are found for the domain, all emails in the queue bounce immediately.</p>
<p>If a time interval is specified, such as <code>30m</code>, only messages that have been queued for that amount of time are bounced if no MX record(s) are found for the domain. Defining a time interval allows PowerMTA to attempt delivery to the domain by looking up its A/AAAA records.</p>
<p>Note that this directive applies only to cases where a MX lookup is performed; if a host list is specified with the <code>smtp-hosts</code> directive, no MX lookup is performed.</p>
<p><strong>Syntax:</strong></p>
<pre><code>bounce-upon-no-mx ( true | false | TIME-INTERVAL | never }
</code></pre>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain example.com&gt;
    bounce-upon-no-mx true
&lt;/domain&gt;

&lt;domain *&gt;
    bounce-upon-no-mx 30m
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="bounce-upon-5xx-greeting"><span class="header-section-number">3.3.10.61</span> bounce-upon-5xx-greeting</h4>
<p>Specifies whether PowerMTA should immediately bounce all messages for the domain when receiving a 5xx SMTP greeting. email protocols mandate this default behavior, however there exist many misconfigured mailers on the network, causing email to be lost unnecessarily. If this directive is set to false, PowerMTA will regard 5xx greetings as a temporary error and try delivering the messages to any secondary MX mailers, as well continue retrying delivery until the bounce-after interval expires.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  bounce-upon-5xx-greeting true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="bounce-upon-pix-transfer-failure"><span class="header-section-number">3.3.10.62</span> bounce-upon-pix-transfer-failure</h4>
<p>This directive is identical to the bounce-upon-transfer-failure directive below, except that the message is only bounced if a Cisco PIX Firewall is detected at the receiving site. Detection is performed based on the SMTP greeting line: if it contains at least ten asterisks, a PIX firewall is detected.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  bounce-upon-pix-transfer-failure true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="bounce-upon-transfer-failure"><span class="header-section-number">3.3.10.63</span> bounce-upon-transfer-failure</h4>
<p>Specifies whether PowerMTA should immediately bounce a message whose delivery failed while its contents (message headers and body) were being transferred. Normally, PowerMTA would not immediately bounce the message, but continue trying until it becomes older than the bounce-after interval. Due to deficiencies in the SMTP protocol (See RFC 1047) and in the receiving mail servers, if the TCP connection fails while the contents are being transmitted, there is some risk that various copies of the same message will be delivered, some of which possibly with only partial contents. By enabling this directive, you instruct PowerMTA to bounce the message immediately after the first failed transfer attempt. This effectively prevents sending out duplicates, but may also cause the recipient to never receive the message, or receive only one (possibly partial) copy of it.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  bounce-upon-transfer-failure true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="connect-timeout"><span class="header-section-number">3.3.10.64</span> connect-timeout</h4>
<p>Specifies the maximum amount of time that PowerMTA waits for an outgoing SMTP connection to be established.</p>
<p><strong>Syntax:</strong></p>
<pre><code>connect-timeout TIME-INTERVAL
</code></pre>
<p><strong>Default:</strong> <code>2m</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  connect-timeout 5m
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="smtp-greeting-timeout"><span class="header-section-number">3.3.10.65</span> smtp-greeting-timeout</h4>
<p>Specifies the amount of time to wait for the initial SMTP 220 greeting message to be received after the connection is accepted.</p>
<p><strong>Syntax:</strong></p>
<pre><code>smtp-greeting-timeout TIME-INTERVAL
</code></pre>
<p><strong>Default:</strong> <code>5m</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  smtp-greeting-timeout 10m
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="data-send-timeout"><span class="header-section-number">3.3.10.66</span> data-send-timeout</h4>
<p>Specifies the maximum amount of time that PowerMTA waits for a chunk of data (message contents and body) to be sent over an outgoing SMTP connection. For full compliance with RFC 2821, this timeout needs to be at least three minutes.</p>
<p><strong>Syntax:</strong></p>
<pre><code>data-send-timeout TIME-INTERVAL
</code></pre>
<p><strong>Default:</strong> <code>3m</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  data-send-timeout 5m
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="ignore-8bitmime"><span class="header-section-number">3.3.10.67</span> ignore-8bitmime</h4>
<p>Specifies whether PowerMTA should ignore the 8BITMIME extension even when supported by the receiving mailer. Setting this directive to true allows you to work around the problem of messages bouncing because a site's external MTA accepting 8BITMIME messages as such but unable to convert them to 7BIT when passing to an internal MTA which does not support 8BITMIME. The directive doesnt change the encoding of the message, but rather, by default if a message has 8bit encoding and the feeding application passed that information along in the MAIL FROM command, PowerMTA passes that info along to the remote mail server via the MAIL FROM command. Setting the value to true tells PowerMTA to not pass along the information. This has nothing to do with anything declared in the body of the message. See RFC 1652 for more information <a href="http://www.ietf.org/rfc/rfc1652.txt">http://www.ietf.org/rfc/rfc1652.txt</a>.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  ignore-8bitmime true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="ignore-chunking"><span class="header-section-number">3.3.10.68</span> ignore-chunking</h4>
<p>Specifies whether PowerMTA should ignore the CHUNKING extension even when supported by the receiving mailer. Setting this directive to true may be useful for debugging message transfer problems.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  ignore-chunking true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="ignore-pipelining"><span class="header-section-number">3.3.10.69</span> ignore-pipelining</h4>
<p>Specifies whether PowerMTA should ignore the PIPELINING extension even when supported by the receiving mailer. Setting this directive to true may be useful for debugging message transfer problems.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  ignore-pipelining true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="ignore-dsn"><span class="header-section-number">3.3.10.70</span> ignore-dsn</h4>
<p>Specifies whether PowerMTA should ignore the DSN extension even when supported by the receiving mailer (seen in the "250" responses after connecting).</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  ignore-dsn true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="max-msg-per-connection"><span class="header-section-number">3.3.10.71</span> max-msg-per-connection</h4>
<p>Specifies the maximum number of messages delivered within a single connection. Normally it is most efficient to deliver as many messages as possible per connection, but in special circumstances it may be desirable to have PowerMTA close the connection and reconnect before delivering more messages. A value of zero means no limit is imposed.</p>
<p><strong>Default:</strong> <code>0</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  max-msg-per-connection 5
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="max-rcpt-per-transaction"><span class="header-section-number">3.3.10.72</span> max-rcpt-per-transaction</h4>
<p>Specifies the maximum number of recipients passed with each message. For example, if a message is submitted including 5,000 recipients for a single domain, and max-rcpt-per-message for that domain is set to 3,000, PowerMTA will transfer the message twice, once for 3,000 recipients and again for the remaining 2,000 recipients. Smaller settings increase parallelism by allowing the same message to be transferred over several connections to the same domain, but also reduce efficiency, since the message contents are transferred several times. max-rcpt-per-transaction is an alias to max-rcpt-per-message.</p>
<p><strong>Default:</strong> <code>1000</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  max-rcpt-per-transaction 100
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="max-rcpt-per-message-1"><span class="header-section-number">3.3.10.73</span> max-rcpt-per-message</h4>
<p>Specifies the maximum number of recipients accepted in each message. If set to zero or <code>unlimited</code>, no explicit limit is enforced.</p>
<p><strong>Syntax:</strong></p>
<pre><code>max-rcpt-per-message { N | unlimited }
</code></pre>
<p><strong>Default:</strong> <code>0</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain yahoo.com&gt;
  max-rcpt-per-message 10
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="max-smtp-out"><span class="header-section-number">3.3.10.74</span> max-smtp-out</h4>
<p>Specifies the <em>maximum</em> number of simultaneous connections to be opened for this queue. This limit is independent of connections to the same domain but from a different VMTA.</p>
<p><strong>Default:</strong> <code>20</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  max-smtp-out 30
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="backoff-max-smtp-out"><span class="header-section-number">3.3.10.75</span> backoff-max-smtp-out</h4>
<p>Specifies the <em>maximum</em> number of simultaneous connections to be opened for this domain when in backoff mode.</p>
<p><strong>Default:</strong> <code>20</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  backoff-max-smtp-out 30
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="max-smtp-out-per-source-ip"><span class="header-section-number">3.3.10.76</span> max-smtp-out-per-source-ip</h4>
<p><strong>Deprecated</strong> Use <code>source-ip-max-smtp-out</code> instead</p>
<hr />
<h4 id="source-ip-max-smtp-out"><span class="header-section-number">3.3.10.77</span> source-ip-max-smtp-out</h4>
<p>Specifies the <em>maximum</em> number of simultaneous connections to be opened for this domain for a given source IP.</p>
<p><strong>Syntax:</strong></p>
<pre><code>source-ip-max-smtp-out CIDR N
</code></pre>
<p><strong>Default:</strong> <code>unlimited</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain comcast.net&gt;
    source-ip-max-smtp-out 1.2.3.4 10
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="smtp-out-rampup-interval"><span class="header-section-number">3.3.10.78</span> smtp-out-rampup-interval</h4>
<p>Specifies the minimum amount of time PowerMTA waits before opening another connection to deliver email from the queue. This can reduce the number of connections needed and help avoid hitting a connection limit.</p>
<p><strong>Syntax:</strong></p>
<pre><code>smtp-out-rampup-interval TIME-INTERVAL
</code></pre>
<p><strong>Default:</strong> <code>0</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  smtp-out-rampup-interval 1s
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="max-connect-rate"><span class="header-section-number">3.3.10.79</span> max-connect-rate</h4>
<p>Specifies the <em>maximum</em> number of connections to be opened for this domain during the specified time period.</p>
<p>See <a href="#max-msg-rate">max-msg-rate</a> for more examples on rate limit syntax that can be used with this directive.</p>
<p><strong>Syntax:</strong></p>
<pre><code>max-connect-rate { unlimited | 0 | N/[M]{d|day|h|hr|m|min|s|sec} }
</code></pre>
<p>where "d" or "day" means per-day, "h" or "hr" means per-hour, "m" or "min" means per-minute and "s" or "sec" means per-second. <code>N</code> is required and must be non-zero, but <code>M</code> is optional. If <code>M</code> is not specified, it defaults to 1.</p>
<p><strong>Default:</strong> <code>unlimited</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  max-connect-rate 10/m
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="source-ip-max-connect-rate"><span class="header-section-number">3.3.10.80</span> source-ip-max-connect-rate</h4>
<p>Specifies the <em>maximum</em> number of connections to be opened during the specified time period when using the given source IP for this domain/vmta (i.e. queue).</p>
<p>See <a href="#max-msg-rate">max-msg-rate</a> for more examples on rate limit syntax that can be used with this directive.</p>
<p><strong>Syntax:</strong></p>
<pre><code>source-ip-max-connect-rate CIDR { unlimited | 0 | N/[M]{d|day|h|hr|m|min|s|sec} }
</code></pre>
<p>where "d" or "day" means per-day, "h" or "hr" means per-hour, "m" or "min" means per-minute and "s" or "sec" means per-second. <code>N</code> is required and must be non-zero, but <code>M</code> is optional. If <code>M</code> is not specified, it defaults to 1.</p>
<p><strong>Default:</strong> <code>unlimited</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
    source-ip-max-connect-rate 1.2.3.4 60/m
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="connection-idle-timeout"><span class="header-section-number">3.3.10.81</span> connection-idle-timeout</h4>
<p>Specifies the maximum amount of time that PowerMTA waits for another email to be submitted for delivery once there is no remaining email to deliver in the queue. This can reduce the number of connections needed and help avoid hitting a connection limit for opening too many connections within a short interval. The maximum value is 10m. See also <a href="#smtp-out-rampup-interval">smtp-out-rampup-interval</a>.</p>
<p><strong>Syntax:</strong></p>
<pre><code>connection-idle-timeout TIME-INTERVAL
</code></pre>
<p><strong>Default:</strong> <code>0</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  connection-idle-timeout 1m
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="source-ip-max-msg-rate-1"><span class="header-section-number">3.3.10.82</span> source-ip-max-msg-rate</h4>
<p>Specifies the <em>maximum</em> number of messages to be attempted for delivery during the specified time period when using the given source IP for this domain/vmta (i.e. queue).</p>
<p>See <a href="#max-msg-rate">max-msg-rate</a> for more examples on rate limit syntax that can be used with this directive.</p>
<p><strong>Syntax:</strong></p>
<pre><code>source-ip-max-msg-rate CIDR { unlimited | 0 | N/[M]{d|day|h|hr|m|min|s|sec} }
</code></pre>
<p>where "d" or "day" means per-day, "h" or "hr" means per-hour, "m" or "min" means per-minute and "s" or "sec" means per-second. <code>N</code> is required and must be non-zero, but <code>M</code> is optional. If <code>M</code> is not specified, it defaults to 1.</p>
<p><strong>Default:</strong> <code>unlimited</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain comcast.net&gt;
    source-ip-max-msg-rate 1.2.3.4 600/m
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="source-ip-max-data-volume-rate"><span class="header-section-number">3.3.10.83</span> source-ip-max-data-volume-rate</h4>
<p>Specifies <em>maximum</em> amount of data that will be transferred to this domain in the given time interval when using the given source IP for this domain/vmta (i.e. queue).</p>
<p>See <a href="#max-data-volume-rate">max-data-volume-rate</a> for more examples on rate limit syntax that can be used with this directive.</p>
<p><strong>Syntax:</strong></p>
<pre><code>source-ip-max-data-volume-rate CIDR { unlimited | 0 | N [{b|B|k|K|m|M|g|G|t|T}] /[X]{d|day|h|hr|m|min|s|sec} }
</code></pre>
<p>For the numerator, "b" or "B" means bytes, "k" or "K" means kilobytes, "m" or "M" means megabyte, "g" or "G" means gigabyte, "t" or "T" means terabyte. A number <code>N</code> must be specified in the numerator. If a data size suffix is not specified, it is assumed to mean bytes.</p>
<p>For the denominator, "d" or "day" means per-day, "h" or "hr" means per-hour, "m" or "min" means per-minute and "s" or "sec" means per-second. <code>X</code> is optional, but must be a number if specified. If <code>X</code> is not specified, it defaults to 1.</p>
<p>See <a href="#max-data-volume-rate">max-data-volume-rate</a> for more examples on rate limit syntax that can be used with this directive.</p>
<p><strong>Default:</strong> <code>unlimited</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain comcast.net&gt;
    source-ip-max-data-volume-rate 1.2.3.4 600/m
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="backoff-max-connect-rate"><span class="header-section-number">3.3.10.84</span> backoff-max-connect-rate</h4>
<p>Specifies the <em>maximum</em> number of connections to be opened for this domain during the specified time period when in backoff mode.</p>
<p>See <a href="#max-msg-rate">max-msg-rate</a> for more examples on rate limit syntax that can be used with this directive.</p>
<p><strong>Syntax:</strong></p>
<pre><code>backoff-max-connect-rate { unlimited | 0 | N/[M]{d|day|h|hr|m|min|s|sec} }
</code></pre>
<p>where "d" or "day" means per-day, "h" or "hr" means per-hour, "m" or "min" means per-minute and "s" or "sec" means per-second. <code>N</code> is required and must be non-zero, but <code>M</code> is optional. If <code>M</code> is not specified, it defaults to 1.</p>
<p><strong>Default:</strong> If <code>max-connect-rate</code> is also configured for the same queue, the default is equal to the configured <code>max-connect-rate</code>. Else, it is <code>unlimited</code>.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  # backoff-max-connect-rate  is 600/h
  backoff-max-connect-rate 600/h
&lt;/domain&gt;

&lt;domain port25.com&gt;
  # backoff-max-connect-rate is unlimited
&lt;/domain&gt;

&lt;domain foo.com&gt;
  max-connect-rate 100/h

  # backoff-max-connect-rate defaults to 100/h

&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="retry-upon-new-mail"><span class="header-section-number">3.3.10.85</span> retry-upon-new-mail</h4>
<p>Specifies if PowerMTA should immediately schedule delivery of a message when it is received if the queue to which it is injected is already in retry mode. If set to true and a queue is in retry mode, new mail injected into that queue will cause the queue to be scheduled for delivery.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  retry-upon-new-mail true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="pix-bug-workaround"><span class="header-section-number">3.3.10.86</span> pix-bug-workaround</h4>
<p>Some versions of the Cisco PIX firewall have a bug (bug ID CSCds90792) in its "fixup smtp" command in that it rejects email (causing duplicates to be delivered) if the final .<CR><LF> sequence is split across various TCP frames. This directive instructs PowerMTA, in case it detects a PIX firewall, to send the final .<CR><LF> in a frame of its own, making it almost certain to arrive at the receiving site in a single frame. Detection is performed based on the SMTP greeting line: if it contains at least ten asterisks, a PIX firewall is detected.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  pix-bug-workaround true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="route"><span class="header-section-number">3.3.10.87</span> route</h4>
<p>Overrides or modifies the normal DNS-based routing, instructing PowerMTA to deliver to specific hosts or to look up an MX record for a different domain.</p>
<p><strong>Deprecated</strong> Use <code>smtp-hosts</code> instead.</p>
<hr />
<h4 id="default-smtp-port"><span class="header-section-number">3.3.10.88</span> default-smtp-port</h4>
<p>Allows specifying the TCP port to use for delivering over SMTP (unless overridden by <code>smtp-hosts</code>). This can be used to simplify the setup when multiple PowerMTAs communicate through a NAT (network address translation) device, since the NAT configuration can key on the destination port rather than require individual local source IPs for each externally visible IP address.</p>
<p><strong>Default:</strong> <code>25</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;virtual-mta vmta1&gt;
    &lt;domain *&gt;
      default-smtp-port 9001
    &lt;/domain&gt;
&lt;/virtual-mta&gt;
&lt;virtual-mta vmta2&gt;
    &lt;domain *&gt;
      default-smtp-port 9002
    &lt;/domain&gt;
&lt;/virtual-mta&gt;
</code></pre>
<hr />
<h4 id="smtp-hosts"><span class="header-section-number">3.3.10.89</span> smtp-hosts</h4>
<p>Overrides or modifies the normal DNS-based routing, instructing PowerMTA to deliver to specific hosts or to look up an MX record for a different domain.</p>
<p>Multiple host names or IP addresses can be entered. Commas separate hosts within a preference level, and semicolons separate preference levels. Email delivery is attempted by preference level (first to last), exactly as though those hosts had been obtained from MX records.</p>
<p>An IP address may be entered in dotted-decimal notation instead of a host name, for example <code>[10.1.0.2]</code> for IPv4 or <code>[IPv6:2001::1]</code> for IPv6. Each host name or IP address may be followed by <code>:</code> and a number specifying an alternative TCP port number, as in <code>h1.test.com:1025</code>.</p>
<p>To specify that a MX lookup be performed instead, specify <code>lookup-mx:</code> followed by the domain name to look up.</p>
<p>Use the empty string (<code>""</code>) to clear any inherited value.</p>
<p><strong>Examples:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
    smtp-hosts lookup-mx:example.com
&lt;/domain&gt;
</code></pre>
<p>In the following example, commas and semicolons are used to create a primary preference level containing hosts <code>h1</code> and <code>h2</code> (which will be used in round-robin fashion), a secondary preference level containing the IP address <code>[10.1.1.1]</code> and specifying an alternate TCP port, and a tertiary preference level (only used if unable to deliver to the first two levels) containing host <code>last</code>:</p>
<pre><code>&lt;domain email.test.com&gt;
    smtp-hosts h1.test.com, h2.test.com; [10.1.1.1]:2525; last.test.com
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="smtp-pattern-list"><span class="header-section-number">3.3.10.90</span> smtp-pattern-list</h4>
<p>Specifies that the given SMTP pattern list is to be used in connections to the given domain. See <a href="#smtp-pattern-list-directives">&lt;smtp-pattern-list&gt; Directives</a> for more information.</p>
<p><strong>Syntax:</strong></p>
<pre><code>smtp-pattern-list NAME
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;smtp-pattern-list foo&gt;
&lt;/smtp-pattern-list&gt;

&lt;domain hotmail.com&gt;
  smtp-pattern-list foo
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="assume-delivery-upon-data-termination-timeout"><span class="header-section-number">3.3.10.91</span> assume-delivery-upon-data-termination-timeout</h4>
<p>If enabled and the connection times out while waiting for the reply to the "." after a DATA or for the reply to the last BDAT segment, PowerMTA assumes that the delivery was successful. May result in duplicate messages if used when not needed.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  assume-delivery-upon-data-termination-timeout true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="disable-mx-rollup"><span class="header-section-number">3.3.10.92</span> disable-mx-rollup</h4>
<p>Controls whether MX rollup should be performed for the domain. When set to true, DNS results for the domain are not checked against any <a href="#mx-rollup-list">MX rollup patterns</a> configured in the system.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  disable-mx-rollup true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="include-2"><span class="header-section-number">3.3.10.93</span> include</h4>
<p>This directive can be used at domain level to specify an additional configuration file to process. This can be used, for example, to facilitate maintenance of the configuration files across multiple hosts, by storing those settings which differ from host to host in a separate file and including it from the main (common) file. Wildcards may be used. An include may be used at global level and within <code>&lt;source&gt;</code>, <code>&lt;domain&gt;</code>, <code>&lt;virtual-mta&gt;</code> or <code>&lt;smtp-pattern-list&gt;</code> tag.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain yahoo.com&gt;
   include /etc/pmta/dkim-keys.txt
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="ssltls-directives"><span class="header-section-number">3.3.10.94</span> SSL/TLS Directives</h4>
<h5 id="use-starttls"><span class="header-section-number">3.3.10.94.1</span> use-starttls</h5>
<p>Specifies whether PowerMTA should use the STARTTLS extension (if supported by the receiving mailer). Setting this directive to true instructs PowerMTA to use that extension to encrypt the connection to the remote mailer.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  use-starttls true
&lt;/domain&gt;
</code></pre>
<hr />
<h5 id="require-starttls"><span class="header-section-number">3.3.10.94.2</span> require-starttls</h5>
<p>Only relevant if "use-starttls" is enabled. The STARTTLS extension may not be available at the remote host, or its use may fail for various reasons. If "require-starttls" is set to "true", PowerMTA will abort the connection, thus avoiding to send the message through a less secure connection. Otherwise, it will send the message anyway.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  require-starttls true
&lt;/domain&gt;
</code></pre>
<hr />
<h5 id="use-dane"><span class="header-section-number">3.3.10.94.3</span> use-dane</h5>
<p>Specifies whether PowerMTA should use DANE DNS records to verify whether the remote site requires the use of STARTTLS extension when transferring email to it. Setting this directive to <code>true</code> instructs PowerMTA to look up DANE DNS records for the remote site and attempt to verify the certificate presented by the remote site during STARTTLS based on the methods specified in the DANE DNS records. If the remote site requires the use of STARTTLS in its DANE DNS records, and the STARTTLS attempt to the remote site fails for any reason, PowerMTA will not transfer email to the remote site over plain text (in other words, downgrades to plain text on STARTTLS failures is not allowed). Note that PowerMTA has to be configured with a DNS resolver that supports DNSSEC. See <a href="#dane">DANE</a> for more information about the use of DANE in PowerMTA.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code># PowerMTA has to be configured with a DNS resolver that supports DNSSEC in order to use DANE.
name-server 8.8.8.8

&lt;domain hotmail.com&gt;
  use-dane true
&lt;/domain&gt;
</code></pre>
<hr />
<h5 id="reuse-ssl-session"><span class="header-section-number">3.3.10.94.4</span> reuse-ssl-session</h5>
<p>Session reuse is a mechanism to improve performance when establishing SSL/TLS sessions with a remote host. If PowerMTA is re-connecting to the same host within a short duration, it may be possible to reuse the previous SSL/TLS session details speeding up the initial handshake via an abbreviated protocol.</p>
<p><strong>This directive depends on the remote host's ability to support reusing SSL/TLS sessions. At present, only <code>gmail.com</code> is known to support. We suggest enabling the directive for only those domains that are known to support this feature.</strong></p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain gmail.com&gt;
    reuse-ssl-session true
&lt;/domain&gt;
</code></pre>
<h5 id="smtp-tls-allow-tlsv1"><span class="header-section-number">3.3.10.94.5</span> smtp-tls-allow-tlsv1</h5>
<p>Allows PowerMTA to use TLSv1 when establishing a secure connection.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
    smtp-tls-allow-tlsv1 false
&lt;/domain&gt;
</code></pre>
<hr />
<h5 id="smtp-tls-allow-tlsv11"><span class="header-section-number">3.3.10.94.6</span> smtp-tls-allow-tlsv1.1</h5>
<p>Allows PowerMTA to use TLSv1.1 when establishing a secure connection.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
    smtp-tls-allow-tlsv1.1 true
&lt;/domain&gt;
</code></pre>
<hr />
<h5 id="smtp-tls-allow-tlsv12"><span class="header-section-number">3.3.10.94.7</span> smtp-tls-allow-tlsv1.2</h5>
<p>Allows PowerMTA to use TLSv1.2 when establishing a secure connection.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
    smtp-tls-allow-tlsv1.2 true
&lt;/domain&gt;
</code></pre>
<hr />
<h5 id="smtp-tls-allow-sslv3"><span class="header-section-number">3.3.10.94.8</span> smtp-tls-allow-sslv3</h5>
<p>Allows PowerMTA to use SSLv3 when establishing a secure connection.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
    smtp-tls-allow-sslv3 true
&lt;/domain&gt;
</code></pre>
<hr />
<h5 id="smtp-tls-ca-file-directive"><span class="header-section-number">3.3.10.94.9</span> smtp-tls-ca-file directive</h5>
<p>Specifies the location of a local text file containing one or more root certificates that will be used to verify remote server certificate chains. Used by senders to authenticate remote gateways when using TLS based delivery. If using opportunistic TLS and the certificate verification fails, PowerMTA will fall back to using plain text for the delivery. In contrast, if TLS is required and the certificate verification fails, PowerMTA will return a temporary 4xx error indicating the failure.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
    smtp-tls-ca-file /etc/pmta/certchain.pem
&lt;/domain&gt;
</code></pre>
<hr />
<h5 id="smtp-tls-ciphers"><span class="header-section-number">3.3.10.94.10</span> smtp-tls-ciphers</h5>
<p>Specifies the ciphers that PowerMTA is allowed to use when negotiating a TLS session with remote client during STARTTLS. Please see documentation for OpenSSL command ciphers for valid cipher names that can be used with this directive.</p>
<p><strong>Default:</strong> <code>"HIGH:!ADH:@STRENGTH"</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain example.com&gt;
    smtp-tls-ciphers HIGH:!ADH:@STRENGTH
&lt;/domain&gt;
</code></pre>
<h5 id="log-tls-1"><span class="header-section-number">3.3.10.94.11</span> log-tls</h5>
<p>Specifies whether PowerMTA should log information during negotiation of a TLS session with the remote during STARTTLS.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain hotmail.com&gt;
  log-tls true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="discard-delivery-directives"><span class="header-section-number">3.3.10.95</span> Discard Delivery Directives</h4>
<p>The directives in this Section are ignored if specified in non-discard delivery domains.</p>
<h5 id="discard-as-bounce"><span class="header-section-number">3.3.10.95.1</span> discard-as-bounce</h5>
<p>Controls whether emails in a discard type queue should be recorded as bounces(b). When set to true for a domain with type discard, all emails in the queue are recorded as bounces in the accounting file. When set to false, all emails in the queue are recorded as deliveries(d) in the accounting file.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain undeliverable-domain.com&gt;
  type discard
  discard-as-bounce true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="file-delivery-directives"><span class="header-section-number">3.3.10.96</span> File Delivery Directives</h4>
<h5 id="file-format"><span class="header-section-number">3.3.10.96.1</span> file-format</h5>
<p>Specifies the format of the file(s) to which PowerMTA delivers the messages:</p>
<ul>
<li><p><strong>newfile-plain</strong>: A new file is created for each message, in the directory indicated by file-destination. The entire message is written to the file, including all headers, but no envelope information.</p></li>
<li><p><strong>newfile-pickup</strong>: A new file is created for each message, in the directory indicated by file-destination. In addition to the entire message body and headers, the special headers x-sender and x-receiver are included, containing the originator and recipient addresses from the message envelope.</p></li>
<li><p><strong>append-mbox</strong>: Messages are appended to the file indicated by file-destination, in the unix "mbox" format.</p></li>
</ul>
<p>PowerMTA creates new files with the initial "extension" of .tmp and renames them to .msg once done. If post-processing these files as they are created, you should code to ignore any .tmp files, to avoid processing a file which hasn't yet been completely written.</p>
<p>When appending to a file (for append-mbox), interlocking is performed using flock on Unix-like platforms and with share options passed to CreateFile on Windows. In order to safely access the file while PowerMTA is running, SparkPost recommends using the <a href="#accessing-files-created-by-the-sample-applications">pmtagetfile</a> application.</p>
<p><strong>Syntax:</strong></p>
<pre><code>file-format { newfile-plain | newfile-pickup | append-mbox }
</code></pre>
<p><strong>Default:</strong> <code>newfile-plain</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain bounce.mydomain.com&gt;
  type file
  file-destination /opt/pickup/
  file-format newfile-pickup
&lt;/domain&gt;
</code></pre>
<h5 id="file-destination"><span class="header-section-number">3.3.10.96.2</span> file-destination</h5>
<p>Specifies the directory or file name for file delivery. The directory or file name is subjected to the same macro expansion as in the pipe delivery's command line:</p>
<ul>
<li><p><strong>$bodytype</strong>: The message body type (7BIT, 8BITMIME or BINARYMIME).</p></li>
<li><p><strong>$ctime</strong>: The current date in Unix ctime format.</p></li>
<li><p><strong>$envid</strong>: The DSN envelope ID (from MAIL ... ENVID=...).</p></li>
<li><p><strong>$from</strong>: The envelope sender (MAIL FROM) address.</p></li>
<li><p><strong>$isodate</strong>: The current date in the format YYYY-MM-DD.</p></li>
<li><p><strong>$timet</strong>: The current time in numeric (time_t) format.</p></li>
<li><p><strong>$rfctime</strong>: The current date in RFC 822 format.</p></li>
<li><p><strong>$to</strong>: The envelope recipient (RCPT TO) address.</p></li>
<li><p><strong>$user</strong>: The recipient user. That is the local part (mailbox) in the recipient address, or, if the local part contains a '+' character, the portion of the mailbox to the left of the '+'. For example, in <a href="mailto:joe+xyzzy@company.com">joe+xyzzy@company.com</a>, the user would be joe.</p></li>
<li><p><strong>$domain</strong>: The recipient's domain.</p></li>
</ul>
<p>Whether $from and $to are lowercased depends on the setting of <a href="#macro-variables-preserve-case">macro-variables-preserve-case</a>. $user and $domain macros always expand in lower case, avoiding issues when those are used to create directories and files on case-sensitive file systems.</p>
<p><strong>Syntax:</strong></p>
<pre><code>file-destination DIRECTORY
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain bounce.mydomain.com&gt;
  type file
  file-destination /opt/pickup/
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="pipe-delivery-directives"><span class="header-section-number">3.3.10.97</span> Pipe Delivery Directives</h4>
<p>The directives in this Section are ignored if specified in non-pipe domains.</p>
<h5 id="command"><span class="header-section-number">3.3.10.97.1</span> command</h5>
<p>Specifies the command to use to start the program which will read from the pipe. This directive is required for pipe domains. PowerMTA substitutes the following macros in the command line:</p>
<ul>
<li><p><strong>$bodytype</strong>: The message body type (7BIT, 8BITMIME or BINARYMIME).</p></li>
<li><p><strong>$ctime</strong>: The current date in Unix ctime format.</p></li>
<li><p><strong>$envid</strong>: The DSN envelope ID (from MAIL ... ENVID=...).</p></li>
<li><p><strong>$from</strong>: The envelope sender (MAIL FROM) address.</p></li>
<li><p><strong>$isodate</strong>: The current date in the format YYYY-MM-DD.</p></li>
<li><p><strong>$timet</strong>: The current time in numeric (time_t) format.</p></li>
<li><p><strong>$rfctime</strong>: The current date in RFC 822 format.</p></li>
<li><p><strong>$to</strong>: The envelope recipient (RCPT TO) address.</p></li>
<li><p><strong>$user</strong>: The recipient user. That is the local part (mailbox) in the recipient address, or, if the local part contains a '+' character, the portion of the mailbox to the left of the '+'. For example, in <a href="mailto:joe+xyzzy@company.com">joe+xyzzy@company.com</a>, the user would be joe.</p></li>
<li><p><strong>$domain</strong>: The recipient's domain.</p></li>
</ul>
<p>To prevent any one of these macros from being interpreted as multiple arguments if they contain spaces, it is a good idea to enclose them in double quotes (like in the example below).</p>
<p><strong>Syntax:</strong></p>
<pre><code>command STRING
</code></pre>
<p>where <code>STRING</code> is the complete command that PowerMTA will use to start the program.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain bounces.xyz.com&gt;
    type pipe
    command &quot;/my/bounce/processor --envid \&quot;$envid\&quot; \&quot;$user\&quot;&quot;
&lt;/domain&gt;
</code></pre>
<hr />
<h5 id="macro-variables-preserve-case"><span class="header-section-number">3.3.10.97.2</span> macro-variables-preserve-case</h5>
<p>When set to true prevents $to and $from from being changed to lowercase. $user and $domain are always changed to lowercase, as they are intended to facilitate integration with Linux environments.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain bounces.mydomain.com&gt;
   type pipe
   command &quot;/my/bounce/processor --envid \&quot;$envid\&quot; \&quot;$user\&quot;&quot;
   macro-variables-preserve-case  true
&lt;/domain&gt;
</code></pre>
<hr />
<h4 id="http-delivery-directives"><span class="header-section-number">3.3.10.98</span> HTTP Delivery Directives</h4>
<h5 id="http-delivery-url"><span class="header-section-number">3.3.10.98.1</span> http-delivery-url</h5>
<p>For a queue with its <a href="#type">type</a> set to <code>http-delivery</code>, this directive can be used to configure an HTTP destination endpoint where messages from the queue will be delivered as a JSON object. See <a href="#http-delivery-webhooks">HTTP Delivery Webhooks</a> for more details on the JSON object format.</p>
<p>The URL specified with this directive must be an absolute URL, not relative, must be prefixed by either <code>http</code> or <code>https</code>, and should not contain any <code>userinfo</code>, <code>query-string</code> or <code>fragment</code> components.</p>
<p><strong>Note:</strong> This directive is required when the queue type is <code>http-delivery</code>.</p>
<p><strong>Syntax:</strong></p>
<pre><code>http-delivery-url scheme://host[:port][/path]
</code></pre>
<p>where <code>scheme</code> can be one of <code>https</code> or <code>http</code>, the <code>host</code> must be either a hostname, or an IP address. IPv4 addresses must be in dot-decimal notation, and IPv6 addresses must be enclosed in brackets (<code>[]</code>). <code>port</code> is optional - if not specified, it defaults to 443 when <code>scheme</code> is <code>https</code> and 80 when <code>scheme</code> is <code>http</code>. The <code>path</code> component is optional, and if specified must consist of a sequence of path segments separated by a slash (<code>/</code>).</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain yahoo.com&gt;
   type http-delivery
   http-delivery-url http://webhooks.endpoint.com:8181/api/v1/email
&lt;/domain&gt;
</code></pre>
<hr />
<h5 id="http-delivery-extra-headers"><span class="header-section-number">3.3.10.98.2</span> http-delivery-extra-headers</h5>
<p>For a queue with its <a href="#type">type</a> set to <code>http-delivery</code>, this optional directive can be used to configure a file containing HTTP headers that will be included in the headers of the HTTP request that PowerMTA will make when delivering messages from the queue. This could be useful, for example, for including a header such as <code>Authorization</code> as part of the HTTP request. See <a href="#http-delivery-webhooks">HTTP Delivery Webhooks</a> for more details on the JSON object format.</p>
<p><strong>Syntax:</strong></p>
<pre><code>http-delivery-extra-headers &lt;file-name&gt;
</code></pre>
<p>where <code>&lt;file-name&gt;</code> is the name of a file containing the extra HTTP headers to include, each header on a line on its own.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain yahoo.com&gt;
   type http-delivery
   http-delivery-url http://webhooks.endpoint.com:8181/api/v1/email
   http-delivery-extra-headers /etc/pmta/http-delivery-headers.txt
&lt;/domain&gt;
</code></pre>
<p>Sample content of the file: <code>/etc/pmta/http-delivery-headers.txt</code>:</p>
<pre><code>Authorization: 14ac5499cfdd2bb2859e4476d2e5b1d2bad079bfd
</code></pre>
<p><strong>Note</strong> PowerMTA does not check or interpret the content of the headers included in the file. It only does basic syntax checking of the header format.</p>
<hr />
<h4 id="sparkpost-traffic-redirection-support"><span class="header-section-number">3.3.10.99</span> SparkPost Traffic Redirection Support</h4>
<p>PowerMTA has special support for redirecting traffic for delivery through SparkPost. This may be desirable for various reasons, such as to seasonally add extra delivery capacity. Once your SparkPost setup is ready, you can have PowerMTA connect to it by creating a domain named {sparkpost} and setting it to authenticate using a SparkPost API key:</p>
<pre><code>&lt;domain {sparkpost}&gt;
    auth-password d41d8cd98f00b204e9800998ecf8427e # API key
&lt;/domain&gt;
</code></pre>
<p>You can then redirect specific domains (or entire Virtual MTAs, as in the example below) to SparkPost by having PowerMTA place messages in the {sparkpost} queue:</p>
<pre><code>&lt;virtual-mta ExtraCapacity&gt;
    &lt;domain *&gt;
        queue-to {sparkpost}
    &lt;/domain&gt;
&lt;/virtual-mta&gt;
</code></pre>
<h5 id="add-x-msys-api-header"><span class="header-section-number">3.3.10.99.1</span> add-x-msys-api-header</h5>
<p>Instructs PowerMTA to add a special X-MSYS-API header required to set SparkPost specific options, also setting SparkPost's campaign to the messages' JobID, if any. This directive is enabled by default for the {sparkpost} domain.</p>
<p><strong>Default:</strong> <code>true</code> for <code>{sparkpost}</code> domain, <code>false</code> for all other domains.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain {sparkpost}&gt;
   add-x-msys-api-header true
&lt;/domain&gt;
</code></pre>
<hr />
<h5 id="sparkpost-sandbox"><span class="header-section-number">3.3.10.99.2</span> sparkpost-sandbox</h5>
<p>Sets the <code>sandbox</code> SparkPost option.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain {sparkpost}&gt;
   sparkpost-sandbox true
&lt;/domain&gt;
</code></pre>
<hr />
<h5 id="sparkpost-ip-pool"><span class="header-section-number">3.3.10.99.3</span> sparkpost-ip-pool</h5>
<p>Sets the IP pool from which SparkPost is to send messages.</p>
<p><strong>Syntax:</strong></p>
<pre><code>sparkpost-ip-pool STRING
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain {sparkpost}&gt;
    sparkpost-ip-pool shared-pool
&lt;/domain&gt;
</code></pre>
<hr />
<h3 id="acct-file-directives"><span class="header-section-number">3.3.11</span> &lt;acct-file&gt; Directives</h3>
<p>The accounting file in CSV format can be written to a file or pipe. For more information, see <a href="#accounting-files-and-statistics">Accounting Files and Statistics</a>.</p>
<h4 id="delete-after"><span class="header-section-number">3.3.11.1</span> delete-after</h4>
<p>This directive tells PowerMTA how long to keep the accounting file before deleting it from the server. "delete-after" only applies if "move-to" isn't active" (and move-to must point to a different location than the directory where the file was originally created).</p>
<p><strong>Syntax:</strong></p>
<pre><code>delete-after { Nd | never }
</code></pre>
<p>where <code>N</code> is the number of days to retain the accounting file for.</p>
<p><strong>Default:</strong> <code>8d</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;acct-file /var/log/pmta/acct.csv&gt;
    delete-after 5d
&lt;/acct-file&gt;
</code></pre>
<hr />
<h4 id="move-to"><span class="header-section-number">3.3.11.2</span> move-to</h4>
<p>This directive tells PowerMTA where to move the accounting file when using move-interval or max-size. If move-to isn't set, no moving is done (<code>move-interval</code>, if configured, is silently ignored). Directory must be on the same volume as the accounting files. Moving across a network is not supported.</p>
<p>The directive is off by default, and the files are not moved unless this directive is configured.</p>
<p><strong>Syntax:</strong></p>
<pre><code>move-to DIRECTORY
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;acct-file /var/log/pmta/acct.csv&gt;
    move-to /var/log/archive
&lt;/acct-file&gt;
</code></pre>
<hr />
<h4 id="move-interval"><span class="header-section-number">3.3.11.3</span> move-interval</h4>
<p>This directive tells PowerMTA at what time interval to move the accounting file and start a new one.</p>
<p><strong>Syntax:</strong></p>
<pre><code>move-interval TIME-INTERVAL
</code></pre>
<p><strong>Default:</strong> <code>1d</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;acct-file /var/log/pmta/acct.csv&gt;
    move-to /var/log/archive
    move-interval 1h
&lt;/acct-file&gt;
</code></pre>
<hr />
<h4 id="max-size"><span class="header-section-number">3.3.11.4</span> max-size</h4>
<p>The max size of the accounting file in Bytes, Kilobytes, Megabytes, Gigabytes, or Terabytes before PowerMTA moves the accounting file and starts a new one. Minimum size is <code>1M</code> (<code>1024K</code>). This directive applies both with and without "move-to". If "move-to" is not specified, a new file is started in place (with a higher NNNN in the file name).</p>
<p><strong>Syntax:</strong></p>
<pre><code>max-size N{b|k|m|g|t}
</code></pre>
<p><strong>Default:</strong> <code>250M</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;acct-file /var/log/pmta/acct.csv&gt;
    max-size 1G
&lt;/acct-file&gt;
</code></pre>
<hr />
<h4 id="queue-filter"><span class="header-section-number">3.3.11.5</span> queue-filter</h4>
<p>Can be set to a comma separated list of queue names, each of which can be optionally prefixed with <strong><code>!</code></strong> to indicate negation. If set, the <strong><code>queue</code></strong> field of accounting records is compared against the queue names in the filter list and is written if it matches a non-negated (without a <code>!</code> prefix) queue name, or not written if it matches a negated (with a <code>!</code> prefix) queue name. The filtering applies to only records that have a 'queue' field in them (d/b/t/tq). Any f/rb/rs/r records that are configured in the acct-file will be written unconditionally (i.e. all records of that type) since they don't have a 'queue' field.</p>
<p>The matching is performed in the order in which the queue names were specified in the <code>queue-filter</code> directive.</p>
<p><strong>Note that if queue-filter is active for an accounting file, any records that are filtered out (i.e., any d/b/t/tq with a queue that does not match one of the queue names listed in the directive) will be lost forever (unless they are configured to be written to other accounting files).</strong> Always make sure that the queue-filter is set exactly to your needs.</p>
<p>If all queue names in <code>queue-filter</code> are negated, no records will match. All the queue names listed in the "queue-filter" directive must obey syntax rules for a valid queue name, namely:</p>
<ul>
<li><p>The domain part must be non-empty, must obey domain name syntax, and must be a qualified domain name. It cannot be a reserved domain name (i.e, cannot start with "{" and end with "}"). This rules out domain names like "{feedbackLoop}", "{bounceProcessor}" etc.</p></li>
<li><p>If a VMTA is specified, it must be a syntactically valid VMTA name, or <code>{default}</code>. Note that there is no check for whether such a VMTA is defined in the configuration. It is sufficient if the VMTA name is syntactically valid.</p></li>
<li><p>If no VMTA name is specified, it is assumed to be the name of the default VMTA (<code>{default}</code>), so <code>foo.com</code> will be treated as <code>foo.com/{default}</code></p></li>
</ul>
<p>By default, filtering is not turned on (in other words, accounting records for all queues are written to the accounting file).</p>
<p><strong>Syntax:</strong></p>
<pre><code>queue-filter QUEUE-NAME-LIST
</code></pre>
<p>where <code>QUEUE-NAME-LIST</code> is a list of comma separated list of queue names, optionally prefixed with <code>!</code>.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;acct-file a.csv&gt;
    records d,b,t,tq,f,rb,rs,r
    queue-filter a.com/vmta1,![*.]b.com/*,*.c.com/vmta2,!*/vmta3,*/vmta4
&lt;/acct-file&gt;
</code></pre>
<hr />
<h4 id="retry-interval"><span class="header-section-number">3.3.11.6</span> retry-interval</h4>
<p>Retries the pipe program in a regular interval in case of a failure. This should only be used when using pipe to write an accounting file.</p>
<p><strong>Syntax:</strong></p>
<pre><code>retry-interval TIME-INTERVAL
</code></pre>
<p><strong>Default:</strong> <code>5m</code></p>
<p><strong>Example:</strong> (Windows)</p>
<pre><code>&lt;acct-file |C:\pmta\bin\customCode.exe -thisOption --thatOption&gt;
    retry-interval 10m
&lt;/acct-file&gt;
</code></pre>
<p><strong>Example:</strong> (Unix)</p>
<pre><code>&lt;acct-file |myscript.pl -thisOption --thatOption&gt;
    retry-interval 10m
&lt;/acct-file&gt;
</code></pre>
<hr />
<h4 id="iso-times"><span class="header-section-number">3.3.11.7</span> iso-times</h4>
<p>Requests that PowerMTA writes time stamps in the accounting file (or pipe) in ISO format.</p>
<p><strong>Default:</strong> <code>yes</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;acct-file /var/log/pmta/acct.csv&gt;
    iso-times yes
&lt;/acct-file&gt;
</code></pre>
<hr />
<h4 id="user-string"><span class="header-section-number">3.3.11.8</span> user-string</h4>
<p>Specifies a custom string to be stored along with other MTA information in the accounting file. The field userstring also needs to be added to the record-fields directive for this to show up in the accounting file.</p>
<p><strong>Syntax:</strong></p>
<pre><code>user-string STRING
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;acct-file /var/log/pmta/acct.csv&gt;
    user-string unique-id
&lt;/acct-file&gt;
</code></pre>
<hr />
<h4 id="write-timeout"><span class="header-section-number">3.3.11.9</span> write-timeout</h4>
<p>Allows for setting write timeouts in accounting pipes, so that an unresponsive accounting application doesn't hold up PowerMTA indefinitely. Only used when piping accounting data to another file.</p>
<p><strong>Syntax:</strong></p>
<pre><code>write-timeout TIME-INTERVAL
</code></pre>
<p><strong>Default:</strong> <code>1m</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;acct-file |C:\pmta\bin\customCode.exe -thisOption --thatOption&gt;
    write-timeout 2m
&lt;/acct-file&gt;
</code></pre>
<hr />
<h4 id="map-header-to-field"><span class="header-section-number">3.3.11.10</span> map-header-to-field</h4>
<p>Allows for mapping a header to a specific field in the accounting file. This is useful if for example the From header needs to be mapped to the SMTP MAIL FROM address (orig field in the accounting file). An example would be like the following:</p>
<p>In the example below, <code>header_x-foo</code> gets mapped to the rcpt field in bounced records, and <code>header_x-bar</code> gets mapped to the rcpt field for delivered records. Multiple entries may be specified to map multiple headers to the same field. The tq record type cannot be used. The order of the directives is significant when using multiple ones for the same record type and field. In the above example the rcpt field will contain the content of the x-foo header if x-foo exists, if not it will contain the content of the x-bar header if that one exists. Otherwise the content of the x-baz header. If that one also doesn't exist it will contain the original value of the orig field (i.e. the rcpt field will not be overwritten). The same header can be mapped to multiple fields (e.g., <code>header_x-foo</code> above) and will be written to all fields mapped.</p>
<p><strong>Syntax:</strong></p>
<pre><code>map-header-to-field RECORD-TYPE header_NAME ACCT-FIELD-NAME
</code></pre>
<p><strong>Default:</strong> <code>none</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;acct-file /var/log/pmta/acct.csv&gt;
  map-header-to-field b header_x-foo rcpt
  map-header-to-field d header_x-bar rcpt
  map-header-to-field d header_x-baz rcpt
  map-header-to-field d header_x-foo orig
&lt;/acct-file&gt;
</code></pre>
<hr />
<h4 id="records"><span class="header-section-number">3.3.11.11</span> records</h4>
<p>This directive tells PowerMTA which record types to include in the accounting file. There are 8 record types: d, b, t, tq, r, f, rb and rs. It may only be defined once per &lt;acct-file&gt; with multiple types separated by commas.</p>
<ul>
<li><p>d is for delivered records and will include all messages that were successfully delivered. delivery can be used in place of d.</p></li>
<li><p>b is for bounced records and will include all locally generated bounces (synchronous bounces). Note that bounces generated by remote mail servers (asynchronous bounces) will not be included. bounce can be used in place of b.</p></li>
<li><p>t is for transient recipient level errors only (such as mailbox full). transient can be used in place of t.</p></li>
<li><p>tq is for queue wide transient errors and will include information about delivery attempts for a given domain/vmta. transient-queue can be used in place of t.</p></li>
<li><p>r is for inbound records and will include information about messages submitted to PowerMTA for delivery. receipt can be used in place of r.</p></li>
<li><p>f is for feedback loop emails if PowerMTA is configured to look for feedback loop emails with the &lt;feedback-loop-processor&gt;. feedback-loop may be used in place of f. See <a href="#processing-feedback-loop-emails">Processing Feeback Loop Emails</a> for more information.</p></li>
<li><p>rb is for remote bounce emails if PowerMTA is configured to look for remote bounce emails with the &lt;bounce-processor&gt;. remote-bounce may be used in place of rb. See <a href="#processing-asynchronous-remote-bounces-and-remote-status-reports">Processing Asynchronous (Remote) Bounces and remote status reports</a> for more information.</p></li>
<li><p>rs is for remote status emails if PowerMTA is configured to look for remote status emails with the &lt;bounce-processor&gt;. remote-status may be used in place of rs. See <a href="#processing-asynchronous-remote-bounces-and-remote-status-reports">Processing Asynchronous (Remote) Bounces and remote status reports</a> for more information.</p></li>
</ul>
<p>Due to the fact that there can be many delivery attempts for one message, it is suggested that type t and/or tq should only be used when needed (debugging, troubleshooting, etc.) as it may cause large file sizes. It is also recommended when using this setting to have the t or tq type records written to their own file, as so not to cause unwanted data in the primary accounting file.</p>
<p><strong>Syntax:</strong></p>
<pre><code>records RECORD-TYPE-LIST
</code></pre>
<p>where <code>RECORD-TYPE-LIST</code> is a comma separated list of record types(<code>{d|b|t|tq|r|rb|rs|f}</code>)</p>
<p><strong>Default:</strong> <code>d,b</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;acct-file /var/log/pmta/acct.csv&gt;
    records d, b, t, tq, r, rb, rs, f
&lt;/acct-file&gt;
</code></pre>
<hr />
<h4 id="record-fields"><span class="header-section-number">3.3.11.12</span> record-fields</h4>
<p>This directive specifies the fields to be included in the records defined via the "record" directive, in the accounting file. By default all per record type are included. To include only a subset of all the fields, simply add the desired fields in a comma separated list. To include a custom header, add the record field header_XXX, where XXX is the name of the custom field you wish to log. For example, to log all fields and a custom header, the directive would look like this:</p>
<pre><code>record-fields delivery *,header_Message-Id
</code></pre>
<p>To include only a subset of the fields, list the required fields similar to the following<span
id="OLE_LINK1" class="anchor"><span id="OLE_LINK2" class="anchor"></span></span>:</p>
<pre><code>record-fields bounce timeLogged,orig,rcpt,dlvSourceIp,vmta
</code></pre>
<p>To exclude fields from the default, you can use an ! to exclude the unwanted fields. For example, to include all fields except orcpt you would use:</p>
<pre><code>record-fields d *,!orcpt
record-fields b *,!orcpt
</code></pre>
<p><strong>Syntax:</strong></p>
<pre><code>record-fields RECORD-TYPE FIELD-LIST
</code></pre>
<p>where <code>RECORD-TYPE</code> is one of <code>{d|b|t|tq|r|rb|rs|f}</code></p>
<p><strong>Default:</strong> <code>*</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;acct-file /var/log/pmta/acct.csv&gt;
    record-fields d *,header_Message-Id
    record-fields b *,!orcpt
&lt;/acct-file&gt;
</code></pre>
<hr />
<h4 id="world-readable"><span class="header-section-number">3.3.11.13</span> world-readable</h4>
<p>This directive tells PowerMTA to provide read permissions to all users on the system when it creates a new accounting file.</p>
<p><strong>Default:</strong> <code>no</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;acct-file /var/log/pmta/acct.csv&gt;
    world-readable yes
&lt;/acct-file&gt;
</code></pre>
<hr />
<h4 id="count-moved-records"><span class="header-section-number">3.3.11.14</span> count-moved-records</h4>
<p>This directive tells PowerMTA whether or not to count the records in CSV files moved. The record counts are written to the logging file along with the message that indicates that the file was moved.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;acct-file /var/log/pmta/acct.csv&gt;
    count-moved-records yes
&lt;/acct-file&gt;
</code></pre>
<hr />
<h4 id="sync"><span class="header-section-number">3.3.11.15</span> sync</h4>
<p>Determines whether the OS' buffers for the accounting file are flushed regularly. This helps ensure that the accounting data isn't corrupted in case of a system crash.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;acct-file /var/log/pmta/acct.csv&gt;
    sync true
&lt;/acct-file&gt;
</code></pre>
<h4 id="privacy-policy"><span class="header-section-number">3.3.11.16</span> privacy-policy</h4>
<p>This directive, when set to anything but <code>retain</code>, instructs PowerMTA to replace the "local part" (left hand size of the "@") in the recipient email addresses, as well as any occurrences found in SMTP responses and in standard VERPed originator addresses, with either the redaction string or a hash of that local part (after normalizing to lower-case). The directive accepts the following:</p>
<ul>
<li><code>retain</code></li>
<li><code>redact</code> with an optional redaction string (defaults to "...")</li>
<li><code>siphash</code> with a key string in plain text</li>
<li><code>siphash-hexkey</code> with hex-formatted key string</li>
<li><code>hmac-sha256</code> with a key string in plain text</li>
<li><code>hmac-sha256-hexkey</code> with a hex-formatted key string</li>
</ul>
<p>For <code>Siphash</code> hash calculations, the key string can only be up to 16 bytes in length. If less than 16 bytes are specified, PowerMTA will append null bytes (<code>\0</code>) to the end of the key string to make it 16 bytes in length. The 16 byte length is a requirement of the SipHash algorithm.</p>
<p>For <code>hmac-sha256</code> hash calculations, RFC 2104 recommends that the key string be at least 32 bytes in length for security reasons. PowerMTA will emit a warning if the key string is less than 32 bytes in length, however, it does not reject such key strings because RFC 2104's suggestion is only a recommendation rather than a requirement.</p>
<p>In the example below, the local part is replaced with <code>X</code>:</p>
<pre><code>&lt;acct-file /var/log/pmta/redacted.csv&gt;
    privacy-policy redact &quot;X&quot;
    records b, d
&lt;/acct-file&gt;
</code></pre>
<p>In this, the local part is replaced with the hex-formatted (64-bit) SipHash of the local part, using the key "secret":</p>
<pre><code>&lt;acct-file /var/log/pmta/siphashed.csv&gt;
    privacy-policy siphash &quot;secret&quot;
    records b, d
&lt;/acct-file&gt;
</code></pre>
<p>See <a href="https://131002.net/siphash/" class="uri"><a href="https://131002.net/siphash/">https://131002.net/siphash/</a></a> for a description of SipHash.</p>
<p>In this, the local part is replaced with the hex-formatted HMAC-SHA256 hash of the local part, using the key "secret":</p>
<pre><code>&lt;acct-file /var/log/pmta/hmacsha256-hashed.csv&gt;
    privacy-policy hmac-sha256 &quot;secret&quot;
    records b, d
&lt;/acct-file&gt;
</code></pre>
<p>To manually compute the hash of a local part, the <a href="#digest">digest</a> command of the PowerMTA command line tool can be used. Be sure to supply just the local part of the email address to the command.</p>
<p><strong>Syntax:</strong></p>
<pre><code>privacy-policy { retain | redact | siphash | siphash-hexkey | hmac-sha256 | hmac-sha256-hexkey } [STRING]
</code></pre>
<p><strong>Default:</strong> <code>retain</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;acct-file /var/log/pmta/siphash.csv&gt;
    privacy-policy siphash &quot;secret&quot;
    records b, d
&lt;/acct-file&gt;
</code></pre>
<hr />
<h3 id="virtual-mta-directives"><span class="header-section-number">3.3.12</span> &lt;virtual-mta&gt; Directives</h3>
<p>These directives specify behavior specific to a "VirtualMTA". VirtualMTA directives only apply when that VirtualMTA has been selected through one of the supported selection methods.</p>
<pre><code>&lt;virtual-mta mta1&gt;
    smtp-source-host 1.2.3.4 mta1.company.com
    &lt;domain *&gt;
        dkim-sign yes
    &lt;/domain&gt;
&lt;/virtual-mta&gt;
</code></pre>
<p>See <a href="#virtualmta-support">VirtualMTA Support</a> for more information.</p>
<h4 id="use-proxy-1"><span class="header-section-number">3.3.12.1</span> use-proxy</h4>
<p>Specifies a comma separate list of proxy servers (see <a href="#proxy">proxy</a> for more details) that the virtual MTA can use when connecting to a remote destination.</p>
<p>The proxy servers in the list are used in the order in which they are defined. The names in the list are strictly used for failover only - the second proxy on the list is used only if the connection to the first proxy fails, the third proxy is used only when connection to both first and second proxy have failed, and so on.</p>
<p>Every proxy server mentioned in this directive must be defined in the configuration with a <a href="#proxy">proxy</a> tag.</p>
<p><strong>Syntax:</strong></p>
<pre><code>use-proxy PROXY-SERVER-LIST
</code></pre>
<p><strong>Default:</strong> None</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;virtual-mta customer1&gt;
    use-proxy mta-proxy-a,mta-proxy-b  # &quot;mta-proxy-a&quot; is always used unless connections to it fail. &quot;mta-proxy-b&quot; is used only when connecting to &quot;mta-proxy-a&quot; fails
&lt;/virtual-mta&gt;


&lt;proxy mta-proxy-a&gt;
  server 10.1.2.3:5000
  client 16.70.55.233 client.hostname.com
&lt;/proxy&gt;

&lt;proxy mta-proxy-b&gt;
  server mta-proxy-b.internal.hostname.com:5000
  client 16.80.77.192  client2.hostname.com
&lt;/proxy&gt;
</code></pre>
<hr />
<h4 id="max-smtp-msg-rate"><span class="header-section-number">3.3.12.2</span> max-smtp-msg-rate</h4>
<p>Specifies <em>maximum</em> attempted recipients per time interval for this VirtualMTA.</p>
<p>Both deliveries and attempted deliveries are counted towards the limit. The following error will be displayed in the web monitor when the rate limit is reached:</p>
<pre><code>message rate limit reached (based on max-smtp-msg-rate in configuration)
</code></pre>
<p>When using rate limiting, it is best to establish a baseline without rate limiting to ensure that the limits set are having a positive impact on deliverability.</p>
<p>See <a href="#max-msg-rate">max-msg-rate</a> for more examples on rate limit syntax that can be used with this directive.</p>
<p><strong>Syntax:</strong></p>
<pre><code>max-smtp-msg-rate { unlimited | 0 | N/[M]{d|day|h|hr|m|min|s|sec} }
</code></pre>
<p>where "d" or "day" means per-day, "h" or "hr" means per-hour, "m" or "min" means per-minute and "s" or "sec" means per-second. <code>N</code> is required and must be non-zero, but <code>M</code> is optional. If <code>M</code> is not specified, it defaults to 1.</p>
<p><strong>Default:</strong> <code>unlimited</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;virtual-mta customer1&gt;
    max-smtp-msg-rate 6/sec
&lt;/virtual-mta&gt;
</code></pre>
<hr />
<h4 id="max-smtp-data-volume-rate"><span class="header-section-number">3.3.12.3</span> max-smtp-data-volume-rate</h4>
<p>Specifies <em>maximum</em> amount of data that will be transferred through this virtual MTA in the given time interval.</p>
<p>Only the volume of data for successful deliveries are counted towards the limit.</p>
<p>See <a href="#max-data-volume-rate">max-data-volume-rate</a> for more examples on rate limit syntax that can be used with this directive.</p>
<p><strong>Syntax:</strong></p>
<pre><code>max-smtp-data-volume-rate { unlimited | 0 | N [{b|B|k|K|m|M|g|G|t|T}] /[X]{d|day|h|hr|m|min|s|sec} }
</code></pre>
<p>For the numerator, "b" or "B" means bytes, "k" or "K" means kilobytes, "m" or "M" means megabyte, "g" or "G" means gigabyte, "t" or "T" means terabyte. A number <code>N</code> must be specified in the numerator. If a data size suffix is not specified, it is assumed to mean bytes.</p>
<p>For the denominator, "d" or "day" means per-day, "h" or "hr" means per-hour, "m" or "min" means per-minute and "s" or "sec" means per-second. <code>X</code> is optional, but must be a number if specified. If <code>X</code> is not specified, it defaults to 1.</p>
<p><strong>Default:</strong> <code>unlimited</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;virtual-mta customer1&gt;
    max-smtp-data-volume-rate 6g/10h
&lt;/virtual-mta&gt;
</code></pre>
<hr />
<h4 id="cold-virtual-mta"><span class="header-section-number">3.3.12.4</span> cold-virtual-mta</h4>
<p>This directive takes the name of a manually configured VirtualMTA. The directive can be repeated to configure multiple cold VirtualMTAs, in which case these are used in round-robin fashion and the per-domain limit applies individually for each cold VirtualMTA.</p>
<p><strong>Syntax:</strong></p>
<pre><code>cold-virtual-mta VMTA-NAME
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;virtual-mta vmta-cold&gt;
    smtp-source-host 1.2.3.4 mail2.yourdomain.com
&lt;/virtual-mta&gt;

&lt;virtual-mta vmta1&gt;
    smtp-source-host 2.3.4.5 mail3.yourdomain.com
    cold-virtual-mta vmta-cold
    &lt;domain *&gt;
        max-cold-virtual-mta-msg 1000/d
    &lt;/domain&gt;
&lt;/virtual-mta&gt;
</code></pre>
<hr />
<h4 id="host-name-1"><span class="header-section-number">3.3.12.5</span> host-name</h4>
<p>See <a href="#host-name">host-name</a> definition in <a href="#global-directives">Global Directives</a> for more information.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;virtual-mta vmta&gt;
    host-name mail.foo.com
&lt;/virtual-mta&gt;
</code></pre>
<hr />
<h4 id="domain-key-1"><span class="header-section-number">3.3.12.6</span> domain-key</h4>
<p>See <a href="#domain-key">domain-key</a> definition in <a href="#general-queueing-and-delivery-directives">General Queueing and Delivery Directives</a> for more information.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;virtual-mta mta1&gt;
    domain-key s1,*,/etc/pmta/key.pem
&lt;/virtual-mta&gt;
</code></pre>
<hr />
<h4 id="include-headers-from-1"><span class="header-section-number">3.3.12.7</span> include-headers-from</h4>
<p>See <a href="#include-headers-from">include-headers-from</a> definition in <a href="#general-queueing-and-delivery-directives">General Queueing and Delivery Directives</a> for more information.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;virtual-mta mta1&gt;
    include-headers-from /etc/pmta/headers.txt
&lt;/virtual-mta&gt;
</code></pre>
<hr />
<h4 id="max-smtp-out-1"><span class="header-section-number">3.3.12.8</span> max-smtp-out</h4>
<p>Specifies the <em>maximum</em> number of simultaneous connections to be opened across all queues from within this virtual MTA.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;virtual-mta mta1&gt;
    max-smtp-out 100
&lt;/virtual-mta&gt;
</code></pre>
<hr />
<h4 id="rewrite-list"><span class="header-section-number">3.3.12.9</span> rewrite-list</h4>
<p>See <a href="#rewrite-list-directives">&lt;rewrite-list&gt; Directives</a> for more information.</p>
<p><strong>Syntax:</strong></p>
<pre><code> rewrite-list NAME
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;rewrite-list abc&gt;
    mail-from *@foo.com *@bar.com
&lt;/rewrite-list&gt;

&lt;virtual-mta mta1&gt;
    rewrite-list abc
&lt;/virtual-mta&gt;
</code></pre>
<hr />
<h4 id="include-3"><span class="header-section-number">3.3.12.10</span> include</h4>
<p>This directive can be used at VirtualMTA level to specify an additional configuration file to process. This can be used, for example, to facilitate maintenance of the configuration files across multiple hosts, by storing those settings which differ from host to host in a separate file and including it from the main (common) file. Wildcards may be used. An include may be used at global level and within <code>&lt;source&gt;</code>, <code>&lt;domain&gt;</code>, <code>&lt;virtual-mta&gt;</code> or <code>&lt;smtp-pattern-list&gt;</code> tag.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;virtual-mta mta1&gt;
   include /etc/pmta/domain-keys.txt
&lt;/virtual-mta&gt;
</code></pre>
<hr />
<h3 id="virtual-mta-pool-directives"><span class="header-section-number">3.3.13</span> &lt;virtual-mta-pool&gt; Directives</h3>
<p>VirtualMTA pools are groups of VirtualMTAs. They share the same name space as VirtualMTAs, so you can select a pool instead of a specific VirtualMTA. When you select a VirtualMTA pool, the VirtualMTAs in that pool are used in round-robin fashion to deliver the message. See <a href="#virtualmta-support">VirtualMTA Support</a> for more information on VirtualMTAs and VirtualMTA pools.</p>
<p>A <code>&lt;domain&gt;</code> may be defined inside of a <code>&lt;virtual-mta-pool&gt;</code>. If this is done, the defined directives will be inherited by any VirtualMTA that is part of the pool. If a conflicting directive is defined directly in the given VirtualMTA, the directive in the VirtualMTA overrides the one defined in the <code>&lt;virtual-mta-pool&gt;</code>.</p>
<p>The following directives are also supported:</p>
<ul>
<li>cold-virtual-mta</li>
<li>domain-key</li>
<li>max-smtp-out</li>
<li>max-smtp-msg-rate</li>
<li>include-headers-from</li>
<li>max-smtp-data-volume-rate</li>
</ul>
<h4 id="virtual-mta"><span class="header-section-number">3.3.13.1</span> virtual-mta</h4>
<p>Specifies the name of a VirtualMTA to include in the pool. To specify multiple VirtualMTAs, repeat this directive with the name of each VirtualMTA to add.</p>
<p><strong>Syntax:</strong></p>
<pre><code>virtual-mta VMTA-NAME
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;virtual-mta mta1&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta mta2&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta-pool pool&gt;
    virtual-mta mta1
    virtual-mta mta2
&lt;/virtual-mta-pool&gt;
</code></pre>
<h4 id="domain-1"><span class="header-section-number">3.3.13.2</span> domain</h4>
<p>Specifies the settings for a domain that will be inherited by all the Virtual MTAs defined in the pool.</p>
<p>Within the inheritance hierarchy, a domain defined inside a Virtual MTA will first inherit its settings from domain definitions in the pool that the Virtual MTA is part of and then subsequently inherit from global domain definitions.</p>
<p><strong>It is an error to define a VMTA in 2 different pools which have <code>&lt;domain&gt;</code> definitions inside them.</strong></p>
<p><strong>Example:</strong> In this example, both <code>yahoo.com/mta1</code> and <code>yahoo.com/mta2</code> will inherit <code>max-msg-rate 10/h</code> setting from the pool.</p>
<pre><code>&lt;virtual-mta mta1&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta mta2&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta-pool pool&gt;

    &lt;domain yahoo.com&gt;
       max-msg-rate 10/h
    &lt;/domain&gt;

    virtual-mta mta1
    virtual-mta mta2
&lt;/virtual-mta-pool&gt;
</code></pre>
<p>Below is an example of an invalid configuration.</p>
<pre><code># Invalid configuration since mta1 is part of both pool-one and pool-two,
# each of which have domain definitions inside them

&lt;virtual-mta mta1&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta-pool pool-one&gt;

    &lt;domain yahoo.com&gt;
       max-msg-rate 10/h
    &lt;/domain&gt;

    virtual-mta mta1

&lt;/virtual-mta-pool&gt;


&lt;virtual-mta-pool pool-two&gt;

    &lt;domain yahoo.com&gt;
       max-msg-rate 15/h
    &lt;/domain&gt;

    virtual-mta mta1

&lt;/virtual-mta-pool&gt;
</code></pre>
<h4 id="domain-key-2"><span class="header-section-number">3.3.13.3</span> domain-key</h4>
<p><strong>Syntax:</strong> See <a href="#domain-key">domain-key</a> definition in <a href="#general-queueing-and-delivery-directives">General Queueing and Delivery Directives</a> for more information.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;virtual-mta mta1&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta mta2&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta-pool pool&gt;

    domain-key s1,*,/etc/pmta/key.pem

    virtual-mta mta1
    virtual-mta mta2

&lt;/virtual-mta-pool&gt;
</code></pre>
<h4 id="include-headers-from-2"><span class="header-section-number">3.3.13.4</span> include-headers-from</h4>
<p><strong>Syntax:</strong> See <a href="#include-headers-from">include-headers-from</a> definition in <a href="#general-queueing-and-delivery-directives">General Queueing and Delivery Directives</a> for more information.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;virtual-mta mta1&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta mta2&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta-pool pool&gt;

    include-headers-from /etc/pmta/headers.txt

    virtual-mta mta1
    virtual-mta mta2

&lt;/virtual-mta-pool&gt;
</code></pre>
<h4 id="max-smtp-msg-rate-1"><span class="header-section-number">3.3.13.5</span> max-smtp-msg-rate</h4>
<p>See <a href="#max-smtp-msg-rate">max-smtp-msg-rate</a> definition in <a href="#virtual-mta-directives">&lt;virtual-mta&gt; Directives</a>.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;virtual-mta mta1&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta mta2&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta-pool pool&gt;

    max-smtp-msg-rate 100/m

    virtual-mta mta1
    virtual-mta mta2

&lt;/virtual-mta-pool&gt;
</code></pre>
<h4 id="max-smtp-out-2"><span class="header-section-number">3.3.13.6</span> max-smtp-out</h4>
<p><strong>Syntax:</strong> See <a href="#max-smtp-out">max-smtp-out</a> definition in <a href="#domain-directives">&lt;domain&gt; Directives</a>.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;virtual-mta mta1&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta mta2&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta-pool pool&gt;

    max-smtp-out 100

    virtual-mta mta1
    virtual-mta mta2

&lt;/virtual-mta-pool&gt;
</code></pre>
<h4 id="rewrite-list-1"><span class="header-section-number">3.3.13.7</span> rewrite-list</h4>
<p>See <a href="#rewrite-list-directives">&lt;rewrite-list&gt; Directives</a> for more information.</p>
<p><strong>Syntax:</strong></p>
<pre><code> rewrite-list NAME
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;virtual-mta mta1&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta mta2&gt;
&lt;/virtual-mta&gt;

&lt;rewrite-list abc&gt;
    mail-from *@foo.com *@bar.com
&lt;/rewrite-list&gt;

&lt;virtual-mta-pool pool&gt;

    rewrite-list abc

    virtual-mta mta1
    virtual-mta mta2

&lt;/virtual-mta-pool&gt;
</code></pre>
<hr />
<h4 id="max-smtp-data-volume-rate-1"><span class="header-section-number">3.3.13.8</span> max-smtp-data-volume-rate</h4>
<p>See <a href="#max-smtp-data-volume-rate">max-smtp-data-volume-rate</a> for more information about the use of this directive within a Virtual MTA .</p>
<p><strong>Syntax:</strong></p>
<pre><code>max-smtp-data-volume-rate { unlimited | 0 | N [{b|B|k|K|m|M|g|G|t|T}] /[X]{d|day|h|hr|m|min|s|sec} }
</code></pre>
<p>For the numerator, "b" or "B" means bytes, "k" or "K" means kilobytes, "m" or "M" means megabyte, "g" or "G" means gigabyte, "t" or "T" means terabyte. A number <code>N</code> must be specified in the numerator. If a data size suffix is not specified, it is assumed to mean bytes.</p>
<p>For the denominator, "d" or "day" means per-day, "h" or "hr" means per-hour, "m" or "min" means per-minute and "s" or "sec" means per-second. <code>X</code> is optional, but must be a number if specified. If <code>X</code> is not specified, it defaults to 1.</p>
<p><strong>Default:</strong> <code>unlimited</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;virtual-mta mta1&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta mta2&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta-pool pool&gt;

    max-smtp-data-volume-rate 6g/10h

    virtual-mta mta1
    virtual-mta mta2

&lt;/virtual-mta-pool&gt;
</code></pre>
<hr />
<h3 id="pattern-list-directives"><span class="header-section-number">3.3.14</span> &lt;pattern-list&gt; Directives</h3>
<p>Pattern lists allow you to select a VirtualMTA or set recipient priority based on the message's originator, the message's recipient, a message header, or a combination of the three.</p>
<p>The directives described in this section define a list of regular expression patterns. Each entry in a pattern list has the following form:</p>
<pre><code>DIRECTIVE PARAMETERS /PATTERN/ RESULT
</code></pre>
<p>where:</p>
<ul>
<li><p><code>DIRECTIVE</code> is one of the directives below, specifying what is matched.</p></li>
<li><p><code>PARAMETERS</code> is additional information depending on the chosen directive; currently only the <em>header</em> directive supports a parameter, which is the message header you want to match.</p></li>
<li><p><code>/PATTERN/</code> is a perl-compatible regular expression (REGEX). For more information on perl-compatible regular expressions, please refer to the <a href="http://perldoc.perl.org/">Perl documentation</a> or the <a href="http://www.pcre.org">PCRE library package</a>.</p></li>
<li><p><code>RESULT</code> is one or more of the following:</p>
<ul>
<li><p><code>virtual-mta=NAME</code> selects a VirtualMTA.</p></li>
<li><p><code>recipient-priority=N</code> sets the priority of the recipient using a scale of 0-100 with 0 being the lowest priority and 100 being the highest with a default of 50 when not specified. This may be used without selecting a VirtualMTA.</p></li>
<li><p><code>call-to:PATTERN-LIST-NAME</code> selects another pattern list.</p></li>
</ul></li>
</ul>
<p>If multiple entries match, the first match is used.</p>
<p>An <code>x-virtual-mta</code> header may be used in conjunction with a <code>&lt;pattern-list&gt;</code> to set a <code>recipient-priority</code>.</p>
<h4 id="header"><span class="header-section-number">3.3.14.1</span> header</h4>
<p>Adds a pattern match against the specified header. Matching is performed against the entire header contents; in particular, any <em>white space</em> characters such as blanks, tabs and CR/LFs will still be present. Because of this, when anchoring the regular expression with the caret (<code>^</code>) and dollar (<code>$</code>) characters, it is important to allow for white space following the caret and preceding the dollar signs, respectively. The <code>\s</code> metacharacter is particularly useful for this, since it will match all white space characters.</p>
<p><strong>Syntax:</strong></p>
<pre><code> header HEADER-NAME REGEX RESULT
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;pattern-list myList&gt;
    header x-eval /^\s*eval/ virtual-mta=evaluation
    header from /jsmith/ virtual-mta=evaluation
    header subject /hello world/ virtual-mta=evaluation
&lt;/pattern-list&gt;

&lt;source 127.0.0.1&gt;
    ...
    pattern-list myList # this selects the pattern list for messages
&lt;/source&gt; # from 127.0.0.1
</code></pre>
<hr />
<h4 id="mail-from"><span class="header-section-number">3.3.14.2</span> mail-from</h4>
<p>Adds a pattern match against the message's originator. This is the SMTP MAIL FROM address and is the address to which bounces are sent. This is not the same as the from header seen in mail clients.</p>
<p><strong>Syntax:</strong></p>
<pre><code> mail-from REGEX RESULT
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;pattern-list myList&gt;
    mail-from /^customerservice/ virtual-mta=service
&lt;/pattern-list&gt;

&lt;source 127.0.0.1&gt;
    ...
    pattern-list myList # this selects the pattern list for messages
&lt;/source&gt; # from 127.0.0.1
</code></pre>
<hr />
<h4 id="rcpt-to"><span class="header-section-number">3.3.14.3</span> rcpt-to</h4>
<p>Adds a pattern match against the message's recipient (SMTP RCPT TO).</p>
<p><strong>Syntax:</strong></p>
<pre><code> rcpt-to REGEX RESULT
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;pattern-list myList&gt;
    rcpt-to /customer/ virtual-mta=customers
&lt;/pattern-list&gt;

&lt;source 127.0.0.1&gt;
    ...
    pattern-list myList # this selects the pattern list for messages
&lt;/source&gt; # from 127.0.0.1
</code></pre>
<p>If multiple recipients are specified in a message and more than one match a rcpt-to directive, the first match's VirtualMTA will apply to the entire message. This behavior may change in the future, so <code>rcpt-to</code> should only be used if you only intend to submit single-recipient messages.</p>
<p>Another example, showing a combination of matching patterns:</p>
<pre><code>&lt;pattern-list myList&gt;
    header x-eval /eval/ virtual-mta=evaluation
    header from /jsmith/ virtual-mta=evaluation
    header subject /hello world/ virtual-mta=evaluation
    mail-from /newsletter/ virtual-mta=newsletters
    rcpt-to /^stud.*@somesite.com$/ virtual-mta=students
    rcpt-to /password-reset@customer.com/ recipient-priority=90
    rcpt-to /special@customer.com/ virtual-mta=students,recipient-priority=90
&lt;/pattern-list&gt;

&lt;source 127.0.0.1&gt;
    ...
    pattern-list myList # this selects the pattern list for messages
&lt;/source&gt; # from 127.0.0.1
</code></pre>
<p>Here, each email is first checked for the <code>x-eval</code> header. If it is present and its content contains <em>eval</em>, the <em>evaluation</em> VirtualMTA is used. If the x-eval header isn't given or does not match the pattern, the next pattern is checked. Each pattern is checked from top to bottom, with the first matching pattern being used. If none of the above matched, PowerMTA will use the default VirtualMTA.</p>
<p>This example shows conditional pattern matching:</p>
<pre><code>&lt;pattern-list patterns&gt;
    mail-from /newsletter/ &lt;pattern-list&gt;
        rcpt-to /^stud.*@somesite.com$/ virtual-mta=students
        rcpt-to /^staff.*@somesite.com$/ virtual-mta=staff
        * virtual-mta=anything
    &lt;/pattern-list&gt;

    rcpt-to /admin/ &lt;pattern-list&gt;
        mail-from /thisdomain.com/ virtual-mta=this
        header x-info /newdata/ virtual-mta=other
        * virtual-mta=anything
    &lt;/pattern-list&gt;
&lt;/pattern-list&gt;

&lt;source 127.0.0.1&gt;
    ...
    pattern-list patterns # this selects the pattern list for messages from 127.0.0.1
&lt;/source&gt;
</code></pre>
<p>Here, first the MAIL FROM is checked for each email. If the MAIL FROM matches newsletter, a sub-pattern is then used. In this sub-pattern, the RCPT TO is checked, and if it matches the pattern, the emails will go to the students VirtualMTA, or the staff VirtualMTA. Anything with newsletter in the MAIL FROM that does not match the sub-patterns get sent to the wildcard defined anything VirtualMTA.</p>
<p>The second pattern is similar to the above, but first checks the RCPT TO. If the RCPT TO matches, the email is then put through the sub patterns, first checking the MAIL FROM, and then for the x-info header. Once again, emails with a RCPT matching admin, but not the sub-patterns will be sent to the VirtualMTA anything.</p>
<p>Emails not matching any patterns will not be sent to a VirtualMTA based on pattern matching.</p>
<h4 id="nested-pattern-list-support"><span class="header-section-number">3.3.14.4</span> Nested pattern-list support</h4>
<p>In some cases it may be better to use a &lt;pattern-list&gt; to select another &lt;pattern-list&gt; instead of selecting a VirtualMTA directly. This can be accomplished in PowerMTA with the new "call-to" option defined within a pattern.</p>
<p>Assuming a message has the following header:</p>
<pre><code>x-custom-header: abc123
</code></pre>
<p>and you wanted to use that header and content to select another pattern to then select the correct VirtualMTA. The following would be defined in PowerMTA's config file:</p>
<pre><code>&lt;pattern-list specialSelector1&gt;
    mail-from /newsletters/ virtual-mta=vmta1
&lt;/pattern-list&gt;

&lt;pattern-list selections&gt;
    header x-custom-header /abc123/ call-to: specialSelector1
&lt;/pattern-list&gt;

&lt;source 0/0&gt;
    pattern-list selections
&lt;/source&gt;
#
</code></pre>
<p>In the above example, &lt;pattern-list selections&gt; would match the <code>x-custom-header: header</code>, and then select <code>&lt;pattern-list specialSelector1&gt;</code> to then apply next to the message, given the "call-to:" definition. If the SMTP MAIL FROM address for this message included "newsletters", PowerMTA would then use VirtualMTA vmta1 for the message.</p>
<h3 id="smtp-pattern-list-directives"><span class="header-section-number">3.3.15</span> &lt;smtp-pattern-list&gt; Directives</h3>
<p>SMTP pattern lists allow you to have PowerMTA change a delivery queue's mode based on pattern matching on the SMTP replies received while attempting deliveries.</p>
<p>SMTP pattern lists currently only accept a single directive (<code>reply</code>). Each entry in a pattern list has the following form:</p>
<pre><code> reply /PATTERN/ ACTION-LIST
</code></pre>
<p>Where:</p>
<ul>
<li><p><code>/PATTERN/</code> is a perl-compatible regular expression (REGEX). For more information on perl-compatible regular expressions, please refer to the <a href="http://perldoc.perl.org/perlre.html">Perl documentation</a> or the <a href="http://www.pcre.org">PCRE library package</a>.</p></li>
<li><p><code>ACTION-LIST</code> is one or more of the following:</p>
<ul>
<li><code>mode=normal</code></li>
<li><code>mode=backoff</code></li>
<li><code>skip-mx</code></li>
<li><code>bounce-queue</code></li>
<li><code>bounce-rcpt</code></li>
<li><code>disable-source-ip</code></li>
<li><code>reenable-after</code></li>
<li><code>defer-queue</code></li>
</ul></li>
</ul>
<p>If multiple conflicting entries match, the first match is used. The following is not allowed:</p>
<ul>
<li><p>both <code>mode=backoff</code> and <code>mode=normal</code></p></li>
<li><p>both <code>skip-mx</code> and <code>bounce-queue</code></p></li>
<li><p><code>reenable-after</code> without a preceding <code>disable-source-ip</code> (in the same rule)</p></li>
<li><p>more than one <code>reenable-after</code></p></li>
</ul>
<p><em><strong>skip-mx</strong></em> is intended to help PowerMTA from give up delivering to one or more MXes which is just giving a transient recipient-level error. Any patterns matched will result in the next MX being used and mail being held in queue, even in the case of a 5xx error.</p>
<p><em><strong>bounce-queue</strong></em> will bounce the entire queue immediately if the pattern is matched. The original error, as well as the fact that the queue was bounced due to this setting, will be recorded in the accounting file.</p>
<p><em><strong>bounce-rcpt</strong></em> will bounce the recipient immediately if the pattern is matched. This only works for 4xx responses to the RCPT command. The original error, as well as the fact that the recipient was bounced due to this setting, will be recorded in the accounting file.</p>
<p><em><strong>disable-source-ip</strong></em> will disable the IP that received the error. The source IP will remain disabled until the time period defined by the &lt;domain&gt; directive reenable-source-ip-after, unless using the reenable-after option.</p>
<p><em><strong>reenable-after</strong></em> Allows for defining the time after which an IP that has been disabled with disable-source-ip will be reenabled. The default is never. Takes priority over the domains reenable-source-ip-after setting when used.</p>
<p><em><strong>defer-queue</strong></em> When a queue goes in backoff mode, it does not automatically go into retry mode as well. Not all SMTP errors will have PowerMTA putting the queue into retry mode immediately vs., for example, having PowerMTA reconnect on the next MX. Since it may be desirable to have the queue put into retry mode immediately for certain errors, a new defer-queue option was added in SMTP pattern lists.</p>
<p>For example, to put any queues in backoff mode upon reception of certain SMTP replies, while bouncing some messages immediately or skipping some MX records:</p>
<pre><code>&lt;smtp-pattern-list blockList&gt;
    reply /generating high volumes of.* complaints from AOL/ mode=backoff
    reply /Excessive unknown recipients - possible Open Relay/ mode=backoff
    reply /^421 .* too many errors/ mode=backoff
    reply /permanently deferred/ bounce-queue
    reply /too many connections/ skip-mx
    reply /account over quota/ bounce-rcpt
    reply /TS03/ mode=backoff,disable-source-ip,reenable-after=1h
    reply /resources temporarily unavailable/ defer-queue
&lt;/smtp-pattern-list&gt;

&lt;domain *&gt;
    ...
    smtp-pattern-list blockList
&lt;/domain&gt;
</code></pre>
<p>To match on a # (the comment symbol in the configuration file) hexadecimal code may be used. For example, to match the pattern Sender address deferred by rule #CR-IN-DEF-2:</p>
<pre><code>&lt;smtp-pattern-list blockList&gt;
    reply /Sender address deferred by rule \x23CR-IN-DEF-2 / mode=backoff
&lt;/smtp-pattern-list&gt;

&lt;domain *&gt;
    ...
    smtp-pattern-list blockList
&lt;/domain&gt;
</code></pre>
<p>Backslashes (\) and quotes () will need to be escaped with a backslash. All patterns are case insensitive. If case sensitivity is needed, it can be forced by adding (?-i) like the following example:</p>
<pre><code>&lt;smtp-pattern-list blockList&gt;
    reply /(?-i)TS03/ mode=backoff
&lt;/smtp-pattern-list&gt;
</code></pre>
<h4 id="include-4"><span class="header-section-number">3.3.15.1</span> include</h4>
<p>This directive can be used at <code>smtp-pattern-list</code> level to specify an additional configuration file to process. This can be used, for example, to facilitate maintenance of the configuration files across multiple hosts, by storing those settings which differ from host to host in a separate file and including it from the main (common) file. Wildcards may be used. An <code>include</code> may be used at global level and within <code>&lt;source&gt;</code>, <code>&lt;domain&gt;</code>, <code>&lt;virtual-mta&gt;</code> or <code>&lt;smtp-pattern-list&gt;</code> tag.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain yahoo.com&gt;
   include /etc/pmta/dkim-keys.txt
&lt;/domain&gt;
</code></pre>
<hr />
<h3 id="dns-directives"><span class="header-section-number">3.3.16</span> &lt;dns&gt; Directives</h3>
<h4 id="precached-domains-file"><span class="header-section-number">3.3.16.1</span> precached-domains-file</h4>
<p>Specifies the name of a text file containing a list of domains, one domain per line, that you want PowerMTA to always have current DNS information for in its DNS cache, regardless of whether recipients are in the queue for the domain or not. Typically PowerMTA would look up domain routing information in DNS when recipients are submitted into PowerMTA for a domain (assuming recipients are not currently queued for the domain already). Depending on the DNS infrastructure and how many other domains are in the queue, this may cause some slight delay in the immediate delivery attempts for these recipients. Having DNS routing information precached in PowerMTA for certain key domains before submission minimizes any delay that may take place due to this required DNS resolution.</p>
<p><strong>Syntax:</strong></p>
<pre><code>precached-domains-file FILENAME
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;dns&gt;
    precached-domains-file /etc/pmta/precached-domains.txt
&lt;/dns&gt;
</code></pre>
<hr />
<h4 id="precached-refresh-interval"><span class="header-section-number">3.3.16.2</span> precached-refresh-interval</h4>
<p>Defines the time frame in which the DNS records for all pre-cached domains are refreshed (looked back up in DNS). Similar to a DNS record's TTL (time to live), however it manually sets the time interval to refresh, and which overrides the actual records' TTL in DNS. The regular TTL records for pre-cached domains are ignored.</p>
<p><strong>Syntax:</strong></p>
<pre><code>precached-refresh-interval TIME-INTERVAL
</code></pre>
<p><strong>Default:</strong> <code>5m</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;dns&gt;
    precached-domains-file /etc/pmta/precached-domains.txt
    precached-refresh-interval 2m
&lt;/dns&gt;
</code></pre>
<hr />
<h4 id="precached-max-domains"><span class="header-section-number">3.3.16.3</span> precached-max-domains</h4>
<p>Specifies the maximum number of domains that can be pre-cached. This number cannot exceed the number of domains defined in the "precached-domains-file". Defining a very large number will result in lots of frequent DNS queries, so a scalable DNS infrastructure is required.</p>
<p><strong>Syntax:</strong></p>
<pre><code>precached-max-domains N
</code></pre>
<p>where <code>N</code> is the maximum number of domains to precache.</p>
<p><strong>Default:</strong> <code>500</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;dns&gt;
    precached-domains-file /etc/pmta/precached-domains.txt
    precached-max-domains 1000
&lt;/dns&gt;
</code></pre>
<hr />
<h3 id="smtp-listener-directives"><span class="header-section-number">3.3.17</span> &lt;smtp-listener&gt; Directives</h3>
<h4 id="await-slot"><span class="header-section-number">3.3.17.1</span> await-slot</h4>
<p>Specifies whether new connections should wait or be refused if PowerMTA is currently at its total-max-smtp-in limit., applies to connections accepted at this <code>&lt;smtp-listener&gt;</code> address.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;smtp-listener 127.0.0.1:25&gt;
  await-slot true
&lt;/smtp-listener&gt;
</code></pre>
<hr />
<h4 id="immediate-tls"><span class="header-section-number">3.3.17.2</span> immediate-tls</h4>
<p>Specifies whether to immediately start TLS when a connection is accepted (implementing "SMTPS")., applies to connections accepted at this &lt;smtp-listener&gt;'s address.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;smtp-listener 127.0.0.1:25&gt;
  immediate-tls true
&lt;/smtp-listener&gt;
</code></pre>
<hr />
<h4 id="source-1"><span class="header-section-number">3.3.17.3</span> source</h4>
<p>Specifies a <code>&lt;source&gt;</code> entry with settings to override those obtained from source IP address matching., applies to connections accepted at this &lt;smtp-listener&gt;'s address.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;source named-source&gt;
  max-message-size 100K
&lt;/source&gt;

&lt;smtp-listener 127.0.0.1:25&gt;
    source named-source
&lt;/smtp-listener&gt;
</code></pre>
<hr />
<h4 id="tls-certificate-1"><span class="header-section-number">3.3.17.4</span> tls-certificate</h4>
<p>Specifies a file containing the X.509 certificate and private key to use if TLS is started on inbound SMTP connections, as well as the password protecting the private key. Applies to connections accepted at this <code>&lt;smtp-listener&gt;</code> address. Inherited from smtp-server-tls-certificate.</p>
<p><strong>Syntax:</strong></p>
<pre><code>tls-certificate FILENAME [PASSWORD]
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;smtp-listener 127.0.0.1:25&gt;
    tls-certificate /var/lib/pmta/smtp.pem aaaa
&lt;/smtp-listener&gt;
</code></pre>
<hr />
<h4 id="tls-allow-tlsv12"><span class="header-section-number">3.3.17.5</span> tls-allow-tlsv1.2</h4>
<p>Allows PowerMTA to use TLSv1.2 when negotiating a secure connection with a remote client during STARTTLS.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;smtp-listener 0/0:25&gt;
    tls-allow-tlsv1.2 true
&lt;/smtp-listener&gt;
</code></pre>
<hr />
<h4 id="tls-allow-tlsv11"><span class="header-section-number">3.3.17.6</span> tls-allow-tlsv1.1</h4>
<p>Allows PowerMTA to use TLSv1.1 when negotiating a secure connection with a remote client during STARTTLS.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;smtp-listener 0/0:25&gt;
    tls-allow-tlsv1.1 true
&lt;/smtp-listener&gt;
</code></pre>
<hr />
<h4 id="tls-allow-tlsv1"><span class="header-section-number">3.3.17.7</span> tls-allow-tlsv1</h4>
<p>Allows PowerMTA to use TLSv1 when negotiating a secure connection with a remote client during STARTTLS.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;smtp-listener 0/0:25&gt;
    tls-allow-tlsv1 true
&lt;/smtp-listener&gt;
</code></pre>
<hr />
<h4 id="tls-allow-sslv3"><span class="header-section-number">3.3.17.8</span> tls-allow-sslv3</h4>
<p>Allows PowerMTA to use SSLv3 when negotiating a secure connection with a remote client during STARTTLS.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;smtp-listener 0/0:25&gt;
    tls-allow-sslv3 true
&lt;/smtp-listener&gt;
</code></pre>
<hr />
<h4 id="tls-ciphers"><span class="header-section-number">3.3.17.9</span> tls-ciphers</h4>
<p>Specifies the ciphers that PowerMTA is allowed to use when negotiating a TLS session with a remote client during STARTTLS. Please see documentation for OpenSSL command ciphers for valid cipher names that can be used with this.</p>
<p><strong>Default:</strong> <code>HIGH:!ADH:@STRENGTH</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;smtp-listener 0/0:25&gt;
    tls-ciphers HIGH:!ADH:@STRENGTH
&lt;/smtp-listener&gt;
</code></pre>
<hr />
<h4 id="tls-ca-file"><span class="header-section-number">3.3.17.10</span> tls-ca-file</h4>
<p>Specifies a "CA file" containing Certification Authority certificates to allow verifying any certificates presented by clients on inbound SMTP connections. The certificates must be in PEM format.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;smtp-listener 0/0:25&gt;
  tls-ca-file /etc/pmta/certchain.pem
&lt;/smtp-listener&gt;
</code></pre>
<hr />
<h3 id="rewrite-list-directives"><span class="header-section-number">3.3.18</span> &lt;rewrite-list&gt; Directives</h3>
<p>Rewrite lists can be used to rewrite the MAIL FROM address (envelope address) of an email and the <code>From</code> header in the body of email. Rewrite lists are created using the tag <code>&lt;rewrite-list&gt;</code>. To use <code>&lt;rewrite-list&gt;</code>, you must configure a <code>source</code> with the name of the <code>rewrite-list</code> to use as shown below.</p>
<p><strong>Syntax:</strong></p>
<pre><code>&lt;rewrite-list abc&gt;
   mail-from SOURCE-ADDRESS TARGET-ADDRESS
   from-domain SOURCE-DOMAIN TARGET-DOMAIN
&lt;/rewrite-list&gt;

&lt;source 0/0&gt;
   rewrite-list abc
&lt;/source&gt;
</code></pre>
<h4 id="mail-from-1"><span class="header-section-number">3.3.18.1</span> mail-from</h4>
<p>Use <code>mail-from</code> rules to rewrite the MAIL FROM address (envelope address) of an email.</p>
<p><strong>Syntax:</strong></p>
<pre><code> mail-from SOURCE-ADDRESS TARGET-ADDRESS
</code></pre>
<p>where <code>SOURCE-ADDRESS</code> can be one of:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;"><code>SOURCE-ADDRESS</code></th>
<th style="text-align: left;">matches</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>abcd@xyz.com</code></td>
<td style="text-align: left;">this exact email address</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>abcd@*</code></td>
<td style="text-align: left;">any address with this local part</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>*@xyz.com</code></td>
<td style="text-align: left;">any address at this domain</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>*@*</code></td>
<td style="text-align: left;">all addresses except the empty address</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>&lt;&gt;</code></td>
<td style="text-align: left;">the empty SMTP MAIL FROM address</td>
</tr>
</tbody>
</table>
<p>Within a source address, the wildcard <code>*</code> has the meaning "match-all".</p>
<p>and <code>TARGET-ADDRESS</code> can be one of:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;"><code>TARGET-ADDRESS</code></th>
<th style="text-align: left;">resulting rewritten address</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>abcd@xyz.com</code></td>
<td style="text-align: left;">this specific email address</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>abcd@*</code></td>
<td style="text-align: left;">the local part <code>abcd</code> and the same domain as the source address</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>*@xyz.com</code></td>
<td style="text-align: left;">the same local part as the source address with the domain <code>xyz.com</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>&lt;&gt;</code></td>
<td style="text-align: left;">the empty address</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Within a target address, the <code>*</code> has the meaning "replace from source address".</p>
</blockquote>
<p>The <code>TARGET-ADDRESS</code> cannot have non-ASCII UTF8 characters in them. For example:</p>
<pre><code> mail-from abc@xyz.com foo@bcher.de # this is an invalid rule
</code></pre>
<p>The wildcard <code>*</code> cannot be used in a <code>TARGET-ADDRESS</code> if the <code>SOURCE-ADDRESS</code> is empty. For example:</p>
<pre><code> mail-from &lt;&gt; *@foo.com # this is an invalid rule
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;rewrite-list abc&gt;
  mail-from  foo@*  *@bar.com   # foo@xyz.com will be rewritten to foo@bar.com
&lt;/rewrite-list&gt;
</code></pre>
<h4 id="from-domain"><span class="header-section-number">3.3.18.2</span> from-domain</h4>
<p>Use <code>from-domain</code> rules to rewrite the domain of the email address contained in the <code>From</code> header of an email.</p>
<p><strong>Syntax:</strong></p>
<pre><code>from-domain SOURCE-DOMAIN TARGET-DOMAIN
</code></pre>
<p>where <code>SOURCE-DOMAIN</code> must be a domain pattern (see DOMAIN definition) and <code>TARGET-DOMAIN</code> must be a specific domain name</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;rewrite-list foo&gt;
  from-domain *.port25.com  bouncedomain.com    # rewrites foo@mail.port25.com to foo@bouncedomain.com
&lt;/rewrite-list&gt;
</code></pre>
<hr />
<h3 id="domain-key-list-directives"><span class="header-section-number">3.3.19</span> &lt;domain-key-list&gt; Directives</h3>
<p><code>domain-key-list</code> can be used to organize a list of domain keys and refer to them using a single name. <code>&lt;domain-key-list&gt;</code> can only be defined in global scope. <code>&lt;domain-key-list&gt;</code> can be used to restrict the search for the exact key to DKIM sign an email to a specific list of keys.</p>
<p><strong>Syntax:</strong></p>
<pre><code>&lt;domain-key-list NAME&gt;
    domain-key ...
    domain-key ...
&lt;/domain-key-list&gt;
</code></pre>
<p>The <code>x-dkim-options</code> header can be used to specify the <code>domain-key-list</code> that PMTA will use to search for a key from. For example:</p>
<pre><code>x-dkim-options: s=foo;key-list=xyz
</code></pre>
<p>In the above example, PMTA will search for the key with the selector <code>foo</code> in the <code>domain-key-list</code> named <code>xyz</code>. If not found, then PMTA will not sign the message.</p>
<p>If the <code>key-list</code> option is not used in <code>x-dkim-options</code>, then PMTA will fallback to the default behavior of selecting a key from those that were defined in the VMTA scope, or were inherited from global scope.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;domain-key-list keylist-customer-one&gt;
    domain-key m,mail.port25.com,c:\pmta\m.pem
    domain-key base,*,c:\pmta\base.pem
&lt;/domain-key-list keylist-customer-one&gt;
</code></pre>
<h4 id="domain-key-3"><span class="header-section-number">3.3.19.1</span> domain-key</h4>
<p>See <a href="#domain-key">domain-key</a> for description.</p>
<hr />
<h3 id="transmissions-api-directives"><span class="header-section-number">3.3.20</span> &lt;transmissions-api&gt; Directives</h3>
<h4 id="log-requests"><span class="header-section-number">3.3.20.1</span> log-requests</h4>
<p>Specifies whether HTTP data exchanges during <a href="#http-transmissions-api">Transmissions API</a> request handling are logged to PowerMTA's log file or not.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;transmissions-api&gt;
   log-requests yes
&lt;/transmissions-api&gt;
</code></pre>
<hr />
<h5 id="api-key"><span class="header-section-number">3.3.20.1.1</span> api-key</h5>
<p>This directive configures authentication keys for applications using the <a href="#http-transmissions-api">Transmissions API</a>; it can be repeated to create multiple keys. Applications passing a valid key in the <code>Authorization</code> header are allowed to use the HTTP Transmissions API.</p>
<p>This directive may be repeated any number of times to add additional API keys.</p>
<p><strong>Syntax:</strong></p>
<pre><code>api-key STRING
</code></pre>
<p>where <code>STRING</code> is a set of alphanumeric characters or the underscore character, and between 32 and 128 characters in length.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;transmissions-api&gt;
   api-key 14ac5499cfdd2bb2859e4476d2e5b1d2bad079bf
   api-key 476d2e5b1d2bad079bf14ac5499cfdd2bb2859e4
&lt;/transmissions-api&gt;
</code></pre>
<hr />
<h5 id="log-data-1"><span class="header-section-number">3.3.20.1.2</span> log-data</h5>
<p>Specifies whether HTTP data exchanges during <a href="#http-transmissions-api">Transmissions API</a> request handling are logged to PowerMTA's log file or not. (More verbose than <code>log-requests</code> within <code>&lt;transmissions-api&gt;</code>)</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;transmissions-api&gt;
    log-data yes
&lt;/transmissions-api&gt;
</code></pre>
<hr />
<h5 id="log-tls-2"><span class="header-section-number">3.3.20.1.3</span> log-tls</h5>
<p>Specifies whether PowerMTA should log information about negotiation of a TLS session with the remote client when handling <a href="#http-transmissions-api">HTTP Transmissions API</a> requests.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;transmissions-api&gt;
    log-data yes
&lt;/transmissions-api&gt;
</code></pre>
<hr />
<h3 id="transmissions-api-listener-directives"><span class="header-section-number">3.3.21</span> &lt;transmissions-api-listener&gt; Directives</h3>
<h4 id="tls-certificate-2"><span class="header-section-number">3.3.21.1</span> tls-certificate</h4>
<p>Specifies a file containing the X.509 certificate and private key to use if TLS is started on inbound <a href="#http-transmissions-api">HTTP Transmissions API</a> connections, as well as the password protecting the private key.</p>
<p><strong>Syntax:</strong></p>
<pre><code>tls-certificate FILENAME [PASSWORD]
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;transmissions-api-listener 127.0.0.1:25&gt;
    tls-certificate /var/lib/pmta/smtp.pem aaaa
&lt;/transmissions-api-listener&gt;
</code></pre>
<hr />
<h4 id="tls-allow-tlsv12-1"><span class="header-section-number">3.3.21.2</span> tls-allow-tlsv1.2</h4>
<p>Allows PowerMTA to use TLSv1.2 when negotiating a secure connection with a remote client during <a href="#http-transmissions-api">HTTP Transmissions API</a> request handling.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;transmissions-api-listener 0/0:25&gt;
    tls-allow-tlsv1.2 true
&lt;/transmissions-api-listener&gt;
</code></pre>
<hr />
<h4 id="tls-allow-tlsv11-1"><span class="header-section-number">3.3.21.3</span> tls-allow-tlsv1.1</h4>
<p>Allows PowerMTA to use TLSv1.1 when negotiating a secure connection with a remote client during <a href="#http-transmissions-api">HTTP Transmissions API</a> request handling.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;transmissions-api-listener 0/0:25&gt;
    tls-allow-tlsv1.1 true
&lt;/transmissions-api-listener&gt;
</code></pre>
<hr />
<h4 id="tls-allow-tlsv1-1"><span class="header-section-number">3.3.21.4</span> tls-allow-tlsv1</h4>
<p>Allows PowerMTA to use TLSv1 when negotiating a secure connection with a remote client during <a href="#http-transmissions-api">HTTP Transmissions API</a> request handling.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;transmissions-api-listener 0/0:25&gt;
    tls-allow-tlsv1 true
&lt;/transmissions-api-listener&gt;
</code></pre>
<hr />
<h4 id="tls-allow-sslv3-1"><span class="header-section-number">3.3.21.5</span> tls-allow-sslv3</h4>
<p>Allows PowerMTA to use SSLv3 when negotiating a secure connection with a remote client during <a href="#http-transmissions-api">HTTP Transmissions API</a> request handling.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;transmissions-api-listener 0/0:25&gt;
    tls-allow-sslv3 true
&lt;/transmissions-api-listener&gt;
</code></pre>
<hr />
<h4 id="tls-ciphers-1"><span class="header-section-number">3.3.21.6</span> tls-ciphers</h4>
<p>Specifies the ciphers that PowerMTA is allowed to use when negotiating a TLS session with a remote client during <a href="#http-transmissions-api">HTTP Transmissions API</a> request handling. Please see documentation for OpenSSL command ciphers for valid cipher names that can be used with this.</p>
<p><strong>Default:</strong> <code>HIGH:!ADH:@STRENGTH</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;transmissions-api-listener 0/0:25&gt;
    tls-ciphers HIGH:!ADH:@STRENGTH
&lt;/transmissions-api-listener&gt;
</code></pre>
<hr />
<h4 id="tls-ca-file-1"><span class="header-section-number">3.3.21.7</span> tls-ca-file</h4>
<p>Specifies a "CA file" containing Certification Authority certificates to allow verifying any certificates presented by clients during <a href="#http-transmissions-api">HTTP Transmissions API</a> request handling. The certificates must be in PEM format.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;transmissions-api-listener 0/0:25&gt;
  tls-ca-file /etc/pmta/certchain.pem
&lt;/transmissions-api-listener&gt;
</code></pre>
<hr />
<h1 id="powermta-management"><span class="header-section-number">4</span> PowerMTA Management</h1>
<p>Although PowerMTA has been designed for being as low maintenance as possible, it does include various tools for management and troubleshooting. This chapter is intended as a guide to daily operations with PowerMTA, for those who wish to actively manage and monitor, as well as to troubleshooting the most commonly encountered problems.</p>
<h2 id="management"><span class="header-section-number">4.1</span> Management</h2>
<h3 id="monitoring"><span class="header-section-number">4.1.1</span> Monitoring</h3>
<p>There are a number of ways in which you can monitor PowerMTA. It has a web-based monitor built in, so you can simply point your web browser to the monitor's TCP port on PowerMTA's machine to view the mailer's current status and display information about its queue. This comes particularly handy when monitoring over longer periods of time. The web monitor is described in detail in <a href="#web-based-monitoring">Web-Based Monitoring</a>.</p>
<p>The same information from the web monitor also available through the <code>pmta</code> command line tool. In addition to displaying the command results in formatted plain text, <code>pmta</code> can also output these in XML, JSON or as DOM-Style variable lists, making it relatively easy to post-process and to integrate PowerMTA in existing management infrastructures. The <code>pmta</code> command line tool and the commands it accepts are described in <a href="#command-line-tool">Command Line Tool</a>.</p>
<p>The available <a href="#sparkpost-signals">SparkPost Signals</a> service can analyze your email sending and response data to help you identify potential problems.</p>
<h3 id="logging-and-accounting"><span class="header-section-number">4.1.2</span> Logging and Accounting</h3>
<p>For greatest flexibility and best performance, PowerMTA maintains its own logging file. The operating system's log (i.e., the Event Log on Windows or the <code>syslog</code> on Unix) is only used for recording information on startup errors and similar situations where it may not be possible for PowerMTA to write to its own logging file.</p>
<p>The logging file is used for recording various information about PowerMTA, such as startup and shutdown messages, any errors found during execution, connection traces, etc. In general, the log file is the place where the mailer writes any error messages, and you should look there first when any problems arise.</p>
<p>In addition to the logging file, PowerMTA records detailed information on e-mails processed in a separate <em>accounting file</em>. Storing accounting data separate from other, more general, logging data allows for a more efficient accounting file format for easier post-processing. It also makes it easier to send feedback about problems with PowerMTA while keeping the accounting data undisclosed. The format of the accounting files is described in <a href="#accounting-files-and-statistics">Accounting Files and Statistics</a>.</p>
<p>Both logging and accounting files are <em>rotated</em> automatically, that is, a new file is started and the older ones are kept for a number of days. The parameters for the rotation, including the number of (historical) files to keep can are described in <a href="#logging-directives">Logging Directives</a> and in <a href="#acct-file-directives">&lt;acct-file&gt; Directives</a>.</p>
<h3 id="powermta-startup-and-shutdown"><span class="header-section-number">4.1.3</span> PowerMTA Startup and Shutdown</h3>
<p>On Windows systems, PowerMTA runs as a service and as such is started up automatically by the operating system after booting. It also can be started and stopped both via the Control Panel and by using the <code>net start pmta</code> and <code>net stop pmta</code> commands from a Command Prompt window. Currently, PowerMTA must run under the <code>SYSTEM</code> account.</p>
<p>On Unix systems, PowerMTA runs as a daemon, i.e., a background process. A standard startup/shutdown script is provided in the system's init.d directory.</p>
<p>On either platform, two processes are started: <code>pmtad</code>, which is PowerMTA itself, and <code>pmtawatch</code>, which is PowerMTA's watchdog process. As the name suggests, <code>pmtawatch</code> watches over PowerMTA and re-starts it in case of a (PowerMTA) crash.</p>
<h2 id="troubleshooting"><span class="header-section-number">4.2</span> Troubleshooting</h2>
<p>The following sections guide through troubleshooting the most commonly encountered problems.</p>
<h3 id="troubleshooting-startup-problems"><span class="header-section-number">4.2.1</span> Troubleshooting Startup Problems</h3>
<p>Startup problems typically occur right after installing PowerMTA or after having changed its configuration. If PowerMTA won't start up, you should look in the logging file a separate logging file called <code>pmta-startuperr.log</code> for an error message. On Windows, this file is located in the log subdirectory of the folder where PowerMTA was installed. On Unix systems, the logging file is located on <code>/var/log/pmta/log</code>.</p>
<p>If no logging file is present or if it does not seem to contain an applicable error message, you can try running PowerMTA on the command line. On Windows, open a Command Prompt window and change to PowerMTA's bin subdirectory. On Unix, ensure that <code>/usr/sbin</code> is in your path. Then start PowerMTA by using the command</p>
<pre><code>pmtad --debug
</code></pre>
<p>That will start up PowerMTA and will have it write any error messages to the screen, rather than to the logging file. Most probably, the startup will fail displaying an error message, like in the example below:</p>
<pre><code># /usr/sbin/pmtad --debug
2018-07-03 18:05:37 Startup error: No logging file specified
</code></pre>
<p>You can then fix the problem and restart PowerMTA.</p>
<p>A common cause of startup problems when PowerMTA is first installed is TCP port conflicts. Applications that listen for (i.e., accept) connections on a TCP port need exclusive access to the port, so if you are running any other SMTP server software on the same machine, either PowerMTA or the other software will fail to obtain access to port number 25 (the standard port for the SMTP protocol). The same might also happen with the TCP port used for the built-in web monitor (port 8080 by default). In the case of the the web monitor, since 8080 is just a local convention, you can resolve the conflict by changing the <a href="#web-based-monitor-directives">configuration</a> and specifying a different port that the web-based monitor could listen on.</p>
<p>The SMTP port conflict may be more difficult to solve. If you are <em>not</em> using PowerMTA for handling inbound traffic, i.e., you are just feeding PowerMTA through SMTP or the submission APIs and inbound traffic is handled by some other software, you can configure PowerMTA to use an alternative <a href="#smtp-listener">SMTP port</a> and change your feeding software to use that port. You can normally pick any free TCP port above 1024; port numbers 2500 and 2525 are popular choices.</p>
<p>If, on the other hand, both PowerMTA and the other SMTP server software are to receive inbound traffic, you will need to give each of them a different IP address. Normally, applications listening for (i.e., accepting) connections on a TCP port will do so for all locally available IP addresses, so <em>both</em> PowerMTA and the other SMTP software need to be configured to use a specific <a href="#smtp-listener">IP address</a> only for PowerMTA's configuration). Naturally, you will first need to allocate a new IP address and configure your operating system to respond to it.</p>
<h3 id="troubleshooting-email-delivery-problems"><span class="header-section-number">4.2.2</span> Troubleshooting Email Delivery Problems</h3>
<p>Email delivery problems constitute by far the most common type of problem encountered. It is quite normal for some email not to be delivered immediately and for the delivery to have to be retried. The causes of such problems are often invalid email addresses, network or server failures or misconfigured software at the recipient's site.</p>
<p>If you notice email building up in the queue for a specific domain, the first step is to check the (DNS-based) routing information for the domain. If that information is available and seemingly correct, the next step would be to check whether any of the listed mailers is reachable. PowerMTA's <code>pmta</code> command line tool has a <code>resolve</code> option that allows you to do all of that in a single step:</p>
<pre><code>$ pmta resolve --connect outlook.com
Querying 127.0.0.1 over UDP about MX outlook.com
Read response from 127.0.0.1
answers:     ttl=60
    outlook.com. 60 IN MX 5 outlook-com.olc.protection.outlook.com.


Querying 127.0.0.1 over UDP about A outlook-com.olc.protection.outlook.com
Read response from 127.0.0.1
answers:     ttl=2
    outlook-com.olc.protection.outlook.com. 2 IN A 104.47.48.33
    outlook-com.olc.protection.outlook.com. 2 IN A 104.47.49.33

status = StatusOk
pref host name                              IP addresses
---- -------------------------------------- -------------------------
   5 outlook-com.olc.protection.outlook.com 104.47.48.33 104.47.49.33

connecting from localhost (0.0.0.0) to outlook-com.olc.protection.outlook.com (104.47.48.33)
&gt;&gt;&gt; 220 CO1NAM05FT041.mail.protection.outlook.com Microsoft ESMTP MAIL Service ready at Thu, 7 Feb 2019 15:18:50 +0000
&lt;&lt;&lt; EHLO localhost
&gt;&gt;&gt; 250-CO1NAM05FT041.mail.protection.outlook.com Hello
&gt;&gt;&gt; 250-SIZE 49283072
&gt;&gt;&gt; 250-PIPELINING
&gt;&gt;&gt; 250-DSN
&gt;&gt;&gt; 250-ENHANCEDSTATUSCODES
&gt;&gt;&gt; 250-STARTTLS
&gt;&gt;&gt; 250-8BITMIME
&gt;&gt;&gt; 250-BINARYMIME
&gt;&gt;&gt; 250-CHUNKING
&gt;&gt;&gt; 250 SMTPUTF8
&lt;&lt;&lt; STARTTLS
&gt;&gt;&gt; 220 2.0.0 SMTP server ready
TLSv1.2 connected with 256-bit ECDHE-RSA-AES256-SHA384
Cert: /C=US/ST=Washington/L=Redmond/O=Microsoft Corporation/CN=mail.protection.outlook.com; issuer=/C=BE/O=GlobalSign nv-sa/CN=GlobalSign Organization Validation CA - SHA256 - G3; verified=no
&lt;&lt;&lt; EHLO localhost
&gt;&gt;&gt; 250-CO1NAM05FT041.mail.protection.outlook.com Hello
&gt;&gt;&gt; 250-SIZE 49283072
&gt;&gt;&gt; 250-PIPELINING
&gt;&gt;&gt; 250-DSN
&gt;&gt;&gt; 250-ENHANCEDSTATUSCODES
&gt;&gt;&gt; 250-8BITMIME
&gt;&gt;&gt; 250-BINARYMIME
&gt;&gt;&gt; 250-CHUNKING
&gt;&gt;&gt; 250 SMTPUTF8
&lt;&lt;&lt; QUIT
&gt;&gt;&gt; 221 2.0.0 Service closing transmission channel
closed outlook-com.olc.protection.outlook.com (104.47.48.33) in=601 out=48
</code></pre>
<p>In the example above, routing information for the domain outlook.com could be resolved. It listed one mail host, with preference level 5 with two IPv4 addresses. The <code>--connect</code> option specified that pmta attempts connecting to the mailhost (which it did, to "104.47.48.33").</p>
<p>When you enter this command during troubleshooting, either part of the command may fail. You may get an error during the DNS resolution part, like, for example "No such domain name" for a domain that is not registered in the DNS. Similarly, if the routing information is available but if the mailhosts themselves are not reachable, the connection attempt fails.</p>
<p>Simply connecting to the mailhosts does not preclude other problems delivering email, for the problem may be related to the specific messages queued, or the mailhosts may be temporarily rejecting email (e.g., returning a 4XX code to SMTP commands). To verify if this is happening, use the <code>pmta</code> command called <a href="#trace">trace</a>. The trace command instructs PowerMTA to retry email delivery to the domain immediately and log the connection. This way, you can see (in the logging file) exactly what happens when delivery is attempted.</p>
<p>The pmta trace command is useful for quickly checking on a domain. If you should need to trace connections to a domain over a longer period of time, enable logging for it in the configuration file by adding a <code>&lt;domain&gt;</code> entry, like in in the example below:</p>
<pre><code>&lt;domain outlook.com&gt;
    log-connections yes
    log-commands yes
&lt;/domain&gt;
</code></pre>
<h3 id="troubleshooting-dns-name-resolution-problems"><span class="header-section-number">4.2.3</span> Troubleshooting DNS Name Resolution Problems</h3>
<p>PowerMTA requires a recursive name service, i.e., a name server that accepts queries and performs the full DNS resolution.</p>
<p>Some name servers fail to do the recursive lookup and return non-recursive (referral-only) responses instead. These responses don't contain the information sought by PowerMTA, so it discards them and retries the query in the hope that whatever caused them is temporary, or that some other server will provide the full response. When such responses are received a number of times from the same name server, PowerMTA also writes a warning to its logging file.</p>
<p>Generally speaking, such non-recursive responses may have various causes. However, some DNS server software versions are known to send them when configured to refuse recursive service, or when its limit of concurrent recursive queries has been reached.</p>
<p>Non-recursive responses waste time and may have an impact on performance. If you find a name server refusing recursive queries too often, check the name server configuration for any quotas or access control lists. If you do not control the name server, you should consider no longer using it for PowerMTA and setting up your own.</p>
<h3 id="troubleshooting-email-receptionsmtp-feeding-problems"><span class="header-section-number">4.2.4</span> Troubleshooting Email Reception/SMTP Feeding Problems</h3>
<p>Problems receiving email are quite rare and happen most commonly when writing custom applications to feed PowerMTA. The most common mistake when writing such applications is to terminate lines with just a line feed, rather than a carriage return and line feed pair as mandated by the email standards.</p>
<p>The simplest way to debug incoming SMTP connections into PowerMTA is to enable debugging for a specific source IP address. You do so by adding a <code>&lt;source&gt;</code> entry in the configuration file, like in the example below,</p>
<pre><code>&lt;source 127.0.0.1&gt;
    log-connections yes
    log-commands yes
    log-data yes
&lt;/source&gt;
</code></pre>
<p>and reload the configuration by using the <code>pmta reload</code> command. This will cause PowerMTA to trace incoming connections to the logging file, which helps determine in what phase of the transaction (for example, in a RCPT command) the problem is occurring. If you suspect the problem to lay in non-printable characters or in the message's body, you can additionally enable <code>log-data</code>, which prints all data sent or received through the connection along with each byte's hexadecimal code.</p>
<h3 id="in-case-of-a-crash"><span class="header-section-number">4.2.5</span> In Case of a Crash</h3>
<p>If PowerMTA crashes, its <code>pmtawatch</code> watchdog program will attempt to restart it and you should get an email informing you about the crash. Please forward this email to us at <code>support@port25.com</code>, so that we can look into the problem. Feel free to include any information you may find relevant, such as recent changes to the configuration or workload, etc.</p>
<p>On Unix systems, the core dump will be stored, compressed if possible, in PowerMTA's subdirectory on the /opt filesystem.</p>
<h3 id="if-all-else-fails"><span class="header-section-number">4.2.6</span> If All Else Fails</h3>
<p>Check out <a href="http://www.port25.com/support/">http://www.port25.com/support/</a> for technical support options from SparkPost. Evaluators and customers with a support agreement may also get support via email at <a href="mailto:support@port25.com">support@port25.com</a> or over the phone at +1.410.750.7687.</p>
<h1 id="web-based-monitoring"><span class="header-section-number">5</span> Web-Based Monitoring</h1>
<h2 id="overview"><span class="header-section-number">5.1</span> Overview</h2>
<p>PowerMTA has a web-based monitoring console built in that provides real time display of PowerMTA's status and allows you to view information on the current message queue based on various criteria.</p>
<p>To access the web monitor, point your web browser to the monitor's TCP port on the machine you installed PowerMTA. For example, if you are reading this document on the machine running PowerMTA, you would use the URL <a href="http://127.0.0.1:8080">http://127.0.0.1:8080</a>. This also assumes that you did not change the default TCP port in the <a href="#web-based-monitor-directives">configuration</a>.</p>
<p>When you try the URL, you may get a message saying that the access is forbidden. This is because, to protect your privacy, access to the web monitor is denied unless authorized in the configuration. Authorization is done on a per source IP address basis, so you need to enter the IP address of the host running your web browser into the configuration.</p>
<p><strong>Note: Accessing the web monitor using Internet Explorer on Windows</strong></p>
<blockquote>
<p>During installation of PowerMTA, the web monitor will configure a self-signed certificate for enabling HTTPS support. We have noticed that accessing web monitor pages on Windows using Internet Explorer is very slow. This issue stems from the use of self-signed certificates for providing HTTPS. A workaround is to obtain a signed certificate from a well known certificate signer entity (such as <em>Lets Encrypt</em>, <em>Thawte</em> etc.) and configure the web monitor to use that certificate (by copying it to the location <code>/var/lib/pmta/webmon.pem</code> on Unix, <code>&lt;PowerMTA install directory&gt;\db\webmon.pem</code> on Windows, and restarting the web monitor).</p>
</blockquote>
<p><strong>Note: Accessing the web monitor with XML and JSON formats</strong></p>
<blockquote>
<p>The web monitor URL <a href="http://127.0.0.1:8080">http://127.0.0.1:8080</a> by default is redirected to the URL with suffix "/ui". To obtain XML or JSON formatted output, you need to use the URL without "/ui" suffix. Refer to the documentation of individual pages below for exact URLs.</p>
</blockquote>
<h2 id="home-display"><span class="header-section-number">5.2</span> Home Display</h2>
<p><img src="media/HomePage.png" /></p>
<p>The initial "Home" page displays basic information about your installation. In addition to this information, there are some useful links:</p>
<p>From the home page, you have the option of changing to other displays:</p>
<ul>
<li><p><strong>Status</strong>, the status monitor page, which displays various information about PowerMTA's status, updated every few seconds.</p></li>
<li><p><strong>Queues</strong>, which presents you with various options for listing queues to which email is queued.</p></li>
<li><p><strong>Domains</strong>, which presents you with various options for listing domains to which email is queued.</p></li>
<li><p><strong>VirtualMTAs</strong>, which displays a summary of the VirtualMTAs in use.</p></li>
<li><p><strong>Jobs</strong>, which presents you with summary information on any jobs (groups of messages) queued.</p></li>
<li><p><strong>Logs</strong>, allows for the viewing and downloading of PowerMTAs various log files.</p></li>
<li><p><strong>Command</strong>  This link allows you to run pmta commands as if you were logged in a the command/shell prompt of the PowerMTA server. This link is displayed only when PowerMTA service is <em>running</em> on the machine.</p></li>
<li><p><strong>License</strong>  This links to a form where you can view/add/change the PowerMTA license.</p></li>
<li><p><strong>Configuration</strong>  This allows you to view and edit the configuration file from within the web monitor window. After saving changes, a pmta reload will not be required as it it done automatically. If the change requires a restart of the service, that will have to be done manually.</p></li>
<li><p><strong>Users Guide</strong>  Opens UsersGuide.pdf in a new window for ease of looking up PowerMTA information.</p></li>
</ul>
<p>This page can also be retrieved in XML or JSON format for processing by a program. You specify the format by using <code>format</code> parameter.</p>
<p>E.g. use the URL: <a href="http://127.0.0.1:8080?format=xml">http://127.0.0.1:8080?format=xml</a></p>
<p>The following sections describe these pages in more detail.</p>
<h2 id="status-monitor-display"><span class="header-section-number">5.3</span> Status Monitor Display</h2>
<p>The status monitor displays data from various components within PowerMTA.</p>
<p><img src="media/StatusPage.png" /></p>
<p>The "Total" counters show the total data received and sent since the mailer was started. Similarly, the "Last Hour" and "Last Minute" counters show the total data received and sent for the respective time intervals.</p>
<p>The "Top/Hour" and "Top/Minute" lines show the highest throughput observed per hour and minute. The various counters are measured independently of each other, i.e., the top number of inbound recipients may or may not have happened at the same time as the top number of inbound kilobytes.</p>
<p>The "Connections" section shows the number of currently active connections, the top number of simultaneous connections made since last restart, and the maximum number of inbound and outbound simultaneous connections available given your license activation key and configured limits.</p>
<p>The "Domain Names" section shows the number of DNS entries currently in PowerMTA's internal cache, as well as the number of DNS queries pending, i.e., currently taking place or scheduled and waiting to take place.</p>
<p>The "Spool Files" section shows the number of spool files currently being used for storing queued messages. And, since the spool management code recycles files for efficiency instead of having to recreate as needed, this section also tracks the number of files that have been recycled and are waiting to be reused.</p>
<p>The "Spool Initialization" section shows whether the initialization is in progress or has been completed. This initialization takes place at startup and consists of reading the message files in the spool and loading queue information into memory.</p>
<p>The "Queues" section provides top level counts for each of the delivery methods available: SMTP or through the pipe delivery API. The counts include the total number of recipients currently in the queue, total number of destination domains for these recipients, and the total amount of data in the mail queues to be delivered, for each method.</p>
<p>This page can also be retrieved in XML format for processing by a program. You specify the XML format by using <code>format=xml</code>. For example, you could use the wget utility to retrieve it:</p>
<p>(Actual output will not be pretty-printed)</p>
<pre><code>$ wget -O- -q http://127.0.0.1:8080/status?format=xml
&lt;rsp&gt;
  &lt;data&gt;
    &lt;mta&gt;
      &lt;product&gt;
        &lt;name&gt;PowerMTA&lt;/name&gt;
        &lt;version&gt;5.0r1&lt;/version&gt;
        &lt;buildDate&gt;2019-09-15 14:27:54&lt;/buildDate&gt;
        &lt;revision&gt;v5_0r1@190914.919ffeb&lt;/revision&gt;
        &lt;bits&gt;64&lt;/bits&gt;
      &lt;/product&gt;
      &lt;lak&gt;
        &lt;serial&gt;123456&lt;/serial&gt;
        &lt;instances&gt;1&lt;/instances&gt;
      &lt;/lak&gt;
      &lt;os&gt;
        &lt;name&gt;Linux&lt;/name&gt;
        &lt;version&gt;3.10.0-957.1.3.el7.x86_64&lt;/version&gt;
        &lt;build&gt;CentOS Linux release 7.6.1810 (Core) &lt;/build&gt;
      &lt;/os&gt;
      &lt;cpu&gt;
        &lt;type&gt;x86_64&lt;/type&gt;
        &lt;count&gt;2&lt;/count&gt;
      &lt;/cpu&gt;
      &lt;ram&gt;
        &lt;real&gt;3878876&lt;/real&gt;
      &lt;/ram&gt;
      &lt;fullHostName&gt;hazmat.port25.com&lt;/fullHostName&gt;
      &lt;userString/&gt;
      &lt;hostId&gt;0&lt;/hostId&gt;
      &lt;webUI&gt;
        &lt;protocol&gt;1&lt;/protocol&gt;
      &lt;/webUI&gt;
    &lt;/mta&gt;
    &lt;status&gt;
      &lt;timeNow&gt;2019-02-07 17:06:02&lt;/timeNow&gt;
      &lt;startupTime&gt;2019-01-31 02:48:06&lt;/startupTime&gt;
      &lt;shuttingDown&gt;0&lt;/shuttingDown&gt;
      &lt;traffic&gt;
        &lt;total&gt;
          &lt;out&gt;
            &lt;rcp&gt;85402&lt;/rcp&gt;
            &lt;msg&gt;85402&lt;/msg&gt;
            &lt;kb&gt;2736957.8&lt;/kb&gt;
          &lt;/out&gt;
          &lt;in&gt;
            &lt;rcp&gt;100640&lt;/rcp&gt;
            &lt;msg&gt;100544&lt;/msg&gt;
            &lt;kb&gt;2177515.3&lt;/kb&gt;
          &lt;/in&gt;
          &lt;bounceProcessed&gt;0&lt;/bounceProcessed&gt;
          &lt;feedbackLoopProcessed&gt;0&lt;/feedbackLoopProcessed&gt;
        &lt;/total&gt;
        &lt;lastHr&gt;
          &lt;out&gt;
            &lt;rcp&gt;772&lt;/rcp&gt;
            &lt;msg&gt;772&lt;/msg&gt;
            &lt;kb&gt;25208.2&lt;/kb&gt;
          &lt;/out&gt;
          &lt;in&gt;
            &lt;rcp&gt;984&lt;/rcp&gt;
            &lt;msg&gt;984&lt;/msg&gt;
            &lt;kb&gt;21202.5&lt;/kb&gt;
          &lt;/in&gt;
          &lt;bounceProcessed&gt;0&lt;/bounceProcessed&gt;
          &lt;feedbackLoopProcessed&gt;0&lt;/feedbackLoopProcessed&gt;
        &lt;/lastHr&gt;
        &lt;lastMin&gt;
          &lt;out&gt;
            &lt;rcp&gt;7&lt;/rcp&gt;
            &lt;msg&gt;7&lt;/msg&gt;
            &lt;kb&gt;54.0&lt;/kb&gt;
          &lt;/out&gt;
          &lt;in&gt;
            &lt;rcp&gt;10&lt;/rcp&gt;
            &lt;msg&gt;10&lt;/msg&gt;
            &lt;kb&gt;79.4&lt;/kb&gt;
          &lt;/in&gt;
          &lt;bounceProcessed&gt;0&lt;/bounceProcessed&gt;
          &lt;feedbackLoopProcessed&gt;0&lt;/feedbackLoopProcessed&gt;
        &lt;/lastMin&gt;
        &lt;topPerHr&gt;
          &lt;out&gt;
            &lt;rcp&gt;883&lt;/rcp&gt;
            &lt;msg&gt;883&lt;/msg&gt;
            &lt;kb&gt;73238.2&lt;/kb&gt;
          &lt;/out&gt;
          &lt;in&gt;
            &lt;rcp&gt;1039&lt;/rcp&gt;
            &lt;msg&gt;1039&lt;/msg&gt;
            &lt;kb&gt;52393.0&lt;/kb&gt;
          &lt;/in&gt;
          &lt;bounceProcessed&gt;0&lt;/bounceProcessed&gt;
          &lt;feedbackLoopProcessed&gt;0&lt;/feedbackLoopProcessed&gt;
        &lt;/topPerHr&gt;
        &lt;topPerMin&gt;
          &lt;out&gt;
            &lt;rcp&gt;158&lt;/rcp&gt;
            &lt;msg&gt;158&lt;/msg&gt;
            &lt;kb&gt;27369.0&lt;/kb&gt;
          &lt;/out&gt;
          &lt;in&gt;
            &lt;rcp&gt;188&lt;/rcp&gt;
            &lt;msg&gt;187&lt;/msg&gt;
            &lt;kb&gt;27269.5&lt;/kb&gt;
          &lt;/in&gt;
          &lt;bounceProcessed&gt;0&lt;/bounceProcessed&gt;
          &lt;feedbackLoopProcessed&gt;0&lt;/feedbackLoopProcessed&gt;
        &lt;/topPerMin&gt;
        &lt;perf&gt;
          &lt;lastMin&gt;
            &lt;in&gt;
              &lt;count&gt;0&lt;/count&gt;
              &lt;mailFromTime&gt;0&lt;/mailFromTime&gt;
              &lt;dataTime&gt;0&lt;/dataTime&gt;
              &lt;totalTime&gt;0&lt;/totalTime&gt;
            &lt;/in&gt;
          &lt;/lastMin&gt;
        &lt;/perf&gt;
      &lt;/traffic&gt;
      &lt;conn&gt;
        &lt;smtpIn&gt;
          &lt;cur&gt;3&lt;/cur&gt;
          &lt;max&gt;200&lt;/max&gt;
          &lt;top&gt;20&lt;/top&gt;
        &lt;/smtpIn&gt;
        &lt;smtpOut&gt;
          &lt;cur&gt;11&lt;/cur&gt;
          &lt;max&gt;1000&lt;/max&gt;
          &lt;top&gt;76&lt;/top&gt;
        &lt;/smtpOut&gt;
      &lt;/conn&gt;
      &lt;resolver&gt;
        &lt;namesCached&gt;81&lt;/namesCached&gt;
        &lt;queriesPending&gt;1&lt;/queriesPending&gt;
        &lt;queriesActive&gt;1&lt;/queriesActive&gt;
      &lt;/resolver&gt;
      &lt;queue&gt;
        &lt;smtp&gt;
          &lt;rcp&gt;132&lt;/rcp&gt;
          &lt;dom&gt;92&lt;/dom&gt;
          &lt;kb&gt;7944.7&lt;/kb&gt;
        &lt;/smtp&gt;
        &lt;pipe&gt;
          &lt;rcp&gt;0&lt;/rcp&gt;
          &lt;dom&gt;0&lt;/dom&gt;
          &lt;kb&gt;0.0&lt;/kb&gt;
        &lt;/pipe&gt;
        &lt;discard&gt;
          &lt;rcp&gt;0&lt;/rcp&gt;
          &lt;dom&gt;0&lt;/dom&gt;
          &lt;kb&gt;0.0&lt;/kb&gt;
        &lt;/discard&gt;
        &lt;file&gt;
          &lt;rcp&gt;0&lt;/rcp&gt;
          &lt;dom&gt;0&lt;/dom&gt;
          &lt;kb&gt;0.0&lt;/kb&gt;
        &lt;/file&gt;
        &lt;alias&gt;
          &lt;rcp&gt;0&lt;/rcp&gt;
          &lt;dom&gt;0&lt;/dom&gt;
          &lt;kb&gt;0.0&lt;/kb&gt;
        &lt;/alias&gt;
        &lt;bounceProcessor&gt;
          &lt;rcp&gt;0&lt;/rcp&gt;
          &lt;dom&gt;0&lt;/dom&gt;
          &lt;kb&gt;0.0&lt;/kb&gt;
        &lt;/bounceProcessor&gt;
        &lt;feedbackLoopProcessor&gt;
          &lt;rcp&gt;0&lt;/rcp&gt;
          &lt;dom&gt;0&lt;/dom&gt;
          &lt;kb&gt;0.0&lt;/kb&gt;
        &lt;/feedbackLoopProcessor&gt;
      &lt;/queue&gt;
      &lt;spool&gt;
        &lt;initPct&gt;100&lt;/initPct&gt;
        &lt;dirs&gt;3&lt;/dirs&gt;
        &lt;files&gt;
          &lt;inUse&gt;134&lt;/inUse&gt;
          &lt;recycled&gt;0&lt;/recycled&gt;
          &lt;total&gt;12288&lt;/total&gt;
        &lt;/files&gt;
        &lt;totalRcp&gt;134&lt;/totalRcp&gt;
        &lt;maxRcp&gt;2880000&lt;/maxRcp&gt;
      &lt;/spool&gt;
      &lt;status&gt;running&lt;/status&gt;
    &lt;/status&gt;
  &lt;/data&gt;
  &lt;succ/&gt;
&lt;/rsp&gt;
</code></pre>
<p>Similarly, this page can also be retrieved in JSON format for processing by a program. You specify the JSON format by using <code>format=json</code>. For example, you could use the wget utility to retrieve it:</p>
<p>(Actual output will not be pretty-printed)</p>
<pre><code>$ wget -O- -q http://127.0.0.1:8080/status?format=json
{
  &quot;data&quot;: {
    &quot;mta&quot;: {
      &quot;product&quot;: {
        &quot;name&quot;: &quot;PowerMTA&quot;,
        &quot;version&quot;: &quot;5.0b1&quot;,
        &quot;buildDate&quot;: &quot;2018-12-17 04:13:56&quot;,
        &quot;revision&quot;: &quot;trunk@18274&quot;,
        &quot;bits&quot;: 64
      },
      &quot;lak&quot;: {
        &quot;serial&quot;: &quot;123456&quot;,
        &quot;instances&quot;: 0
      },
      &quot;os&quot;: {
        &quot;name&quot;: &quot;Linux&quot;,
        &quot;version&quot;: &quot;3.10.0-862.3.2.el7.x86_64&quot;,
        &quot;build&quot;: &quot;CentOS Linux release 7.5.1804 (Core) &quot;
      },
      &quot;cpu&quot;: {
        &quot;type&quot;: &quot;x86_64&quot;,
        &quot;count&quot;: 2
      },
      &quot;ram&quot;: {
        &quot;real&quot;: 3879568
      },
      &quot;fullHostName&quot;: &quot;foo.int.port25.com&quot;,
      &quot;userString&quot;: &quot;&quot;,
      &quot;hostId&quot;: 0
    },
    &quot;status&quot;: {
      &quot;timeNow&quot;: &quot;2019-02-19 23:00:46&quot;,
      &quot;startupTime&quot;: &quot;2019-02-19 17:15:07&quot;,
      &quot;shuttingDown&quot;: false,
      &quot;traffic&quot;: {
        &quot;total&quot;: {
          &quot;out&quot;: {
            &quot;rcp&quot;: 2007007,
            &quot;msg&quot;: 2007007,
            &quot;kb&quot;: 1370100.3
          },
          &quot;in&quot;: {
            &quot;rcp&quot;: 2007845,
            &quot;msg&quot;: 28046,
            &quot;kb&quot;: 8799.7
          },
          &quot;bounceProcessed&quot;: 0,
          &quot;feedbackLoopProcessed&quot;: 0
        },
        &quot;lastHr&quot;: {
          &quot;out&quot;: {
            &quot;rcp&quot;: 348704,
            &quot;msg&quot;: 348704,
            &quot;kb&quot;: 142245.3
          },
          &quot;in&quot;: {
            &quot;rcp&quot;: 348700,
            &quot;msg&quot;: 4936,
            &quot;kb&quot;: 33.7
          },
          &quot;bounceProcessed&quot;: 0,
          &quot;feedbackLoopProcessed&quot;: 0
        },
        &quot;lastMin&quot;: {
          &quot;out&quot;: {
            &quot;rcp&quot;: 5809,
            &quot;msg&quot;: 5809,
            &quot;kb&quot;: 2372.6
          },
          &quot;in&quot;: {
            &quot;rcp&quot;: 5800,
            &quot;msg&quot;: 81,
            &quot;kb&quot;: 0.6
          },
          &quot;bounceProcessed&quot;: 0,
          &quot;feedbackLoopProcessed&quot;: 0
        },
        &quot;topPerHr&quot;: {
          &quot;out&quot;: {
            &quot;rcp&quot;: 348947,
            &quot;msg&quot;: 348947,
            &quot;kb&quot;: 693034.3
          },
          &quot;in&quot;: {
            &quot;rcp&quot;: 348700,
            &quot;msg&quot;: 4936,
            &quot;kb&quot;: 8633.6
          },
          &quot;bounceProcessed&quot;: 0,
          &quot;feedbackLoopProcessed&quot;: 0
        },
        &quot;topPerMin&quot;: {
          &quot;out&quot;: {
            &quot;rcp&quot;: 6219,
            &quot;msg&quot;: 6219,
            &quot;kb&quot;: 214286.9
          },
          &quot;in&quot;: {
            &quot;rcp&quot;: 5900,
            &quot;msg&quot;: 99,
            &quot;kb&quot;: 3480.8
          },
          &quot;bounceProcessed&quot;: 0,
          &quot;feedbackLoopProcessed&quot;: 0
        },
        &quot;perf&quot;: {
          &quot;lastMin&quot;: {
            &quot;in&quot;: {
              &quot;count&quot;: 0,
              &quot;mailFromTime&quot;: 0,
              &quot;dataTime&quot;: 0,
              &quot;totalTime&quot;: 0
            }
          }
        }
      },
      &quot;conn&quot;: {
        &quot;smtpIn&quot;: {
          &quot;cur&quot;: 1,
          &quot;max&quot;: 5,
          &quot;top&quot;: 1
        },
        &quot;smtpOut&quot;: {
          &quot;cur&quot;: 0,
          &quot;max&quot;: 1200,
          &quot;top&quot;: 157
        }
      },
      &quot;resolver&quot;: {
        &quot;namesCached&quot;: 589,
        &quot;queriesPending&quot;: 0,
        &quot;queriesActive&quot;: 0
      },
      &quot;queue&quot;: {
        &quot;smtp&quot;: {
          &quot;rcp&quot;: 805,
          &quot;dom&quot;: 226,
          &quot;kb&quot;: 5.5
        },
        &quot;pipe&quot;: {
          &quot;rcp&quot;: 0,
          &quot;dom&quot;: 0,
          &quot;kb&quot;: 0
        },
        &quot;discard&quot;: {
          &quot;rcp&quot;: 0,
          &quot;dom&quot;: 0,
          &quot;kb&quot;: 0
        },
        &quot;file&quot;: {
          &quot;rcp&quot;: 0,
          &quot;dom&quot;: 0,
          &quot;kb&quot;: 0
        },
        &quot;alias&quot;: {
          &quot;rcp&quot;: 0,
          &quot;dom&quot;: 0,
          &quot;kb&quot;: 0
        },
        &quot;bounceProcessor&quot;: {
          &quot;rcp&quot;: 0,
          &quot;dom&quot;: 0,
          &quot;kb&quot;: 0
        },
        &quot;feedbackLoopProcessor&quot;: {
          &quot;rcp&quot;: 0,
          &quot;dom&quot;: 0,
          &quot;kb&quot;: 0
        }
      },
      &quot;spool&quot;: {
        &quot;initPct&quot;: 100,
        &quot;dirs&quot;: 1,
        &quot;files&quot;: {
          &quot;inUse&quot;: 504,
          &quot;recycled&quot;: 0,
          &quot;total&quot;: 504
        },
        &quot;totalRcp&quot;: 805,
        &quot;maxRcp&quot;: 25000
      },
      &quot;status&quot;: &quot;running&quot;
    }
  },
  &quot;status&quot;: &quot;success&quot;,
  &quot;message&quot;: &quot;&quot;
}
</code></pre>
<h2 id="queues-display"><span class="header-section-number">5.4</span> Queues Display</h2>
<p>Similar to the "Top Domains" page, the "Top Queues" page provides a listing of the top ten queues ranked by number of recipients.</p>
<p>For greatest flexibility and control, PowerMTA groups messages for a particular domain for a particular VirtualMTA in its own separate queue. For example, mail destined for msn.com and handled by VirtualMTA mta5 would be in a different queue than mail destined for msn.com and handled by VirtualMTA mta10.</p>
<p>Whereas the "Top Domains" page provides a global view with the top ten domains across all queues, the "Top Queues" page provides a listing and counts for specific queues.</p>
<p><img src="media/QueuesPage.png" /></p>
<p>The individual queue pages also include data on the last 50 recipient events, the last 10 queue errors and the last 10 mode change (backoff/normal) events.</p>
<p><img src="media/QueuePage.png" /></p>
<p>This information is also available in the output of the pmta show queues command.</p>
<p>This page can also be retrieved in XML or JSON format for processing by a program. You specify the format by using <code>format</code> parameter.</p>
<p>E.g. for obtaining top queues, use the URL: <a href="http://127.0.0.1:8080/queues?format=xml">http://127.0.0.1:8080/queues?format=xml</a></p>
<p>E.g. for obtaining an individual queue's detail, use the URL: <a href="http://127.0.0.1:8080/queueDetail?format=xml&amp;queue=domain.com/VirtualMTA">http://127.0.0.1:8080/queueDetail?format=xml&amp;queue=domain.com/VirtualMTA</a></p>
<h2 id="queues-view-options"><span class="header-section-number">5.5</span> Queues View Options</h2>
<p>The "Queues" page consists of a Queues view options" form which after submitting, generates an output similar in format to the "Top Queues" page, but for the specific queue(s) specified in conjunction with relevant filters.</p>
<p>The filters include:</p>
<ul>
<li><p>connected queues only, unconnected queues only, or both</p></li>
<li><p>queues in normal mode, backoff mode, or any mode</p></li>
<li><p>the desired number of queues to list</p></li>
</ul>
<p>One can then choose how to sort the output, either by queue name, number of recipients, or queue size.</p>
<p><img src="media/QueuesView.png" /></p>
<h2 id="domains-display"><span class="header-section-number">5.6</span> Domains Display</h2>
<p>The "Top Domains" page provides a listing of the top ten domains in the queue ranked by number of recipients.</p>
<p><img src="media/DomainsPage.png" /></p>
<p>For each domain listed, the number of recipients, amount of data (kilobytes), the number of open connections and the last error occurred while delivering to the domain are displayed.</p>
<h2 id="domains-view-options"><span class="header-section-number">5.7</span> Domains View Options</h2>
<p>The "Domains" page consists of a Domains view options" form which after submitting, generates an output similar in format to the "Top Domains" page, but for the specific domain(s) and based on the other parameters specified.</p>
<p><img src="media/DomainsView.png" /></p>
<p>This page can also be retrieved in XML or JSON format for processing by a program. You specify the format by using <code>format</code> parameter.</p>
<p>E.g. for obtaining top domains, use the URL: <a href="http://127.0.0.1:8080/domains?format=xml">http://127.0.0.1:8080/domains?format=xml</a></p>
<p>E.g. for obtaining an individual domain's detail, use the URL: <a href="http://127.0.0.1:8080/domainDetail?format=xml&amp;domain=domain.com">http://127.0.0.1:8080/domainDetail?format=xml&amp;domain=domain.com</a></p>
<h2 id="configuration-page"><span class="header-section-number">5.8</span> Configuration Page</h2>
<p>The "Configuration" page can be used to view and edit PowerMTA's main configuration as well as any other files that were included in the configuration through the <a href="#include">include</a>.</p>
<p><strong>Note</strong></p>
<blockquote>
<p>While the <code>config-defaults</code> file is also shown in the output, you should not modify the contents of this file since they get overwritten during PowerMTA installation or upgrade.</p>
</blockquote>
<p><img src="media/ConfigurationPage.png" /></p>
<h2 id="license-page"><span class="header-section-number">5.9</span> License Page</h2>
<p>The "License" page can be used to view and edit PowerMTA's license file.</p>
<p><img src="media/LicensePage.png" /></p>
<h2 id="common-last-errors"><span class="header-section-number">5.10</span> Common "Last Error"s</h2>
<p>Included below is a list of the most common "Last Error" messages, with an explanation about what may cause them. On Windows, system status codes may be prefixed with WSA, but indicate generally the same condition.</p>
<p><strong>ETIMEDOUT in connection to <em>domain</em> (<em>IP</em>)</strong></p>
<blockquote>
<p>This error indicates that the connection failed because, while connected, the remote host did not properly respond within a period of time. It possibly indicates that the remote host is overwhelmed or that there are connectivity problems. PowerMTA's connection timeout parameter is 10 minutes, and is not configurable.</p>
</blockquote>
<p><strong>ECONNREFUSED connecting to <em>domain</em> (<em>IP</em>)</strong></p>
<blockquote>
<p>This error indicates that no connection could be made because the remote host actively refused it. This usually results when the remote mailer software is temporarily down or inactive, or if the remote site is actively refusing connections (usually with a packet filter) from your company and/or IP address.</p>
</blockquote>
<p><strong>EDISCON in connection to <em>domain</em> (<em>IP</em>)</strong></p>
<blockquote>
<p>This error indicates that the remote host has unexpectedly closed the connection. It may result from the remote mail server being taken down, crashing, or simply closing the connection, possibly as a "last resort" kind of response to message contents it could not process.</p>
</blockquote>
<p><strong>StatusDnsQueryFailed resolving domain</strong></p>
<blockquote>
<p>This error indicates that the DNS query for the domain could not be completed. This could be due to more than one reason, specifically timeouts when PowerMTA attempts to talk to your local DNS server, but more likely, timeouts in your local DNS server itself when attempting to talk to other DNS servers. Although these errors can and will be seen for some domains that appear to not have valid MX or A records, the fact that the actual DNS queries timeout before receiving any verification of this precludes PowerMTA from making any assumptions and thus, for example, bouncing mail to these domains immediately.</p>
</blockquote>
<p><strong>EHLO failed</strong></p>
<blockquote>
<p>These are errors that are returned by the remote mail server during the initial SMTP handshake (at the HELO or EHLO SMTP commands). Usually the text included in the error messages is self-explanatory. Here are a few examples:</p>
</blockquote>
<pre><code>421 domain Service not available - too busy
421 domain Sorry, you are not authorized to make this connection.
421 domain temporarily not accepting mail
452 domain Too busy, please try later.
</code></pre>
<p>If you see domains in the queue with no errors specified, along with no active connections, this would mean that the queue is most likely to be waiting for DNS resolution to complete. For these domains, we recommend running the <a href="#trace">trace</a> command with the <code>--log-resolution</code> option from the command line interface or enable one or more of the various types of <a href="#logging-directives">logging</a> available.</p>
<h2 id="virtualmtas-display"><span class="header-section-number">5.11</span> VirtualMTAs Display</h2>
<p><img src="media/VirtualMTAsPage.png" /></p>
<p>The VirtualMTAs page provides a listing of the VirtualMTAs selected that currently have messages in the queue. The VirtualMTAs are listed sorted by number of recipients.</p>
<p>Each VirtualMTA listed also links to a top domains page that subsequently lists the top 10 domains in the queue for the specific VirtualMTA, ranked by number of recipients in the queue. Also included on this page is the volume of data in the queue, number of current connections open to the domain, and the last error received for the domain, again for the specific VirtualMTA.</p>
<p>This page can also be retrieved in XML or JSON format for processing by a program. You specify the format by using <code>format</code> parameter.</p>
<p>E.g. for obtaining top Virtual MTAs, use the URL: <a href="http://127.0.0.1:8080/vmtas?format=xml">http://127.0.0.1:8080/vmtas?format=xml</a></p>
<p>E.g. for obtaining an individual Virtual MTAs's detail, use the URL: <a href="http://127.0.0.1:8080/queues?format=xml&amp;queue=*/VirtualMTA">http://127.0.0.1:8080/queues?format=xml&amp;queue=*/VirtualMTA</a></p>
<h2 id="jobs-display"><span class="header-section-number">5.12</span> Jobs Display</h2>
<p><img src="media/JobsPage.png" /></p>
<p>For each job listed, the number of recipients and amount of data (kilobytes) are displayed.</p>
<p>This page can also be retrieved in XML or JSON format for processing by a program. You specify the format by using <code>format</code> parameter.</p>
<p>E.g. for obtaining top jobs, use the URL: <a href="http://127.0.0.1:8080/jobs?format=xml">http://127.0.0.1:8080/jobs?format=xml</a></p>
<p>E.g. for obtaining an individual job's detail, use the URL: <a href="http://127.0.0.1:8080/jobDetail?format=xml&amp;jobid=123">http://127.0.0.1:8080/jobDetail?format=xml&amp;jobid=123</a></p>
<h2 id="logs-display"><span class="header-section-number">5.13</span> Logs Display</h2>
<p>The Logs page displays the various log and accounting files currently available in PowerMTA. By choosing the download link, these files can be downloaded directly to your local machine for viewing. In addition, these files can be accessed programmatically via the URL format: <a href="http://127.0.0.1:8080/getFile?file=log.txt">http://127.0.0.1:8080/getFile?file=log.txt</a> where <code>log.txt</code> is the name of the file you want to download.</p>
<p><img src="media/LogsPage.png" /></p>
<p>This page can also be retrieved in XML or JSON format for processing by a program. You specify the format by using <code>format</code> parameter.</p>
<p>E.g. for obtaining logs, use the URL: <a href="http://127.0.0.1:8080/logs?format=xml">http://127.0.0.1:8080/logs?format=xml</a></p>
<h2 id="listing-of-local-ips"><span class="header-section-number">5.14</span> Listing of local IPs</h2>
<p>To get a list of the IPs currently configured on your machine, use the following URL in your web browser: <a href="http://127.0.0.1:8080/getlocalips">http://127.0.0.1:8080/getlocalips</a></p>
<p><img src="media/getLocalIps.png" /></p>
<h2 id="listing-of-emails-in-queue"><span class="header-section-number">5.15</span> Listing of emails in queue</h2>
<p>To get a listing of the messages that are currently in the queue, use a URL similar to the following in your web browser:</p>
<p><a href="http://127.0.0.1:8080/listqueue?format=xml&amp;queue=domain.com/VirtualMTA&amp;jobid=12">http://127.0.0.1:8080/listqueue?format=xml&amp;queue=domain.com/VirtualMTA&amp;jobid=12</a></p>
<p><a href="http://127.0.0.1:8080/listqueue?format=xml&amp;queue=yahoo.com/*&amp;jobid=12&amp;envid=3">http://127.0.0.1:8080/listqueue?format=xml&amp;queue=yahoo.com/*&amp;jobid=12&amp;envid=3</a></p>
<p><a href="http://127.0.0.1:8080/listqueue?format=xml&amp;queue=*/vmta12&amp;rcpt=test@port25.com">http://127.0.0.1:8080/listqueue?format=xml&amp;queue=*/vmta12&amp;rcpt=test@port25.com</a></p>
<p><a href="http://127.0.0.1:8080/listqueue?format=xml&amp;queue=*/*&amp;orig=test@port25.com">http://127.0.0.1:8080/listqueue?format=xml&amp;queue=*/*&amp;orig=test@port25.com</a></p>
<p>Use of jobid is optional. Replace <code>domain.com</code> with the domain for which you are looking. Also replace VirtualMTA with the name of the VirtualMTA in question. Also, use <code>*</code> for all domains or all VirtualMTAs.</p>
<p><img src="media/listQueue.png" /></p>
<h1 id="command-line-tool"><span class="header-section-number">6</span> Command Line Tool</h1>
<h2 id="overview-1"><span class="header-section-number">6.1</span> Overview</h2>
<p>PowerMTA comes with a command line tool that allows you to execute commands, display various information and also generally aids in investigating delivery problems. On Windows, this tool can be found under <code>bin\pmta.exe</code> in the folder where PowerMTA was installed. On Unix, it is installed as <code>/usr/sbin/pmta</code>. At the command line, you can get a quick listing of the commands available by invoking <code>pmta --help</code>:</p>
<pre><code>PowerMTA(TM) v5.0b1 command tool
Copyright(c) 1999-2018, Port25 Solutions, Inc.  All Rights Reserved.

Usage: pmta [options] command

where &#39;options&#39; are:
    --help                display this message
    --xml                 display result in XML
    --dom                 display result as DOM-like &quot;variables&quot;
    --json                display result in JSON

and where &#39;command&#39; is one of:
    clear dnscache domainname
    check mfrom [--tcp] [--dumppackets] mfrom ip
    check spf [--tcp] [--dumppackets] ip heloDomain [mailFrom]
    delete [--dsn] [--queue=domain[/vmta]] [--orig=addr] [--rcpt=addr] [--jobId=id] [--envId=id] [--older-than=time-interval] [--no-accounting]
    deregister [--user=name] [--local-only] [--retain-unloaded]
    digest [--hmac-sha256] [--siphash] [--key=string] [--hexkey=string] string
    disable source [--reenable-after=interval] ip domain[/vmta]
    enable source ip domain[/vmta]
    list [--queue=domain[/vmta]] [--orig=addr] [--rcpt=addr] [--jobId=id] [--envId=id] [--maxitems=n] [--older-than=time-interval] [--pause] [--priority] [--schedule]
    pause queue domain[/vmta]
    pause job jobid
    register [--user=name] [--label=name] [--webmon-ip=ip] [--webmon-port=number] [--pmtamc-port=number] [--reuse-label] pmtamc-hostname
    reload
    reset counters
    reset status
    resolve [--tcp] [--connect] [--use-dane] [--dumppackets] [--interactive] [--server=ip] [--source=[host,]ip] domainname
    resume queue domain[/vmta]
    resume job jobid
    rotate acct [file]
    rotate log
    schedule [--retry-recipients] domain[/vmta]
    set priority [--queue=domain[/vmta]] [--orig=addr] [--rcpt=addr] [--jobId=id] [--envId=id] number
    set queue --mode={normal|backoff} domain[/vmta]
    show disabled sources [domain[/vmta]]
    show domains [--vmta=name] [--connected={yes|no}] [--maxitems=n] [--errors] [--sort={name|rcpt|size}] [name]
    show jobs [--maxitems=n]
    show license
    show precache
    show queues [--connected={yes|no}] [--paused={yes|no}] [--mode={normal|backoff}] [--maxitems=n] [--errors] [--sort={name|rcpt|size}] [--no-rcpt-events] [--mode-events] [domain[/vmta]]
    show registration
    show status
    show settings domain[/vmta]
    show topdomains [--vmta=name] [--connected={yes|no}] [--maxitems=n] [--errors]
    show topqueues [--connected={yes|no}] [--paused={yes|no}] [--mode={normal|backoff}] [--maxitems=n] [--errors] [--no-rcpt-events] [domain[/vmta]]
    show version
    show vmtas [--maxitems=n]
    test config
    trace [--log-data] [--log-resolution] [--to-log] [--retry-recipients] [--source-ip=ip] domain[/vmta]
</code></pre>
<p>Note: On Windows, you can also use the "/" character instead of "--" (but "--" works on all platforms).</p>
<h2 id="command-output-formats"><span class="header-section-number">6.2</span> Command Output Formats</h2>
<p><code>pmta</code> supports four output formats:</p>
<ul>
<li><p>formatted plain text, intended for human consumption, e.g., for the system or services administrator executing PowerMTA commands. It is the default format if no options are passed to <code>pmta</code>.</p></li>
<li><p>XML format, intended for XML-enabled applications. It is selected by specifying the <code>--xml</code> option to <code>pmta</code>.</p></li>
<li><p>DOM-style variable listing, intended for non XML-capable applications and for quick Perl or shell scripts. It is selected by specifying the <code>--dom</code> option to <code>pmta</code>.</p></li>
<li><p>JSON format, intended for JSON-enabled applications. It is selected by specifying the <code>--json</code> option to <code>pmta</code>.</p></li>
</ul>
<h3 id="sample-command-outputs"><span class="header-section-number">6.2.1</span> Sample Command Outputs</h3>
<p>Included below are three sample command outputs along with the commands and options used to generate each. For comparison purposes, all three are based on the show status command.</p>
<p><strong>Formatted Plain Text (<code>pmta show status</code>):</strong></p>
<pre><code>PowerMTA v5.0 status on example.port25.com on 2018-09-10 10:16:19

  Traffic    ------------inbound------------  ------------outbound-----------
                 rcpts      msgs      kbytes      rcpts      msgs      kbytes
      Total     939437      5940    233409.5     939430    939430  34550887.2
  Last Hour     939437      5940    233409.5     939263    939263  34544775.4
   Top/Hour     939437      5940    233409.5     939263    939263  34544775.4
  Last Min.      45063       298     11632.6      45021     45021   1658056.5
   Top/Min.      69881       458     18005.6      69115     69115   2489680.7

 Connections    active       top     maximum  Domain       cached     pending
    Inbound          0         1           5    Names           2           0
   Outbound      10000     10000       10000

     Queues      rcpts   domains      kbytes  Spool        in use    recycled
       SMTP      99459      2895   3985272.8    Files        5667           0
      other          0         0         0.0    Init.                complete

     Status    running    Started  2018-09-10 20:02:12    Uptime   0  0:20:01

</code></pre>
<p><strong>XML Format (<code>pmta --xml show status</code>):</strong></p>
<p>(Actual output will not be pretty-printed)</p>
<div class="sourceCode" id="cb535"><pre class="sourceCode xml"><code class="sourceCode xml"><a class="sourceLine" id="cb535-1" title="1"><span class="kw">&lt;rsp&gt;</span></a>
<a class="sourceLine" id="cb535-2" title="2">  <span class="kw">&lt;data&gt;</span></a>
<a class="sourceLine" id="cb535-3" title="3">    <span class="kw">&lt;mta&gt;</span></a>
<a class="sourceLine" id="cb535-4" title="4">      <span class="kw">&lt;product&gt;</span></a>
<a class="sourceLine" id="cb535-5" title="5">        <span class="kw">&lt;name&gt;</span>PowerMTA<span class="kw">&lt;/name&gt;</span></a>
<a class="sourceLine" id="cb535-6" title="6">        <span class="kw">&lt;version&gt;</span>5.0<span class="kw">&lt;/version&gt;</span></a>
<a class="sourceLine" id="cb535-7" title="7">        <span class="kw">&lt;buildDate&gt;</span>2015-08-31 16:07:03<span class="kw">&lt;/buildDate&gt;</span></a>
<a class="sourceLine" id="cb535-8" title="8">        <span class="kw">&lt;revision&gt;</span>tags/v4_5c1@15693<span class="kw">&lt;/revision&gt;</span></a>
<a class="sourceLine" id="cb535-9" title="9">        <span class="kw">&lt;bits&gt;</span>64<span class="kw">&lt;/bits&gt;</span></a>
<a class="sourceLine" id="cb535-10" title="10">      <span class="kw">&lt;/product&gt;</span></a>
<a class="sourceLine" id="cb535-11" title="11">      <span class="kw">&lt;lak&gt;</span></a>
<a class="sourceLine" id="cb535-12" title="12">        <span class="kw">&lt;serial&gt;</span>112345<span class="kw">&lt;/serial&gt;</span></a>
<a class="sourceLine" id="cb535-13" title="13">        <span class="kw">&lt;instances&gt;</span>1<span class="kw">&lt;/instances&gt;</span></a>
<a class="sourceLine" id="cb535-14" title="14">      <span class="kw">&lt;/lak&gt;</span></a>
<a class="sourceLine" id="cb535-15" title="15">      <span class="kw">&lt;os&gt;</span></a>
<a class="sourceLine" id="cb535-16" title="16">        <span class="kw">&lt;name&gt;</span>Linux<span class="kw">&lt;/name&gt;</span></a>
<a class="sourceLine" id="cb535-17" title="17">        <span class="kw">&lt;version&gt;</span>3.10.0-229.1.2.el7.x86_64<span class="kw">&lt;/version&gt;</span></a>
<a class="sourceLine" id="cb535-18" title="18">        <span class="kw">&lt;build&gt;</span>CentOS Linux release 7.1.1503 (Core) <span class="kw">&lt;/build&gt;</span></a>
<a class="sourceLine" id="cb535-19" title="19">      <span class="kw">&lt;/os&gt;</span></a>
<a class="sourceLine" id="cb535-20" title="20">      <span class="kw">&lt;cpu&gt;</span></a>
<a class="sourceLine" id="cb535-21" title="21">        <span class="kw">&lt;type&gt;</span>x86_64<span class="kw">&lt;/type&gt;</span></a>
<a class="sourceLine" id="cb535-22" title="22">        <span class="kw">&lt;count&gt;</span>12<span class="kw">&lt;/count&gt;</span></a>
<a class="sourceLine" id="cb535-23" title="23">      <span class="kw">&lt;/cpu&gt;</span></a>
<a class="sourceLine" id="cb535-24" title="24">      <span class="kw">&lt;ram&gt;</span></a>
<a class="sourceLine" id="cb535-25" title="25">        <span class="kw">&lt;real&gt;</span>32750628<span class="kw">&lt;/real&gt;</span></a>
<a class="sourceLine" id="cb535-26" title="26">      <span class="kw">&lt;/ram&gt;</span></a>
<a class="sourceLine" id="cb535-27" title="27">      <span class="kw">&lt;fullHostName&gt;</span>example.port25.com<span class="kw">&lt;/fullHostName&gt;</span></a>
<a class="sourceLine" id="cb535-28" title="28">      <span class="kw">&lt;userString/&gt;</span></a>
<a class="sourceLine" id="cb535-29" title="29">      <span class="kw">&lt;hostId&gt;</span>0<span class="kw">&lt;/hostId&gt;</span></a>
<a class="sourceLine" id="cb535-30" title="30">    <span class="kw">&lt;/mta&gt;</span></a>
<a class="sourceLine" id="cb535-31" title="31">    <span class="kw">&lt;status&gt;</span></a>
<a class="sourceLine" id="cb535-32" title="32">      <span class="kw">&lt;timeNow&gt;</span>2015-09-01 10:17:07<span class="kw">&lt;/timeNow&gt;</span></a>
<a class="sourceLine" id="cb535-33" title="33">      <span class="kw">&lt;startupTime&gt;</span>2015-08-31 16:22:01<span class="kw">&lt;/startupTime&gt;</span></a>
<a class="sourceLine" id="cb535-34" title="34">      <span class="kw">&lt;shuttingDown&gt;</span>0<span class="kw">&lt;/shuttingDown&gt;</span></a>
<a class="sourceLine" id="cb535-35" title="35">      <span class="kw">&lt;traffic&gt;</span></a>
<a class="sourceLine" id="cb535-36" title="36">        <span class="kw">&lt;total&gt;</span></a>
<a class="sourceLine" id="cb535-37" title="37">          <span class="kw">&lt;out&gt;</span></a>
<a class="sourceLine" id="cb535-38" title="38">            <span class="kw">&lt;rcp&gt;</span>5317436<span class="kw">&lt;/rcp&gt;</span></a>
<a class="sourceLine" id="cb535-39" title="39">            <span class="kw">&lt;msg&gt;</span>5317436<span class="kw">&lt;/msg&gt;</span></a>
<a class="sourceLine" id="cb535-40" title="40">            <span class="kw">&lt;kb&gt;</span>2788394.0<span class="kw">&lt;/kb&gt;</span></a>
<a class="sourceLine" id="cb535-41" title="41">          <span class="kw">&lt;/out&gt;</span></a>
<a class="sourceLine" id="cb535-42" title="42">          <span class="kw">&lt;in&gt;</span></a>
<a class="sourceLine" id="cb535-43" title="43">            <span class="kw">&lt;rcp&gt;</span>5104905<span class="kw">&lt;/rcp&gt;</span></a>
<a class="sourceLine" id="cb535-44" title="44">            <span class="kw">&lt;msg&gt;</span>128951<span class="kw">&lt;/msg&gt;</span></a>
<a class="sourceLine" id="cb535-45" title="45">            <span class="kw">&lt;kb&gt;</span>1951.8<span class="kw">&lt;/kb&gt;</span></a>
<a class="sourceLine" id="cb535-46" title="46">          <span class="kw">&lt;/in&gt;</span></a>
<a class="sourceLine" id="cb535-47" title="47">          <span class="kw">&lt;bounceProcessed&gt;</span>0<span class="kw">&lt;/bounceProcessed&gt;</span></a>
<a class="sourceLine" id="cb535-48" title="48">          <span class="kw">&lt;feedbackLoopProcessed&gt;</span>0<span class="kw">&lt;/feedbackLoopProcessed&gt;</span></a>
<a class="sourceLine" id="cb535-49" title="49">        <span class="kw">&lt;/total&gt;</span></a>
<a class="sourceLine" id="cb535-50" title="50">        <span class="kw">&lt;lastHr&gt;</span></a>
<a class="sourceLine" id="cb535-51" title="51">          <span class="kw">&lt;out&gt;</span></a>
<a class="sourceLine" id="cb535-52" title="52">            <span class="kw">&lt;rcp&gt;</span>295376<span class="kw">&lt;/rcp&gt;</span></a>
<a class="sourceLine" id="cb535-53" title="53">            <span class="kw">&lt;msg&gt;</span>295376<span class="kw">&lt;/msg&gt;</span></a>
<a class="sourceLine" id="cb535-54" title="54">            <span class="kw">&lt;kb&gt;</span>97626.3<span class="kw">&lt;/kb&gt;</span></a>
<a class="sourceLine" id="cb535-55" title="55">          <span class="kw">&lt;/out&gt;</span></a>
<a class="sourceLine" id="cb535-56" title="56">          <span class="kw">&lt;in&gt;</span></a>
<a class="sourceLine" id="cb535-57" title="57">            <span class="kw">&lt;rcp&gt;</span>295358<span class="kw">&lt;/rcp&gt;</span></a>
<a class="sourceLine" id="cb535-58" title="58">            <span class="kw">&lt;msg&gt;</span>7366<span class="kw">&lt;/msg&gt;</span></a>
<a class="sourceLine" id="cb535-59" title="59">            <span class="kw">&lt;kb&gt;</span>111.4<span class="kw">&lt;/kb&gt;</span></a>
<a class="sourceLine" id="cb535-60" title="60">          <span class="kw">&lt;/in&gt;</span></a>
<a class="sourceLine" id="cb535-61" title="61">          <span class="kw">&lt;bounceProcessed&gt;</span>0<span class="kw">&lt;/bounceProcessed&gt;</span></a>
<a class="sourceLine" id="cb535-62" title="62">          <span class="kw">&lt;feedbackLoopProcessed&gt;</span>0<span class="kw">&lt;/feedbackLoopProcessed&gt;</span></a>
<a class="sourceLine" id="cb535-63" title="63">        <span class="kw">&lt;/lastHr&gt;</span></a>
<a class="sourceLine" id="cb535-64" title="64">        <span class="kw">&lt;lastMin&gt;</span></a>
<a class="sourceLine" id="cb535-65" title="65">          <span class="kw">&lt;out&gt;</span></a>
<a class="sourceLine" id="cb535-66" title="66">            <span class="kw">&lt;rcp&gt;</span>4776<span class="kw">&lt;/rcp&gt;</span></a>
<a class="sourceLine" id="cb535-67" title="67">            <span class="kw">&lt;msg&gt;</span>4776<span class="kw">&lt;/msg&gt;</span></a>
<a class="sourceLine" id="cb535-68" title="68">            <span class="kw">&lt;kb&gt;</span>1669.2<span class="kw">&lt;/kb&gt;</span></a>
<a class="sourceLine" id="cb535-69" title="69">          <span class="kw">&lt;/out&gt;</span></a>
<a class="sourceLine" id="cb535-70" title="70">          <span class="kw">&lt;in&gt;</span></a>
<a class="sourceLine" id="cb535-71" title="71">            <span class="kw">&lt;rcp&gt;</span>4772<span class="kw">&lt;/rcp&gt;</span></a>
<a class="sourceLine" id="cb535-72" title="72">            <span class="kw">&lt;msg&gt;</span>124<span class="kw">&lt;/msg&gt;</span></a>
<a class="sourceLine" id="cb535-73" title="73">            <span class="kw">&lt;kb&gt;</span>1.9<span class="kw">&lt;/kb&gt;</span></a>
<a class="sourceLine" id="cb535-74" title="74">          <span class="kw">&lt;/in&gt;</span></a>
<a class="sourceLine" id="cb535-75" title="75">          <span class="kw">&lt;bounceProcessed&gt;</span>0<span class="kw">&lt;/bounceProcessed&gt;</span></a>
<a class="sourceLine" id="cb535-76" title="76">          <span class="kw">&lt;feedbackLoopProcessed&gt;</span>0<span class="kw">&lt;/feedbackLoopProcessed&gt;</span></a>
<a class="sourceLine" id="cb535-77" title="77">        <span class="kw">&lt;/lastMin&gt;</span></a>
<a class="sourceLine" id="cb535-78" title="78">        <span class="kw">&lt;topPerHr&gt;</span></a>
<a class="sourceLine" id="cb535-79" title="79">          <span class="kw">&lt;out&gt;</span></a>
<a class="sourceLine" id="cb535-80" title="80">            <span class="kw">&lt;rcp&gt;</span>450637<span class="kw">&lt;/rcp&gt;</span></a>
<a class="sourceLine" id="cb535-81" title="81">            <span class="kw">&lt;msg&gt;</span>450637<span class="kw">&lt;/msg&gt;</span></a>
<a class="sourceLine" id="cb535-82" title="82">            <span class="kw">&lt;kb&gt;</span>1176613.1<span class="kw">&lt;/kb&gt;</span></a>
<a class="sourceLine" id="cb535-83" title="83">          <span class="kw">&lt;/out&gt;</span></a>
<a class="sourceLine" id="cb535-84" title="84">          <span class="kw">&lt;in&gt;</span></a>
<a class="sourceLine" id="cb535-85" title="85">            <span class="kw">&lt;rcp&gt;</span>303999<span class="kw">&lt;/rcp&gt;</span></a>
<a class="sourceLine" id="cb535-86" title="86">            <span class="kw">&lt;msg&gt;</span>7591<span class="kw">&lt;/msg&gt;</span></a>
<a class="sourceLine" id="cb535-87" title="87">            <span class="kw">&lt;kb&gt;</span>114.9<span class="kw">&lt;/kb&gt;</span></a>
<a class="sourceLine" id="cb535-88" title="88">          <span class="kw">&lt;/in&gt;</span></a>
<a class="sourceLine" id="cb535-89" title="89">          <span class="kw">&lt;bounceProcessed&gt;</span>0<span class="kw">&lt;/bounceProcessed&gt;</span></a>
<a class="sourceLine" id="cb535-90" title="90">          <span class="kw">&lt;feedbackLoopProcessed&gt;</span>0<span class="kw">&lt;/feedbackLoopProcessed&gt;</span></a>
<a class="sourceLine" id="cb535-91" title="91">        <span class="kw">&lt;/topPerHr&gt;</span></a>
<a class="sourceLine" id="cb535-92" title="92">        <span class="kw">&lt;topPerMin&gt;</span></a>
<a class="sourceLine" id="cb535-93" title="93">          <span class="kw">&lt;out&gt;</span></a>
<a class="sourceLine" id="cb535-94" title="94">            <span class="kw">&lt;rcp&gt;</span>213222<span class="kw">&lt;/rcp&gt;</span></a>
<a class="sourceLine" id="cb535-95" title="95">            <span class="kw">&lt;msg&gt;</span>213222<span class="kw">&lt;/msg&gt;</span></a>
<a class="sourceLine" id="cb535-96" title="96">            <span class="kw">&lt;kb&gt;</span>1098011.2<span class="kw">&lt;/kb&gt;</span></a>
<a class="sourceLine" id="cb535-97" title="97">          <span class="kw">&lt;/out&gt;</span></a>
<a class="sourceLine" id="cb535-98" title="98">          <span class="kw">&lt;in&gt;</span></a>
<a class="sourceLine" id="cb535-99" title="99">            <span class="kw">&lt;rcp&gt;</span>8365<span class="kw">&lt;/rcp&gt;</span></a>
<a class="sourceLine" id="cb535-100" title="100">            <span class="kw">&lt;msg&gt;</span>207<span class="kw">&lt;/msg&gt;</span></a>
<a class="sourceLine" id="cb535-101" title="101">            <span class="kw">&lt;kb&gt;</span>3.1<span class="kw">&lt;/kb&gt;</span></a>
<a class="sourceLine" id="cb535-102" title="102">          <span class="kw">&lt;/in&gt;</span></a>
<a class="sourceLine" id="cb535-103" title="103">          <span class="kw">&lt;bounceProcessed&gt;</span>0<span class="kw">&lt;/bounceProcessed&gt;</span></a>
<a class="sourceLine" id="cb535-104" title="104">          <span class="kw">&lt;feedbackLoopProcessed&gt;</span>0<span class="kw">&lt;/feedbackLoopProcessed&gt;</span></a>
<a class="sourceLine" id="cb535-105" title="105">        <span class="kw">&lt;/topPerMin&gt;</span></a>
<a class="sourceLine" id="cb535-106" title="106">        <span class="kw">&lt;perf&gt;</span></a>
<a class="sourceLine" id="cb535-107" title="107">          <span class="kw">&lt;lastMin&gt;</span></a>
<a class="sourceLine" id="cb535-108" title="108">            <span class="kw">&lt;in&gt;</span></a>
<a class="sourceLine" id="cb535-109" title="109">              <span class="kw">&lt;count&gt;</span>0<span class="kw">&lt;/count&gt;</span></a>
<a class="sourceLine" id="cb535-110" title="110">              <span class="kw">&lt;mailFromTime&gt;</span>0<span class="kw">&lt;/mailFromTime&gt;</span></a>
<a class="sourceLine" id="cb535-111" title="111">              <span class="kw">&lt;dataTime&gt;</span>0<span class="kw">&lt;/dataTime&gt;</span></a>
<a class="sourceLine" id="cb535-112" title="112">              <span class="kw">&lt;totalTime&gt;</span>0<span class="kw">&lt;/totalTime&gt;</span></a>
<a class="sourceLine" id="cb535-113" title="113">            <span class="kw">&lt;/in&gt;</span></a>
<a class="sourceLine" id="cb535-114" title="114">          <span class="kw">&lt;/lastMin&gt;</span></a>
<a class="sourceLine" id="cb535-115" title="115">        <span class="kw">&lt;/perf&gt;</span></a>
<a class="sourceLine" id="cb535-116" title="116">      <span class="kw">&lt;/traffic&gt;</span></a>
<a class="sourceLine" id="cb535-117" title="117">      <span class="kw">&lt;conn&gt;</span></a>
<a class="sourceLine" id="cb535-118" title="118">        <span class="kw">&lt;smtpIn&gt;</span></a>
<a class="sourceLine" id="cb535-119" title="119">          <span class="kw">&lt;cur&gt;</span>0<span class="kw">&lt;/cur&gt;</span></a>
<a class="sourceLine" id="cb535-120" title="120">          <span class="kw">&lt;max&gt;</span>150<span class="kw">&lt;/max&gt;</span></a>
<a class="sourceLine" id="cb535-121" title="121">          <span class="kw">&lt;top&gt;</span>1<span class="kw">&lt;/top&gt;</span></a>
<a class="sourceLine" id="cb535-122" title="122">        <span class="kw">&lt;/smtpIn&gt;</span></a>
<a class="sourceLine" id="cb535-123" title="123">        <span class="kw">&lt;smtpOut&gt;</span></a>
<a class="sourceLine" id="cb535-124" title="124">          <span class="kw">&lt;cur&gt;</span>0<span class="kw">&lt;/cur&gt;</span></a>
<a class="sourceLine" id="cb535-125" title="125">          <span class="kw">&lt;max&gt;</span>500<span class="kw">&lt;/max&gt;</span></a>
<a class="sourceLine" id="cb535-126" title="126">          <span class="kw">&lt;top&gt;</span>299<span class="kw">&lt;/top&gt;</span></a>
<a class="sourceLine" id="cb535-127" title="127">        <span class="kw">&lt;/smtpOut&gt;</span></a>
<a class="sourceLine" id="cb535-128" title="128">      <span class="kw">&lt;/conn&gt;</span></a>
<a class="sourceLine" id="cb535-129" title="129">      <span class="kw">&lt;resolver&gt;</span></a>
<a class="sourceLine" id="cb535-130" title="130">        <span class="kw">&lt;namesCached&gt;</span>0<span class="kw">&lt;/namesCached&gt;</span></a>
<a class="sourceLine" id="cb535-131" title="131">        <span class="kw">&lt;queriesPending&gt;</span>0<span class="kw">&lt;/queriesPending&gt;</span></a>
<a class="sourceLine" id="cb535-132" title="132">        <span class="kw">&lt;queriesActive&gt;</span>0<span class="kw">&lt;/queriesActive&gt;</span></a>
<a class="sourceLine" id="cb535-133" title="133">      <span class="kw">&lt;/resolver&gt;</span></a>
<a class="sourceLine" id="cb535-134" title="134">      <span class="kw">&lt;queue&gt;</span></a>
<a class="sourceLine" id="cb535-135" title="135">        <span class="kw">&lt;smtp&gt;</span></a>
<a class="sourceLine" id="cb535-136" title="136">          <span class="kw">&lt;rcp&gt;</span>692<span class="kw">&lt;/rcp&gt;</span></a>
<a class="sourceLine" id="cb535-137" title="137">          <span class="kw">&lt;dom&gt;</span>241<span class="kw">&lt;/dom&gt;</span></a>
<a class="sourceLine" id="cb535-138" title="138">          <span class="kw">&lt;kb&gt;</span>10.4<span class="kw">&lt;/kb&gt;</span></a>
<a class="sourceLine" id="cb535-139" title="139">        <span class="kw">&lt;/smtp&gt;</span></a>
<a class="sourceLine" id="cb535-140" title="140">        <span class="kw">&lt;pipe&gt;</span></a>
<a class="sourceLine" id="cb535-141" title="141">          <span class="kw">&lt;rcp&gt;</span>0<span class="kw">&lt;/rcp&gt;</span></a>
<a class="sourceLine" id="cb535-142" title="142">          <span class="kw">&lt;dom&gt;</span>0<span class="kw">&lt;/dom&gt;</span></a>
<a class="sourceLine" id="cb535-143" title="143">          <span class="kw">&lt;kb&gt;</span>0.0<span class="kw">&lt;/kb&gt;</span></a>
<a class="sourceLine" id="cb535-144" title="144">        <span class="kw">&lt;/pipe&gt;</span></a>
<a class="sourceLine" id="cb535-145" title="145">        <span class="kw">&lt;discard&gt;</span></a>
<a class="sourceLine" id="cb535-146" title="146">          <span class="kw">&lt;rcp&gt;</span>0<span class="kw">&lt;/rcp&gt;</span></a>
<a class="sourceLine" id="cb535-147" title="147">          <span class="kw">&lt;dom&gt;</span>0<span class="kw">&lt;/dom&gt;</span></a>
<a class="sourceLine" id="cb535-148" title="148">          <span class="kw">&lt;kb&gt;</span>0.0<span class="kw">&lt;/kb&gt;</span></a>
<a class="sourceLine" id="cb535-149" title="149">        <span class="kw">&lt;/discard&gt;</span></a>
<a class="sourceLine" id="cb535-150" title="150">        <span class="kw">&lt;file&gt;</span></a>
<a class="sourceLine" id="cb535-151" title="151">          <span class="kw">&lt;rcp&gt;</span>0<span class="kw">&lt;/rcp&gt;</span></a>
<a class="sourceLine" id="cb535-152" title="152">          <span class="kw">&lt;dom&gt;</span>0<span class="kw">&lt;/dom&gt;</span></a>
<a class="sourceLine" id="cb535-153" title="153">          <span class="kw">&lt;kb&gt;</span>0.0<span class="kw">&lt;/kb&gt;</span></a>
<a class="sourceLine" id="cb535-154" title="154">        <span class="kw">&lt;/file&gt;</span></a>
<a class="sourceLine" id="cb535-155" title="155">        <span class="kw">&lt;alias&gt;</span></a>
<a class="sourceLine" id="cb535-156" title="156">          <span class="kw">&lt;rcp&gt;</span>0<span class="kw">&lt;/rcp&gt;</span></a>
<a class="sourceLine" id="cb535-157" title="157">          <span class="kw">&lt;dom&gt;</span>0<span class="kw">&lt;/dom&gt;</span></a>
<a class="sourceLine" id="cb535-158" title="158">          <span class="kw">&lt;kb&gt;</span>0.0<span class="kw">&lt;/kb&gt;</span></a>
<a class="sourceLine" id="cb535-159" title="159">        <span class="kw">&lt;/alias&gt;</span></a>
<a class="sourceLine" id="cb535-160" title="160">        <span class="kw">&lt;bounceProcessor&gt;</span></a>
<a class="sourceLine" id="cb535-161" title="161">          <span class="kw">&lt;rcp&gt;</span>0<span class="kw">&lt;/rcp&gt;</span></a>
<a class="sourceLine" id="cb535-162" title="162">          <span class="kw">&lt;dom&gt;</span>0<span class="kw">&lt;/dom&gt;</span></a>
<a class="sourceLine" id="cb535-163" title="163">          <span class="kw">&lt;kb&gt;</span>0.0<span class="kw">&lt;/kb&gt;</span></a>
<a class="sourceLine" id="cb535-164" title="164">        <span class="kw">&lt;/bounceProcessor&gt;</span></a>
<a class="sourceLine" id="cb535-165" title="165">        <span class="kw">&lt;feedbackLoopProcessor&gt;</span></a>
<a class="sourceLine" id="cb535-166" title="166">          <span class="kw">&lt;rcp&gt;</span>0<span class="kw">&lt;/rcp&gt;</span></a>
<a class="sourceLine" id="cb535-167" title="167">          <span class="kw">&lt;dom&gt;</span>0<span class="kw">&lt;/dom&gt;</span></a>
<a class="sourceLine" id="cb535-168" title="168">          <span class="kw">&lt;kb&gt;</span>0.0<span class="kw">&lt;/kb&gt;</span></a>
<a class="sourceLine" id="cb535-169" title="169">        <span class="kw">&lt;/feedbackLoopProcessor&gt;</span></a>
<a class="sourceLine" id="cb535-170" title="170">      <span class="kw">&lt;/queue&gt;</span></a>
<a class="sourceLine" id="cb535-171" title="171">      <span class="kw">&lt;spool&gt;</span></a>
<a class="sourceLine" id="cb535-172" title="172">        <span class="kw">&lt;initPct&gt;</span>100<span class="kw">&lt;/initPct&gt;</span></a>
<a class="sourceLine" id="cb535-173" title="173">        <span class="kw">&lt;dirs&gt;</span>1<span class="kw">&lt;/dirs&gt;</span></a>
<a class="sourceLine" id="cb535-174" title="174">        <span class="kw">&lt;files&gt;</span></a>
<a class="sourceLine" id="cb535-175" title="175">          <span class="kw">&lt;inUse&gt;</span>491<span class="kw">&lt;/inUse&gt;</span></a>
<a class="sourceLine" id="cb535-176" title="176">          <span class="kw">&lt;recycled&gt;</span>0<span class="kw">&lt;/recycled&gt;</span></a>
<a class="sourceLine" id="cb535-177" title="177">          <span class="kw">&lt;total&gt;</span>491<span class="kw">&lt;/total&gt;</span></a>
<a class="sourceLine" id="cb535-178" title="178">        <span class="kw">&lt;/files&gt;</span></a>
<a class="sourceLine" id="cb535-179" title="179">        <span class="kw">&lt;totalRcp&gt;</span>692<span class="kw">&lt;/totalRcp&gt;</span></a>
<a class="sourceLine" id="cb535-180" title="180">        <span class="kw">&lt;maxRcp&gt;</span>1000000<span class="kw">&lt;/maxRcp&gt;</span></a>
<a class="sourceLine" id="cb535-181" title="181">      <span class="kw">&lt;/spool&gt;</span></a>
<a class="sourceLine" id="cb535-182" title="182">      <span class="kw">&lt;status&gt;</span>running<span class="kw">&lt;/status&gt;</span></a>
<a class="sourceLine" id="cb535-183" title="183">    <span class="kw">&lt;/status&gt;</span></a>
<a class="sourceLine" id="cb535-184" title="184">  <span class="kw">&lt;/data&gt;</span></a>
<a class="sourceLine" id="cb535-185" title="185">  <span class="kw">&lt;succ/&gt;</span></a>
<a class="sourceLine" id="cb535-186" title="186"><span class="kw">&lt;/rsp&gt;</span></a></code></pre></div>
<p><strong>DOM-Style (<code>pmta --dom show status</code>):</strong></p>
<pre><code>mta.product.name=&quot;PowerMTA&quot;
mta.product.version=&quot;5.0&quot;
mta.product.buildDate=&quot;2015-08-31 16:07:03&quot;
mta.product.revision=&quot;tags/v4_5@15693&quot;
mta.product.bits=&quot;64&quot;
mta.lak.serial=&quot;112345&quot;
mta.lak.instances=&quot;1&quot;
mta.os.name=&quot;Linux&quot;
mta.os.version=&quot;3.10.0-229.1.2.el7.x86_64&quot;
mta.os.build=&quot;CentOS Linux release 7.1.1503 (Core) &quot;
mta.cpu.type=&quot;x86_64&quot;
mta.cpu.count=&quot;12&quot;
mta.ram.real=&quot;32750628&quot;
mta.fullHostName=&quot;example.port25.com&quot;
mta.userString=&quot;&quot;
mta.hostId=&quot;0&quot;
status.timeNow=&quot;2015-09-01 10:17:50&quot;
status.startupTime=&quot;2015-08-31 16:22:01&quot;
status.shuttingDown=&quot;0&quot;
status.traffic.total.out.rcp=&quot;5319661&quot;
status.traffic.total.out.msg=&quot;5319661&quot;
status.traffic.total.out.kb=&quot;2789142.9&quot;
status.traffic.total.in.rcp=&quot;5107093&quot;
status.traffic.total.in.msg=&quot;129008&quot;
status.traffic.total.in.kb=&quot;1952.7&quot;
status.traffic.total.bounceProcessed=&quot;0&quot;
status.traffic.total.feedbackLoopProcessed=&quot;0&quot;
status.traffic.lastHr.out.rcp=&quot;294091&quot;
status.traffic.lastHr.out.msg=&quot;294091&quot;
status.traffic.lastHr.out.kb=&quot;97231.2&quot;
status.traffic.lastHr.in.rcp=&quot;294046&quot;
status.traffic.lastHr.in.msg=&quot;7335&quot;
status.traffic.lastHr.in.kb=&quot;111.0&quot;
status.traffic.lastHr.bounceProcessed=&quot;0&quot;
status.traffic.lastHr.feedbackLoopProcessed=&quot;0&quot;
status.traffic.lastMin.out.rcp=&quot;3275&quot;
status.traffic.lastMin.out.msg=&quot;3275&quot;
status.traffic.lastMin.out.kb=&quot;1092.6&quot;
status.traffic.lastMin.in.rcp=&quot;3242&quot;
status.traffic.lastMin.in.msg=&quot;85&quot;
status.traffic.lastMin.in.kb=&quot;1.3&quot;
status.traffic.lastMin.bounceProcessed=&quot;0&quot;
status.traffic.lastMin.feedbackLoopProcessed=&quot;0&quot;
status.traffic.topPerHr.out.rcp=&quot;450637&quot;
status.traffic.topPerHr.out.msg=&quot;450637&quot;
status.traffic.topPerHr.out.kb=&quot;1176613.1&quot;
status.traffic.topPerHr.in.rcp=&quot;303999&quot;
status.traffic.topPerHr.in.msg=&quot;7591&quot;
status.traffic.topPerHr.in.kb=&quot;114.9&quot;
status.traffic.topPerHr.bounceProcessed=&quot;0&quot;
status.traffic.topPerHr.feedbackLoopProcessed=&quot;0&quot;
status.traffic.topPerMin.out.rcp=&quot;213222&quot;
status.traffic.topPerMin.out.msg=&quot;213222&quot;
status.traffic.topPerMin.out.kb=&quot;1098011.2&quot;
status.traffic.topPerMin.in.rcp=&quot;8365&quot;
status.traffic.topPerMin.in.msg=&quot;207&quot;
status.traffic.topPerMin.in.kb=&quot;3.1&quot;
status.traffic.topPerMin.bounceProcessed=&quot;0&quot;
status.traffic.topPerMin.feedbackLoopProcessed=&quot;0&quot;
status.traffic.perf.lastMin.in.count=&quot;0&quot;
status.traffic.perf.lastMin.in.mailFromTime=&quot;0&quot;
status.traffic.perf.lastMin.in.dataTime=&quot;0&quot;
status.traffic.perf.lastMin.in.totalTime=&quot;0&quot;
status.conn.smtpIn.cur=&quot;0&quot;
status.conn.smtpIn.max=&quot;150&quot;
status.conn.smtpIn.top=&quot;1&quot;
status.conn.smtpOut.cur=&quot;0&quot;
status.conn.smtpOut.max=&quot;500&quot;
status.conn.smtpOut.top=&quot;299&quot;
status.resolver.namesCached=&quot;0&quot;
status.resolver.queriesPending=&quot;0&quot;
status.resolver.queriesActive=&quot;0&quot;
status.queue.smtp.rcp=&quot;655&quot;
status.queue.smtp.dom=&quot;243&quot;
status.queue.smtp.kb=&quot;9.9&quot;
status.queue.pipe.rcp=&quot;0&quot;
status.queue.pipe.dom=&quot;0&quot;
status.queue.pipe.kb=&quot;0.0&quot;
status.queue.discard.rcp=&quot;0&quot;
status.queue.discard.dom=&quot;0&quot;
status.queue.discard.kb=&quot;0.0&quot;
status.queue.file.rcp=&quot;0&quot;
status.queue.file.dom=&quot;0&quot;
status.queue.file.kb=&quot;0.0&quot;
status.queue.alias.rcp=&quot;0&quot;
status.queue.alias.dom=&quot;0&quot;
status.queue.alias.kb=&quot;0.0&quot;
status.queue.bounceProcessor.rcp=&quot;0&quot;
status.queue.bounceProcessor.dom=&quot;0&quot;
status.queue.bounceProcessor.kb=&quot;0.0&quot;
status.queue.feedbackLoopProcessor.rcp=&quot;0&quot;
status.queue.feedbackLoopProcessor.dom=&quot;0&quot;
status.queue.feedbackLoopProcessor.kb=&quot;0.0&quot;
status.spool.initPct=&quot;100&quot;
status.spool.dirs=&quot;1&quot;
status.spool.files.inUse=&quot;476&quot;
status.spool.files.recycled=&quot;0&quot;
status.spool.files.total=&quot;476&quot;
status.spool.totalRcp=&quot;655&quot;
status.spool.maxRcp=&quot;1000000&quot;
status.status=&quot;running&quot;
</code></pre>
<p><strong>JSON-Style (<code>pmta --json show status</code>):</strong> (Actual output will not be pretty-printed)</p>
<pre><code>{
  &quot;data&quot;: {
    &quot;mta&quot;: {
      &quot;product&quot;: {
        &quot;name&quot;: &quot;PowerMTA&quot;,
        &quot;version&quot;: &quot;5.0b1&quot;,
        &quot;buildDate&quot;: &quot;2018-12-17 04:13:56&quot;,
        &quot;revision&quot;: &quot;trunk@18274&quot;,
        &quot;bits&quot;: 64
      },
      &quot;lak&quot;: {
        &quot;serial&quot;: &quot;123456&quot;,
        &quot;instances&quot;: 0
      },
      &quot;os&quot;: {
        &quot;name&quot;: &quot;Linux&quot;,
        &quot;version&quot;: &quot;3.10.0-862.3.2.el7.x86_64&quot;,
        &quot;build&quot;: &quot;CentOS Linux release 7.5.1804 (Core) &quot;
      },
      &quot;cpu&quot;: {
        &quot;type&quot;: &quot;x86_64&quot;,
        &quot;count&quot;: 2
      },
      &quot;ram&quot;: {
        &quot;real&quot;: 3879568
      },
      &quot;fullHostName&quot;: &quot;foo.int.port25.com&quot;,
      &quot;userString&quot;: &quot;&quot;,
      &quot;hostId&quot;: 0
    },
    &quot;status&quot;: {
      &quot;timeNow&quot;: &quot;2019-02-19 23:00:46&quot;,
      &quot;startupTime&quot;: &quot;2019-02-19 17:15:07&quot;,
      &quot;shuttingDown&quot;: false,
      &quot;traffic&quot;: {
        &quot;total&quot;: {
          &quot;out&quot;: {
            &quot;rcp&quot;: 2007007,
            &quot;msg&quot;: 2007007,
            &quot;kb&quot;: 1370100.3
          },
          &quot;in&quot;: {
            &quot;rcp&quot;: 2007845,
            &quot;msg&quot;: 28046,
            &quot;kb&quot;: 8799.7
          },
          &quot;bounceProcessed&quot;: 0,
          &quot;feedbackLoopProcessed&quot;: 0
        },
        &quot;lastHr&quot;: {
          &quot;out&quot;: {
            &quot;rcp&quot;: 348704,
            &quot;msg&quot;: 348704,
            &quot;kb&quot;: 142245.3
          },
          &quot;in&quot;: {
            &quot;rcp&quot;: 348700,
            &quot;msg&quot;: 4936,
            &quot;kb&quot;: 33.7
          },
          &quot;bounceProcessed&quot;: 0,
          &quot;feedbackLoopProcessed&quot;: 0
        },
        &quot;lastMin&quot;: {
          &quot;out&quot;: {
            &quot;rcp&quot;: 5809,
            &quot;msg&quot;: 5809,
            &quot;kb&quot;: 2372.6
          },
          &quot;in&quot;: {
            &quot;rcp&quot;: 5800,
            &quot;msg&quot;: 81,
            &quot;kb&quot;: 0.6
          },
          &quot;bounceProcessed&quot;: 0,
          &quot;feedbackLoopProcessed&quot;: 0
        },
        &quot;topPerHr&quot;: {
          &quot;out&quot;: {
            &quot;rcp&quot;: 348947,
            &quot;msg&quot;: 348947,
            &quot;kb&quot;: 693034.3
          },
          &quot;in&quot;: {
            &quot;rcp&quot;: 348700,
            &quot;msg&quot;: 4936,
            &quot;kb&quot;: 8633.6
          },
          &quot;bounceProcessed&quot;: 0,
          &quot;feedbackLoopProcessed&quot;: 0
        },
        &quot;topPerMin&quot;: {
          &quot;out&quot;: {
            &quot;rcp&quot;: 6219,
            &quot;msg&quot;: 6219,
            &quot;kb&quot;: 214286.9
          },
          &quot;in&quot;: {
            &quot;rcp&quot;: 5900,
            &quot;msg&quot;: 99,
            &quot;kb&quot;: 3480.8
          },
          &quot;bounceProcessed&quot;: 0,
          &quot;feedbackLoopProcessed&quot;: 0
        },
        &quot;perf&quot;: {
          &quot;lastMin&quot;: {
            &quot;in&quot;: {
              &quot;count&quot;: 0,
              &quot;mailFromTime&quot;: 0,
              &quot;dataTime&quot;: 0,
              &quot;totalTime&quot;: 0
            }
          }
        }
      },
      &quot;conn&quot;: {
        &quot;smtpIn&quot;: {
          &quot;cur&quot;: 1,
          &quot;max&quot;: 5,
          &quot;top&quot;: 1
        },
        &quot;smtpOut&quot;: {
          &quot;cur&quot;: 0,
          &quot;max&quot;: 1200,
          &quot;top&quot;: 157
        }
      },
      &quot;resolver&quot;: {
        &quot;namesCached&quot;: 589,
        &quot;queriesPending&quot;: 0,
        &quot;queriesActive&quot;: 0
      },
      &quot;queue&quot;: {
        &quot;smtp&quot;: {
          &quot;rcp&quot;: 805,
          &quot;dom&quot;: 226,
          &quot;kb&quot;: 5.5
        },
        &quot;pipe&quot;: {
          &quot;rcp&quot;: 0,
          &quot;dom&quot;: 0,
          &quot;kb&quot;: 0
        },
        &quot;discard&quot;: {
          &quot;rcp&quot;: 0,
          &quot;dom&quot;: 0,
          &quot;kb&quot;: 0
        },
        &quot;file&quot;: {
          &quot;rcp&quot;: 0,
          &quot;dom&quot;: 0,
          &quot;kb&quot;: 0
        },
        &quot;alias&quot;: {
          &quot;rcp&quot;: 0,
          &quot;dom&quot;: 0,
          &quot;kb&quot;: 0
        },
        &quot;bounceProcessor&quot;: {
          &quot;rcp&quot;: 0,
          &quot;dom&quot;: 0,
          &quot;kb&quot;: 0
        },
        &quot;feedbackLoopProcessor&quot;: {
          &quot;rcp&quot;: 0,
          &quot;dom&quot;: 0,
          &quot;kb&quot;: 0
        }
      },
      &quot;spool&quot;: {
        &quot;initPct&quot;: 100,
        &quot;dirs&quot;: 1,
        &quot;files&quot;: {
          &quot;inUse&quot;: 504,
          &quot;recycled&quot;: 0,
          &quot;total&quot;: 504
        },
        &quot;totalRcp&quot;: 805,
        &quot;maxRcp&quot;: 25000
      },
      &quot;status&quot;: &quot;running&quot;
    }
  },
  &quot;status&quot;: &quot;success&quot;,
  &quot;message&quot;: &quot;&quot;
}
</code></pre>
<h2 id="command-reference"><span class="header-section-number">6.3</span> Command Reference</h2>
<h3 id="clear-dnscache"><span class="header-section-number">6.3.1</span> <code>clear dnscache</code></h3>
<p>This command clears PowerMTA's internal DNS cache, removing all entries for the given domain. If the domain is <code>*</code> all cached DNS data is discarded. On Unix the asterisk must be escaped with a backslash.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta clear dnscache domain
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>$ pmta clear dns *
DNS cache cleared.

$ pmta clear dns port25.com
Cleared port25.com from DNS cache.
</code></pre>
<hr />
<h3 id="check-mfrom"><span class="header-section-number">6.3.2</span> <code>check mfrom</code></h3>
<p>This command has been deprecated because the Sender-ID standard checking performed by this command is obsolete. Please use <code>check spf</code> instead.</p>
<h3 id="check-spf"><span class="header-section-number">6.3.3</span> <code>check spf</code></h3>
<p>This command checks whether a message with the given sender would pass the SPF check if sent from the given IP address. If the <code>mailFrom</code> parameter is specified, it will be used as the identity to check, else the <code>heloDomain</code> identity is checked.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta check spf [--tcp] [--dumppackets] ip heloDomain [mailFrom]
</code></pre>
<p><strong>Options</strong>:</p>
<p><strong><code>--tcp</code></strong></p>
<blockquote>
<p>use TCP (rather than the default UDP) for querying the name server(s).</p>
</blockquote>
<p><strong><code>--dumppackets</code></strong></p>
<blockquote>
<p>print out a hexadecimal dump of any DNS queries and responses exchanged with the name servers. It is ignored unless the output is in text format.</p>
</blockquote>
<hr />
<h3 id="reload"><span class="header-section-number">6.3.4</span> <code>reload</code></h3>
<p>PowerMTA reads its configuration during startup. Use this command to activate the new settings after making changes to the configuration file. The <code>reload</code> command is generally preferable to stopping and restarting PowerMTA because it is more efficient and does not cause an interruption in service.</p>
<p>If PowerMTA detects an error in the configuration file, the reload command fails and the previous in-memory configuration is retained.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta reload
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>$ pmta reload
Configuration reloaded.
</code></pre>
<hr />
<h3 id="reset-counters"><span class="header-section-number">6.3.5</span> <code>reset counters</code></h3>
<p>The <code>reset counters</code> command allows you to reset the various counters for statistics shown by PowerMTA in the output of <code>show status</code> command without having to restart the PowerMTA service.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta reset counters
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>$ pmta reset count
Traffic counters reset.
</code></pre>
<hr />
<h3 id="reset-status"><span class="header-section-number">6.3.6</span> <code>reset status</code></h3>
<p>This command is just an alias to <code>reset counters</code>.</p>
<hr />
<h3 id="resolve"><span class="header-section-number">6.3.7</span> <code>resolve</code></h3>
<p>The <code>resolve</code> command queries DNS for mail routing information (MX and A/AAAA records) for the specified domain, displays that information, and optionally connects to the first available mailhost. It is intended to facilitate debugging connectivity problems to destination domains. For example, if you notice that the queue is building up for a specific domain, you can run <code>resolve</code> against that domain to figure out what problems exist and what if anything can be done to fix the problem.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta resolve [--tcp] [--connect] [--use-dane] [--dumppackets] [--interactive] [--server=ip] [--source=[host,]ip] domainname
</code></pre>
<p><strong>Defaults</strong>:</p>
<p>If no options are specified, DNS resolution is attempted via UDP and any relevant information is displayed, however no attempt is made to connect to a mailhost.</p>
<p><strong>Options</strong>:</p>
<p><strong><code>--tcp</code></strong></p>
<blockquote>
<p>this tells PowerMTA to use TCP (rather than the default UDP) for querying the name server(s)</p>
</blockquote>
<p><strong><code>--connect</code></strong></p>
<blockquote>
<p>this option tells PowerMTA to attempt to connect to the first available mailhost as well, after querying and displaying the specified domain's DNS server for mail routing information.</p>
</blockquote>
<p><strong><code>--dumppackets</code></strong></p>
<blockquote>
<p>this option tells PowerMTA to print out an hexadecimal dump of any DNS queries and responses exchanged with the name servers. It is ignored unless the output is in textual format.</p>
</blockquote>
<p><strong><code>--interactive</code></strong></p>
<blockquote>
<p>this option allows the user to try various SMTP commands, to help diagnose problems.</p>
</blockquote>
<p><strong><code>--server</code></strong></p>
<blockquote>
<p>this option tells PowerMTA which DNS server to connect to when resolving hostnames.</p>
</blockquote>
<p><strong><code>--source</code></strong></p>
<blockquote>
<p>this option tells PowerMTA the internal IP address or hostname to use during the connection attempt.</p>
</blockquote>
<p><strong><code>--use-dane</code></strong></p>
<blockquote>
<p>this option tells PowerMTA to lookup DANE DNS records for the connection attempt, and use STARTTLS during the connection attempt based on the remote site's preference as listed in its DANE DNS records. Note that PowerMTA has to be configured with a DNS resolver that supports DNSSEC for this flag to be used. See <a href="#dane">DANE</a> for more information.</p>
</blockquote>
<p><strong>Examples:</strong></p>
<pre><code>$ pmta resolve --connect outlook.com
Querying 127.0.0.1 over UDP about MX outlook.com
Read response from 127.0.0.1
answers:     ttl=60
    outlook.com. 60 IN MX 5 outlook-com.olc.protection.outlook.com.


Querying 127.0.0.1 over UDP about A outlook-com.olc.protection.outlook.com
Read response from 127.0.0.1
answers:     ttl=2
    outlook-com.olc.protection.outlook.com. 2 IN A 104.47.48.33
    outlook-com.olc.protection.outlook.com. 2 IN A 104.47.49.33

status = StatusOk
pref host name                              IP addresses
---- -------------------------------------- -------------------------
   5 outlook-com.olc.protection.outlook.com 104.47.48.33 104.47.49.33

connecting from localhost (0.0.0.0) to outlook-com.olc.protection.outlook.com (104.47.48.33)
&gt;&gt;&gt; 220 CO1NAM05FT041.mail.protection.outlook.com Microsoft ESMTP MAIL Service ready at Thu, 7 Feb 2019 15:18:50 +0000
&lt;&lt;&lt; EHLO localhost
&gt;&gt;&gt; 250-CO1NAM05FT041.mail.protection.outlook.com Hello
&gt;&gt;&gt; 250-SIZE 49283072
&gt;&gt;&gt; 250-PIPELINING
&gt;&gt;&gt; 250-DSN
&gt;&gt;&gt; 250-ENHANCEDSTATUSCODES
&gt;&gt;&gt; 250-STARTTLS
&gt;&gt;&gt; 250-8BITMIME
&gt;&gt;&gt; 250-BINARYMIME
&gt;&gt;&gt; 250-CHUNKING
&gt;&gt;&gt; 250 SMTPUTF8
&lt;&lt;&lt; STARTTLS
&gt;&gt;&gt; 220 2.0.0 SMTP server ready
TLSv1.2 connected with 256-bit ECDHE-RSA-AES256-SHA384
Cert: /C=US/ST=Washington/L=Redmond/O=Microsoft Corporation/CN=mail.protection.outlook.com; issuer=/C=BE/O=GlobalSign nv-sa/CN=GlobalSign Organization Validation CA - SHA256 - G3; verified=no
&lt;&lt;&lt; EHLO localhost
&gt;&gt;&gt; 250-CO1NAM05FT041.mail.protection.outlook.com Hello
&gt;&gt;&gt; 250-SIZE 49283072
&gt;&gt;&gt; 250-PIPELINING
&gt;&gt;&gt; 250-DSN
&gt;&gt;&gt; 250-ENHANCEDSTATUSCODES
&gt;&gt;&gt; 250-8BITMIME
&gt;&gt;&gt; 250-BINARYMIME
&gt;&gt;&gt; 250-CHUNKING
&gt;&gt;&gt; 250 SMTPUTF8
&lt;&lt;&lt; QUIT
&gt;&gt;&gt; 221 2.0.0 Service closing transmission channel
closed outlook-com.olc.protection.outlook.com (104.47.48.33) in=601 out=48
</code></pre>
<pre><code>$ pmta --dom resolve yahoo.com
status=&quot;StatusOk&quot;
host[0].pref=&quot;1&quot;
host[0].name=&quot;mta5.am0.yahoodns.net&quot;
host[0].ip[0]=&quot;98.137.159.25&quot;
host[0].ip[1]=&quot;98.137.159.27&quot;
host[0].ip[2]=&quot;98.137.159.28&quot;
host[0].ip[3]=&quot;66.218.85.52&quot;
host[0].ip[4]=&quot;67.195.228.141&quot;
host[0].ip[5]=&quot;67.195.229.58&quot;
host[0].ip[6]=&quot;67.195.229.59&quot;
host[0].ip[7]=&quot;98.136.102.54&quot;
host[1].pref=&quot;1&quot;
host[1].name=&quot;mta6.am0.yahoodns.net&quot;
host[1].ip[0]=&quot;74.6.137.63&quot;
host[1].ip[1]=&quot;74.6.137.64&quot;
host[1].ip[2]=&quot;74.6.137.65&quot;
host[1].ip[3]=&quot;98.137.159.26&quot;
host[1].ip[4]=&quot;98.137.159.28&quot;
host[1].ip[5]=&quot;66.218.85.52&quot;
host[1].ip[6]=&quot;67.195.228.141&quot;
host[1].ip[7]=&quot;67.195.229.58&quot;
host[2].pref=&quot;1&quot;
host[2].name=&quot;mta7.am0.yahoodns.net&quot;
host[2].ip[0]=&quot;67.195.229.58&quot;
host[2].ip[1]=&quot;67.195.229.59&quot;
host[2].ip[2]=&quot;98.136.101.117&quot;
host[2].ip[3]=&quot;98.136.102.54&quot;
host[2].ip[4]=&quot;98.137.159.24&quot;
host[2].ip[5]=&quot;98.137.159.27&quot;
host[2].ip[6]=&quot;98.137.159.28&quot;
host[2].ip[7]=&quot;66.218.85.139&quot;
</code></pre>
<hr />
<h3 id="rotate-acct"><span class="header-section-number">6.3.8</span> <code>rotate acct</code></h3>
<p>This command instructs PowerMTA to immediately rotate all configured accounting files. If a filename is specified in the command, only that specified accounting file will be rotated. Immediate rotation does not affect the automatic rotation at midnight, which is still performed.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta rotate acct [file]
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>$ pmta rotate acct
Accounting file rotated.
</code></pre>
<hr />
<h3 id="rotate-log"><span class="header-section-number">6.3.9</span> <code>rotate log</code></h3>
<p>This command instructs PowerMTA to immediately rotate the logging file. Immediate rotation does not affect the automatic rotation at midnight, which is still performed.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta rotate log
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>$ pmta rotate log
Logging file rotated.
</code></pre>
<hr />
<h3 id="schedule"><span class="header-section-number">6.3.10</span> <code>schedule</code></h3>
<p>Instructs PowerMTA to immediately request workers to be assigned to the specified queue(s) in order to start delivery attempts for messages queued in them. This command would be used, for example, if connectivity problems to a domain were fixed and the normal retry interval should be bypassed. A wildcard can also be specified in <em>domain</em> or <em>vmta</em>, allowing multiple domains/vmtas to be scheduled at once.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta schedule [--retry-recipients] domain/vmta
</code></pre>
<p><strong>Options</strong>:</p>
<p><strong><code>--retry-recipients</code></strong></p>
<blockquote>
<p>Recipients that received SMTP 4xx errors (such as "mailbox full" error) are placed in a separate retry bucket where they are held for up to a period of time controlled by the per-domain setting <a href="#retry-recipients-after">retry-recipients-after</a>. This flag overrides the <code>retry-after</code> period for recipients, and immediately makes them available for delivery attempts.</p>
</blockquote>
<p><strong>Example:</strong></p>
<pre><code>$ pmta schedule */*
154 of 3888 matching queues scheduled.
</code></pre>
<hr />
<h3 id="set-queue"><span class="header-section-number">6.3.11</span> <code>set queue</code></h3>
<p>Sets the given queue's mode of operation to either normal or backoff. While in backoff mode, various different settings may apply. See the <code>backoff-...</code> directives in <a href="#domain-directives">&lt;domain&gt; Directives</a> for more information.</p>
<p>Wildcards can be used to modify various queues at the same time.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta set queue --mode={normal|backoff} domain/vmta
</code></pre>
<hr />
<h3 id="show-domains"><span class="header-section-number">6.3.12</span> <code>show domains</code></h3>
<p>This command allows you to view current information on the specified destination domain(s).</p>
<p><strong>Syntax:</strong></p>
<pre><code>show domains [--vmta=name] [--connected={yes|no}] [--maxitems=n] [--errors] [--sort={name|rcpt|size}] [name]
</code></pre>
<p><strong>Options</strong>:</p>
<p><strong><code>--vmta=name</code></strong></p>
<blockquote>
<p>displays only domains information for the given VirtualMTA. The default is to display (accumulated) information for all VirtualMTAs, including messages for which no VirtualMTA was selected.</p>
</blockquote>
<p><strong><code>--connected</code></strong></p>
<blockquote>
<p>displays domains to which PowerMTA has least one open outgoing connection. The default is to display both connected and unconnected domains.</p>
</blockquote>
<p><strong><code>--maxitems=n</code></strong></p>
<blockquote>
<p>specifies the maximum number of domains to be displayed in the output. By default, 20 domains are displayed.</p>
</blockquote>
<p><strong><code>--errors</code></strong></p>
<blockquote>
<p>displays any errors recorded for the domain.</p>
</blockquote>
<p><strong><code>--sort=key</code></strong></p>
<blockquote>
<p>sort output by <em>key</em> where <em>key</em> may be <code>name</code> to order the domain list alphabetically by name, <code>rcpt</code> to order the list by number of recipients or <code>size</code> to order the list by volume (kbytes).</p>
</blockquote>
<p><strong><code>name</code></strong></p>
<blockquote>
<p>domain name or wildcard specifying the domains about which information is to be displayed. If omitted, all domains are displayed (subject to the maxitems limit).</p>
</blockquote>
<p><strong>Examples:</strong></p>
<pre><code>$ pmta show domains
-----------------------------domain --#rcpt ---kbytes conn last error----------
                   test1.port25.com       7      30.6    0
                  test10.port25.com       8      30.6    0
                  test11.port25.com       3      30.6    0
                  test12.port25.com      13      30.6    0
                  test13.port25.com       3      30.6    0
                  test14.port25.com       3      30.6    0
                  test15.port25.com       3      30.6    0
                  test16.port25.com      52      30.6    0
                  test17.port25.com       3      30.6    0
                  test18.port25.com       3      30.6    0 ETIMEDOUT connect...
                  test19.port25.com       3      30.6    0
                   test2.port25.com       3      30.6    0
                  test20.port25.com       3      30.6    0
                  test21.port25.com       3      30.6    0
                  test22.port25.com       3      30.6    0
                  test23.port25.com       3      30.6    0
                  test24.port25.com       3      30.6    0
                  test25.port25.com       3      30.6    0
                  test26.port25.com       3      30.6    0
                  test27.port25.com       3      30.6    0

20 of 30 domains shown.
</code></pre>
<hr />
<h3 id="show-queues"><span class="header-section-number">6.3.13</span> <code>show queues</code></h3>
<p>This command allows you to view current information on the specified queues. The output also includes the last 50 delivery/bounce/deferral events by default.</p>
<p><strong>Syntax:</strong></p>
<pre><code>show queues [--connected={yes|no}] [--paused={yes|no}] [--mode-events] [--mode={normal|backoff}] [--maxitems=n] [--errors] [--sort={name|rcpt|size}] [--no-rcpt-events] [queue]
</code></pre>
<p><strong>Options</strong>:</p>
<p><strong><code>--connected</code></strong></p>
<blockquote>
<p>displays queues for which PowerMTA has least one open outgoing connection. The default is to display both connected and unconnected queues.</p>
</blockquote>
<p><strong><code>--mode</code></strong></p>
<blockquote>
<p>displays only queues in the specified mode. The default is to display queues in all modes.</p>
</blockquote>
<p><strong><code>--maxitems=n</code></strong></p>
<blockquote>
<p>specifies the maximum number of queues to be displayed in the output. By default, 20 domains are displayed.</p>
</blockquote>
<p><strong><code>--errors</code></strong></p>
<blockquote>
<p>displays any errors recorded for the queue.</p>
</blockquote>
<p><strong><code>--sort=key</code></strong></p>
<blockquote>
<p>sort output by <em>key</em> where <em>key</em> may be <code>name</code> to order the queue list alphabetically by name, <code>rcpt</code> to order the list by number of recipients or <code>size</code> to order the list by volume (kbytes).</p>
</blockquote>
<p><strong><code>--no-rcpt-events</code></strong></p>
<blockquote>
<p>hides the delivery events, that by default are shown.</p>
</blockquote>
<p><strong><code>--paused={yes|no}</code></strong></p>
<blockquote>
<p>allows selecting only paused or running queues for display. By default, both are shown.</p>
</blockquote>
<p><strong><code>--mode-events</code></strong></p>
<blockquote>
<p>allows show the recent mode changes</p>
</blockquote>
<p><strong><code>queue</code></strong></p>
<blockquote>
<p>name of the queue(s) to display, in the format <em>domain</em>[/<em>vmta</em>], where <em>domain</em> is the destination domain name and <em>vmta</em> is the VirtualMTA. If omitted, both <em>domain</em> and <em>vmta</em> default to <code>*</code> (i.e., <code>*/*</code>), which matches all queues.</p>
</blockquote>
<p><strong>Examples:</strong></p>
<pre><code>$ pmta show queue
queue           #rcpt kbytes conn st    retry last error
--------------- ----- ------ ---- -- -------- ----------
*/*
example.com/vmta1   2    0.2    0    09:35:42

Recipient Events (deliveries:4, bounces:1, deferrals:1)
-------------------------------------------------------
delivered | 2014-11-24 09:35:09 | 10.25.25.235 | kf@example.com | jobid10145783566176 | [192.168.10.48] (192.168.10.48) | smtp;250 DATA ok
delivered | 2014-11-24 09:31:07 | 10.25.25.235 | ft@example.com | jobid10145783566176 | [192.168.10.48] (192.168.10.48) | smtp;250 DATA ok
deferred | 2014-11-24 09:29:06 | 10.25.25.235 | np@example.com | jobid8363372138340 | [192.168.10.48] (192.168.10.48) | smtp;450 4.0.0 (undefined status);smtp;421 Refused. Your reverse DNS entry does not resolve.
delivered | 2014-11-24 09:26:06 | 10.25.25.235 | ce@example.com | jobid8363372138340 | [192.168.10.48] (192.168.10.48) | smtp;250 DATA ok
delivered | 2014-11-24 09:26:06 | 10.25.25.235 | rd@example.com | jobid10145783566176 | [192.168.10.48] (192.168.10.48) | smtp;250 DATA ok
bounced | 2014-11-24 09:36:09 | 10.25.25.235 | vc@example.com | jobid8363372138340 | [192.168.10.48] (192.168.10.48) | smtp;550 5.0.0 (undefined status);smtp;550 No Such User Here3 of 3 matching queues.
</code></pre>
<hr />
<h3 id="show-jobs"><span class="header-section-number">6.3.14</span> <code>show jobs</code></h3>
<p>This command allows you to view the jobs currently in PowerMTA's queue.</p>
<p><strong>Syntax:</strong></p>
<pre><code>show jobs [--maxitems=n]
</code></pre>
<p><strong>Options</strong>:</p>
<p><strong><code>--maxitems=n</code></strong></p>
<blockquote>
<p>specifies the maximum number of queues to be displayed in the output. By default all jobs are displayed.</p>
</blockquote>
<p><strong>Example:</strong></p>
<pre><code>$ pmta show jobs
-----------------------------job-id ----#rcpt ---kbytes
                    weeklyNews22100       431    1236.9

Total of 1 job(s).
</code></pre>
<hr />
<h3 id="show-settings"><span class="header-section-number">6.3.15</span> <code>show settings</code></h3>
<p>This command allows you to view the (per-queue) settings for the specified domain and VirtualMTA.</p>
<p><strong>Syntax:</strong></p>
<pre><code>show settings domain[/vmta]
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>$ pmta show settings port25.com/vmta1
Virtual MTA Settings
--------------------
max-smtp-msg-rate unlimited
max-smtp-out unlimited

Queue Settings
--------------
type smtp
add-x-msys-api-header no
allow-cancel-during-transfer yes
allow-priority-interruption yes
allow-priority-interruption-during-transfer no
assume-delivery-upon-data-termination-timeout no
auth-password &quot;&quot;
auth-username &quot;&quot;
backoff-max-connect-rate unlimited
backoff-max-msg-rate unlimited
backoff-max-smtp-out 20
backoff-notify &quot;&quot;
backoff-reroute-to-virtual-mta &quot;&quot;
backoff-retry-after 10m
backoff-to-normal-after never
backoff-to-normal-after-delivery no
backoff-upon-all-sources-disabled no
bcc-upon-delivery &quot;&quot;
bounce-after 4d12h
bounce-upon-5xx-greeting yes
bounce-upon-no-mx no
bounce-upon-pix-transfer-failure no
bounce-upon-transfer-failure no
check-spf-outbound no
connect-timeout 2m
data-send-timeout 3m
default-smtp-port 25
deliver-local-dsn yes
disable-acct-records &quot;&quot;
disable-mx-rollup no
disabled-source-ip-notify &quot;&quot;
dkim-add-body-limit no
dkim-add-timestamp no
dkim-algorithm rsa-sha256
dkim-body-canon relaxed
dkim-disallow-adding-headers &quot;&quot;
dkim-expire-after never
dkim-headers &quot;&quot;
dkim-headers-canon relaxed
dkim-identity sender-or-from
dkim-query-method &quot;&quot;
dkim-sign yes
ignore-8bitmime no
ignore-chunking yes
ignore-dsn no
ignore-pipelining no
log-commands no
log-connections no
log-data no
log-disabled-ips no
log-resolution yes
log-transfer-failures no
max-cold-virtual-mta-msg 0/d
max-connect-rate unlimited
max-errors-per-connection unlimited
max-events-recorded 10
max-msg-per-connection 20
max-msg-rate unlimited
max-rcpt-per-message 1000
max-smtp-out 20
mx-connection-attempts 10
notify-of-delay-every 4h
pix-bug-workaround yes
queue-priority 50
reenable-source-ip-after never
remove-header &quot;&quot;
replace-smtp-421-service-response no
require-starttls no
retry-after 10m
retry-recipients-after 600
retry-upon-new-mail no
reuse-ssl-session no
smtp-421-means-mx-unavailable no
smtp-553-means-invalid-mailbox yes
smtp-client-certificate &quot;&quot;
smtp-data-termination-timeout 10m
smtp-greeting-timeout 5m
smtp-hosts &quot;&quot;
smtp-multiple-line-response-timeout 5m
smtp-pattern-list &quot;&quot;
smtp-tls-allow-SSLv3 no
smtp-tls-allow-TLSv1 yes
smtp-tls-ca-file &quot;&quot;
sparkpost-ip-pool &quot;&quot;
sparkpost-sandbox no
track-recipient-events no
use-starttls yes
use-unencrypted-plain-auth no
</code></pre>
<hr />
<h3 id="show-status"><span class="header-section-number">6.3.16</span> <code>show status</code></h3>
<p>Displays various statistics and counters since last restart. The output includes totals, top throughput and queue information among other things.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta show status
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>$ pmta show status
PowerMTA v5.0 status on example.port25.com on 2018-09-10 10:16:19

  Traffic    ------------inbound------------  ------------outbound-----------
                 rcpts      msgs      kbytes      rcpts      msgs      kbytes
      Total     939437      5940    233409.5     939430    939430  34550887.2
  Last Hour     939437      5940    233409.5     939263    939263  34544775.4
   Top/Hour     939437      5940    233409.5     939263    939263  34544775.4
  Last Min.      45063       298     11632.6      45021     45021   1658056.5
   Top/Min.      69881       458     18005.6      69115     69115   2489680.7

 Connections    active       top     maximum  Domain       cached     pending
    Inbound          0         1           5    Names           2           0
   Outbound      10000     10000       10000

     Queues      rcpts   domains      kbytes  Spool        in use    recycled
       SMTP      99459      2895   3985272.8    Files        5667           0
      other          0         0         0.0    Init.                complete

     Status    running    Started  2018-09-10 20:02:12    Uptime   0  0:20:01
</code></pre>
<hr />
<h3 id="show-topdomains"><span class="header-section-number">6.3.17</span> <code>show topdomains</code></h3>
<p>For displaying the top domains in the queue sorted by number of recipients. Since this command is equivalent to <code>show domains --sort=rcpt</code>, please see <a href="#show-domains">show-domains</a> for more information on the various options.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta show topdomains [--vmta=name] [--connected={yes|no}] [--maxitems=n] [--errors]
</code></pre>
<hr />
<h3 id="show-topqueues"><span class="header-section-number">6.3.18</span> <code>show topqueues</code></h3>
<p>For displaying the top queues sorted by number of recipients. Since this command is equivalent to <code>show queues --sort=rcpt</code>, please see <a href="#show-queues">show-queues</a> for more information on the various options.</p>
<p><strong>Syntax:</strong></p>
<pre><code>show topqueues [--connected={yes|no}] [--mode={normal|backoff}] [--maxitems=n] [--errors] [--paused={yes|no}] [--no-rcpt-events] [domain[/vmta]
</code></pre>
<hr />
<h3 id="show-version"><span class="header-section-number">6.3.19</span> <code>show version</code></h3>
<p>Displays PowerMTA's version and build date.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta show version
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>$ pmta show ver
PowerMTA v5.0r1 (2019-09-13 16:27:31, 64-bit; master@190913.ba26ec5).
</code></pre>
<hr />
<h3 id="show-vmtas"><span class="header-section-number">6.3.20</span> <code>show vmtas</code></h3>
<p>This command displays a summary of the VirtualMTA(s) in use, as well as the number of recipients and message size in kilobytes within the VirtualMTA.</p>
<p><strong>Syntax:</strong></p>
<pre><code>show vmtas [--maxitems=n]
</code></pre>
<p><strong>Options</strong>:</p>
<p><strong><code>--maxitems=n</code></strong></p>
<blockquote>
<p>specifies the maximum number of queues to be displayed in the output. By default all vmtas are displayed.</p>
</blockquote>
<p><strong>Example:</strong></p>
<pre><code>name    domains #rcpt % total kbytes conn
------- ------- ----- ------- ------ ----
vmta572      13    18       2    0.1   16
vmta103       1     8       1    0.1    8
vmta118       2     8       1    0.1    5
vmta808       2     8       1    0.1    2
vmta261       7     8       1    0.1    3
vmta188       1     7       1    0.0    0
vmta863       4     6       0    0.0    5

7 of 7 virtual MTAs.
</code></pre>
<hr />
<h3 id="trace"><span class="header-section-number">6.3.21</span> <code>trace</code></h3>
<p>Instructs PowerMTA to open a connection to the specified domain and to attempt delivery of a single message from the queue. This command is similar to the <code>schedule</code> command, with the difference that it also automatically enables logging for the domain for the duration of one connection. If the <code>--to-log</code> switch is used, it is a shortcut to enabling logging in the configuration file, reloading the configuration, scheduling a call and undoing these changes when debugging is finished. By default, only the SMTP commands and responses are logged. The result of this command is written to the logging file.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta trace [--log-data] [--log-resolution] [--to-log] [--retry-recipients] [--source-ip=ip] domain/vmta
</code></pre>
<p><strong>Options</strong>:</p>
<p><strong><code>--log-data</code></strong></p>
<blockquote>
<p>this enables logging of data transfers as well, like the <code>log-data</code> option in the configuration file.</p>
</blockquote>
<p><strong><code>--log-resolution</code></strong></p>
<blockquote>
<p>this enables logging of the DNS resolution as well, like the <code>log-resolution</code> option in the configuration file.</p>
</blockquote>
<p><strong><code>--to-log</code></strong></p>
<blockquote>
<p>this enables logging trace info to the log file</p>
</blockquote>
<p><strong><code>--retry-recipients</code></strong></p>
<blockquote>
<p>Use of the retry-recipients flag will cause all the recipients of the queue that are in Await Retry bucket to become available for retry immediately.</p>
</blockquote>
<p><strong><code>--source-ip</code></strong></p>
<blockquote>
<p>Specifies the source IP used for connection attempts from a virtual mta with multiple smtp-source-hosts configured in it</p>
</blockquote>
<p><strong><code>domain[/vmta]</code></strong></p>
<blockquote>
<p>name of the queue(s) to display, where <em>domain</em> is the destination domain name and <em>vmta</em> is the VirtualMTA. If omitted, both <em>domain</em> and <em>vmta</em> default to <code>*</code> (i.e., <code>*/*</code>), which matches all queues.</p>
</blockquote>
<p><strong>Example:</strong></p>
<pre><code>$ pmta trace yahoo.com
2019-02-07 22:31:24 starting port25.com/{default}
2019-02-07 22:31:24 connecting from foo.port25.com (::) to ASPMX.L.GOOGLE.com (2607:f8b0:400e:c07::1a)
2019-02-07 22:31:24 connected from [2600:1a17:a893:9b59:dac9:5dr1:de28:5324]:39339
2019-02-07 22:31:24 &gt;&gt;&gt; 220 mx.google.com ESMTP u2si198147pgp.592 - gsmtp
2019-02-07 22:31:24 &lt;&lt;&lt; EHLO foo.port25.com
2019-02-07 22:31:24 &gt;&gt;&gt; 250-mx.google.com at your service
2019-02-07 22:31:24 &gt;&gt;&gt; 250-SIZE 157286400
2019-02-07 22:31:24 &gt;&gt;&gt; 250-8BITMIME
2019-02-07 22:31:24 &gt;&gt;&gt; 250-STARTTLS
2019-02-07 22:31:24 &gt;&gt;&gt; 250-ENHANCEDSTATUSCODES
2019-02-07 22:31:24 &gt;&gt;&gt; 250-PIPELINING
2019-02-07 22:31:24 &gt;&gt;&gt; 250-CHUNKING
2019-02-07 22:31:24 &gt;&gt;&gt; 250 SMTPUTF8
2019-02-07 22:31:24 &lt;&lt;&lt; STARTTLS
2019-02-07 22:31:24 &gt;&gt;&gt; 220 2.0.0 Ready to start TLS
2019-02-07 22:31:24 tls:TLSv1.2 connected with 128-bit ECDHE-RSA-AES128-GCM-SHA256
2019-02-07 22:31:24 tls:Cert: /C=US/ST=California/L=Mountain View/O=Google LLC/CN=mx.google.com; issuer=/C=US/O=Google Trust Services/CN=Google Internet Authority G3; verified=no
2019-02-07 22:31:24 &lt;&lt;&lt; EHLO foo.port25.com
2019-02-07 22:31:24 &gt;&gt;&gt; 250-mx.google.com at your service
2019-02-07 22:31:24 &gt;&gt;&gt; 250-SIZE 157286400
2019-02-07 22:31:24 &gt;&gt;&gt; 250-8BITMIME
2019-02-07 22:31:24 &gt;&gt;&gt; 250-ENHANCEDSTATUSCODES
2019-02-07 22:31:24 &gt;&gt;&gt; 250-PIPELINING
2019-02-07 22:31:24 &gt;&gt;&gt; 250-CHUNKING
2019-02-07 22:31:24 &gt;&gt;&gt; 250 SMTPUTF8
2019-02-07 22:31:24 &lt;&lt;&lt; QUIT
2019-02-07 22:31:24 &gt;&gt;&gt; 221 2.0.0 closing connection u2si198147pgp.592 - gsmtp
2019-02-07 22:31:24 closed ASPMX.L.GOOGLE.com (2607:f8b0:400e:c07::1a) in=511 out=68
2019-02-07 22:31:24 done port25.com/{default}
</code></pre>
<hr />
<h3 id="delete"><span class="header-section-number">6.3.22</span> <code>delete</code></h3>
<p>Deletes recipients from the queue. Although <code>--queue</code>'s default is <code>*/*</code>, the command requires either <code>--queue</code> or <code>--jobId</code> to be entered explicitly, so that an accidental <code>pmta delete</code> command doesn't delete the entire queue. Messages are marked in the accounting file as deleted by administrator.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta delete [--dsn] [--queue=domain[/vmta]] [--orig=addr] [--rcpt=addr] [--jobId=id] [--envId=id] [--older-than=time-interval] [--no-accounting]
</code></pre>
<p><strong>Options</strong>:</p>
<p><strong><code>--dsn</code></strong></p>
<blockquote>
<p>specifies that a DSN report should be sent. Using this option may slow the deletion process. No entry is written to the accounting file unless the <code>--accounting</code> flag is used as well.</p>
</blockquote>
<p><strong><code>--queue</code></strong></p>
<blockquote>
<p>specifies which queue(s) to delete from, and defaults to all queues.</p>
</blockquote>
<p><strong><code>--orig</code></strong></p>
<blockquote>
<p>specifies that only recipients with the given MAIL FROM address be deleted</p>
</blockquote>
<p><strong><code>--rcpt</code></strong></p>
<blockquote>
<p>specifies that only recipient(s) with the given address are to be deleted</p>
</blockquote>
<p><strong><code>--jobId</code></strong></p>
<blockquote>
<p>specifies that only recipients with the given Job ID are to be deleted</p>
</blockquote>
<p><strong><code>--envId</code></strong></p>
<blockquote>
<p>specifies that only recipients with the given Envelope ID are to be deleted</p>
</blockquote>
<p><strong><code>--no-accounting</code></strong></p>
<blockquote>
<p>specifies that deletion information will not be written to the accounting file</p>
</blockquote>
<p><strong><code>--older-than</code></strong></p>
<blockquote>
<p>deletes all the recipients in the given queue that are older than the given from the current time. The syntax for the time interval is same as the syntax used to specify <code>bounce-after</code> in the configuration file.</p>
</blockquote>
<p><strong>Example:</strong></p>
<pre><code>$ pmta delete --queue=yahoo.com/*
</code></pre>
<hr />
<h3 id="pause-queue"><span class="header-section-number">6.3.23</span> <code>pause queue</code></h3>
<p>Pause delivery of messages for the given queue and prevents them from being delivered until they are resumed.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta pause queue domain[/vmta]
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>$ pmta pause queue */customer1
Queue(s) paused.
</code></pre>
<hr />
<h3 id="pause-job"><span class="header-section-number">6.3.24</span> <code>pause job</code></h3>
<p>Pause delivery of messages for the given jobID, and prevents them from being delivered until they are resumed.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta pause job jobid
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>$ pmta pause job campaign1234
paused job.
</code></pre>
<hr />
<h3 id="resume-queue"><span class="header-section-number">6.3.25</span> <code>resume queue</code></h3>
<p>Resumes delivery of messages in the queue.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta resume queue domain[/vmta]
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>$ pmta resume queue */customer1
Queue(s) resumed.
</code></pre>
<hr />
<h3 id="resume-job"><span class="header-section-number">6.3.26</span> <code>resume job</code></h3>
<p>Resumes delivery of messages matching the given jobID.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta resume job jobid
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>$ pmta resume job campaign1234
resumed job.
</code></pre>
<hr />
<h3 id="list"><span class="header-section-number">6.3.27</span> <code>list</code></h3>
<p>Lists recipients matching the provided options.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta list [--queue=domain[/vmta]] [--orig=addr] [--rcpt=addr] [--jobId=id] [--envId=id] [--maxitems=n] [--older-than=time-interval] [--pause] [--priority] [--schedule]
</code></pre>
<p><strong>Options</strong>:</p>
<p><strong><code>--queue</code></strong></p>
<blockquote>
<p>specifies which queue(s) to list from, and defaults to all queues.</p>
</blockquote>
<p><strong><code>--orig</code></strong></p>
<blockquote>
<p>specifies that only recipients with the given MAIL FROM address be listed</p>
</blockquote>
<p><strong><code>--rcpt</code></strong></p>
<blockquote>
<p>specifies that only recipients with the given RCPT TO address are to be listed.</p>
</blockquote>
<p><strong><code>--jobId</code></strong></p>
<blockquote>
<p>specifies that only recipients with the given Job ID are to be listed</p>
</blockquote>
<p><strong><code>--envId</code></strong></p>
<blockquote>
<p>specifies that only recipients with the given Envelope ID are to be listed.</p>
</blockquote>
<p><strong><code>--maxitems=n</code></strong></p>
<blockquote>
<p>specifies the maximum number of recipients to be displayed in the output. By default 100 recipients are displayed.</p>
</blockquote>
<p><strong><code>--pause</code></strong></p>
<blockquote>
<p>if recipient is being actively delivered, pause the delivery to enable showing the recipient in the output</p>
</blockquote>
<p><strong><code>--priority</code></strong></p>
<blockquote>
<p>display the priority of each recipient in the output of the command</p>
</blockquote>
<p><strong><code>--schedule</code></strong></p>
<blockquote>
<p>display the per-recipient schedule in the output of the command</p>
</blockquote>
<p><strong><code>--older-than=&lt;time interval&gt;</code></strong></p>
<blockquote>
<p>displays recipients that have been in the queue for longer than the specified time interval. For example, <code>--older-than=24h</code> will list all recipients that have been in the queue for longer than 24 hours. Other examples of valid time intervals are <code>6h</code>, <code>2h15m</code>, <code>4d12h</code>.</p>
</blockquote>
<p><strong>Example:</strong></p>
<pre><code>$ pmta list --queue=yahoo.com/vmta1
</code></pre>
<hr />
<h3 id="show-license"><span class="header-section-number">6.3.28</span> <code>show license</code></h3>
<p>Allows listing license information from the command line.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta show license
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>$ pmta show license
  product: PowerMTA
  version: 5.0
 platform: linux-intel
    units: 0
instances: 1
 licensee: Foo Corp
   serial: 238478
   issued: 2016-12-10
  expires: 2100-03-20
copyright: Port25 Solutions, Inc.  All Rights Reserved
</code></pre>
<hr />
<h3 id="deregister"><span class="header-section-number">6.3.29</span> <code>deregister</code></h3>
<p>Deregisters a node for PowerMTA Management Console. This command will delete all data that has not yet been loaded into PowerMTA Management Console. This does not effect the user configured accounting files.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta deregister [--user=name] [--local-only] [--retain-unloaded]
</code></pre>
<p><strong>Options</strong>:</p>
<p><strong><code>--user</code></strong></p>
<blockquote>
<p>specifies the PowerMTA Management Console user account to use when deregistering</p>
</blockquote>
<p><strong><code>--local-only</code></strong></p>
<blockquote>
<p>only deregisters locally, registration will still exist in PowerMTA Management Console.</p>
</blockquote>
<p><strong><code>--retain-unloaded</code></strong></p>
<blockquote>
<p>prevents deleting accounting files that have not yet been loaded from PowerMTA into PMC. Useful when needing to deregister and then reregister without losing any data.</p>
</blockquote>
<p><strong>Example:</strong></p>
<pre><code>$ pmta deregister --retain-unloaded
Deregistration successful.
You may still need to remove this PowerMTA node manually from PowerMTA Management Console.
</code></pre>
<hr />
<h3 id="digest"><span class="header-section-number">6.3.30</span> <code>digest</code></h3>
<p>Calculates the hash of the given string using the specified algorithm, either HMAC-SHA256 or Siphash, and a key, provided either as a regular string using the --key option, or as a hexadecimal value using the --hex-key option.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta digest [--hmac-sha256] [--siphash] [--key=string] [--hexkey=string] string
</code></pre>
<p><strong>Options</strong>:</p>
<p><strong><code>--hmac-sha256</code></strong></p>
<blockquote>
<p>specifies the usage of the HMAC-SHA256 hashing algorithm. Cannot be combined with <code>--siphash</code>.</p>
</blockquote>
<p><strong><code>--siphash</code></strong></p>
<blockquote>
<p>specifies the usage of the Siphash hashing algorithm. A key of size 0 - 16 bytes must be provided. Keys less than 16 bytes will be end-padded with 0x00 (null-bytes) to reach 16 bytes. A key larger than 16 bytes will not be accepted. Cannot be combined with <code>--hmac-sha256</code>.</p>
</blockquote>
<p><strong><code>--key=string</code></strong></p>
<blockquote>
<p>specifies a regular string to be used as the key for the hashing algorithm. Cannot be combined with <code>--hexkey=string</code>.</p>
</blockquote>
<p><strong><code>--hexkey=string</code></strong></p>
<blockquote>
<p>specifies a hexadecimal string to be used as the key for the hashing algorithm. Cannot be combined with <code>--key=string</code>.</p>
</blockquote>
<p><strong>Examples:</strong></p>
<pre><code>$ pmta digest --hmac-sha256 --key=secretkey port25
Result: 614648A140A88192D375C22E606BEC922E8CFA71A5063C067E6BE7CB49C506AA

$ pmta digest --siphash --key=secretkey port25
Result: EB938A2508145899

$ pmta digest --hmac-sha256 --hexkey=1234abcd port25
Result: 3BB5D751EB1C3ECCD12C10B315DADEBA35C3A6DF822E44A347FC01B38001477A

$ pmta digest --siphash --hexkey=1234abcd port25
Result: D343D887797D2CFB
</code></pre>
<hr />
<h3 id="register"><span class="header-section-number">6.3.31</span> <code>register</code></h3>
<p>Registers a node with PowerMTA Management Console.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta register [--user=name] [--label=name] [--webmon-ip=ip] [--webmon-port=number]
[--pmtamc-port=number] [--reuse-label] pmtamc-hostname
</code></pre>
<p><strong>Options</strong>:</p>
<p><strong><code>--user</code></strong></p>
<blockquote>
<p>PowerMTA Management Console user to be used for registration</p>
</blockquote>
<p><strong><code>--label</code></strong></p>
<blockquote>
<p>Name of PowerMTA instance that will be shown in PowerMTA Management Console</p>
</blockquote>
<p><strong><code>--webmon-ip</code></strong></p>
<blockquote>
<p>IP address for PowerMTA Management Console to connect to PowerMTA instance</p>
</blockquote>
<p><strong><code>--webmon-port</code></strong></p>
<blockquote>
<p>Port for PowerMTA Management Console to connect to PowerMTA instance</p>
</blockquote>
<p><strong><code>--pmtamc-port</code></strong></p>
<blockquote>
<p>PowerMTA Management Console port to be used for registration</p>
</blockquote>
<p><strong><code>--reuse-label</code></strong></p>
<blockquote>
<p>If label was previously used, but deregistered, this allows label to be used again</p>
</blockquote>
<p><strong><code>--pmtamc-hostname</code></strong></p>
<blockquote>
<p>PowerMTA Management Console server to be used for registration</p>
</blockquote>
<p><strong>Example:</strong></p>
<pre><code>$ pmta register --label=pmta1server central.yourdomain.com
PowerMTA Management Console &quot;admin&quot; password:
Registration successful.
PowerMTA Management Console certificate fingerprint:
0B:1D:EC:9C:8F:20:4E:06:55:2C:A8:9B:A1:A6:05:C7:DD:07:93:01

For best security, please verify that the above value is the same as the one displayed on PowerMTA
Management Console&#39;s PowerMTA Management page.
</code></pre>
<hr />
<h3 id="show-registration"><span class="header-section-number">6.3.32</span> <code>show registration</code></h3>
<p>Shows current PowerMTA Management Console registration information.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta show registration
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>$ pmta show registration
Currently registered with PowerMTA Management Console cental.yourdomain.com:8181 as &quot;pmta1server&quot;
PowerMTA Management Console certificate fingerprint:
0B:1D:EC:9C:8F:20:4E:06:55:2C:A8:9B:A1:A6:05:C7:DD:07:93:01
</code></pre>
<hr />
<h3 id="disable-source"><span class="header-section-number">6.3.33</span> <code>disable source</code></h3>
<p>Disables the given source IP from being used for delivering email from the given queue.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta disable source [--reenable-after=interval] ip domain[/vmta]
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>$ pmta disable source --reenable-after=1h 1.2.3.4 yahoo.com/vmta1
</code></pre>
<hr />
<h3 id="enable-source"><span class="header-section-number">6.3.34</span> <code>enable source</code></h3>
<p>Enables the given source IP to be used for delivering email from the given queue.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta enable source ip domain[/vmta]
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>$ pmta enable source 1.2.3.4 yahoo.com/vmta1
</code></pre>
<hr />
<h3 id="show-disabled-sources"><span class="header-section-number">6.3.35</span> <code>show disabled sources</code></h3>
<p>Shows currently disabled source IPs for the given queue.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta show disabled sources [domain[/vmta]]
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>$ pmta show disabled sources yahoo.com/vmta1
</code></pre>
<hr />
<h3 id="show-precache"><span class="header-section-number">6.3.36</span> <code>show precache</code></h3>
<p>Shows currently precached domains.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta show precache
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>$ pmta show precache
</code></pre>
<hr />
<h3 id="set-priority"><span class="header-section-number">6.3.37</span> <code>set priority</code></h3>
<p>Sets priority for individual messages that match the given criteria.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta set priority [--queue=domain[/vmta]] [--orig=addr] [--rcpt=addr] [--jobId=id] [--envId=id] number
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>$ pmta set priority --rcpt=ceo@example.com 100
</code></pre>
<hr />
<h3 id="test-config"><span class="header-section-number">6.3.38</span> <code>test config</code></h3>
<p>Can be used to verify whether the syntax of the configuration file is correct without reloading PMTA's running configuration.</p>
<p><strong>Syntax:</strong></p>
<pre><code>pmta test config
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>$ pmta test config
Error in line 11 of /etc/pmta/config: argument missing
</code></pre>
<hr />
<h1 id="application-programming-interfaces"><span class="header-section-number">7</span> Application Programming Interfaces</h1>
<p>PowerMTA includes various programming interfaces (APIs) intended to facilitate the creation of email enabled applications and to optimize the way in which messages are submitted to PowerMTA. The following APIs are available:</p>
<ul>
<li><p>submission APIs, for submitting email from Perl, Java, .NET, C++, and C programs.</p></li>
<li><p>a "pickup" directory, for submitting pre-formatted email by copying it into a directory.</p></li>
<li><p>"pipe" delivery, for delivering email to a local program.</p></li>
</ul>
<p>Use of the APIs may require the use of the <a href="#always-allow-api-submission">always-allow-api-submission</a> directive.</p>
<p>On Windows Server, any applicable API materials can be found in the api subdirectory within the folder into which PowerMTA was installed. On Linux, these can be found on <code>/opt/pmta/api</code>.</p>
<h2 id="submission-apis"><span class="header-section-number">7.1</span> Submission APIs</h2>
<p>The submission APIs allow you to programmatically submit messages for delivery by PowerMTA. Since most users already have pre-formatted messages to send, the APIs mostly concern themselves with the transport of such messages. However, they do include a <code>Date:</code> header generator and a Base64 encoder to facilitate the jobs of those creating messages from scratch.</p>
<p>The submission APIs are object-oriented and comprise three objects:</p>
<ul>
<li><p>a <code>Connection</code> which represents a connection to a PowerMTA server.</p></li>
<li><p>a <code>Message</code> which represents the message being submitted.</p></li>
<li><p>a <code>Recipient</code> which represents the message's recipients.</p></li>
</ul>
<p>The general procedure for submitting a message is pretty straightforward:</p>
<ul>
<li><p>connect to a PowerMTA server by creating a <code>Connection</code>.</p></li>
<li><p>create a <code>Message</code>.</p></li>
<li><p>create one or more <code>Recipient</code>s and add them to the <code>Message</code>.</p></li>
<li><p>add headers and body to the <code>Message</code> by invoking the <code>addData</code> method one or more times.</p></li>
<li><p>submit the message by invoking the <code>Connection</code>'s <code>submit</code> method, passing the <code>Message</code> to it.</p></li>
</ul>
<p>Other methods are available to set various delivery options, select automatic data encoding, etc. See the language-specific sections below for more information.</p>
<p><strong>NOTE</strong>: The submission API doesn't have any clear advantage over the SMTP connection in terms of speed except in the cases where mailmerge is used and multiple recipients are sent per message.</p>
<h3 id="requirements"><span class="header-section-number">7.1.1</span> Requirements</h3>
<p>The submission APIs can be run remotely or locally, as they use a modified version of SMTP.</p>
<p>Applications using the submission APIs must also have the proper authorization. On Windows Server, programs must run under either the <code>SYSTEM</code> account or under an account belonging to the Administrators group.</p>
<p>On Unix, programs must either run as <code>root</code> or from an username who belongs to the <code>pmta</code> group. The <code>pmta</code> group is created automatically during PowerMTA's installation.</p>
<p>The following are required when using the Perl, .NET, or Java APIs:</p>
<ul>
<li><p>Perl 5.12 or newer when using the Perl API</p></li>
<li><p>.NET 2.0 or better when using the .NET API</p></li>
<li><p>Java 6 or better (for JavaMail: JavaMail and Java Activation Framework from Sun's download site as detailed in the JavaDoc from the archive) when using the Java API</p></li>
<li><p>PowerMTA needs to be configured with <code>always-allow-relaying yes</code> and <code>allow-mailmerge yes</code> for the appropriate <code>&lt;source&gt;</code>. <code>always-allow-api-submission yes</code> can be used as well, as this will set <code>allow-mailmerge yes</code>. If you want to use authentication you need to define users and passwords and allow auth for the source.</p></li>
<li><p>It is recommend to add no more than 5000 recipients per batch submission. In the event that the batch fails, this will affect fewer recipients. Also, this helps keep memory usage to a minimum.</p></li>
</ul>
<h3 id="perl-submission-api"><span class="header-section-number">7.1.2</span> Perl Submission API</h3>
<p>To install on Linux, the <code>Submitter</code> package is distributed in the standard CPAN format, so you will need to unpack, compile and install as follows:</p>
<pre><code># cd /opt/pmta/api
# tar -xzf Port25-Submitter-1.5.tar.gz
# cd Port25-Submitter-1.5
# perl Makefile.PL
# make test
# make install
</code></pre>
<p>To install on Windows, use the following commands (possibly changing the path first). Currently only Perl 5.6 is supported:</p>
<pre><code>ppm install --location=C:\pmta\api Port25-Submitter
ppm install --location=C:\pmta\api Port25-Accounter
</code></pre>
<p>Documentation for the perl APIs is provided in perldoc format. The APIs are available from the download site.</p>
<pre><code>perldoc Port25::Submitter
perldoc Port25::Submitter::Connection
perldoc Port25::Submitter::Message
perldoc Port25::Submitter::Recipient

</code></pre>
<h3 id="java-submission-api"><span class="header-section-number">7.1.3</span> Java Submission API</h3>
<p>To use the Java API, include <code>pmta.jar</code> in your classpath. If you want to use PowerMTA with Oracle's JavaMail API, install the provided <code>javamail.providers</code> file according to your system configuration. See the JavaMail documentation for details.</p>
<p>Documentation for the Java APIs is provided in JavaDoc format.</p>
<p>On Windows, it can be found in the <code>pmtajavadoc.zip</code> file in the <code>api\java</code> subdirectory of where PowerMTA was installed.</p>
<p>On Linux, it can be found in the <code>/opt/pmta/api/java/doc/javadoc</code> directory as <code>/opt/pmta/api/java/doc/javadoc/index.html</code>.</p>
<h3 id="c-submission-api"><span class="header-section-number">7.1.4</span> C++ Submission API</h3>
<p>In C++, the three objects described in <a href="#submission-apis">Submission APIs</a> are available in the include files <code>submitter/Connection.hxx</code>, <code>submitter/Message.hxx</code> and <code>submitter/Recipient.hxx</code>.</p>
<p>On Windows, you can find these files in the <code>api\include</code> subdirectory of where PowerMTA was installed. On Linux, that is <code>/opt/pmta/api/include</code>.</p>
<p>All the methods in the submission API throw an exception in case of an error. Any errors render the object unusable, after which you should discard it.</p>
<hr />
<h4 id="connectionconnection"><span class="header-section-number">7.1.4.1</span> Connection::Connection</h4>
<p>Creates a new connection.</p>
<pre><code>Connection(const char* server, int port, const char* name = &quot;&quot;, const char*  password = &quot;&quot;)
</code></pre>
<ul>
<li><code>server</code> server to which to connect, either as an numeric IP address or a host name.</li>
<li><code>port</code> port number to connect to; use 25 for the default SMTP port.</li>
<li><code>name</code> user name for authentication with the remote server. Leave name and password empty if you don't want to use authentification.</li>
<li><code>password</code> password to use for authentication. Authentication is done with CRAM-MD5, so no password is ever sent to the remote server.</li>
</ul>
<hr />
<h4 id="connectionsubmit"><span class="header-section-number">7.1.4.2</span> Connection::submit</h4>
<p>Submits a message for delivery.</p>
<pre><code>void Connection::submit(const Message&amp; message)
</code></pre>
<hr />
<h4 id="messagemessage"><span class="header-section-number">7.1.4.3</span> Message::Message</h4>
<p>Creates a new message.</p>
<pre><code>Message::Message(const char* originator)
</code></pre>
<ul>
<li><code>originator</code> the new message's originator.</li>
</ul>
<hr />
<h4 id="messagesetverp"><span class="header-section-number">7.1.4.4</span> Message::setVerp</h4>
<p>Sets whether this message should use the VERP extension.</p>
<pre><code>void Message::setVerp(bool isVerp)
</code></pre>
<hr />
<h4 id="messagesetreturntype"><span class="header-section-number">7.1.4.5</span> Message::setReturnType</h4>
<p>Sets the type of message return requested in delivery reports.</p>
<pre><code>void Message::setReturnType(PmtaMsgRETURN type)
</code></pre>
<ul>
<li><code>type</code> should be one of:
<ul>
<li><code>PmtaMsgRETURN_HEADERS</code> (default) return only this message's headers</li>
<li><code>PmtaMsgRETURN_FULL</code> return the full message headers and body</li>
</ul></li>
</ul>
<hr />
<h4 id="messagesetenvelopeid"><span class="header-section-number">7.1.4.6</span> Message::setEnvelopeId</h4>
<p>Sets this message's envelope ID.</p>
<pre><code>void Message::setEnvelopeId(const char* envelopeId)
</code></pre>
<hr />
<h4 id="messagesetvirtualmta"><span class="header-section-number">7.1.4.7</span> Message::setVirtualMta</h4>
<p>Selects the VirtualMTA to use for this message.</p>
<pre><code>void Message::setVirtualMta(const char* virtualMta)
</code></pre>
<hr />
<h4 id="messagesetjobid"><span class="header-section-number">7.1.4.8</span> Message::setJobId</h4>
<p>Sets the job id for this message. This tags the message as belonging to the specified job.</p>
<pre><code>void Message::setJobId(const char* jobId)
</code></pre>
<ul>
<li><code>jobId</code> id of the job (printable, non-white space characters only).</li>
</ul>
<hr />
<h4 id="messageaddrecipient"><span class="header-section-number">7.1.4.9</span> Message::addRecipient</h4>
<p>Adds a recipient to this message. Do not make any changes to a recipient after it has been added to the message.</p>
<pre><code>void Message::addRecipient(const Recipient&amp; r)
</code></pre>
<hr />
<h4 id="messagesetencoding"><span class="header-section-number">7.1.4.10</span> Message::setEncoding</h4>
<p>Sets the kind of encoding to perform on data. The encoding applies to all thereafter added data. The actual processing performed depends on the encoding selected: <code>PmtaMsgENCODING_7BIT</code> and <code>PmtaMsgENCODING_8BIT</code> both select the identity encoding, i.e., no transformation is performed on the data, except that any lines terminated with LF alone are converted to CRLF. In the case of 7-bit encoding, it is your responsibility to ensure that all bytes have their high bit off. <code>PmtaMsgENCODING_BASE64</code> specifies that any data added shall be encoded on the fly using base-64 encoding. No transformation is performed on the data prior to encoding, making it possible to transmit binary content. Note, however, that to effectively transmit binary data, you must also provide the appropriate MIME headers. In fact, the selected encoding should, in general, agree with the Content-Transfer-Encoding header you specify. The default (if this method is never invoked) is <code>PmtaMsgENCODING_7BIT</code>.</p>
<pre><code>void Message::setEncoding(PmtaMsgENCODING encoding)
</code></pre>
<ul>
<li><code>encoding</code> Data encoding desired. This should be one of:
<ul>
<li><code>PmtaMsgENCODING_7BIT</code></li>
<li><code>PmtaMsgENCODING_8BIT</code></li>
<li><code>PmtaMsgENCODING_BASE64</code></li>
</ul></li>
</ul>
<hr />
<h4 id="messagebeginpart"><span class="header-section-number">7.1.4.11</span> Message::beginPart</h4>
<p>Starts the next mailmerge part which will have the given number. Note that part 1 is started automatically, so the first settable number is 2.</p>
<pre><code>void Message::beginPart(int partNum)
</code></pre>
<ul>
<li><code>partNum</code> positive integer for the part number. No part number may be specified more than once.</li>
</ul>
<hr />
<h4 id="messageadddata"><span class="header-section-number">7.1.4.12</span> Message::addData</h4>
<p>Appends data to this message. Use this method to give this message both its headers and a body. How the data you add is handled depends on the kind of encoding selected (see <code>setEncoding</code>). All the data is entered as-is, with no mailmerge variable substitution being performed. To add mailmerge data, use <code>addMergeData</code>.</p>
<pre><code>void Message::addData(const char* data, int length)
</code></pre>
<ul>
<li><code>data</code> data to append (as-is).</li>
<li><code>length</code> length of the data block.</li>
</ul>
<hr />
<h4 id="messageadddata-1"><span class="header-section-number">7.1.4.13</span> Message::addData</h4>
<p>Appends null-terminated data to this message. This is a convenience method to facilitate adding C strings directly.</p>
<pre><code>void Message::addData(const char* data)
</code></pre>
<ul>
<li><code>data</code> null-terminated data to append (as-is).</li>
</ul>
<hr />
<h4 id="messageaddmergedata"><span class="header-section-number">7.1.4.14</span> Message::addMergeData</h4>
<p>Appends merge data to this message. Use this method to give this message both its headers and a body. How the data you add is handled depends on the kind of encoding selected (see <code>setEncoding</code>). Currently only 7-bit and 8-bit encodings are supported. If any mailmerge variables are included in the data, they will be substituted by their respective values.</p>
<pre><code>void Message::addMergeData(const char* data, int length)
</code></pre>
<ul>
<li><code>data</code> data to append.</li>
<li><code>length</code> length of the data block.</li>
</ul>
<hr />
<h4 id="messageaddmergedata-1"><span class="header-section-number">7.1.4.15</span> Message::addMergeData</h4>
<p>Appends null-terminated merge data to this message. This is a convenience method to facilitate adding C strings directly.</p>
<pre><code>void Message::addMergeData(const char* data)
</code></pre>
<ul>
<li><code>data</code> null-terminated merge data to append.</li>
</ul>
<hr />
<h4 id="messageadddateheader"><span class="header-section-number">7.1.4.16</span> Message::addDateHeader</h4>
<p>Adds (appends) a Date: header to this message. This method appends a date header line to the message. It is provided as a convenience function.</p>
<pre><code>void Message::addDateHeader()
</code></pre>
<hr />
<h4 id="recipientrecipient"><span class="header-section-number">7.1.4.17</span> Recipient::Recipient</h4>
<p>Creates a new recipient with the given email address.</p>
<pre><code>Recipient::Recipient(const char* address)
</code></pre>
<hr />
<h4 id="recipientsetnotify"><span class="header-section-number">7.1.4.18</span> Recipient::setNotify</h4>
<p>Sets the kind of notification (report) desired for this recipient. By default, notification is only requested upon delivery failure.</p>
<pre><code>void Recipient::setNotify(int notifyWhen)
</code></pre>
<ul>
<li><code>notifyWhen</code> should be either <code>PmtaRcptNOTIFY_NEVER</code> to indicate that no notification is desired, or one or more of the following flags (joined by a bitwise OR):
<ul>
<li><code>PmtaRcptNOTIFY_SUCCESS</code> notify in case the delivery is successful</li>
<li><code>PmtaRcptNOTIFY_FAILURE</code> notify in case of a delivery failure</li>
<li><code>PmtaRcptNOTIFY_DELAY</code> notify in case of a delay in the delivery</li>
</ul></li>
</ul>
<hr />
<h4 id="recipientdefinevariable"><span class="header-section-number">7.1.4.19</span> Recipient::defineVariable</h4>
<p>Defines a new mailmerge variable for this recipient. PowerMTA will substitute the variable for its value during delivery of a mailmerge message. Carriage returns and line feeds may be added to a variable with <code>\r</code> or <code>\n</code> respectively.</p>
<pre><code>void Recipient::defineVariable(char* name, char* value)
</code></pre>
<ul>
<li><code>name</code> the variable's name.</li>
<li><code>value</code> the variable's value.</li>
</ul>
<p><strong>Examples:</strong></p>
<pre><code>Recipient rcpt(&quot;me@here.com&quot;);
rcpt.defineVariable(&quot;cr&quot;, &quot;A\rB&quot;);             // one linebreak
rcpt.defineVariable(&quot;lf&quot;, &quot;A\nB&quot;);             // one linebreak
rcpt.defineVariable(&quot;crLf&quot;, &quot;A\r\nB&quot;);         // one linebreak
rcpt.defineVariable(&quot;literalCrLf&quot;, &quot;A\\r\\nB&quot;);  // no linebreaks
</code></pre>
<hr />
<h3 id="c-submission-api-1"><span class="header-section-number">7.1.5</span> C Submission API</h3>
<p>In C, the three objects described in <a href="#submission-apis">Submission APIs</a> are available as sets of functions which share a common prefix. <code>Connection</code>'s functions all begin with <code>PmtaConn</code> and are defined in the file <code>submitter/PmtaConn.h</code>. <code>Message</code>'s functions all begin with <code>PmtaMsg</code> and are defined in the file <code>submitter/PmtaMsg.h</code>; and <code>Recipient</code>'s functions all begin with <code>PmtaRcpt</code> and are defined in the file <code>submitter/PmtaRcpt.h</code>.</p>
<p>On Windows, you can find these files in the <code>api\include</code> subdirectory of where PowerMTA was installed. On Linux, that is <code>/opt/pmta/api/include</code>.</p>
<p>In order to differentiate between "out of memory" conditions and other errors, object creation is split in two calls: allocation and initialization. To create an object, you first call its <code>...Alloc</code> function. If memory cannot be allocated, a null pointer is returned; otherwise, a pointer to the object is returned, which you then pass to the object's initialization function: <code>PmtaConnConnect</code>, <code>PmtaMsgInit</code> and <code>PmtaRcptInit</code>, for a <code>Connection</code>, <code>Message</code> or <code>Recipient</code> object, respectively.</p>
<p>When done with an object, you should call the object's <code>...Free</code> method to discard its resources.</p>
<p>Most of the functions in the submission API return a <code>BOOL</code> (boolean) value. You should check every return value to make sure that no errors occurred. If an error occurs, you can find out what went wrong by calling either <code>PmtaConnGetLastError</code>, <code>PmtaMsgGetLastError</code> or <code>PmtaRcptGetLastError</code> (depending on which object the error occurred). Any errors render the object unusable, after which you should discard it with the appropriate <code>...Free</code> function.</p>
<hr />
<h4 id="pmtaconnalloc"><span class="header-section-number">7.1.5.1</span> PmtaConnAlloc</h4>
<p>Allocates a new connection. After allocating, invoke <code>PmtaConnConnectRemote</code> to establish the connection to the PowerMTA server. It returns the new connection, or 0 if not enough memory was available.</p>
<pre><code>PmtaConn PmtaConnAlloc()
</code></pre>
<hr />
<h4 id="pmtaconnconnect"><span class="header-section-number">7.1.5.2</span> PmtaConnConnect</h4>
<p><strong>Deprecated</strong> Use one of <code>..Connect</code> functions below.</p>
<hr />
<h4 id="pmtaconnconnectremote"><span class="header-section-number">7.1.5.3</span> PmtaConnConnectRemote</h4>
<p>Connects to a PowerMTA server. No login / authentication is done. Returns <code>TRUE</code> in case of success, <code>FALSE</code> in case of failure. The cause of the error can be obtained with <code>PmtaConnGetLastError</code>.</p>
<pre><code>PMTACALL(BOOL) PmtaConnConnectRemote(PmtaConn connection, const char* server, int port);
</code></pre>
<ul>
<li><code>connection</code> connection to establish.</li>
<li><code>server</code> string containing the server to which to connect. This can be a host name or an IP address. Use "127.0.0.1" for the local machine.</li>
<li><code>port</code> which port to connect to. Use 25 for the default SMTP port.</li>
</ul>
<hr />
<h4 id="pmtaconnconnectremoteauth"><span class="header-section-number">7.1.5.4</span> PmtaConnConnectRemoteAuth</h4>
<p>Connects to a PowerMTA server using the given credentials. Returns <code>TRUE</code> in case of success, <code>FALSE</code> in case of failure. The cause of the error can be obtained with <code>PmtaConnGetLastError</code>.</p>
<pre><code>PMTACALL(BOOL) PmtaConnConnectRemoteAuth(PmtaConn connection,
                                         const char* server, int port,
                                         const char* username,
                                         const char* password);
</code></pre>
<ul>
<li><code>connection</code> connection to establish.</li>
<li><code>server</code> string containing the server to which to connect. This can be a host name or an IP address.</li>
<li><code>port</code> to which port to connect. Use 25 for the default SMTP port.</li>
<li><code>username</code> local user name for logging in to PowerMTA. PowerMTA must be configured to allow authentication.</li>
<li><code>password</code> password for the given user name.</li>
</ul>
<hr />
<h4 id="pmtaconnsubmit"><span class="header-section-number">7.1.5.5</span> PmtaConnSubmit</h4>
<p>Submits a message for delivery. Returns <code>TRUE</code> in case of success, <code>FALSE</code> in case of failure. The cause of the error can be obtained with <code>PmtaConnGetLastError</code>.</p>
<pre><code>BOOL PmtaConnSubmit(PmtaConn connection, PmtaMsg message)
</code></pre>
<ul>
<li><code>connection</code> connection through which to submit the message.</li>
<li><code>message</code> message to submit.</li>
</ul>
<hr />
<h4 id="pmtaconnfree"><span class="header-section-number">7.1.5.6</span> PmtaConnFree</h4>
<p>Discards this connection object, freeing any resouces used by it. This automatically closes the connection to the server, if any.</p>
<pre><code>void PmtaConnFree(PmtaConn connection)
</code></pre>
<ul>
<li><code>connection</code> connection to discard.</li>
</ul>
<hr />
<h4 id="pmtaconngetlasterror"><span class="header-section-number">7.1.5.7</span> PmtaConnGetLastError</h4>
<p>Returns the last error that occurred on this connection. This function should only be called immediately after an error occurred.</p>
<pre><code>const char* PmtaConnGetLastError(PmtaConn connection)
</code></pre>
<ul>
<li><code>connection</code> connection to query for an error.</li>
</ul>
<hr />
<h4 id="pmtaconngetlasterrortype"><span class="header-section-number">7.1.5.8</span> PmtaConnGetLastErrorType</h4>
<p>Returns the type of the last error occurred (one of the <code>PmtaApiERROR</code> codes defined in <code>PmtaApi.h</code>.). This function should only be called immediately after an error occurred.</p>
<pre><code>int PmtaConnGetLastErrorType(PmtaConn connection)
</code></pre>
<ul>
<li><code>connection</code> connection to query for an error.</li>
</ul>
<hr />
<h4 id="pmtamsgalloc"><span class="header-section-number">7.1.5.9</span> PmtaMsgAlloc</h4>
<p>Allocates a new message. Once allocated, the new message must be initialized with PmtaMsgInit. Once done with the message, invoke PmtaMsgFree to free its resources. Returns 0 if not enough memory was available.</p>
<pre><code>PmtaMsg PmtaMsgAlloc()
</code></pre>
<hr />
<h4 id="pmtamsginit"><span class="header-section-number">7.1.5.10</span> PmtaMsgInit</h4>
<p>Initializes a new message. Returns <code>TRUE</code> in case of success, <code>FALSE</code> in case of failure. The cause of the error can be obtained with <code>PmtaMsgGetLastError</code>.</p>
<pre><code>BOOL PmtaMsgInit(PmtaMsg message, const char* originator)
</code></pre>
<ul>
<li><code>message</code> Newly allocated message to initialize.</li>
<li><code>originator</code> Address for the new message's originator.</li>
</ul>
<hr />
<h4 id="pmtamsgfree"><span class="header-section-number">7.1.5.11</span> PmtaMsgFree</h4>
<p>Frees memory allocated for this message.</p>
<pre><code>void PmtaMsgFree(PmtaMsg message)
</code></pre>
<hr />
<h4 id="pmtamsgsetverp"><span class="header-section-number">7.1.5.12</span> PmtaMsgSetVerp</h4>
<p>Sets whether this is a VERP message. If you enable VERP, PowerMTA will encode both the originator and recipient addresses in the originator address used for delivering the message. This may make tracking any bounces easier, since you can always derive the original addresses from the address where the bounce is sent. Returns <code>TRUE</code> in case of success, <code>FALSE</code> in case of failure. The cause of the error can be obtained with <code>PmtaMsgGetLastError</code>.</p>
<pre><code>BOOL PmtaMsgSetVerp(PmtaMsg message, BOOL isVerp)
</code></pre>
<ul>
<li><code>message</code> Message to set.</li>
<li><code>isVerp</code> <code>TRUE</code> if the message should be VERP.</li>
</ul>
<hr />
<h4 id="pmtamsgsetreturntype"><span class="header-section-number">7.1.5.13</span> PmtaMsgSetReturnType</h4>
<p>Sets the type of message return requested in delivery reports. Returns <code>TRUE</code> in case of success, <code>FALSE</code> in case of failure. The cause of the error can be obtained with <code>PmtaMsgGetLastError</code>.</p>
<pre><code>BOOL PmtaMsgSetReturnType(PmtaMsg message, PmtaMsgRETURN type)
</code></pre>
<ul>
<li><code>message</code> Message to set.</li>
<li><code>type</code> This should be one of:
<ul>
<li><code>PmtaMsgRETURN_HEADERS</code> (default) return only this message's headers</li>
<li><code>PmtaMsgRETURN_FULL</code> return the full message headers and body</li>
</ul></li>
</ul>
<hr />
<h4 id="pmtamsgsetenvelopeid"><span class="header-section-number">7.1.5.14</span> PmtaMsgSetEnvelopeId</h4>
<p>Sets this message's envelope ID. Returns <code>TRUE</code> in case of success, <code>FALSE</code> in case of failure. The cause of the error can be obtained with <code>PmtaMsgGetLastError</code>.</p>
<pre><code>BOOL PmtaMsgSetEnvelopeId(PmtaMsg message, const char* envelopeId)
</code></pre>
<ul>
<li><code>message</code> Message to set.</li>
<li><code>envelopeId</code> Envelope ID for this message.</li>
</ul>
<hr />
<h4 id="pmtamsgsetvirtualmta"><span class="header-section-number">7.1.5.15</span> PmtaMsgSetVirtualMta</h4>
<p>Selects the VirtualMTA to use for this message. Returns <code>TRUE</code> in case of success, <code>FALSE</code> in case of failure. The cause of the error can be obtained with <code>PmtaMsgGetLastError</code>.</p>
<pre><code>BOOL PmtaMsgSetVirtualMta(PmtaMsg message, const char* virtualMta)
</code></pre>
<ul>
<li><code>message</code> Message to set.</li>
<li><code>virtualMta</code> name of the VirtualMTA to use.</li>
</ul>
<hr />
<h4 id="pmtamsgsetjobid"><span class="header-section-number">7.1.5.16</span> PmtaMsgSetJobId</h4>
<p>Sets the job id for this message. This tags the message as belonging to the specified job. Returns <code>TRUE</code> in case of success, <code>FALSE</code> in case of failure. The cause of the error can be obtained with <code>PmtaMsgGetLastError</code>.</p>
<pre><code>BOOL PmtaMsgSetJobId(PmtaMsg message, const char* jobId)
</code></pre>
<ul>
<li><code>message</code> Message to set.</li>
<li><code>jobId</code> id of the job, printable, non-white space characters only.</li>
</ul>
<hr />
<h4 id="pmtamsgaddrecipient"><span class="header-section-number">7.1.5.17</span> PmtaMsgAddRecipient</h4>
<p>Adds a recipient to this message. Returns <code>TRUE</code> in case of success, <code>FALSE</code> in case of failure. The cause of the error can be obtained with <code>PmtaMsgGetLastError</code>.</p>
<p>Do not make any changes to a recipient after it has been added to the message. Once added, a recipient should be freed with <code>PmtaRcptFree</code>.</p>
<pre><code>BOOL PmtaMsgAddRecipient(PmtaMsg message, PmtaRcpt recipient)
</code></pre>
<ul>
<li><code>message</code> Message to set.</li>
<li><code>recipient</code> Recipient to add.</li>
</ul>
<hr />
<h4 id="pmtamsgsetencoding"><span class="header-section-number">7.1.5.18</span> PmtaMsgSetEncoding</h4>
<p>Sets the kind of encoding to perform on data. The encoding applies to all thereafter added data. The actual processing performed depends on the encoding selected: <code>PmtaMsgENCODING_7BIT</code> and <code>PmtaMsgENCODING_8BIT</code> both select the identity encoding, i.e., no transformation is performed on the data, except that any lines terminated with LF alone are converted to CRLF. In the case of 7-bit encoding, it is your responsibility to ensure that all bytes have their high bit off. <code>PmtaMsgENCODING_BASE64</code> specifies that any data added shall be encoded on the fly using base-64 encoding. No transformation is performed on the data prior to encoding, making it possible to transmit binary content. Note, however, that to effectively transmit binary data, you must also provide the appropriate MIME headers. In fact, the selected encoding should, in general, agree with the <code>Content-Transfer-Encoding</code> header you specify. The default (if this function is never invoked) is <code>PmtaMsgENCODING_7BIT</code>. Returns <code>TRUE</code> in case of success, <code>FALSE</code> in case of failure. The cause of the error can be obtained with <code>PmtaMsgGetLastError</code>.</p>
<pre><code>BOOL PmtaMsgSetEncoding(PmtaMsg message, PmtaMsgENCODING encoding)
</code></pre>
<ul>
<li><code>message</code> Message to set.</li>
<li><code>encoding</code> Data encoding desired. This should be one of:
<ul>
<li><code>PmtaMsgENCODING_7BIT</code></li>
<li><code>PmtaMsgENCODING_8BIT</code></li>
<li><code>PmtaMsgENCODING_BASE64</code></li>
</ul></li>
</ul>
<hr />
<h4 id="pmtamsgbeginpart"><span class="header-section-number">7.1.5.19</span> PmtaMsgBeginPart</h4>
<p>Starts the next mailmerge part which will have the given number. Note that part 1 is started automatically, so the first settable number is 2. Returns <code>TRUE</code> in case of success, <code>FALSE</code> in case of failure. The cause of the error can be obtained with <code>PmtaMsgGetLastError</code>.</p>
<pre><code>BOOL PmtaMsgBeginPart(PmtaMsg message, int partNum)
</code></pre>
<ul>
<li><code>message</code> Message to set.</li>
<li><code>partNum</code> positive integer for the part number. No part number may be specified more than once.</li>
</ul>
<hr />
<h4 id="pmtamsgadddata"><span class="header-section-number">7.1.5.20</span> PmtaMsgAddData</h4>
<p>Adds (appends) data to this message. Use this function to give this message both its headers and a body. How the data you add is handled depends on the kind of encoding selected (see PmtaMsgSetEncoding). All the data is entered as-is, with no mailmerge variable substitution being performed. To add mailmerge data, use <code>PmtaMsgAddMergeData</code>. Returns <code>TRUE</code> in case of success, <code>FALSE</code> in case of failure. The cause of the error can be obtained with <code>PmtaMsgGetLastError</code>.</p>
<pre><code>BOOL PmtaMsgAddData(PmtaMsg message, const char* data, int length)
</code></pre>
<ul>
<li><code>message</code> Message to which to add.</li>
<li><code>data</code> Data to add.</li>
<li><code>length</code> Length of the data block.</li>
</ul>
<hr />
<h4 id="pmtamsgaddmergedata"><span class="header-section-number">7.1.5.21</span> PmtaMsgAddMergeData</h4>
<p>Adds (appends) mailmerge data to this message. Use this function to give this message both its headers and a body. How the data you add is handled depends on the kind of encoding selected (see PmtaMsgSetEncoding). Currently only 7-bit and 8-bit encodings are supported. If any mailmerge variables are included in the data, they will be substituted by their respective values. Returns <code>TRUE</code> in case of success, <code>FALSE</code> in case of failure. The cause of the error can be obtained with <code>PmtaMsgGetLastError</code>.</p>
<pre><code>BOOL PmtaMsgAddMergeData(PmtaMsg message, const char* data, int length)
</code></pre>
<ul>
<li><code>message</code> Message to which to add.</li>
<li><code>data</code> Merge data to add.</li>
<li><code>length</code> Length of the data block.</li>
</ul>
<hr />
<h4 id="pmtamsgaddstring"><span class="header-section-number">7.1.5.22</span> PmtaMsgAddString</h4>
<p>Adds (appends) a string to this message. This function is identical to <code>PmtaMsgAddData</code>, except that it expects a '0'-terminated string and computes the length of the data automatically. It is provided as a convenience function only. Returns <code>TRUE</code> in case of success, <code>FALSE</code> in case of failure. The cause of the error can be obtained with <code>PmtaMsgGetLastError</code>.</p>
<pre><code>BOOL PmtaMsgAddString(PmtaMsg message, const char* str)
</code></pre>
<ul>
<li><code>message</code> Message to which to add.</li>
<li><code>str</code> Null-terminated string to add.</li>
</ul>
<hr />
<h4 id="pmtamsgaddmergestring"><span class="header-section-number">7.1.5.23</span> PmtaMsgAddMergeString</h4>
<p>Adds (appends) a mailmerge string to this message. This function is identical to <code>PmtaMsgAddMergeData,</code> except that it expects a '0'-terminated string and computes the length of the data automatically. It is provided as a convenience function only. Returns <code>TRUE</code> in case of success, <code>FALSE</code> in case of failure. The cause of the error can be obtained with <code>PmtaMsgGetLastError</code>.</p>
<pre><code>BOOL PmtaMsgAddMergeString(PmtaMsg message, const char* str)
</code></pre>
<ul>
<li><code>message</code> Message to which to add.</li>
<li><code>str</code> Null-terminated string to add.</li>
</ul>
<hr />
<h4 id="pmtamsgadddateheader"><span class="header-section-number">7.1.5.24</span> PmtaMsgAddDateHeader</h4>
<p>Adds (appends) a Date: header to this message. This function appends a date header line to the message. It is provided as a convenience function only.</p>
<pre><code>BOOL PmtaMsgAddDateHeader(PmtaMsg message)
</code></pre>
<hr />
<h4 id="pmtamsggetlasterror"><span class="header-section-number">7.1.5.25</span> PmtaMsgGetLastError</h4>
<p>Returns the last error that occurred on this message. This function should only be called immediately after an error occurred.</p>
<pre><code>const char* PmtaMsgGetLastError(PmtaMsg message)
</code></pre>
<ul>
<li><code>message</code> Message to query for an error.</li>
</ul>
<hr />
<h4 id="pmtamsggetlasterrortype"><span class="header-section-number">7.1.5.26</span> PmtaMsgGetLastErrorType</h4>
<p>Returns the type of the last error occurred (one of the <code>PmtaApiERROR</code> codes defined in <code>PmtaApi.h</code>). This function should only be called immediately after an error occurred.</p>
<pre><code>int PmtaMsgGetLastErrorType(PmtaMsg message)
</code></pre>
<ul>
<li><code>message</code> Message to query for an error.</li>
</ul>
<hr />
<h4 id="pmtarcptalloc"><span class="header-section-number">7.1.5.27</span> PmtaRcptAlloc</h4>
<p>Allocates a new recipient. Once allocated, the new recipient must be initialized with <code>PmtaRcptInit</code>. When no longer needed (e.g., after adding the recipient to a message), its resources should be freed by calling <code>PmtaRcptFree</code>. Returns 0 if not enough memory was available.</p>
<pre><code>PmtaRcpt PmtaRcptAlloc()
</code></pre>
<hr />
<h4 id="pmtarcptinit"><span class="header-section-number">7.1.5.28</span> PmtaRcptInit</h4>
<p>Initializes a new recipient. Returns <code>TRUE</code> in case of success, <code>FALSE</code> in case of failure. The cause of the error can be obtained with <code>PmtaMsgGetLastError</code>.</p>
<pre><code>BOOL PmtaRcptInit(PmtaRcpt recipient, const char* address)
</code></pre>
<ul>
<li><code>recipient</code> Newly allocated recipient to initialize.</li>
<li><code>address</code> email address for the recipient.</li>
</ul>
<hr />
<h4 id="pmtarcptfree"><span class="header-section-number">7.1.5.29</span> PmtaRcptFree</h4>
<p>Frees storage allocated by this recipient. To avoid memory leaks, this function should be called on every recipient allocated, whether it has been added to a message or not.</p>
<pre><code>void PmtaRcptFree(PmtaRcpt recipient)
</code></pre>
<hr />
<h4 id="pmtarcptsetnotify"><span class="header-section-number">7.1.5.30</span> PmtaRcptSetNotify</h4>
<p>Sets the kind of notification (report) desired for this recipient. By default, notification is only requested upon delivery failure. Returns <code>TRUE</code> in case of success, <code>FALSE</code> in case of failure. The cause of the error can be obtained with <code>PmtaMsgGetLastError</code>.</p>
<pre><code>BOOL PmtaRcptSetNotify(PmtaRcpt recipient, int notifyWhen)
</code></pre>
<ul>
<li><code>recipient</code> Recipient to set</li>
<li><code>notifyWhen</code> This should be either <code>PmtaRcptNOTIFY_NEVER</code> to indicate that no notification is desired, or one or more of the following flags (joined by a bitwise OR):
<ul>
<li><code>PmtaRcptNOTIFY_SUCCESS</code> notify in case the delivery is successful</li>
<li><code>PmtaRcptNOTIFY_FAILURE</code> notify in case of a delivery failure</li>
<li><code>PmtaRcptNOTIFY_DELAY</code> notify in case of a delay in the delivery</li>
</ul></li>
</ul>
<hr />
<h4 id="pmtarcptdefinevariable"><span class="header-section-number">7.1.5.31</span> PmtaRcptDefineVariable</h4>
<p>Defines a new mailmerge variable for this recipient. PowerMTA will substitute the variable for its value during delivery of a mailmerge message. Carriage returns and line feeds may be added to a variable with <code>\r</code> or <code>\n</code> respectively (Assuming that rcpt is of type <code>PmtaRcpt</code> and is properly initialized). Returns <code>TRUE</code> in case of success, <code>FALSE</code> in case of failure. The cause of the error can be obtained with <code>PmtaMsgGetLastError</code>.</p>
<pre><code>BOOL PmtaRcptDefineVariable(PmtaRcpt recipient, const char* name, const char* value)
</code></pre>
<ul>
<li><code>recipient</code> recipient whose variable is being defined.</li>
<li><code>name</code> the variable's name.</li>
<li><code>value</code> the variable's value.</li>
</ul>
<p><strong>Examples:</strong></p>
<pre><code>if (!PmtaRcptDefineVariable(rcpt, &quot;cr&quot;, &quot;A\rB&quot;)) {      // one linebreak
    fprintf(stderr, &quot;Error defining cr variable: %s\n&quot;,
                    PmtaRcptGetLastError(rcpt));
    return 1;
}
if (!PmtaRcptDefineVariable(rcpt, &quot;lf&quot;, &quot;A\nB&quot;)) {      // one linebreak
    fprintf(stderr, &quot;Error defining lf variable: %s\n&quot;,
                    PmtaRcptGetLastError(rcpt));
    return 1;
}
if (!PmtaRcptDefineVariable(rcpt, &quot;crlf&quot;, &quot;A\r\nB&quot;)) {  // one linebreak
    fprintf(stderr, &quot;Error defining crlf variable: %s\n&quot;,
                    PmtaRcptGetLastError(rcpt));
    return 1;
}

if (!PmtaRcptDefineVariable(rcpt, &quot;literalCrlf&quot;, &quot;A\\r\\nB&quot;)) {  // no linebreaks
    fprintf(stderr, &quot;Error defining literalCrlf variable: %s\n&quot;,
                    PmtaRcptGetLastError(rcpt));
    return 1;
}
</code></pre>
<hr />
<h4 id="pmtarcptgetlasterror"><span class="header-section-number">7.1.5.32</span> PmtaRcptGetLastError</h4>
<p>Returns the last error occurred on this recipient. This function should only be called immediately after an error occurred.</p>
<pre><code>const char* PmtaRcptGetLastError(PmtaRcpt recipient)
</code></pre>
<ul>
<li><code>recipient</code> Recipient to query for an error.</li>
</ul>
<hr />
<h4 id="pmtarcptgetlasterrortype"><span class="header-section-number">7.1.5.33</span> PmtaRcptGetLastErrorType</h4>
<p>Returns the type of the last error occurred (one of the <code>PmtaApiERROR</code> codes defined in <code>PmtaApi.h</code>). This function should only be called immediately after an error occurred.</p>
<pre><code>int PmtaRcptGetLastErrorType(PmtaRcpt recipient)
</code></pre>
<ul>
<li><code>recipient</code> Recipient to query for an error.</li>
</ul>
<hr />
<h3 id="net-submission-api"><span class="header-section-number">7.1.6</span> .NET Submission API</h3>
<p>Documentation for the .NET APIs is provided in doc folder.</p>
<p>On Windows, it can be found in the <code>api\dotnet</code> subdirectory of where PowerMTA was installed.</p>
<h2 id="pickup-directory"><span class="header-section-number">7.2</span> Pickup Directory</h2>
<p>PowerMTA can be instructed to pick up message files from a directory. To submit a message, you write it to a file, formatting it according to Internet email standards but preceding it with envelope information in special headers: <code>x-sender</code>, <code>x-receiver</code> and, optionally, <code>x-envid</code> and <code>x-job</code>. You then move this file to the pickup directory, from where PowerMTA reads it into its message spool and performs delivery. It is recommend to add no more than 5000 recipients per pickup file.</p>
<p>The <code>x-sender</code> header should be in the first line in the file, followed by one or more <code>x-receiver</code> headers, each in its own line. You can also optionally set the DSN envelope ID and the job ID by adding the <code>x-envid</code> and <code>x-job</code> headers respectively. The <code>x-sender</code> and <code>x-receiver</code> headers must contain the email addresses only, with <em>no</em> free form name, no <code>&lt;&gt;</code>s, etc. For example:</p>
<pre><code>x-sender: me@over.here
x-receiver: you@over.there
x-receiver: someone.else@some.other.place
x-envid: me-0001
x-job: love-2003-01
From: Myself Personally &lt;me@over.here&gt;
To: You &lt;you@over.there&gt;
Date: Thu, 6 Jul 2000 07:45:43 -0400
Subject: I love it

Hey, did you know that ...
</code></pre>
<p>Note that in the example above, <code>someone.else@some.other.place</code> is BCC'ed, i.e., blind copied: he or she receives a copy of the message but is not included in the recipient headers.</p>
<p>PowerMTA's pickup directory also supports the <code>x-sender-override</code> header, which allows you to override the contents of <code>x-sender</code>. If <code>x-sender-override</code> is present, its contents override the sender specified in <code>x-sender</code>, if any. This is useful when you wish to customize the message sender despite the software you're using to create the messages not allowing for that. Typically that software will still allow you to pass additional headers, such as <code>x-sender-override</code>.</p>
<p>Other than reading the sender and receiver email address headers and removing them from the message, no other header or body processing takes place. You are responsible for properly formatting the message.</p>
<p>Instead of creating the file elsewhere and then moving to the pickup directory, it is also possible to create the file directly in it. However, since PowerMTA must repeatedly attempt to lock the file for exclusive access, it is less efficient to do so.</p>
<p>To configure PowerMTA for a pickup directory, specify the <a href="#pickup">pickup</a> directory. You must also specify a directory as the "bad mail" directory, to which messages are moved if there is a permanent error processing the message.</p>
<h3 id="bsmtp-files"><span class="header-section-number">7.2.1</span> BSMTP files</h3>
<p>The pickup directory also supports BSMTP (batched SMTP) files. A BSMTP file is simply a file that contains all of the SMTP commands necessary for submitting a message batched together in one text file. For example:</p>
<pre><code>MAIL FROM:&lt;me@over.here&gt;
RCPT TO:&lt;you@over.there&gt;
DATA
From: Myself Personally &lt;me@over.here&gt;
To: You &lt;you@over.there&gt;
Date: Thu, 6 Jul 2000 07:45:43 -0400
Subject: I love it

Hey, did you know that ...
.
</code></pre>
<p>The pickup directory supports the following SMTP commands: <code>HELO</code>, <code>EHLO</code>, <code>MAIL</code>, <code>RCPT</code> and <code>DATA</code>. Additionally, it also supports PowerMTA's extended SMTP mailmerge commands (<code>XMRG</code>, <code>XDFN</code>, <code>XPRT</code> and <code>XACK</code>), allowing for both mailmerge and non-mailmerge messages to be created.</p>
<p>To be recognized as such, BSMTP files need not be marked in any special way, other than the first command be one of: <code>HELO</code>, <code>EHLO</code>, <code>MAIL</code>, <code>XACK</code> or <code>XACK</code>.</p>
<p>Like in traditional pickup files, only one message may be submitted per file. However, since mailmerge is supported, the message submitted may actually be a template used for many recipients. See <a href="#pickup-directory-submission">Pickup Directory Submission</a> for examples on using the pickup directory for submitting mailmerge messages.</p>
<p>If any commands cannot be successfully processed, the entire file is rejected and moved to the "bad file" directory. For certain recipient address related errors, however, you have the option of requesting that PowerMTA bounce the recipient rather than rejecting the file during submission. This is activated by disabling recipient acknowledgements, using PowerMTA's <code>XACK</code> SMTP extension. For example:</p>
<pre><code>XACK OFF
MAIL FROM:&lt;me@over.here&gt;
RCPT TO:&lt;you@over.there&gt;
RCPT TO:&lt;notyou@not..here&gt;
DATA
From: Me Personally &lt;me@over.here&gt;
To: (recipients omitted)
Date: Thu, 6 Jul 2000 07:45:43 -0400
Subject: I love it

Hey, did you know that ...
.
</code></pre>
<p>In the example above, despite the error in the second recipient's domain, the file would not be rejected, but a bounce would be sent to the address in the MAIL FROM.</p>
<p><a href="#mailmerge-smtp-extensions">Mailmerge SMTP extensions</a> describes PowerMTA's mailmerge extensions; look at <a href="#the-xack-smtp-extension">The XACK SMTP extension</a> for the <code>XACK</code> extension.</p>
<h2 id="pipe-delivery"><span class="header-section-number">7.3</span> Pipe Delivery</h2>
<p>PowerMTA can be configured to deliver email to another program on the same machine. It does so by starting the program for each new recipient and writing the message to the program's standard input. The mechanism used to pass on the message is called "pipe", so this feature is named "pipe delivery".</p>
<p>To use pipe delivery, you add domain definitions for one or more domains, specifying a type of pipe and defining the command to run for starting the pipe receiver program. For example:</p>
<pre><code>&lt;domain bounces.company.com&gt;
    type pipe
    command &quot;c:\\path\\bounceproc.exe --envid $envid&quot;
&lt;/domain&gt;
</code></pre>
<p>Note that since the backslash character is also used for escaping other characters (such as spaces, quotes and the dollar sign), you need to specify it twice where you want just one to appear. On Windows, you can also use the (forward) slash character to specify paths, so in the example above it could have been <code>c:/path/bounceproc.exe</code>.</p>
<p>Before starting the program, PowerMTA substitutes any macros found in the command line (such as <code>$envid</code> in the example above), allowing you to pass on additional message-related parameters to the pipe receiver program. The complete list of macros supported and other configuration directives for pipe domains are described in <a href="#pipe-delivery-directives">Pipe Delivery Directives</a>.</p>
<h3 id="delivering-mail-to-local-users"><span class="header-section-number">7.3.1</span> Delivering mail to local users</h3>
<p>PowerMTA's pipe delivery can be used to deliver email to local users. The special <code>local</code> domain name makes this simple to configure by concentrating all email destined to recipients on any of the local domains. PowerMTA will use the hostname of the OS and any <code>host-name</code>s configured in PowerMTA, to determine if an email is local. On Unix systems, it is often sufficient to specify procmail as the command to execute for pipe delivery:</p>
<pre><code>&lt;domain local&gt;
    type pipe
    command &quot;/usr/bin/procmail -t -Y -d $user&quot;
&lt;/domain&gt;
</code></pre>
<p>Note, however, that PowerMTA does not currently process the <code>/etc/aliases</code> or <code>.forward</code> files.</p>
<p>Alternatively, the same could be done be explicitly specifying the domain name as in this example:</p>
<pre><code>&lt;domain bounces.yourdomain.com&gt;
    type pipe
    command &quot;/usr/bin/procmail -t -Y -d $user&quot;
&lt;/domain&gt;
</code></pre>
<p>The same is also available on Windows, but you will need to provide a pipe delivery processor that can write the messages in a way your user agents (i.e., email clients) understand.</p>
<h3 id="pipe-delivery-programs-included-with-powermta"><span class="header-section-number">7.3.2</span> Pipe Delivery Programs Included With PowerMTA</h3>
<p>PowerMTA comes with two (fully functional) sample programs to be used with the new pipe delivery functionality; <code>appendtofile</code>, which appends messages to a file, and <code>newfile</code>, which writes each message to a separate (new) file.</p>
<p><strong><code>appendtofile</code></strong> appends the message and / or arguments passed to it to the file specified. The syntax for appendtofile is:</p>
<pre><code>appendtofile [--nomsg] filename [text]
</code></pre>
<ul>
<li>where <em>filename</em> is the name of the file to which to append the data and <em>text</em> is an optional text or a supported macro to write in front of each message. If the first command line argument given to appendtofile is --nomsg (or /nomsg), it will just apppend the text or the macro's value to the file. You can thus choose to either save the complete message to the file or just the summary data passed on the command line, such as only the recipient address of the message (when using the $to macro).</li>
</ul>
<p><strong><code>newfile</code></strong> writes each message to a separate (new) file. The syntax for newfile is simply:</p>
<pre><code>newfile dirname
</code></pre>
<ul>
<li>where <em>dirname</em> is the directory where the message file should be created. If the given directory does not yet exist, newfile automatically creates it. Each message file name is automatically generated by newfile, and will have a '.msg' extension.</li>
</ul>
<p>For greatest flexibility, you can use the supported macro substitutions described in <a href="#pipe-delivery-directives">Pipe Delivery Directives</a> to automatically pass message-dependent file names and directory names. For example, <code>appendtofile c:/pipe/$domain</code> in the <code>command</code> directive will append messages to the file named after the domain of the recipient address, given the presence of the <code>$domain</code> macro. A message sent to <code>test@port25.com</code> would be appended to a file named <code>port25.com</code> in the directory <code>c:\pipe</code>, while a message sent to <code>test@powermta.com</code> would be appended to a file named <code>powermta.com</code> in the same directory.</p>
<p>In the typical scenario where the pipe delivery applications are used to store and process bounces, using the <code>$domain</code> macro results in files named after the originator / SMTP <code>MAIL FROM</code> domain you used in your original messages, since the recipient address of a bounce report is the original <code>MAIL FROM</code> address used.</p>
<p>For example, if you used a <code>MAIL FROM</code> domain of <code>bounces5.port25.com</code> for all of your messages for customer or campaign ID#5, the file <code>bounces5.port25.com</code> would contain the bounce reports for the messages of this customer or campaign. The configuration for this would be:</p>
<pre><code>&lt;domain bounces5.port25.com&gt;
    type pipe
    command &quot;c:/pmta/bin/appendtofile.exe c:/pipe/$domain&quot;
&lt;/domain&gt;
</code></pre>
<p>Alternatively, with the <code>--nomsg</code> and passing the <code>$to</code> macro to <code>appendtofile</code> as well, like in:</p>
<pre><code>&lt;domain bounces5.port25.com&gt;
    type pipe
    command &quot;c:/pmta/bin/appendtofile.exe --nomsg c:/pipe/$domain $to&quot;
&lt;/domain&gt;
</code></pre>
<p>only the recipients would be written to a file (given the <code>$to</code>), which is named after the domain of the recipients (given the <code>$domain</code>), <code>port25.com</code>.</p>
<p>With <code>newfile</code>, if you had a configuration like:</p>
<pre><code>&lt;domain bounces5.port25.com&gt;
    type pipe
    command &quot;c:/pmta/bin/newfile.exe c:/pipe/$domain&quot;
&lt;/domain&gt;
</code></pre>
<p><code>newfile</code> will create subdirectories named after the recipients' domains, and only create message files within the appropriate subdirectories. Using the example above with the domain <code>bounces5.port25.com</code> as the domain of your originator address, when bounces come in, the directory created would be <code>c:\pipe\bounces5.port25.com</code>, and which would contain only files / messages received for the recipients of that domain. If you had PowerMTA handling inbound mail for 50 separate domains, <code>newfile</code> would create 50 separate subdirectories, each named for a different domain, and containing only messages for that domain.</p>
<h3 id="accessing-files-created-by-the-sample-applications"><span class="header-section-number">7.3.3</span> Accessing Files Created By The Sample Applications</h3>
<p>Since, in principle, new messages may be delivered at any time through the sample applications, special care must be taken when accessing the files these applications create to avoid loss of data</p>
<p><code>newfile</code> solves concurrency conflicts by using a naming convention: it initially creates files with a <code>.tmp</code> suffix ("extension") and when done writing to them, renames them to <code>.msg</code>. This makes it very easy to access the files: you can freely access all the <code>.msg</code> files, while leaving any <code>.tmp</code> files alone.</p>
<p>Doing the same for <code>appendtofile</code> is a little more challenging, since it writes data to the same file and due to the differences in file lock handling across the PowerMTA platforms. To allow access to <code>appendtofile</code>-generated files in a simple and uniform way, SparkPost provides a program named <code>pmtagetfile</code>, which moves the contents of a given file.</p>
<p>To use <code>pmtagetfile</code>, you simply run it passing the name of the file to which <code>appendtofile</code> writes and the new destination file name on the command line. For example,</p>
<pre><code>pmtagetfile c:/pmta-pipe/port25.com.txt c:/tmp/port25.com.txt
</code></pre>
<p>moves the file <code>c:\pmta-pipe\port25.com.txt</code> to <code>c:\tmp\port25.com.txt</code>.</p>
<p>Once in the new directory, the file is out of <code>appendtofile</code>'s reach, and you can safely process it as required. Note that the <code>pmtagetfile</code> program will fail if the first file listed does not exist (nothing to copy from) or if the second file already exists (preventing accidental overwriting of previous data). Also, <code>pmtagetfile</code> does not work across file system boundaries, i.e., the the new file must be on the same file system or drive (on Unix and Windows systems, respectively). To move a file to a different file system, use <code>pmtagetfile</code> to first move it away from <code>appendtofile</code> to a safe place on the same file system, and then move that file with your usual tools (Explorer, shell commands, etc.) to the desired location.</p>
<p>Please note that <code>pmtagetfile</code> is only intended for use with files written by <code>appendtofile</code> or with files written to by File Delivery.</p>
<h3 id="writing-your-own-pipe-delivery-programs"><span class="header-section-number">7.3.4</span> Writing Your Own Pipe Delivery Programs</h3>
<p>For convenience and flexibility, the sample pipe delivery programs detailed above are also provided in source code, allowing you to modify or customize as needed.</p>
<p>The program used for pipe delivery should terminate with certain specific exit codes. On Unix systems, these are defined in <code>/usr/include/sysexits.h</code>. On Windows, a corresponding file is included in the <code>api\include</code> directory. Depending on the exit code, PowerMTA will consider the delivery to have succeeded or to have temporarily or permanently failed and generate any DSN delivery reports as appropriate:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">exit code</th>
<th style="text-align: center;">action</th>
<th style="text-align: left;">DSN status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">EX_OK</td>
<td style="text-align: center;">delete</td>
<td style="text-align: left;">2.0.0 (success)</td>
</tr>
<tr class="even">
<td style="text-align: left;">EX_USAGE</td>
<td style="text-align: center;">bounce</td>
<td style="text-align: left;">5.5.4 (invalid command arguments)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EX_NOUSER</td>
<td style="text-align: center;">bounce</td>
<td style="text-align: left;">5.1.1 (bad destination mailbox address)</td>
</tr>
<tr class="even">
<td style="text-align: left;">EX_NOHOST</td>
<td style="text-align: center;">bounce</td>
<td style="text-align: left;">5.1.2 (bad destination system address)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EX_CANTCREAT</td>
<td style="text-align: center;">bounce</td>
<td style="text-align: left;">5.2.0 (mailbox-related failure)</td>
</tr>
<tr class="even">
<td style="text-align: left;">EX_UNAVAILABLE</td>
<td style="text-align: center;">bounce</td>
<td style="text-align: left;">5.3.0 (mail system-related failure)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EX_SOFTWARE</td>
<td style="text-align: center;">bounce</td>
<td style="text-align: left;">5.3.0 (mail system-related failure)</td>
</tr>
<tr class="even">
<td style="text-align: left;">EX_OSFILE</td>
<td style="text-align: center;">bounce</td>
<td style="text-align: left;">5.3.0 (mail system-related failure)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EX_NOINPUT</td>
<td style="text-align: center;">bounce</td>
<td style="text-align: left;">5.3.0 (mail system-related failure)</td>
</tr>
<tr class="even">
<td style="text-align: left;">EX_OSERR</td>
<td style="text-align: center;">retry</td>
<td style="text-align: left;">4.3.0 (mail system-related failure)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EX_IOERR</td>
<td style="text-align: center;">retry</td>
<td style="text-align: left;">4.3.0 (mail system-related failure)</td>
</tr>
<tr class="even">
<td style="text-align: left;">EX_TEMPFAIL</td>
<td style="text-align: center;">retry</td>
<td style="text-align: left;">4.0.0 (transient failure)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EX_DATAERR</td>
<td style="text-align: center;">bounce</td>
<td style="text-align: left;">5.5.2 (syntax error)</td>
</tr>
<tr class="even">
<td style="text-align: left;">EX_PROTOCOL</td>
<td style="text-align: center;">bounce</td>
<td style="text-align: left;">5.5.0 (protocol-related failure)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EX_CONFIG</td>
<td style="text-align: center;">bounce</td>
<td style="text-align: left;">5.3.5 (system incorrectly configured)</td>
</tr>
<tr class="even">
<td style="text-align: left;">EX_NOPERM</td>
<td style="text-align: center;">bounce</td>
<td style="text-align: left;">5.7.1 (delivery not authorized)</td>
</tr>
</tbody>
</table>
<p>If you use <code>appendtofile</code> but for some reason would like to replace <code>pmtagetfile</code>, please look into <code>pmtagetfile</code>'s sources first to better understand how it works to avoid file locking conflicts.</p>
<h1 id="virtualmta-support"><span class="header-section-number">8</span> VirtualMTA Support</h1>
<h2 id="overview-2"><span class="header-section-number">8.1</span> Overview</h2>
<p>Increasing volumes of email have prompted many ISPs and email administrators to proactively filter or block incoming email. While their intentions are honest, this also results in the blocking of legitimate mail for sites running on or delivering through a shared mail gateway. Traditionally, all mail sent from a shared MTA or gateway is sent from same host name and IP addresses. Since ISPs and email administrators tend to initially key on the source IP address for blocking incoming mail, more aggressive senders, or simply higher volume customers delivering through a shared MTA will almost certainly put all others at risk of being blocked.</p>
<p>To maximize deliverability and minimize collateral blocking of legitimate email on shared gateways, SparkPost has developed <em>VirtualMTA</em> technology within PowerMTA. Simply put, this functionality allows sites to define and control both the source IP address and host name for each message. This allows for creating VirtualMTAs for separate and specific campaigns, customers or departments, while still running just one instance of PowerMTA.</p>
<h2 id="virtualmta-definitions"><span class="header-section-number">8.2</span> VirtualMTA Definitions</h2>
<p>VirtualMTAs are defined via the new <code>&lt;virtual-mta&gt;</code> directive. Defining a VirtualMTA entails creating a <code>&lt;virtual-mta&gt;</code> tag with the desired name and listing its host name and SMTP source IP(s). For example, if you wanted to create a VirtualMTA named mta1, you would simply add in the configuration file:</p>
<pre><code>&lt;virtual-mta mta1&gt;
    smtp-source-host 1.2.3.4 mta1.port25.com
&lt;/virtual-mta&gt;
</code></pre>
<p>Changes to the VirtualMTA definitions are reloadable via the <code>pmta reload</code> command and do not require a restart.</p>
<p>Note that if you leave out the <code>smtp-source-host</code> directive in the definition, PowerMTA will use the corresponding global settings for that VirtualMTA. Since that may or may not be the desired result, SparkPost always recommends that you specify at least one <code>smtp-source-host</code> within each VirtualMTA definition. For example, you could use the desired host name as the VirtualMTA name, but you would still need to specify the host-name directive to ensure that the right host name is used:</p>
<pre><code>&lt;virtual-mta mta2.port25.com&gt;
    smtp-source-host 2.3.4.5 mta2.port25.com
&lt;/virtual-mta&gt;
</code></pre>
<p>Lastly, if more than one <code>smtp-source-host</code> address is listed in a definition, PowerMTA will use the various source IPs in round robin fashion for connections from that VirtualMTA:</p>
<pre><code>&lt;virtual-mta mta3&gt;
    smtp-source-host 1.2.3.4 mta4.port25.com
    smtp-source-host 2.3.4.5 mta5.port25.com
    smtp-source-host 3.4.5.6 mta6.port25.com
&lt;/virtual-mta&gt;
</code></pre>
<p>VirtualMTA directives only apply when the VirtualMTA has been selected as described in <a href="#selecting-a-virtualmta-or-virtualmta-pool">Selecting a VirtualMTA or VirtualMTA Pool</a>. Otherwise, they are simply ignored. More information about <a href="#smtp-source-host">smtp-source-host</a> directive can be found in <a href="#powermta-configuration">PowerMTA Configuration</a> section.</p>
<h2 id="virtualmta-pools"><span class="header-section-number">8.3</span> VirtualMTA Pools</h2>
<p>PowerMTA supports the defining and selecting of VirtualMTA pools per message or campaign as well, which are basically multiple VirtualMTAs grouped in a pool. When a pool is defined and selected for a campaign, PowerMTA will use the VirtualMTAs listed in round robin fashion for connections from that pool.</p>
<p>VirtualMTA pools are defined via the new <code>&lt;virtual-mta-pool&gt;</code> directive. Defining a pool entails creating a <code>&lt;virtual-mta-pool&gt;</code> group with the desired name and listing the VirtualMTAs that you want belonging to that pool. For example, if you wanted to create a VirtualMTA pool named <code>pond</code>, you would first define the specific VirtualMTAs to be part of <code>pond</code>, as described in <a href="#virtualmta-definitions">VirtualMTA Definitions</a>, and then subsequently list each of the VirtualMTAs that are to be included using the <code>virtual-mta</code> directive:</p>
<pre><code>&lt;virtual-mta mta1&gt;
    smtp-source-host 1.2.3.4 mta1.port25.com
&lt;/virtual-mta&gt;

&lt;virtual-mta mta2&gt;
    smtp-source-host 2.3.4.5 mta2.port25.com
&lt;/virtual-mta&gt;

&lt;virtual-mta-pool pond&gt;
    virtual-mta mta1
    virtual-mta mta2
&lt;/virtual-mta-pool&gt;
</code></pre>
<p>Note that PowerMTA will not accept a VirtualMTA pool definition if the pool name equals a previously defined VirtualMTA name, given that you select a VirtualMTA pool and/or VirtualMTA via the same headers and function calls, as detailed in <a href="#selecting-a-virtualmta-or-virtualmta-pool">Selecting a VirtualMTA or VirtualMTA Pool</a>.</p>
<p>A <code>&lt;domain&gt;</code> may be defined inside of a <code>&lt;virtual-mta-pool&gt;</code>. If this is done, the defined directives will be inherited by any VirtualMTA that is part of the pool. If a conflicting directive is defined directly in the given VirtualMTA, the directive in the VirtualMTA overrides the one defined in the <code>&lt;virtual-mta-pool&gt;</code>.</p>
<p>The following directives are also supported:</p>
<pre><code>cold-virtual-mta
domain-key
max-smtp-out
max-smtp-msg-rate
include-headers-from
</code></pre>
<h2 id="selecting-a-virtualmta-or-virtualmta-pool"><span class="header-section-number">8.4</span> Selecting a VirtualMTA or VirtualMTA Pool</h2>
<p>PowerMTA supports various methods of selecting a VirtualMTA (or pool), depending on your submission method:</p>
<ul>
<li><p>Submission APIs:</p>
<ul>
<li><p>by defining the <code>*vmta</code> mailmerge variable in mailmerge messages.</p></li>
<li><p>by using the <code>setVirtualMta</code> or equivalent method (see <a href="#trace">trace</a> for details).</p></li>
</ul></li>
<li><p>Pickup directory submission:</p>
<ul>
<li><p>by defining the <code>*vmta</code> mailmerge variable in BSMTP messages.</p></li>
<li><p>by pattern matching based on the MAIL FROM, RCPT TO, or a header.</p></li>
</ul></li>
<li><p>SMTP submission:</p>
<ul>
<li><p>by defining the <code>*vmta</code> mailmerge variable in mailmerge messages.</p></li>
<li><p>by including the <code>X-virtual-MTA</code> header in the message (see <a href="#selecting-a-virtualmta-with-a-x-virtual-mta-header">Selecting a VirtualMTA with a X-virtual-MTA Header</a> below for details).</p></li>
<li><p>by regular expression matching of the SMTP <code>MAIL FROM</code> or <code>RCPT TO</code> addresses, or a message header; see <a href="#pattern-list-directives">&lt;pattern-list&gt; Directives</a> and the <a href="#pattern-list">pattern-list</a> directive as well as <a href="#selecting-a-virtualmta-by-regular-expression-matching">Selecting a VirtualMTA by Regular Expression Matching</a> below for details).</p></li>
<li><p>by configuring a default VirtualMTA on a <code>&lt;source&gt;</code> directive selected by the IP address and port in the PowerMTA machine that you connect to (see the <a href="#smtp-listener">smtp-listener</a> directive as well as <a href="#virtualmta-pools">VirtualMTA Pools</a> below for details).</p></li>
<li><p>by configuring a default VirtualMTA on a <code>&lt;source&gt;</code> directive selected by the source IP address (see the <a href="#default-virtual-mta">default-virtual-mta</a> directive as well as <a href="#selecting-a-virtualmta-by-the-source-ip-address">Selecting a VirtualMTA by the Source IP Address</a> below for details).</p></li>
</ul></li>
</ul>
<p>The selection methods above are listed in the order of precedence within each submission methods.</p>
<p>Using mailmerge may effect how VirtualMTA selection is done. When using mailmerge and the API or SMTP, the <code>x-virtual-mta</code> will apply to the entire mailmerge job, not individual recipients (in most cases using the first defined <code>x-virtual-mta</code>).</p>
<p>When using mailmerge and pattern lists, VirtualMTA selection will be for each recipient when matching the RCPT TO, and will only be for each recipient for the MAIL FROM when using the <code>*from</code> mailmerge variable. When not using the <code>*from</code>, or when using header matching, <em>all</em> recipients in the mailmerge job will use the same VirtualMTA (in most cases the first matched pattern).</p>
<p>Note that one selects a VirtualMTA pool using the same exact header, directives or function call, but using the pool name instead of the VirtualMTA name.</p>
<h3 id="selecting-a-virtualmta-with-a-x-virtual-mta-header"><span class="header-section-number">8.4.1</span> Selecting a VirtualMTA with a X-virtual-MTA Header</h3>
<p>To select a VirtualMTA with the <code>X-virtual-MTA</code> header, you need to:</p>
<ol>
<li><p>define the VirtualMTA(s) or VirtualMTA pool(s) in the configuration file using the <code>&lt;virtual-mta&gt;</code> directive.</p></li>
<li><p>define the specific IP address or IP address range for the source of the messages that it is applicable using the expanded <code>&lt;source&gt;</code> directive.</p></li>
<li><p>define the ability for PowerMTA to process the <code>x-virtual-mta</code> header via the <code>process-x-virtual-mta</code> directive, within the <code>&lt;source&gt;</code> directive defined in step 2.</p></li>
</ol>
<p>After setting up the configuration file properly, you simply need to then add the <code>x-virtual-mta</code> header to your message specifying the VirtualMTA name, like in</p>
<p><code>x-virtual-mta: yyyyy</code></p>
<p>where <em>yyyyy</em> is the VirtualMTA name in the configuration file. PowerMTA will remove the <code>x-virtual-mta</code> header by default before ultimate delivery, so it will not be seen by the recipient's mail gateway or the recipient.</p>
<p>For example, assuming that you had the following VirtualMTA definition in your configuration file:</p>
<pre><code>&lt;virtual-mta mta1&gt;
    smtp-source-host 1.2.3.4 mta1.port25.com
&lt;/virtual-mta&gt;
</code></pre>
<p>and you wanted PowerMTA to process the <code>x-virtual-mta</code> header for mail arriving from the local IP address <code>127.0.0.1</code> for selecting a VirtualMTA, you would need to have the following in your configuration file:</p>
<pre><code>&lt;source 127.0.0.1&gt;
    process-x-virtual-mta yes # allow selection of a VirtualMTA using x-virtual-mta header
    always-allow-relaying yes # allow feeding from 127.0.0.1
&lt;/source&gt;
</code></pre>
<p>With this, any messages submitted from the local IP address <code>127.0.0.1</code> that contained the header <code>x-virtual-mta: mta1</code> would have PowerMTA using VirtualMTA <code>mta1</code> and its parameters when making connections to deliver these messages. One can also select a VirtualMTA pool to be used for messages in the same manner.</p>
<p>The entire message (in this example, submitted through the pickup directory) could thus read:</p>
<pre><code>x-sender: me@over.here
x-envid: me-0001
x-receiver: you@over.there
x-virtual-mta: mta1
From: Me &lt;me@over.here&gt;
To: You &lt;you@over.there&gt;
Date: Thu, 13 Mar 2018 07:45:43 -0400
Subject: PowerMTA is the best

Hey, this new VirtualMTA technology really improves delivery rates!
</code></pre>
<h3 id="selecting-a-virtualmta-by-regular-expression-matching"><span class="header-section-number">8.4.2</span> Selecting a VirtualMTA by Regular Expression Matching</h3>
<p>Sites can also have PowerMTA use a VirtualMTA or VirtualMTA pool for specific messages by way of regular expression pattern matching of the SMTP MAIL FROM address, the SMTP RCPT TO address, or a header, based on the IP address of the source of the message.</p>
<p>To select a VirtualMTA or VirtualMTA pool based on regular expression pattern matching, you</p>
<ol>
<li><p>define the VirtualMTAs or VirtualMTA pools in the configuration file using the <code>&lt;virtual-mta&gt;</code> directive.</p></li>
<li><p>define the name for the regular expression pattern list using the <code>&lt;pattern-list&gt;</code> directive.</p></li>
<li><p>define the actual regular expression pattern to use for matching the SMTP MAIL FROM, the RCPT TO address, or a header as well as subsequent VirtualMTA or VirtualMTA pool to use when a match occurs, via the <code>mail-from</code>, <code>rcpt-to</code>, and <code>header</code> directives. These directives are defined within the <code>&lt;pattern-list&gt;</code> definition created in step 2.</p></li>
<li><p>define the specific IP address or IP address range for the source of the messages that is applicable within the expanded <code>&lt;source&gt;</code> directive.</p></li>
<li><p>define the <code>pattern-list</code> directive using the corresponding name defined in step 2 within the <code>&lt;source&gt;</code> directive defined in step 4. Conditional pattern matching as defined in <a href="#pattern-list-directives">&lt;pattern-list&gt; Directives</a> may also be used.</p></li>
</ol>
<p>For example, assuming that you had the following VirtualMTA definitions in your configuration file:</p>
<pre><code>&lt;virtual-mta mta1&gt;
    smtp-source-host 1.2.3.4 mta1.port25.com
&lt;/virtual-mta&gt;

&lt;virtual-mta mta2&gt;
    smtp-source-host 2.3.4.5 mta2.port25.com
&lt;/virtual-mta&gt;
</code></pre>
<p>and you wanted PowerMTA to match the patterns "abc" and "xyz" at the beginning of the MAIL FROM address in order to select the appropriate VirtualMTA to use for each, you would need to have at a minimum the following in your configuration file:</p>
<pre><code>&lt;pattern-list group2&gt;
    mail-from /^abc/ virtual-mta=mta1
    mail-from /^xyz/ virtual-mta=mta2
&lt;/pattern-list&gt;

&lt;source 127.0.0.1&gt;
    pattern-list group2 # this selects the pattern list for messages from this IP
    always-allow-relaying yes # allow feeding from 127.0.0.1
&lt;/source&gt;
</code></pre>
<p>With this, any messages submitted from the local IP address 127.0.0.1 would have PowerMTA using regular expression matching on the MAIL FROM address, and if PowerMTA found "abc" at the beginning of the address (for example <a href="mailto:abc-2890u8@bounces.port25.com">abc-2890u8@bounces.port25.com</a>), VirtualMTA mta1 and its parameters would be used when making connections to deliver these messages. For messages submitted that had a MAIL FROM starting with "xyz", for example <code>xyz-ljwer@bounces.port25.com</code>, VirtualMTA mta2 and its parameters would instead be used when making connections to deliver these messages.</p>
<p>To additionally select some other VirtualMTA for recipients at yahoo.com, you could add a rcpt-to directive as below:</p>
<pre><code>&lt;pattern-list group2&gt;
    mail-from /^abc/ virtual-mta=mta1
    mail-from /^xyz/ virtual-mta=mta2
    rcpt-to /@yahoo.com$/ virtual-mta=mta3
&lt;/pattern-list&gt;

...
</code></pre>
<p>Per the examples above, you can see that PowerMTA can use different matching patterns for different campaigns, customers and/or mailings simultaneously, in order to use different VirtualMTAs or VirtualMTA pools for each.</p>
<p>More than one <code>mail-from</code>, <code>rcpt-to</code> and <code>header</code> directives are allowed within a <code>&lt;pattern-list&gt;</code> definition, and since the first match is used, you will want to list the most likely matches first. Only one pattern-list is allowed within a <code>&lt;source&gt;</code> group.</p>
<p>Conditional matching is allowed as well. For example, if you want wanted all emails that have a MAIL FROM of X, and a RCPT TO of Y, that is allowed in a pattern similar to the following:</p>
<pre><code>&lt;pattern-list patterns&gt;
    mail-from /X/ &lt;pattern-list&gt;
        rcpt-to /Y/ virtual-mta=vmta2
        rcpt-to /Z/ virtual-mta=vmta1
        * virtual-mta=vmta2
    &lt;/pattern-list&gt;
&lt;/pattern-list&gt;
</code></pre>
<p>For more information on conditional pattern matching, see <a href="#pattern-list-directives">&lt;pattern-list&gt; Directives</a>.</p>
<p>Note that simple to advanced regular expression pattern matching is supported, and which is based on Perl Compatible Regular Expressions (PCRE).</p>
<h3 id="selecting-a-virtualmta-by-the-ip-addressport-receiving-connections"><span class="header-section-number">8.4.3</span> Selecting a VirtualMTA by the IP Address/Port Receiving Connections</h3>
<p>For added flexibility, PowerMTA supports the ability to select a VirtualMTA based on the IP address (and TCP port number) on the PowerMTA machine to which you connect when submitting your messages.</p>
<p>For example, if you have 10 VirtualMTAs defined, each with a different IP address, you could select the VirtualMTA to use for each message simply by making your SMTP connection to the specific IP address defined on your PowerMTA machine for the specific VirtualMTA.</p>
<p>This is accomplished through named <code>&lt;source&gt;</code> tags, in conjunction with the <code>smtp-listener</code> directive. Named <code>&lt;source&gt;</code> tags allow you to specify directives that override those normally selected by source IP address; they apply only when referenced in the smtp-listener directive (and for authenticated users  see <a href="#implementation-for-inbound-connections">Implementation for Inbound Connections</a>.</p>
<p>For example, to select VirtualMTA vmta1 by its assigned <code>smtp-source-host</code> address 1.2.3.4 and the standard SMTP port (25), you would configure:</p>
<pre><code>&lt;virtual-mta vmta1&gt;
    smtp-source-host 1.2.3.4 vmta1.yourdomain.com
    ...
&lt;/virtual-mta&gt;

&lt;source vmta1&gt;
default-virtual-mta vmta1
&lt;/source&gt;

smtp-listener 1.2.3.4:25 source=vmta1
</code></pre>
<p>Multiple smtp-listener entries can be specified in a configuration file, each of which specifying a different IP address and/or port.</p>
<p>Since the named source's directives apply to anyone who can connect to the listener's IP address and port, one should be careful about what is entered there. For example, <code>always-allow-relaying</code> should most probably <strong>not</strong> be enabled in the named source. Instead, permission for relaying, for accessing the mailmerge extensions, etc. should be based on authenticated sources (see <a href="#implementation-for-inbound-connections">Implementation for Inbound Connections</a>) or on the source IP address, as in the example below:</p>
<pre><code>&lt;virtual-mta vmta1&gt;
    smtp-source-host 1.2.3.4 vmta1.yourdomain.com
    ...
&lt;/virtual-mta&gt;

smtp-listener 1.2.3.4:25 source=vmta1
smtp-listener 0.0.0.0:25

&lt;source vmta1&gt;
default-virtual-mta vmta1
&lt;/source&gt;

&lt;source 10/8&gt;
allow-mailmerge yes
always-allow-relaying yes
&lt;/source&gt;

&lt;source 0/0&gt;
allow-mailmerge no
always-allow-relaying no
&lt;/source&gt;
</code></pre>
<p>Above, VirtualMTA vmta1 is selected by default for any messages received through 1.2.3.4 on the PowerMTA machine. The default listener on 0.0.0.0:25 is retained through its own <code>smtp-listener</code> directive. Permission for relaying and for using the mailmerge extensions is granted to connections coming from <code>&lt;source 10/8&gt;</code>, whether they connect to 1.2.3.4 or not.</p>
<h3 id="selecting-a-virtualmta-by-the-source-ip-address"><span class="header-section-number">8.4.4</span> Selecting a VirtualMTA by the Source IP Address</h3>
<p>For sites that are using applications that do not allow them to create custom X-headers within their messages, or for sites feeding PowerMTA messages from a variety of different SMTP applications and machines, PowerMTA supports the ability to select and use VirtualMTAs based only on the IP address of the source of the message.</p>
<p>To select a VirtualMTA or VirtualMTA pool based on the IP address of the original source of the message, you need to:</p>
<ol>
<li><p>define the VirtualMTAs or VirtualMTA pools in the configuration file using the <code>&lt;virtual-mta&gt;</code> directive.</p></li>
<li><p>define the specific IP address or IP address range for the source of the messages that is applicable using the expanded <code>&lt;source&gt;</code> directive.</p></li>
<li><p>define the VirtualMTA to use for messages via the new default-virtual-mta directive within the <code>&lt;source&gt;</code> directive defined in step 2.</p></li>
</ol>
<p>For example, assuming that you had the following VirtualMTA definition in your configuration file:</p>
<pre><code>&lt;virtual-mta mta1&gt;
    smtp-source-host 1.2.3.4 mta1.port25.com
&lt;/virtual-mta&gt;
</code></pre>
<p>and you wanted only mail coming from the local IP address 127.0.0.1 to use this VirtualMTA by default for each message (without having to specify an <code>x-virtual-mta</code> header in the messages), you would need to have at a minimum the following in your configuration file:</p>
<pre><code>&lt;source 127.0.0.1&gt;
    default-virtual-mta mta1 # selects a VirtualMTA/pool by source of the message
    always-allow-relaying yes # allow feeding from 127.0.0.1
&lt;/source&gt;
</code></pre>
<p>With this, any messages submitted from the local IP address 127.0.0.1 would have PowerMTA using VirtualMTA mta1 and its parameters when making connections to deliver these messages. One can also select a VirtualMTA pool to be used for messages coming from the specific IP address by instead specifying a VirtualMTA pool name via the default-virtual-mta directive.</p>
<p>You can basically define as many different source IP addresses or IP address ranges for messages in the configuration file as you wish, with each using a different VirtualMTA or VirtualMTA pool.</p>
<h3 id="selecting-a-virtualmta-by-a-virtualmta-ip-address"><span class="header-section-number">8.4.5</span> Selecting a VirtualMTA by a VirtualMTA IP address</h3>
<p>In addition to the above, a VirtualMTA can be selected based on which PowerMTA IP is used for the connection, and the corresponding VirtualMTA that is configured with that IP. To use this selection method, the source directive <code>default-virtual-mta</code> will need to be used with a setting of <code>by-smtp-source-ip</code> in place of a VirtualMTA name.</p>
<p>When configured in this way, on an inbound SMTP connection PowerMTA will use as the default VirtualMTA that whose <code>smtp-source-host</code> setting equals the destination IP address on the inbound connection.</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;virtual-mta mta1&gt;
    smtp-source-host 1.2.3.4 vmta1.port25.com
&lt;/virtual-mta&gt;

&lt;source 0/0&gt;
    default-virtual-mta by-smtp-source-ip
&lt;/source&gt;
</code></pre>
<p>In the above example, connecting to IP address 1.2.3.4 would automatically route the message through VirtualMTA mta1.</p>
<h2 id="changing-virtualmtas-on-the-fly"><span class="header-section-number">8.5</span> Changing VirtualMTAs on the Fly</h2>
<p>There may be times when you need to change or even cancel a VirtualMTA definition after mail has already been queued for it, so PowerMTA has been designed to handle these scenarios.</p>
<h3 id="changing-a-virtualmta"><span class="header-section-number">8.5.1</span> Changing a VirtualMTA</h3>
<p>If you change the host name and/or source IP addresses of a VirtualMTA after email has already been queued, PowerMTA will use the new information for all new connections once the configuration file has been reloaded. However, if connections were already established when the changes are loaded, the old VirtualMTA information will be used for the duration of those connections.</p>
<h3 id="canceling-a-virtualmta"><span class="header-section-number">8.5.2</span> Canceling a VirtualMTA</h3>
<p>If you would like to cancel a VirtualMTA after messages have already been queued, you can simply delete or comment its definition out of the configuration file (and run the <code>pmta reload</code> command). PowerMTA will use the new information for all new connections once the configuration file has been reloaded. However, if connections were already established when the changes are loaded, the old VirtualMTA information will be used for the duration of those connections.</p>
<p>If a message selects a VirtualMTA which does not exist when PowerMTA attempts to deliver it, that message is bounced with the DSN status</p>
<pre><code>5.3.5 (specified VirtualMTA does not exist)
</code></pre>
<h1 id="mailmerge-support"><span class="header-section-number">9</span> Mailmerge Support</h1>
<h2 id="overview-3"><span class="header-section-number">9.1</span> Overview</h2>
<p>PowerMTA includes internal mailmerge support to maximize performance and efficiency in the creation, queueing, and delivery of customized email messages. PowerMTA's mailmerge implementation supports both simple keyword or phrase merging as well as merging of larger blocks of data (such as paragraphs or body parts) for respective recipients. Merging does not depend on the actual message contents and can thus be used for both text and HTML formatted messages.</p>
<p>The process is basically similar to general mailmerge implementations. Your application generates a pre-formatted merge file or <em>recipe</em> that includes all of the recipient data (recipient addresses, names, order information, etc.) to be merged for each recipient, along with a message template. The message template includes the respective pointers to the variable content and data blocks to be merged in. Based on this, PowerMTA then creates the final merged (i.e., customized) messages for each recipient at actual delivery time.</p>
<p>PowerMTA mailmerge is supported with all of the current mail submission methods. Mailmerge submissions through SMTP and the pickup directory (BSMTP) are supported through special protocol extensions.</p>
<h2 id="benefits"><span class="header-section-number">9.2</span> Benefits</h2>
<p>While PowerMTA is designed to handle the queueing and delivery of very large volumes of customized messages, inline mailmerge support via PowerMTA Mailmerge offers additional performance and efficiency advantages to all components of your solution. Some of the obvious benefits are:</p>
<ul>
<li><p>decreased responsibility and load on your CRM or email marketing application by shifting the merging to PowerMTA.</p></li>
<li><p>increased feeding performance by application to PowerMTA, given that you would be feeding far fewer messages to PowerMTA for the same number of recipients.</p></li>
<li><p>increased efficiency and delivery throughput given the decrease of the I/O impact on your PowerMTA machine. There will be a huge decrease in the number of queued mail files in the spool for the same number of recipients, allowing for maximum scalability. For example, instead of one spool file for each recipient in the queue, with PowerMTA Mailmerge you could have 10,000 recipients in a single spool file.</p></li>
</ul>
<h2 id="configuration-requirements"><span class="header-section-number">9.3</span> Configuration Requirements</h2>
<p>No special configuration is needed to submit mailmerge messages through the submission APIs or the pickup directory. However, to use the mailmerge SMTP extensions, you must enable them with the <code>allow-mailmerge</code> directive for the IP address(es) from which you will be submitting the messages:</p>
<pre><code>&lt;source 127.0.0.1&gt;
    allow-mailmerge yes
&lt;/source&gt;
</code></pre>
<h2 id="creating-mailmerge-messages"><span class="header-section-number">9.4</span> Creating Mailmerge Messages</h2>
<h3 id="message-template-and-mailmerge-variables"><span class="header-section-number">9.4.1</span> Message Template and Mailmerge Variables</h3>
<p>Creating mailmerge messages is easy. The first task is to create a message template, marking and labeling the portions that you would like customized for each recipient, like in the example below:</p>
<pre><code>From: shipping-confirmation@example.port25.com
Subject: Your order #[OrderNumber] shipped!

[First_Name],

Your order #[OrderNumber] was shipped on [ShipTime]. Thank you for your
business!
</code></pre>
<p>The labels for the customized portions are names of the variables which define what the content for each portion.</p>
<p>Once you have created your message template, you define the content for of these variables for the various recipients. For example, for one recipient you may want to have First_Name set to Bob, OrderNumber set to 1234-56 and ShipTime to 7/14 10:00. In the example above, this would yield:</p>
<pre><code>From: shipping-confirmation@example.port25.com
Subject: Your order #1234-56 shipped!

Bob,

Your order #1234-56 was shipped on 7/14 10:00. Thank you for your
business!
</code></pre>
<p>Mailmerge variables are defined per recipient, and you cannot use the same variable name to define more than one set of data in the same message. Variable names are case-insensitive, e.g. name and Name are the same variable. Variable names may be composed of the letters (a-z and A-Z), the digits (0-9), and the underscore (_). The first character in a variable name must be a letter.</p>
<p>As noted above, variable substitutions are enclosed in square brackets in the message template. To include a square bracket itself, simply write it twice. For example,</p>
<pre><code>[First_Name],

Please fill out the fields below marked with square brackets [[].
...
</code></pre>
<p>would become (for a First_Name of "George")</p>
<pre><code>George,

Please fill out the fields below marked with square brackets []
...
</code></pre>
<h3 id="reserved-variables"><span class="header-section-number">9.4.2</span> Reserved Variables</h3>
<p>Variable names beginning with an asterisk are "reserved" and have a special meaning to PowerMTA:</p>
<p><strong>*from</strong></p>
<blockquote>
<p>overrides the SMTP MAIL FROM (originator) address for the recipient's message.</p>
</blockquote>
<p><strong>*envid</strong></p>
<blockquote>
<p>overrides the DSN envelope ID for the recipient's message, for better tracking in bounces and in the accounting file. This setting overrides any other method of defining the envelope ID.</p>
</blockquote>
<p><strong>*vmta</strong></p>
<blockquote>
<p>selects the VirtualMTA (or VirtualMTA pool) through which the recipient's message should be delivered. This setting overrides any of the other VirtualMTA selection methods described in <a href="#selecting-a-virtualmta-or-virtualmta-pool">Selecting a VirtualMTA or VirtualMTA Pool</a>.</p>
</blockquote>
<p><strong>*jobid</strong></p>
<blockquote>
<p>defines the job (or campaign) ID for the recipient's message, for tracking in the WWW based monitoring facility. If set, the content of this variable overrides any job ID already set for the recipient's message. x-job header can be used with Mailmerge, but using *jobid is faster.</p>
</blockquote>
<p><strong>*parts</strong></p>
<blockquote>
<p>defines the list of merge parts to include in the recipient's message. For example, if your message has 3 parts, numbered 1, 2 and 3 and you want to include all of them in the recipient message, you should set *parts=1,2,3 or shorter, *parts=1-3. If you wanted part 3 to go before part 2 in the recipient's message, you would set *parts=1,3,2.</p>
</blockquote>
<p><strong>*to</strong></p>
<blockquote>
<p>merges in the defined RCPT TO/recipient email address. This variable is automatically set from the recipient address and cannot be overridden.</p>
</blockquote>
<p><strong>*date</strong></p>
<blockquote>
<p>merges in the message's reception date &amp; time stamp. This variable is automatically set and cannot be overridden.</p>
</blockquote>
<p><strong>*schedule</strong></p>
<blockquote>
<p>sets the delivery schedule for the recipient in a message. This overrides any schedule that may be defined in the message body.</p>
</blockquote>
<p><strong>*priority</strong></p>
<blockquote>
<p>sets the priority of a recipient to the specified value. The value must be a number in the range 1-100, with higher values signifying higher priority for the recipient. The default priority for a recipient, if not set, is 50. If "*priority" is used, it overrides the priority value, if any, obtained from &lt;pattern-list&gt; for the same recipient.</p>
</blockquote>
<p><strong>*subaccountid</strong></p>
<blockquote>
<p>sets the numeric subaccount ID to be included in SparkPost Signals events. If this variable is set, it overrides a subaccount determined by any configuration file directives.</p>
</blockquote>
<p><strong>*custommessageid</strong></p>
<blockquote>
<p>sets the custom message ID (sent to SparkPost via <code>custom_message_id</code> field) for SparkPost Signals events.</p>
</blockquote>
<hr />
<h3 id="merge-parts"><span class="header-section-number">9.4.3</span> Merge Parts</h3>
<p>Each message template is made up of one or more sections called <em>merge parts</em>. A merge part can be a sentence, a paragraph, a block of paragraphs, a body part, or even the message headers. Within each merge part there can be many mailmerge variable substitutions.</p>
<p>The parts or sections of the message are labelled with a part number, and then assembled for each recipient based upon the content of the special <code>*parts</code> variable for the recipient.</p>
<p>For example, a travel alerts service could send messages in three parts: the first containing the headers and a common preamble,</p>
<pre><code>From: &quot;Customer Service&quot; [*from]
To: &quot;[FName]&quot; [*to]
Date: [*date]
Subject: Travel Plans

Dear [FName],

You are flying out of [Airport] given that it is closest to your location
in [City], [State].
</code></pre>
<p>the second containing a notice that is only sent to some of the recipients,</p>
<pre><code>With this flight, you are only [MilesToBonus] frequent flyer miles away from
your next SuperBonus(TM)!
</code></pre>
<p>the third with a common final block:</p>
<pre><code>Have a great trip!
</code></pre>
<p>Some recipients could then be sent all parts (*parts=1-3) while others would only be sent parts #1 and #3 (*parts=1,3). Note that the variable MilesToBonus would only need to be defined for those recipients receiving part #2.</p>
<h2 id="submitting-mailmerge-messages"><span class="header-section-number">9.5</span> Submitting Mailmerge Messages</h2>
<p>You can feed mailmerge messages to PowerMTA using any of the standard supported submission APIs, pickup directory, or through PowerMTA's mailmerge SMTP extensions. It is recommend to add no more than 5000 recipients per mail merge file when feeding via pickup directory.</p>
<h3 id="api-submission"><span class="header-section-number">9.5.1</span> API Submission</h3>
<p>All PowerMTA submission APIs include support for mailmerge. The basic process involves defining per-recipient variables by invoking the <code>defineVariable</code> for each Recipient object, and then passing the message template by invoking the <code>addMergeData</code> method for the <code>Message</code> object. Please refer to the corresponding API reference for more details.</p>
<p>Sample programs for using mailmerge in the APIs are provided with PowerMTA.</p>
<h3 id="mailmerge-smtp-extensions"><span class="header-section-number">9.5.2</span> Mailmerge SMTP extensions</h3>
<p>SparkPost has extended the SMTP protocol for sites that would prefer to feed PowerMTA mailmerge messages via a modified SMTP interface.</p>
<p>The mailmerge extensions define three new verbs:</p>
<h4 id="xmrg"><span class="header-section-number">9.5.2.1</span> XMRG</h4>
<blockquote>
<p>Replaces the MAIL FROM command of a standard SMTP submission. All extensions (such as DSN, VERP, etc.) that are supported with MAIL are also supported with XMRG.</p>
</blockquote>
<p><strong>Example:</strong></p>
<pre><code>XMRG FROM:&lt;travelAlerts@example.port25.com&gt; VERP
</code></pre>
<hr />
<h4 id="xdfn"><span class="header-section-number">9.5.2.2</span> XDFN</h4>
<blockquote>
<p>Defines variables for the recipient following it. One or more XDFN commands should be issued prior to each <code>RCPT</code> command in a mailmerge submission. Variables are defined in the format <code>name=value</code>, where <code>name</code> is the variable name and <code>value</code> is the value to to be associated with the variable. If the value contains any white space, it should be enclosed in double quotes. You can specify multiple variables in a single XDFN command by separating them with blanks.</p>
</blockquote>
<p><strong>Example:</strong></p>
<pre><code>XDFN name=&quot;Bob Example&quot; Airport=BWI
XDFN *jobid=&quot;TravelAlerts&quot;
RCPT TO:&lt;bob@example.port25.com&gt;
</code></pre>
<h4 id="xprt"><span class="header-section-number">9.5.2.3</span> XPRT</h4>
<blockquote>
<p>Replaces the DATA command of a standard SMTP submission. One <code>XPRT</code> command should be issued per merge part in the mailmerge submission, passing the merge part number, like in the example below:</p>
</blockquote>
<pre><code>XPRT 1
</code></pre>
<blockquote>
<p>Like for DATA, PowerMTA responds to the XPRT command with a 3xx reply code. Also, like data, the message template must be passed dot-escaped. A dot on a line by itself terminates the merge part. The last XPRT is indicated with the additional LAST parameter and terminates the submission:</p>
</blockquote>
<pre><code>XPRT 2 LAST
</code></pre>
<p>The following example shows all the three verbs used to submit a mailmerge to two recipients. In addition to parts 1 and 3, Alice is also sent part #2 with a reminder that she's close to obtaining a bonus:</p>
<pre><code>XMRG FROM:&lt;travelAlerts@example.port25.com&gt; VERP
XDFN FName=&quot;Alice&quot; Airport=&quot;IAD&quot; MilesToBonus=&quot;120&quot;
XDFN City=&quot;Herndon&quot; State=&quot;VA&quot; *parts=1-3 *vmta=&quot;mta4&quot;
XDFN *jobid=&quot;TravelAlerts&quot;
RCPT TO:&lt;alice@example.port25.com&gt;
XDFN FName=&quot;Bob&quot; Airport=&quot;BWI&quot;
XDFN City=&quot;Ellicott City&quot; State=&quot;MD&quot; *parts=1,3 *vmta=&quot;mta5&quot;
XDFN *jobid=&quot;TravelAlerts&quot;
RCPT TO:&lt;bob@example.port25.com&gt;
XPRT 1
From: &quot;Customer Service&quot; [*from]
To: &quot;[FName]&quot; [*to]
Date: [*date]
Subject: Travel Plans

Dear [FName],

You are flying out of [Airport] given that it is closest to your location
in [City], [State].
.
XPRT 2

With this flight, you are only [MilesToBonus] frequent flyer miles away from
your next SuperBonus(TM)!
.
XPRT 3 LAST

Have a great trip!
.
</code></pre>
<h3 id="pickup-directory-submission"><span class="header-section-number">9.5.3</span> Pickup Directory Submission</h3>
<p>The pickup directory submission method includes support for mailmerge, which greatly minimizes the disk I/O impact usually associated with this submission method. Instead of creating and writing 100,000 messages, one per recipient, mailmerge support allows you to write say only 25-50 files for the same number of recipients, greatly minimizing the resources utilized and increasing throughput. See <a href="#pickup-directory">Pickup Directory</a> for more details.</p>
<p>The pickup directory submission method is less efficient than submitting messages over SMTP.</p>
<p>Support for mailmerge in the pickup directory is accomplished through its support for BSMTP (batched SMTP) files. See <a href="#bsmtp-files">BSMTP files</a> for more information.</p>
<p>Here is a simple example of a properly formatted BSMTP mailmerge file for PowerMTA's pickup directory:</p>
<pre><code>XMRG FROM:&lt;bounce@port25.com&gt;
XDFN *from=&quot;blahblah@port25.com&quot;
XDFN subject=&quot;BSMTP mailmerge format&quot;
RCPT TO:&lt;bob@port25.com&gt;
XPRT 1 LAST
From: [*from]
To: [*to]
Subject: [subject]

Hello [*to]!
.
</code></pre>
<p>Here is another that contains information for 4 recipients:</p>
<pre><code>XACK ON
XMRG FROM:&lt;bounce@port25.com&gt; verp
XDFN FName=&quot;Jim&quot; FavFood=&quot;pizza&quot; Car=&quot;minivan&quot; CID=&quot;1234&quot;
XDFN *vmta=&quot;mta1&quot; *parts=&quot;1-3&quot; *jobID=&quot;1234&quot;
RCPT TO:&lt;jim@test.port25.com&gt;
XDFN FName=&quot;Tim&quot; FavFood=&quot;sushi&quot; Car=&quot;porsche&quot; CID=&quot;2345&quot;
XDFN *vmta=&quot;mta2&quot; *parts=&quot;1,3,2&quot; *jobID=&quot;5678&quot;
RCPT TO:&lt;tim@test.port25.com&gt;
XDFN FName=&quot;Cosmo&quot; Car=&quot;Gremlin&quot; CID=&quot;3456&quot;
XDFN *vmta=&quot;mta3&quot; *parts=&quot;1,3&quot; *jobID=&quot;1234&quot;
RCPT TO:&lt;cosmo@test.port25.com&gt;
XDFN FName=&quot;Frank&quot; FavFood=&quot;pizza&quot; CID=&quot;4567&quot;
XDFN *vmta=&quot;mta5&quot; *parts=&quot;1,2&quot; *jobID=&quot;5678&quot;
RCPT TO:&lt;frank@test.port25.com&gt;
XPRT 1
X-CID: [CID]-abc
From: &quot;Customer Service&quot; [*from]
To: &quot;[Fname]&quot; [*to]
Subject: Travel Plans
Date: [*date]

Hey [FName],
.
XPRT 2
Your favorite food is [favfood].
.
XPRT 3 LAST
You drive a [car].
.
</code></pre>
<p><a href="#mailmerge-smtp-extensions">Mailmerge SMTP extensions</a> also provides another good example for reference.</p>
<p>Here is an example of a multi-part mailmerge file for a pickup directory:</p>
<pre><code>XMRG FROM:&lt;me@yourdomain.com&gt; verp
XDFN *from=&quot;me@yourdomain.com&quot;
XDFN subject=&quot;test \ 1&quot;
RCPT TO:&lt;you@yourdomain.com&gt;
XDFN *from=&quot;me@yourdomain.com&quot; subject=&quot;test 2&quot;
RCPT TO:&lt;you@yourdomain.com&gt;
XPRT 1 LAST
Mime-Version: 1.0
Content-Type: multipart/alternative; boundary=&quot;12345&quot;
From: [*from]
To: [*to]
Subject: [subject]

--12345
Content-Type: text/plain;

Hello. This is the text version.
--12345
Content-Type: text/html;

&lt;b&gt;This is the HTML version.&lt;/b&gt;

--12345--
.

</code></pre>
<h3 id="the-xack-smtp-extension"><span class="header-section-number">9.5.4</span> The XACK SMTP extension</h3>
<p>To facilitate and improve the feeding performance while using the mailmerge extensions, SparkPost has also defined the XACK protocol extension.</p>
<p>The XACK command disables acknowledgements for the RCPT and XDFN commands. It accepts a single parameter, either ON or OFF. To disable acknowledgements, you issue XACK like in the example below:</p>
<p><code>XACK OFF</code></p>
<p>Once acknowledgements are disabled, they stay disabled until the connection is closed or until they are re-enabled with XACK ON.</p>
<p>While acknowledgements are disabled, any errors occurring as a result of RCPT or XDFN command during a submission (i.e., after MAIL or XMRG and before the final DATA/BDAT/XPRT command) are reported as a response to the next DATA or BDAT (for non-mailmerge messages) or XPRT (for mailmerge messages). As a result of the error, the entire submission is canceled.</p>
<p>Some errors (e.g., address errors in the RCPT) may optionally be reported by sending a failure Delivery Status Notification, thus allowing the submission to continue. Any RCPT or XDFN errors (e.g., out of sequence errors) occurring not during a submission are ignored entirely.</p>
<p>The following example shows the connection trace (with commands and replies, but with the message content omitted) while submitting a mailmerge message:</p>
<pre><code>&gt;&gt;&gt; 220 mailhost.port25.com (PowerMTA v2.x) ESMTP service ready
&lt;&lt;&lt; EHLO test.port25.com
&gt;&gt;&gt; 250-mailhost.port25.com says hello
&gt;&gt;&gt; 250-ENHANCEDSTATUSCODES
&gt;&gt;&gt; 250-PIPELINING
&gt;&gt;&gt; 250-CHUNKING
&gt;&gt;&gt; 250-8BITMIME
&gt;&gt;&gt; 250-XACK
&gt;&gt;&gt; 250-XMRG
&gt;&gt;&gt; 250-SIZE 0
&gt;&gt;&gt; 250-VERP
&gt;&gt;&gt; 250 DSN
&lt;&lt;&lt; XACK OFF
&gt;&gt;&gt; 250 2.0.0 ok
&lt;&lt;&lt; XMRG FROM:&lt;bounce@example.port25.com&gt; verp
&gt;&gt;&gt; 250 2.1.0 XMRG ok
&lt;&lt;&lt; XDFN FName=&quot;Jim&quot; FavFood=&quot;pizza&quot; Car=&quot;minivan&quot; CID=&quot;1234&quot; *vmta=&quot;vmtapool&quot; *parts=&quot;1-3&quot;
&lt;&lt;&lt; RCPT TO:&lt;jim@example.port25.com&gt;
&lt;&lt;&lt; XDFN FName=&quot;Tim&quot; FavFood=&quot;sushi&quot; Car=&quot;porsche&quot; CID=&quot;2345&quot; *vmta=&quot;vmta2&quot; *parts=&quot;1,3,2&quot;
&lt;&lt;&lt; RCPT TO:&lt;tim@example.port25.com&gt;
&lt;&lt;&lt; XDFN FName=&quot;Cosmo&quot; Car=&quot;Gremlin&quot; CID=&quot;3456&quot; *vmta=&quot;vmta3&quot; *parts=&quot;1,3&quot;
&lt;&lt;&lt; RCPT TO:&lt;cosmo@example.port25.com&gt;
&lt;&lt;&lt; XDFN FName=&quot;Frank&quot; FavFood=&quot;pizza&quot; CID=&quot;4567&quot; *vmta=&quot;vmta1&quot; *parts=&quot;1,2&quot;
&lt;&lt;&lt; RCPT TO:&lt;frank@example.port25.com&gt;
&lt;&lt;&lt; XPRT 1
&gt;&gt;&gt; 354 send part
&lt;&lt;&lt; .
&gt;&gt;&gt; 250 2.6.0 part ok
&lt;&lt;&lt; XPRT 2
&gt;&gt;&gt; 354 send part
&lt;&lt;&lt; .
&gt;&gt;&gt; 250 2.6.0 part ok
&lt;&lt;&lt; XPRT 3 LAST
&gt;&gt;&gt; 354 send part
&lt;&lt;&lt; .
&gt;&gt;&gt; 250 2.6.0 message received
&lt;&lt;&lt; QUIT
&gt;&gt;&gt; 221 2.0.0 mailhost.port25.com says goodbye
</code></pre>
<h1 id="advanced-features"><span class="header-section-number">10</span> Advanced Features</h1>
<h2 id="sparkpost-signals"><span class="header-section-number">10.1</span> SparkPost Signals</h2>
<p><a href="https://www.port25.com/sdm_downloads/sparkpost-signals-for-powermta/">SparkPost Signals</a> is an email analytics suite that helps you improve email performance by diagnosing health issues before they impact your business. It analyzes your email sending and benchmark data from across our industry-leading email network to provide data-driven, predictive, and actionable insights to help you increase open rates, prevent blacklisting, and boost inbox placement. See <a href="https://www.sparkpost.com/docs/signals/overview/">https://www.sparkpost.com/docs/signals/overview/</a> for more information.</p>
<p>To utilize Signals, you'll need to enroll in the service and have the feature enabled. To begin your enrollment process please visit <a href="https://pages.messagesystems.com/signals-pmta-ty.html">Signals enrollment</a>.</p>
<p>Once the feature is enabled you will need to create a SparkPost API key and configure your PowerMTA to send accounting data to SparkPost. To create a SparkPost API key with the <code>Incoming Events: Write</code> permission go to <a href="https://app.sparkpost.com/account/api-keys">https://app.sparkpost.com/account/api-keys</a>.</p>
<p>Note: For initial testing, the Signals servers need several thousand emails worth of data and then must batch-process the data, so there may be up to a day's delay before data is reflected in the reports.</p>
<p>Note: A restart of PowerMTA is recommended after the <code>&lt;signals&gt;</code> tag has been added to the <a href="#configuration-directives-1">configuration</a> or any signals-related settings have been changed. While a reload is all that is required, a restart will ensure that all internal processes start working with the new settings immediately.</p>
<p>Note: If PowerMTA connects to the external world through a firewall, you need to enable connections to the hostname <code>api.sparkpost.com</code> port <code>443</code> through the firewall in order for PowerMTA to upload SparkPost Signals data.</p>
<h3 id="optional-data-loading-support"><span class="header-section-number">10.1.1</span> Optional Data Loading Support</h3>
<p>You can optionally designate the virtual MTAs that are allowed to send Signals data to SparkPost. You can also optionally designate the sending domain (this would be the domain portion of the <code>Sender</code> or <code>From</code> header within the body of the message - see <a href="#sample-use-cases-for-optional-loading-of-signals-data">Sample Use Cases</a> below for more details) whose events will be sent over to SparkPost.</p>
<p>PowerMTA offers the use of <a href="#enable-signals">enable-signals</a> at these scopes:</p>
<ol>
<li>Global scope: used to enable/disable generation of Signals events globally.</li>
<li>VMTA pool scope: used to enable/disable generation of Signals events for all the virtual MTAs within the same pool.</li>
<li>VMTA scope: used to enable/disable generation of Signals events for a single VMTA.</li>
</ol>
<h3 id="sparkpost-subaccounts"><span class="header-section-number">10.1.2</span> SparkPost Subaccounts</h3>
<p>You can configure PowerMTA to send Signals data to a specific SparkPost subaccount. In order to use a <code>subaccount</code> ID in PowerMTA it must first be created on SparkPost. To manage subaccounts on SparkPost, go to <a href="https://app.sparkpost.com/account/subaccounts">https://app.sparkpost.com/account/subaccounts</a></p>
<p>If you configure PowerMTA with a <code>subaccount</code> ID that does not exist on SparkPost, you may see subaccount names such as these in the Signals reports: "Deleted (ID x)", where x is the configured <code>subaccount</code> ID. In such a case:</p>
<ul>
<li>if the data should not be in the subaccount then, update the <code>subaccount</code> ID in PowerMTA configuration</li>
<li>if the data should be in the stated subaccount, then create the <code>subaccount</code> ID on SparkPost</li>
</ul>
<p>See the <a href="#enable-signals">enable-signals</a>, <a href="#sender-or-from">sender-or-from</a>, and <a href="#process-x-sp-subaccount-id">process-x-sp-subaccount-id</a> directives for information on how to specify the subaccount ID for a message.</p>
<h3 id="sample-use-cases-for-optional-loading-of-signals-data"><span class="header-section-number">10.1.3</span> Sample Use Cases for Optional Loading of Signals Data</h3>
<h4 id="use-case-1-disable-signals-completely"><span class="header-section-number">10.1.3.1</span> Use Case #1. Disable Signals completely.</h4>
<pre><code>&lt;signals&gt;
  api-key 0123456789012345678901234567890123456789
&lt;/signals&gt;

enable-signals false
</code></pre>
<p><strong>Result</strong> No signals data is sent at all from this PowerMTA.</p>
<p><strong>Explanation</strong> The global directive <a href="#enable-signals">enable-signals</a> is set to false, and is inherited by all VMTAs in the system.</p>
<h4 id="use-case-2-use-signals-to-track-every-email-delivered-out-of-powermta"><span class="header-section-number">10.1.3.2</span> Use Case #2. Use Signals to track every email delivered out of PowerMTA.</h4>
<pre><code>&lt;signals&gt;
  api-key 0123456789012345678901234567890123456789
&lt;/signals&gt;

enable-signals true

&lt;virtual-mta mktg&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta transact&gt;
&lt;/virtual-mta&gt;
</code></pre>
<p><strong>Result</strong> Signals data for all VMTAs, including <code>{default}</code>, <code>mktg</code> and <code>transact</code>, is sent from this PowerMTA to SparkPost.</p>
<p>Explanation: The global directive <a href="#enable-signals">enable-signals</a> is set to true and is inherited by all VMTAs in the system. So, PowerMTA sends event data for all VMTAs to SparkPost.</p>
<h4 id="use-case-3-dedicated-vmtas-per-message-stream"><span class="header-section-number">10.1.3.3</span> Use Case #3. Dedicated VMTAs per message stream.</h4>
<p>I am an ESP or an enterprise business with multiple customers/message streams. I have mapped my customers or message streams to individual VMTAs. I don't mix different message streams within a single VMTA. I want to selectively enable Signals for only some of my message streams but I want to disable Signals for all other customers.</p>
<pre><code>&lt;signals&gt;
  api-key 0123456789012345678901234567890123456789
&lt;/signals&gt;

enable-signals false

&lt;virtual-mta mktg&gt;
  enable-signals true
&lt;/virtual-mta&gt;

&lt;virtual-mta transact&gt;
&lt;/virtual-mta&gt;
</code></pre>
<p><strong>Result</strong> Signals data for all events in <code>mktg</code> virtual MTA is sent from this PowerMTA to SparkPost. No data is sent for any other virtual MTA in the system (all other VMTAs, including <code>transact</code> VMTA, inherit <code>enable-signals false</code> from global settings)</p>
<h4 id="use-case-4-dedicated-vmtas-per-message-stream-with-subaccounts"><span class="header-section-number">10.1.3.4</span> Use Case #4. Dedicated VMTAs per message stream, with subaccounts.</h4>
<p>I am an ESP or an enterprise business with multiple customers/message streams. I have mapped my customers or message streams to individual VMTAs. I don't mix different message streams within a single VMTA. I want to selectively enable Signals for only some of my message streams (and assign them a subaccount ID) but I want to disable Signals for all other customers.</p>
<pre><code>&lt;signals&gt;
  api-key 0123456789012345678901234567890123456789
&lt;/signals&gt;

enable-signals false

&lt;virtual-mta mktg&gt;
  enable-signals true,subaccount=100
&lt;/virtual-mta&gt;

&lt;virtual-mta sales&gt;
  enable-signals true,subaccount=200
&lt;/virtual-mta&gt;


&lt;virtual-mta transact&gt;
&lt;/virtual-mta&gt;
</code></pre>
<p><strong>Result</strong> Signals data for all events in <code>mktg</code> and <code>sales</code> virtual MTAs are sent from this PowerMTA to SparkPost. Each event will have the subaccount ID configured for that VMTA, (<code>mktg</code> events will have subaccount ID 100, while <code>sales</code> VMTA events will have subaccount ID set to 999). No data is sent for any other virtual MTA in the system (all other VMTAs, including <code>transact</code> VMTA, inherit <code>enable-signals false</code> from global settings)</p>
<h4 id="use-case-5-use-of-vmta-pools"><span class="header-section-number">10.1.3.5</span> Use Case #5. Use of VMTA pools.</h4>
<p>I am an ESP or an enterprise business with multiple customers/message streams. I have mapped my customers or message streams to individual VMTAs. Some of my large message streams have been assigned multiple VMTAs, all of which are in a pool. I want to enable Signals for a large message stream using a pool, but keep Signals disabled for all other message streams.</p>
<pre><code>&lt;signals&gt;
  api-key 0123456789012345678901234567890123456789
&lt;/signals&gt;

enable-signals false

&lt;virtual-mta v1&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta v2&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta transact&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta-pool pond&gt;
    virtual-mta v1
    virtual-mta v2

    enable-signals true
&lt;/virtual-mta-pool&gt;
</code></pre>
<p><strong>Result</strong> Signals data for all events in <code>v1</code> and <code>v2</code> virtual MTAs (because they inherit <code>enable-signals true</code> from <code>pond</code> virtual MTA pool) are sent from this PowerMTA to SparkPost. No data is sent for any other virtual MTA in the system (all other VMTAs, including <code>transact</code> VMTA, inherit <code>enable-signals false</code> from global settings). This data can also be configured to have a subaccount ID.</p>
<h4 id="use-case-6-use-of-shared-vmtas"><span class="header-section-number">10.1.3.6</span> Use Case #6. Use of shared VMTAs.</h4>
<p>I am an ESP or an enterprise business with multiple customers/message streams that mixes multiple message streams within a single shared VMTA. I need to enable Signals for only some of the mail streams that go out from the shared VMTA but not all. Each mail stream uses a unique <code>sender-or-from</code> domain.</p>
<pre><code>&lt;signals&gt;
  api-key 0123456789012345678901234567890123456789
&lt;/signals&gt;

enable-signals false

&lt;signals-filter ListOne&gt;

   sender-or-from  mktg.customer1.com             enable-signals,subaccount=100

   sender-or-from  sales.customer1.com            enable-signals,subaccount=100

   sender-or-from  sales.customer2.com            enable-signals,subaccount=999

&lt;/signals-filter&gt;

&lt;virtual-mta v1&gt;
    enable-signals ListOne
&lt;/virtual-mta&gt;

&lt;virtual-mta transact&gt;
&lt;/virtual-mta&gt;
</code></pre>
<p><strong>Result</strong> Signals data for all events with <code>mktg.customer1.com</code> or <code>sales.customer1.com</code> as their <code>sender-or-from</code> domain are sent from this PowerMTA to SparkPost with subaccount ID set to 100. Similarly, data for all events with <code>sales.customer2.com</code> as their <code>sender-or-from</code> domain are sent from this PowerMTA to SparkPost with subaccount ID set to 999. No data is sent for any other <code>sender-or-from</code> domain that is used for sending within this virtual MTA. No data is sent for any other <code>sender-or-from</code> domain within <code>v1</code> virtual MTA, or any other virtual MTAs in the system (all other VMTAs, including <code>transact</code> VMTA, inherit <code>enable-signals false</code> from global settings)</p>
<h4 id="use-case-7-use-of-shared-vmtas-wildcard-support"><span class="header-section-number">10.1.3.7</span> Use Case #7: Use of shared VMTAs (wildcard support)</h4>
<p>I am an ESP or an enterprise business with customers/multiple message streams that mixes multiple message streams within a single shared VMTA. I need to enable Signals for all mail streams that go out from the shared VMTA with a common subdomain (<code>*.customer1.com</code>) as their <code>sender-or-from</code> address. I also want to disable Signals for some mail streams that use a specific <code>sender-or-from</code> domain from within that shared VMTA.</p>
<pre><code>&lt;signals&gt;
  api-key 0123456789012345678901234567890123456789
&lt;/signals&gt;

enable-signals false

&lt;signals-filter ListOne&gt;

   sender-or-from  *.customer1.com             enable-signals,subaccount=100

   sender-or-from  transact.customer1.com      disable-signals

&lt;/signals-filter&gt;

&lt;virtual-mta v1&gt;
    enable-signals ListOne
&lt;/virtual-mta&gt;

&lt;virtual-mta transact&gt;
&lt;/virtual-mta&gt;
</code></pre>
<p><strong>Result</strong> Signals data for all events with <code>.customer1.com</code> as their <code>sender-or-from</code> domain suffix are sent from this PowerMTA to SparkPost with subaccount ID set to 100. The only exception is that events with <code>sender-or-from</code> domain set to <code>transact.customer1.com</code> within this virtual MTA are not sent to SparkPost. No data is sent for any other virtual MTA in the system (all other VMTAs, including <code>transact</code> VMTA, inherit <code>enable-signals false</code> from global settings)</p>
<h4 id="use-case-8-global-level-configuration"><span class="header-section-number">10.1.3.8</span> Use Case #8: Global level configuration.</h4>
<p>I want a single, global location where I can enable/disable Signals for all the <code>sender-or-from</code> domains I use to mail from, irrespective of the virtual MTA that the email goes out of.</p>
<pre><code>&lt;signals&gt;
  api-key 0123456789012345678901234567890123456789
&lt;/signals&gt;

enable-signals ListOne

&lt;signals-filter ListOne&gt;

   sender-or-from  *.foo.com             enable-signals,subaccount=100

   sender-or-from  transact.foo.com      disable-signals

&lt;/signals-filter&gt;

&lt;virtual-mta v1&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta v2&gt;
&lt;/virtual-mta&gt;
</code></pre>
<p><strong>Result</strong> Signals data for all events in the system, irrespective of the VMTA they were generated from, with <code>.foo.com</code> as their <code>sender-or-from</code> domain suffix are sent from this PowerMTA to SparkPost with subaccount ID set to 100. The only exception is that events with <code>sender-or-from</code> domain set to <code>transact.foo.com</code> are not sent to SparkPost.</p>
<h4 id="use-case-9-global-level-configuration-example-2"><span class="header-section-number">10.1.3.9</span> Use Case #9: Global level configuration, example #2.</h4>
<p>I want to enable Signals for all Virtual MTAs in the system, but I don't want Signals enabled for the VMTAs used for transactional and personal email streams. I also want to be able to configure the specific <code>sender-or-from</code> domains that Signals is enabled for, and keep Signals disabled for the rest of the domains.</p>
<pre><code>&lt;signals&gt;
  api-key 0123456789012345678901234567890123456789
&lt;/signals&gt;

enable-signals ListOne

&lt;signals-filter ListOne&gt;

   sender-or-from  mail.customer1.com              enable-signals,subaccount=100
   sender-or-from  sales.customer1.com             enable-signals,subaccount=200
   sender-or-from  mktg.customer1.com              enable-signals,subaccount=300
   sender-or-from  foo.customer1.com               enable-signals,subaccount=400
   sender-or-from  bar.customer1.com               enable-signals,subaccount=500
   sender-or-from  baz.customer1.com               enable-signals,subaccount=600

   sender-or-from  *                               disable-signals

&lt;/signals-filter&gt;

&lt;virtual-mta v1&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta v2&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta transact&gt;
   enable-signals false
&lt;/virtual-mta&gt;

&lt;virtual-mta personal&gt;
   enable-signals false
&lt;/virtual-mta&gt;
</code></pre>
<p><strong>Result</strong> Signals data for all events in the system with any of <code>{mail|sales|mktg|foo|bar|baz}.customer1.com</code> as their <code>sender-or-from</code> domain suffix are sent from this PowerMTA to SparkPost along with their respective subaccount IDs.</p>
<p>Events belonging to <code>personal</code> or <code>transact</code> VMTAs, or having any other <code>sender-or-from</code> domain other than the ones listed above are not sent to SparkPost.</p>
<h3 id="configuration-directives-1"><span class="header-section-number">10.1.4</span> Configuration Directives</h3>
<p>Signals configuration is done within the <code>&lt;signals&gt;</code> tag. Note that there is no need to designate which records and record fields to send to SparkPost - all the record types and fields needed for Signals are automatically configured by PowerMTA.</p>
<p>Note: It's recommended to restart PowerMTA after the <code>&lt;signals&gt;</code> tag has been added to the configuration or any signals-related settings have been changed. While a reload is all that is required, a restart will ensure that all internal processes start working with the new settings immediately.</p>
<p>You also have the option of configuring PowerMTA to only transmit data for designated virtual MTAs, virtual MTA pools or sending domains to Signals. See <a href="#enable-signals">enable-signals</a> directive and <a href="#optional-data-loading-support">Optional Data Loading Support</a> section for more details.</p>
<p>In prior versions of PowerMTA, <code>&lt;signals&gt;</code> tag was called <code>&lt;sparkpost-analytics&gt;</code>, which is deprecated. Please use <code>signals</code> instead.</p>
<p>The available internal directives are as follows.</p>
<h4 id="global-directives-1"><span class="header-section-number">10.1.4.1</span> Global Directives</h4>
<h5 id="enable-signals"><span class="header-section-number">10.1.4.1.1</span> enable-signals</h5>
<p>This directive can be used at global, VMTA pool or VMTA scopes to enable/disable generation of Signals events at that scope level. When this directive is set to <code>true</code>, it can also be optionally suffixed with the <a href="#sparkpost-subaccounts">subaccount</a> information in Signals for the events generated within that scope.</p>
<p>If this directive is unspecified at global level, then it defaults to <code>true</code> if a <code>&lt;signals&gt;</code> tag has been added to PowerMTA configuration. This is in order to maintain compatibility with how the feature was enabled in previous versions.</p>
<p>Normal rules for inheritance apply to this directive. A virtual MTA inherits this setting from both pool and global scopes, with the pool scope taking precedence over the global scope.</p>
<p><strong>Syntax:</strong></p>
<pre><code>enable-signals {true[,subaccount=N] | false | &lt;signals-filter-name&gt;}
</code></pre>
<p>where <code>N</code> is a <a href="#sparkpost-subaccounts">subaccount</a> ID obtained from SparkPost.</p>
<p>Note that <code>subaccount</code> ID can only be specified when <code>enable-signals</code> is set to <code>true</code>. It cannot be specified when <code>enable-signals</code> is <code>false</code> or set alongside a <a href="#signals-filter-directives">&lt;signals-filter&gt;</a> list.</p>
<p><strong>Default:</strong> <code>true</code> at global level if <code>&lt;signals&gt;</code> has been configured; <code>false</code> otherwise</p>
<p><strong>Example #1:</strong></p>
<pre><code># at global scope, inherited by all VMTAs in the system.
enable-signals true,subaccount=555

# at pool scope, inherited by all VMTAs in the pool
&lt;virtual-mta-pool pond&gt;
   enable-signals true,subaccount=999

   virtual-mta v1
   virtual-mta v2
   virtual-mta v3
   virtual-mta v4
&lt;/virtual-mta-pool&gt;

# inherits pool setting
&lt;virtual-mta v1&gt;
&lt;/virtual-mta&gt;

# overrides all inheritance
&lt;virtual-mta v2&gt;
   enable-signals true,subaccount=888
&lt;/virtual-mta&gt;

# inherits pool setting
&lt;virtual-mta v3&gt;
&lt;/virtual-mta&gt;

# overrides all inheritance
&lt;virtual-mta v4&gt;
   enable-signals false
&lt;/virtual-mta&gt;

# inherits global setting
&lt;virtual-mta v5&gt;
&lt;/virtual-mta&gt;

</code></pre>
<p><strong>Example #2:</strong></p>
<pre><code>&lt;signals&gt;
    api-key 0123456789012345678901234567890123456789
&lt;/signals&gt;
</code></pre>
<p>In the above example, <code>enable-signals</code> defaults to <code>true</code> since its not explicitly set at global level but a <code>signals</code> tag is present in the configuration.</p>
<h4 id="signals-directives"><span class="header-section-number">10.1.4.2</span> &lt;signals&gt; Directives</h4>
<h5 id="api-key-1"><span class="header-section-number">10.1.4.2.1</span> api-key</h5>
<p>Specifies the API key (obtained from SparkPost) that authorizes this PowerMTA to the Signals server. Required.</p>
<p>Must be composed of exactly 40 hexadecimal digits (0-9 A-F a-f).</p>
<p><strong>Example:</strong></p>
<pre><code>&lt;signals&gt;
    api-key 0123456789abcdef012345678901234567890123
&lt;/signals&gt;
</code></pre>
<h5 id="upload-url"><span class="header-section-number">10.1.4.2.2</span> upload-url</h5>
<p>Specifies the SparkPost Signals server URL where the accounting data is sent.</p>
<p><strong>Default:</strong></p>
<pre><code>https://api.sparkpost.com/api/v1/ingest/events
</code></pre>
<p><strong>Example:</strong></p>
<pre><code>&lt;signals&gt;
    api-key 0123456789012345678901234567890123456789
    upload-url https://api.sparkpost.com/api/v1/ingest/events
&lt;/signals&gt;
</code></pre>
<h5 id="engagement-tracking"><span class="header-section-number">10.1.4.2.3</span> engagement-tracking</h5>
<p>This directive must be set to <code>true</code> for Signals Health Score to be calculated. Note that transmission of engagement events such as open and click events is done outside of PowerMTA. Contact SparkPost Support for more help in getting Signals Health Score when using PowerMTA.</p>
<p>Note that this directive needs to be set to <code>true</code> only if you plan to send engagement events such as open and click events to SparkPost Signals. If you don't intend to use SparkPost Signals to track engagement events, this directive should be set to <code>false</code>.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;signals&gt;
    api-key 0123456789012345678901234567890123456789
    engagement-tracking true
&lt;/signals&gt;
</code></pre>
<h5 id="custom-message-id-header"><span class="header-section-number">10.1.4.2.4</span> custom-message-id-header</h5>
<p>Allows setting the name of a header that will be used to set the <code>custom_message_id</code> in Signals events. This field is used by Signals to correlate open and click events with other Signals events for a message. This correlation is important for getting the full benefits of the Signals analytics suite. The ID specified by the header can be up to 512 ASCII characters. If using Mailmerge, you must use the <code>*custommessageid</code> variable, not the header.</p>
<p>Sample header:</p>
<pre><code>x-my-msgid: 01234.abc@mysite
</code></pre>
<p><strong>Default:</strong> <code>none</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;signals&gt;
    api-key 0123456789012345678901234567890123456789
    custom-message-id-header x-my-msgid
&lt;/signals&gt;
</code></pre>
<h5 id="process-x-sp-subaccount-id"><span class="header-section-number">10.1.4.2.5</span> process-x-sp-subaccount-id</h5>
<p>Specifies whether PowerMTA should process an <code>x-sp-subaccount-id</code> header. If set to true and one such header is included, PowerMTA will use the value to set the subaccount ID in Signals events. If set to false, PowerMTA will ignore this header, leaving it in the message if present. The subaccount ID must be an unsigned integer greater than zero. If using Mailmerge, you must use the <code>*subaccountid</code> variable, not this header. If the <code>*subaccountid</code> variable is set, or this header is enabled and present in the message, a subaccount determined by a configuration file directive will be ignored.</p>
<p>Sample header:</p>
<pre><code>x-sp-subaccount-id: 123
</code></pre>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;signals&gt;
    api-key 0123456789012345678901234567890123456789
    process-x-sp-subaccount-id true
&lt;/signals&gt;
</code></pre>
<h5 id="retain-x-sp-subaccount-id"><span class="header-section-number">10.1.4.2.6</span> retain-x-sp-subaccount-id</h5>
<p>Specifies whether PowerMTA should retain a processed <code>x-sp-subaccount-id</code> header. If set to true or <code>process-x-sp-subaccount-id</code> is false, PowerMTA will keep the header in the message when sending it on.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;signals&gt;
    api-key 0123456789012345678901234567890123456789
    process-x-sp-subaccount-id true
    retain-x-sp-subaccount-id true
&lt;/signals&gt;
</code></pre>
<h5 id="log-verbose"><span class="header-section-number">10.1.4.2.7</span> log-verbose</h5>
<p>Causes all upload activity to be logged. If not set, upload activity is summarized and logged at regular intervals. Enable this setting to help diagnose upload problems.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;signals&gt;
    api-key 0123456789012345678901234567890123456789
    log-verbose true
&lt;/signals&gt;
</code></pre>
<h5 id="min-free-space-1"><span class="header-section-number">10.1.4.2.8</span> min-free-space</h5>
<p>Instructs PowerMTA to start deleting SparkPost accounting data files if the space available on the file system falls below the amount specified. Note that these files are normally deleted once the contents have been sent to the SparkPost Signals server, so space should only run low if there is a problem such as the Signals server being down or too busy or an incorrect configuration. Once these files are deleted, that data is lost forever, and there will be "holes" in the Signals reports.</p>
<p>On Unix, this refers to the space available to non-<code>root</code> users in <code>/var/lib/pmta/sparkpost</code>.</p>
<p><strong>Syntax:</strong></p>
<pre><code>min-free-space { N{b|k|m|g|t} | 0 }
</code></pre>
<p>where <code>N</code> is a positive integer followed by a size multiplier (<code>B</code> for byte, <code>K</code> for Kilobyte, <code>M</code> for Megabyte, <code>G</code> for Gigabyte or <code>T</code> for Terabyte).</p>
<p><strong>Default:</strong> <code>20M</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;signals&gt;
    api-key 0123456789012345678901234567890123456789
    min-free-space 1G
&lt;/signals&gt;
</code></pre>
<h5 id="privacy-policy-1"><span class="header-section-number">10.1.4.2.9</span> privacy-policy</h5>
<p>This directive can be used to tell PowerMTA to hash (with the one-way SHA-1 hash) the lower-cased rcpt address in the data sent to the Signals server.</p>
<p><strong>Syntax:</strong></p>
<pre><code>privacy-policy { retain | sha1 }
</code></pre>
<p><strong>Default:</strong> <code>retain</code></p>
<p><strong>Example:</strong></p>
<pre><code>&lt;signals&gt;
    api-key 0123456789012345678901234567890123456789
    privacy-policy sha1
&lt;/signals&gt;
</code></pre>
<h4 id="signals-filter-directives"><span class="header-section-number">10.1.4.3</span> &lt;signals-filter&gt; Directives</h4>
<h5 id="sender-or-from"><span class="header-section-number">10.1.4.3.1</span> sender-or-from</h5>
<p>Another way to designate the specific events for Signals is to use the domain portion of <code>Sender</code> or <code>From</code> headers within the content of the email to filter. This permits filtering independent of the virtual MTA that the email was received or delivered out of.</p>
<p><strong>Syntax:</strong></p>
<pre><code>&lt;signals-filter NAME&gt;
   sender-or-from  &lt;domain-pattern&gt;  { enable-signals[,subaccount=N] | disable-signals}
&lt;/signals-filter&gt;
</code></pre>
<p>where <code>N</code> is a <a href="#sparkpost-subaccounts">subaccount</a> ID obtained from SparkPost.</p>
<p>Note that <code>subaccount</code> ID can only be specified when <code>enable-signals</code> is set. It cannot be specified when <code>disable-signals</code> is set.</p>
<p><strong>Example:</strong></p>
<pre><code># at global scope, inherited by all VMTAs in the system.
&lt;signals-filter ListOne&gt;

  sender-or-from  marketing.customer1.com   enable-signals,subaccount=555
  sender-or-from  transact.customer1.com    disable-signals
  sender-or-from  *.customer1.com           enable-signals,subaccount=333

  sender-or-from  *                         enable-signals,subaccount=222

&lt;/signals-filter&gt;

&lt;signals-filter ListTwo&gt;

  sender-or-from  sales.customer2.com       enable-signals,subaccount=999

&lt;/signals-filter&gt;

&lt;signals-filter ListThree&gt;

  sender-or-from  *                         enable-signals,subaccount=777

&lt;/signals-filter&gt;


enable-signals ListOne

# at pool scope, inherited by all VMTAs in the pool
&lt;virtual-mta-pool pond&gt;
   enable-signals ListTwo

   virtual-mta v1
   virtual-mta v2
   virtual-mta v3
   virtual-mta v4
&lt;/virtual-mta-pool&gt;

# inherits pool setting
&lt;virtual-mta v1&gt;
&lt;/virtual-mta&gt;

# overrides all inheritance
&lt;virtual-mta v2&gt;
   enable-signals ListThree
&lt;/virtual-mta&gt;

# inherits pool setting
&lt;virtual-mta v3&gt;
&lt;/virtual-mta&gt;

# overrides all inheritance
&lt;virtual-mta v4&gt;
   enable-signals false
&lt;/virtual-mta&gt;

# inherits global setting
&lt;virtual-mta v5&gt;
&lt;/virtual-mta&gt;

</code></pre>
<h3 id="summary-report-display"><span class="header-section-number">10.1.5</span> Summary Report Display</h3>
<p><img src="media/SPRepSummary.png" /></p>
<p>The Summary report provides you the ability to view a variety of <a href="https://www.sparkpost.com/docs/reporting/metrics-definitions/">metrics</a>, adjust reporting date range, and filter by campaign (jobID), recipient domain, or other metrics by clicking on the desired value in the "Group By" listing.</p>
<p>The following "Group By" options are available for viewing detailed data:</p>
<ul>
<li><strong>Recipient Domain</strong></li>
<li><strong>Sending Domain</strong> - the domain portion of the "Sender" or "From" header</li>
<li><strong>Campaign</strong> - the jobID</li>
<li><strong>Sending IP</strong></li>
<li><strong>IP Pool</strong> - the VirtualMTA pool</li>
</ul>
<p>For more information, see <a href="https://www.sparkpost.com/docs/reporting/reporting-and-analytics/">https://www.sparkpost.com/docs/reporting/reporting-and-analytics/</a>.</p>
<h3 id="bounce-report-display"><span class="header-section-number">10.1.6</span> Bounce Report Display</h3>
<p><img src="media/SPRepBounce.png" /></p>
<p>The Bounce report provides detailed information about the bounces during the selected time period. Note that the bounces have been classified according to <a href="https://www.sparkpost.com/docs/deliverability/bounce-classification-codes/">SparkPost bounce classification codes</a> and will not correspond directly to PMTA bounce categories.</p>
<p>See <a href="https://www.sparkpost.com/docs/reporting/bounces/">https://www.sparkpost.com/docs/reporting/bounces/</a> for more information.</p>
<h3 id="signals-overview-display"><span class="header-section-number">10.1.7</span> Signals Overview Display</h3>
<p><img src="media/SPSignalsOverview.png" /></p>
<p>The Signals Overview contains leaderboards for the three signals provided: Health Score, Spam Trap Monitoring, and Engagement Recency. The Engagement Recency Summary is not yet supported in PMTA.</p>
<p>Each row in these tables contains the summary for a different subaccount, and can be further sliced by campaign (jobID), IP pool (VirtualMTA pool), or sending domain to help catch issues across any of these facets. Additionally, you can view the data for up to 90 days to analyze trends over time.</p>
<p>See <a href="https://www.sparkpost.com/docs/user-guide/signals/">https://www.sparkpost.com/docs/user-guide/signals/</a> for more information.</p>
<h3 id="spam-traps-display"><span class="header-section-number">10.1.8</span> Spam Traps Display</h3>
<p><img src="media/SPSpamTraps.png" /></p>
<p>With visibility across multiple commercial and non-commercial spam trap networks, SparkPost Signals is a crucial resource for maintaining the health of your email. Spam Trap Monitoring reports the share over time of your total email volume that was sent to known spam traps for each given day. This indicator is important to take note of since an excessive rate of spam trap hits indicates poor list procurement and hygiene practices. You can view the spam trap hits as a raw number or a ratio over the number of injections for that day.</p>
<p>See <a href="https://www.sparkpost.com/docs/user-guide/signals/#spam-trap-monitoring">https://www.sparkpost.com/docs/user-guide/signals/#spam-trap-monitoring</a> for more information.</p>
<h2 id="haproxy-protocol-for-outbound-traffic"><span class="header-section-number">10.2</span> HAProxy Protocol for outbound traffic</h2>
<p>For customers that own multiple source IPs distributed across many PowerMTA installations, we offer support for proxy protocol that helps make administration easier. With this feature, you can now deploy any number of PowerMTAs within your network to use internal IPs. All external facing source IPs can be deployed on a single proxy machine. The internal PowerMTA machines will not connect to the remote MTAs (like gmail.com, yahoo.com) directly, but instead connect through the proxy. The proxy protocol support in PowerMTA will let the proxy server know which external facing source IP to use when connecting to the remote IPs.</p>
<p>PowerMTA can be configured to use a proxy server that supports HAProxy protocol version 1 (see <a href="https://www.haproxy.org/download/1.8/doc/proxy-protocol.txt">https://www.haproxy.org/download/1.8/doc/proxy-protocol.txt</a> for more details about the protocol) for delivering email to the outside world. When PowerMTA is configured to use a proxy for outbound traffic, PowerMTA will perform DNS resolution of the destination domain as usual, but when delivering email, it will connect to the configured proxy server instead of directly connecting to the remote destination MTA. PowerMTA will transmit the client and destination IPs that it wants to connect to as part of the proxy header. It is the responsibility of the proxy server to interpret the protocol header to connect to the destination IP address using the requested client IP address.</p>
<p>When a proxy is configured, for deliveries and bounces, PowerMTA will report the client IP as the source IP address("dlvSourceIp" in CSV accounting file) and the destination MTA's IP as the destination IP ("dlvDestinationIp" in the CSV accounting file). The fact that it used a proxy to deliver the email is transparent when looking at the data in accounting files.</p>
<p>Note that proxy protocol support is only for outbound traffic from PowerMTA to remote MTAs. We will be extending PowerMTA to support proxy protocol for traffic inbound into PowerMTA in subsequent releases.</p>
<p><strong>Example</strong></p>
<p>In the configuration below, PowerMTA is configured to use 2 proxy servers:</p>
<ol>
<li><p><code>mta-proxy-a</code> This proxy server listens on IP <code>10.1.2.3</code>, port 5000 for incoming connections. When making outgoing connections, this proxy will use the external facing IP <code>16.70.55.233</code> (used here for illustration purpose only) and the hostname <code>client.hostname.com</code>.</p></li>
<li><p><code>mta-proxy-b</code> This proxy server listens on hostname <code>mta-proxy-b.internal.hostname.com</code>, port 5000 for incoming connections. When making outgoing connections, this proxy will use the external facing IP <code>16.80.77.192</code> (used here for illustration purpose only) and the hostname <code>client2.hostname.com</code>.</p></li>
</ol>
<p>There is one virtual MTA on PowerMTA.</p>
<ol>
<li>vmta This virtual MTA is configured to use an internal IP 10.8.9.10 (with the hostname <code>vmta.hostname.com</code>) to connect to the proxy nodes. The virtual MTA <code>vmta</code> is configured to use the 2 proxy nodes defined above. The second proxy node is used only when the connection to the first proxy node fails for any reason.</li>
</ol>
<pre><code>&lt;proxy mta-proxy-a&gt;
  # the proxy server listens on IP 10.1.2.3, port 5000 for incoming connections
  server 10.1.2.3:5000
  # the client IP tells the proxy what source IP to use when connecting to the destination host
  client 16.70.55.233:0  client.hostname.com
&lt;/proxy&gt;

# You can configure multiple proxies, each with its own name, proxy server IP and client IP configuration
&lt;proxy mta-proxy-b&gt;
  # the proxy server listens on IP 10.5.6.7, port 5000 for incoming connections
  server mta-proxy-b.internal.hostname.com:5000

  # the client IP tells the proxy what source IP to use when connecting to the destination host
  # PowerMTA only checks for syntactic validity of the client IP address, and it cannot verify that
  # the client IP address has been configured on the proxy server.
  client 16.80.77.192:0  client2.hostname.com
&lt;/proxy&gt;


&lt;virtual-mta vmta&gt;
   # The &quot;smtp-source-host&quot; is used to configure the source IP that PowerMTA will connect to the proxy server from
   # The IP address must be configured on the machine on which PowerMTA runs
   # The IP address is completely independent of the client IP address that the proxy will use to connect to the destination
   smtp-source-host 10.8.9.10 vmta.hostname.com

   # &quot;use-proxy&quot; directive is used to configure the proxy server(s) that PowerMTA will use when connecting to destination MTAs.
   # This directive takes a comma separated list of proxy server names.
   # PowerMTA will connect to proxies strictly in the order defined - PowerMTA will only use the second proxy if the connection
   # to the first proxy fails, and similarly for the third.
   # PowerMTA does NOT roundrobin or load balance its outgoing connections between the configured proxy servers.
   # Configuring multiple proxies is strictly for helping with failover.

    use-proxy mta-proxy-a,mta-proxy-b  # &quot;mta-proxy-a&quot; is always used unless connections to it fail. &quot;mta-proxy-b&quot; is used only when connecting to &quot;mta-proxy-a&quot; fails

&lt;/virtual-mta&gt;
</code></pre>
<h3 id="directives"><span class="header-section-number">10.2.1</span> Directives</h3>
<h4 id="proxy"><span class="header-section-number">10.2.1.1</span> proxy</h4>
<p>The <code>proxy</code> tag is used to configure a proxy server for use by a virtual MTA. It must be named. A <code>proxy</code> tag must have both <code>server</code> and <code>client</code> directives defined within it.</p>
<h5 id="server"><span class="header-section-number">10.2.1.1.1</span> server</h5>
<p>The <code>server</code> directive within a <code>proxy</code> tag is used to configure the hostname or the IP address and the port of the proxy server.</p>
<p><strong>Syntax:</strong></p>
<pre><code>server {IP | hostname }:PORT
</code></pre>
<p><strong>Example</strong></p>
<pre><code>&lt;proxy mta-proxy-a&gt;
  server 10.1.2.3:5000
  client 16.80.99.192:0  client.hostname.com
&lt;/proxy&gt;


&lt;proxy mta-proxy-b&gt;
  server proxy.internal.hostname.com:9999
  client 16.80.77.101:0  client2.hostname.com
&lt;/proxy&gt;
</code></pre>
<h5 id="client"><span class="header-section-number">10.2.1.1.2</span> client</h5>
<p>The <code>client</code> directive within a <code>proxy</code> tag is be used to configure the IP address that the proxy server must use when connecting to the remote destinations. A port number is not required, and if unspecified, the port number will default to zero. A hostname must be defined.</p>
<p><strong>Syntax:</strong></p>
<pre><code>client IP[:PORT] hostname
</code></pre>
<p><strong>Example</strong></p>
<pre><code>&lt;proxy mta-proxy-a&gt;
  server 10.1.2.3:5000
  client 16.80.99.192  client.hostname.com
&lt;/proxy&gt;


&lt;proxy mta-proxy-b&gt;
  server proxy.internal.hostname.com:9999
  client 16.80.77.101  client2.hostname.com
&lt;/proxy&gt;
</code></pre>
<h2 id="sender-reputation-monitoring"><span class="header-section-number">10.3</span> Sender Reputation Monitoring</h2>
<h3 id="overview-4"><span class="header-section-number">10.3.1</span> Overview</h3>
<p>One of the keys to maximizing deliverability to valid domains is to know as soon as possible when specific delivery problems occur. The sooner one realizes that there are certain problems, or more specifically, that a remote site is rejecting messages for one reason or another, the sooner one can attempt to get the problems resolved. There are many different kinds of errors that remote sites can respond with when connected, both positive and negative, and these responses allow you to see your current sender reputation in the eyes of that recipient domain or mail gateway.</p>
<p>Given the importance of having this information as soon as possible, PowerMTA includes automated sender reputation monitoring, via an advanced, real time SMTP command monitoring implementation. Not only does it give you an early warning alert system for specific types of errors, but it can also be configured to try and possibly resolve some problems as well, via support for automated configuration changes for future delivery attempts.</p>
<h3 id="implementation"><span class="header-section-number">10.3.2</span> Implementation</h3>
<p>PowerMTA groups messages for a particular domain for a particular VirtualMTA in its own queue. Sender reputation monitoring provides real time monitoring of defined SMTP responses (e.g., "551 Sender IP rejected") from remote hosts for each queue, with the ability to define certain actions (e.g., send an email alert while throttling deliveries, lower the rate at which messages are delivered etc.) upon a match.</p>
<p>This is accomplished through the introduction of queue "modes". The two modes initially supported are "normal" and "backoff". You can configure PowerMTA so that when a queue enters backoff mode, it</p>
<ul>
<li><p>sends an email alert to one or more addresses (<code>backoff-notify</code> directive).</p></li>
<li><p>dynamically changes the retry schedule for that queue (<code>backoff-retry-after directive</code>).</p></li>
<li><p>dynamically applies per-queue delivery throttling (<code>backoff-max-msg-rate directive</code>).</p></li>
<li><p>dynamically reroutes the messages from one VirtualMTA to another VirtualMTA (<code>backoff-reroute-to-virtual-mta directive</code>).</p></li>
</ul>
<p>The dynamic reroute, combined with the ability to have separate per domain configurations per VirtualMTA, allows one to use the full range of domain directives beyond the new <code>backoff-...</code> directives (e.g., using <code>bounce-after</code>), as well as VirtualMTA attributes, for the fallback queue. A chain of backoff VirtualMTAs is also supported (vmta -&gt; vmta1, vmta1 -&gt; vmta2, vmta2 -&gt; vmta3, etc.).</p>
<p>SMTP response matching is performed based on a list of regular expressions, entered in an <code>smtp-pattern-list</code> directive in the configuration file.</p>
<p>For example, you could define a list of errors that might occur during deliveries to AOL in an <code>smtp-pattern-list</code> named aol-errors, and specify that the queue be put in backoff mode if any such match:</p>
<pre><code>&lt;smtp-pattern-list aol-errors&gt;
    reply /generating high volumes of.* complaints from AOL/ mode=backoff
    reply /Excessive unknown recipients - possible Open Relay/ mode=backoff
    reply /^421 .* too many errors/ mode=backoff
    reply /blocked.*spamhaus/ mode=backoff
    reply /451 Rejected/ mode=backoff
&lt;/smtp-pattern-list&gt;
</code></pre>
<p>You would then indicate that PowerMTA should match based on that pattern list while delivering to aol.com:</p>
<pre><code>&lt;domain aol.com&gt;
    ...
    smtp-pattern-list aol-errors
    ...
&lt;/domain&gt;
</code></pre>
<p>Finally, also within that domain definition, you would specify certain backoff-... actions to be taken when the queue enters backoff mode:</p>
<pre><code>&lt;domain aol.com&gt;
    ...
    smtp-pattern-list aol-errors # SMTP response pattern list to use
    backoff-max-msg-rate 120/h # 10 messages per 5 min interval
    backoff-retry-after 1h # retry every hour
    backoff-notify postmaster@yourdomain.com
    ...
&lt;/domain&gt;
</code></pre>
<p>Upon the first match of the SMTP response, the queue for aol.com for this particular VirtualMTA will enter backoff mode, dynamically applying the specific backoff-... directives:</p>
<ul>
<li><p>send an email alert to the defined PowerMTA postmaster address.</p></li>
<li><p>change the retry interval to aol.com for this particular VirtualMTA to 1 hour.</p></li>
<li><p>throttle the delivery rates to aol.com for this particular VirtualMTA to at most 120 attempted deliveries per hour.</p></li>
</ul>
<p>The backoff directives apply until the mode for the queue is returned to normal, which can be accomplished either within an <code>smtp-pattern-list</code> (by specifying a <code>mode=normal</code> for a pattern), or with the <code>pmta set queue</code> command, or by restarting PowerMTA. In the example above, the command to return that queue to normal mode would be</p>
<p><code>pmta set queue --mode=normal aol.com</code></p>
<p>Defining backoff VirtualMTAs is also relatively straightforward, using the <code>backoff-reroute-to-virtual-mta</code> directive. It simply specifies that PowerMTA should reroute messages to the given VirtualMTA in case the queue enters backoff mode.</p>
<p>For example, if messages are queued for example.port25.com/vmta1 and that queue enters backoff mode while <code>backoff-reroute-to-virtual-mta</code> is set to vmta2, all of its messages would be rerouted to the queue example.port25.com/vmta2. Since the messages would then be queued within vmta2, that VirtualMTA's settings would apply. New messages entering the queue are also immediately rerouted to the new VirtualMTA, as long as the vmta1 queue remains in backoff mode.</p>
<p>For example, one could define a backoff VirtualMTA as follows:</p>
<pre><code>&lt;virtual-mta mta1&gt;
    smtp-source-host 1.1.1.1 mta1.port25.com

    &lt;domain *&gt;
        backoff-reroute-to-virtual-mta backoff-mta1
        smtp-pattern-list block-errors
    &lt;/domain&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta backoff-mta1&gt;
    smtp-source-host 1.1.1.2 mta2.port25.com

    &lt;domain *&gt;
        retry-after 30m
        bounce-after 1h
    &lt;/domain&gt;
&lt;/virtual-mta&gt;
</code></pre>
<p>With this, if there is an SMTP pattern match for any domain for VirtualMTA mta1, any messages in that specific queue will be delivered using the domain directives and VirtualMTA parameters defined in VirtualMTA backoff-mta1. As desired, the backoff parameters will <em>only</em> apply to messages for the specific queue, that is, for messages in the queue whose delivery attempts received the matched SMTP response.</p>
<p>Note that since the messages are really transferred from one VirtualMTA to another, the <code>backoff-reroute-to-virtual-mta</code> directive effectively takes precedence over <code>backoff-max-msg-rate</code> and <code>backoff-retry-after</code>.</p>
<h3 id="supporting-commands"><span class="header-section-number">10.3.3</span> Supporting commands</h3>
<p>There are two commands that can be used for sender reputation monitoring and queue modes:</p>
<ul>
<li><p>pmta set queue --mode={normal|backoff} domain/vmta</p></li>
<li><p>pmta show queues</p></li>
</ul>
<p>The <code>set queue</code> command sets the given queue's mode of operation to either normal or backoff. See <a href="#set-queue"><code>set queue</code></a> for more information.</p>
<p>The <code>show queues</code> command allows you to view current information on the specified queues, including the current mode of the queue. See <a href="#show-queues"><code>show queues</code></a> for more information.</p>
<h2 id="smtp-auth-support"><span class="header-section-number">10.4</span> SMTP AUTH support</h2>
<h3 id="overview-5"><span class="header-section-number">10.4.1</span> Overview</h3>
<p>To facilitate creating a secure email delivery channel, PowerMTA supports authentication in both inbound and outbound SMTP connections.</p>
<h3 id="implementation-for-inbound-connections"><span class="header-section-number">10.4.2</span> Implementation for Inbound Connections</h3>
<p>PowerMTA supports authentication with either LOGIN, PLAIN or the CRAM-MD5 mechanism in inbound connections. Support for CRAM-MD5 is available whenever AUTH itself is enabled. The password is never sent when using CRAM-MD5 as it's a challenge/response authentication.</p>
<p>To use AUTH you must also create an <code>&lt;smtp-user&gt;</code> tag for each valid username, including their passwords, as well as the named source to use when that user authenticates, like in the example below:</p>
<pre><code>&lt;smtp-user jsmith&gt;
    password qwerty123
    source auth2
&lt;/smtp-user&gt;

&lt;smtp-user jdoe&gt;
    password abc123
    source auth1
&lt;/smtp-user&gt;
</code></pre>
<p>For maximum flexibility in supporting the various SASL authentication methods, the passwords must be entered in plaintext in the configuration file. Because of this, it is crucial that the PowerMTA config file permissions are set up as restrictively as possible.</p>
<p>The named source in the configuration file (that is a <code>&lt;source&gt;</code> entry that has a name rather than an IP address or CIDR specification), allows you to specify which <code>&lt;source&gt;</code> settings should apply on a per-user basis.</p>
<p>In the example above, and with the configuration file below, user <code>jsmith</code> would be allowed access to PowerMTA's mail merge extensions, while <code>jdoe</code> would not:</p>
<pre><code>&lt;source auth2&gt;
    allow-mailmerge yes
    always-allow-relaying yes # allow feeding for auth2
    process-x-virtual-mta yes # allow selection of a VirtualMTA
    max-message-size unlimited
    smtp-service yes          # allow SMTP service
    require-auth true
&lt;/source&gt;

&lt;source auth1&gt;
    allow-mailmerge no
    always-allow-relaying yes # allow feeding for auth1
    process-x-virtual-mta yes # allow selection of a VirtualMTA
    max-message-size unlimited
    smtp-service yes          # allow SMTP service
    require-auth true
&lt;/source&gt;
</code></pre>
<p>When users <code>jsmith</code> and <code>jdoe</code> authenticate, any settings in their named sources would override those settings normally obtained based on each connections' source IP address. This way, you can combine the usual IP-based settings (which apply to all connections) with specific settings based on the authenticated user.</p>
<p>Certificate based authentication is also supported with a configuration like the following:</p>
<pre><code>&lt;smtp-user jsmith&gt;
    authentication-method certificate
    tls-certificate /etc/pmta/jsmith.pem
    source auth3
&lt;/smtp-user&gt;

&lt;source auth3&gt;
    always-allow-relaying yes # allow feeding for auth2
    process-x-virtual-mta yes # allow selection of a VirtualMTA
    max-message-size unlimited
    smtp-service yes          # allow SMTP service
    require-auth true
&lt;/source&gt;
</code></pre>
<p>In the above example, <code>jsmith</code> can authenticate with the certificate given in <code>jsmith.pem</code> file, and relay through PowerMTA. <code>&lt;source {auth}&gt;</code> would apply to any users that dont have <code>&lt;source&gt;</code> set.</p>
<h3 id="implementation-for-outbound-connections"><span class="header-section-number">10.4.3</span> Implementation for Outbound Connections</h3>
<p>PowerMTA supports authentication with the CRAM-MD5, LOGIN, or PLAIN mechanisms in outbound connections, with additional mechanisms being considered for a future version.</p>
<p>To have PowerMTA authenticate to a remote mailhost when delivering messages to a domain, define the domain in the configuration file and specify the auth-username and auth-password directives. Authentication will be attempted only if the remote mailer supports CRAM-MD5, LOGIN, or PLAIN (LOGIN or PLAIN if using the <code>&lt;domain&gt;</code> directive <code>use-unencrypted-plain-auth yes</code>).</p>
<p>To illustrate how this feature could be used, consider the following scenario: an email service provider using PowerMTA is delivering email to secure.example.org, but that domain's corporate mail system will only accept mail from an authenticated source.</p>
<p>To satisfy the corporate mail system's requirement, one could configure PowerMTA to select a VirtualMTA based on pattern matching of the From: address (using the support for pattern matching of any RFC 2822 header), and within that VirtualMTA, configure the required username and password for all mail delivered to secure.example.org.</p>
<p>The VirtualMTA definition could look like:</p>
<pre><code>&lt;virtual-mta auth-mta&gt;
    smtp-source-host 1.2.3.4 vmta.esp.com
    ...

    &lt;domain secure.example.org&gt;
        auth-username costanza
        auth-password bosco
    &lt;/domain&gt;
&lt;/virtual-mta&gt;
</code></pre>
<p>With this, all mail delivered by this VirtualMTA to the domain of secure.example.org would attempt authentication, whereas all other mail delivered to this domain by other VirtualMTAs would not.</p>
<p>Note that authentication is not attempted if either <code>auth-username</code> or <code>auth-password</code> are not defined for a domain.</p>
<h2 id="automated-authentication"><span class="header-section-number">10.5</span> Automated Authentication</h2>
<p>To help maintain a strong sender reputation, PowerMTA can be configured to ensure SPF compliance by only delivering mail that passes SPF tests. Compliance checking is done based on the sender address (SMTP MAIL FROM and HELO domain), the source IP address to be used in the connection, and the SPF records published in the DNS. If the test results in anything other than a "Pass" or a "TempError", the message bounces.</p>
<p>To enable Automated Authentication for a domain, set the <code>check-spf-outbound</code> directive to yes in its definition in the configuration file (or in <code>&lt;domain *&gt;</code> for all domains).</p>
<p>When enabling this feature, it is advisable to disable it for the domains to which your bounces are delivered, if they are delivered via SMTP. This way, if the check fails, there is no risk of these bounces being lost ("double-bouncing") due to some problem in your bounce domain's SPF records.</p>
<p>For example, if your MAIL FROM domain was yourbouncedomain.com, you could configure:</p>
<pre><code>&lt;domain yourbouncedomain.com&gt;
    check-spf-outbound no
&lt;/domain&gt;

&lt;domain *&gt;
    check-spf-outbound yes
&lt;/domain&gt;
</code></pre>
<p>Note that since a specific IP address is needed for the Automated Authentication check, you will need to make sure that the IP address(es) used by PowerMTA for outbound connections are defined in the configuration file (via the <code>smtp-source-host</code> directive). If no specific source IPs are defined, PowerMTA cannot perform the SPF check. It then generates an error message in the log file and treats this like a transient ("4xx") error, keeping the messages in the queue and retrying until the bounce-after interval passes.</p>
<h2 id="dkim-support"><span class="header-section-number">10.6</span> DKIM support</h2>
<h3 id="overview-6"><span class="header-section-number">10.6.1</span> Overview</h3>
<p>DomainKeys Identified Mail (DKIM) is a sender authentication method based on cryptographically signing messages. Essentially, the steps to signing an email are:</p>
<ol>
<li><p>A public / private key pair is generated.</p></li>
<li><p>The public key is published in DNS, while the private key is made available (normally as part of the configuration) to the email server.</p></li>
<li><p>When a message is submitted for delivery, the email server uses the private key to cryptographically sign the message, adding a DKIM-Signature: header.</p></li>
</ol>
<p>More information about DKIM can be found at</p>
<p><a href="http://www.dkim.org/">http://www.dkim.org/</a></p>
<p>SparkPost highly recommends this site to anyone looking to use this functionality.</p>
<h3 id="powermta-dkim-implementation"><span class="header-section-number">10.6.2</span> PowerMTA DKIM Implementation</h3>
<p>Domain keys are added to PowerMTAs configuration using the <code>domain-key</code> directive, which can be defined globally, making it available for all mail, or within a VirtualMTA definition, making it specific to that VirtualMTA. They can also be defined within a <code>&lt;domain-key-list&gt;</code> section which can be selected by name in various ways. The directive takes three comma-separated arguments:</p>
<ul>
<li><p>The keys selector, which identifies that key among others on the same domain.</p></li>
<li><p>The DNS domain name for the key, and</p></li>
<li><p>The name of the file containing the key.</p></li>
</ul>
<p>For example:</p>
<pre><code>&lt;virtual-mta domainkey&gt;
    host-name port25.com
    ...
    domain-key test, port25.com, c:\pmta\test.port25.pem
&lt;/virtual-mta&gt;
</code></pre>
<p>or</p>
<pre><code>domain-key test, port25.com, c:\pmta\test.port25.pem
</code></pre>
<p>You can specify multiple <code>domain-key</code> entries. PowerMTA determines the key to use by going through the keys sequentially and picking the first key whose domain matches the identity on behalf of which the email is being signed. That identity is extracted by default from the emails Sender header address, or, if Sender is not present, the From header, but can also be specified with the <code>dkim-identity</code> directive.</p>
<p>A domain-key may also specify a wildcard * domain, in which case PowerMTA considers it to match any identitys domain. This is useful when the same public key is entered in the DNS under multiple domain names.</p>
<p>To set up DKIM signing for a domain,</p>
<ol>
<li><p>Determine the domain in which the key will be registered. That should be either the DKIM identitys domain itself or a parent of that domain. In the examples below, we will assume example.org.</p></li>
<li><p>Decide what to use for your selector. The selector will uniquely identify the key within the domain determined above. We will use k1 in the examples below.</p></li>
<li><p>Generate your private key using either PowerMTAs <code>pmtakeytool</code> utility or SparkPosts DomainKey wizard at</p>
<p><a href="https://port25.com/dkim-wizard/">https://port25.com/dkim-wizard/</a></p>
<p>(If using the wizard, skip step 8):</p></li>
</ol>
<p><code>pmtakeytool newdk k1 example.org 2048</code></p>
<ol>
<li><p>This creates a 2048-bit private key in the file k1.example.org.pem and a corresponding public key in BIND format in the file k1.example.org.dns.</p></li>
<li><p>Move the PEM file to <code>c:\pmta\</code> on Windows or to <code>/etc/pmta</code> on Unix and ensure its permissions are set properly (ideally only PowerMTA process should have access to it).</p></li>
<li><p>Add the DNS TXT record written to k1.example.org.dns to your DNS configuration. You may have to adjust the syntax depending on the software used. Also, please refer to the DKIM specification (from <a href="http://www.dkim.org)">http://www.dkim.org)</a> for more information on the record syntax:</p></li>
</ol>
<pre><code>k1._domainkey  IN TXT (&quot;k=rsa\; p=&quot;&lt;br /&gt;
 &quot;MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAxeRmblkAUC0ZwBLltS37&quot;
&quot;ubgOk3bifNP8ubH5wc01mkAskRJcSDnXhxrbNseIBJye2lwVyRSDmkhCo5lreGbt&quot;
&quot;pwdo3kqIEj0k2+ZC2MSNREovoyFXuJHbNDB2VUvlh0ROJMNQx3VuBsYr884K1dsE&quot;
&quot;tzb+9+8JjYwKr6khNu4GeuebT4XdTwcqvtYkqw/MW4H0RxPJ8/w7pUHy1o08W1Hk&quot;
&quot;N/wAQkhcxygJTaehtkApDfY3N5kVk8XAYdzbJaSe/7Uw0ImqFgxy60MrWlUaUyWO&quot;
&quot;uTBwIPQScDgX3yIl1GHgV25DlEKo8sfTNgFJhil1ju3iZ25KoiPeFyWN+7AohF1Y&quot;
&quot;SQIDAQAB&quot;)
</code></pre>
<ol>
<li>Add the domain-key directive to the configuration file:</li>
</ol>
<pre><code>&lt;virtual-mta example&gt;
...
domain-key k1, example.org, c:\pmta\k1.example.org.pem
&lt;/virtual-mta&gt;
</code></pre>
<ol>
<li>or (at global level in the configuration):</li>
</ol>
<p><code>domain-key k1, example.org, c:\pmta\k1.example.org.pem</code></p>
<ol>
<li>Enable signing for the domain(s) desired, or in <code>&lt;domain *&gt;</code> to enable signing for all domains:</li>
</ol>
<pre><code>&lt;domain yahoo.com&gt;
...
dkim-sign yes
&lt;/domain&gt;
</code></pre>
<ol>
<li>If the <code>domain-key</code> directive is configured for a VirtualMTA instead of globally, configure PowerMTA so that email originating in the domain(s) to be signed are submitted to that VirtualMTA, for example, by using a pattern list:</li>
</ol>
<pre><code>&lt;pattern-list L&gt;
    mail-from /[@\.]example\.com$/ virtual-mta=example
&lt;/pattern-list&gt;

&lt;source 10.1.0.0/16&gt; # feeding sources
    pattern-list L
&lt;/source&gt;
</code></pre>
<ol>
<li>See <a href="#virtualmta-support">VirtualMTA Support</a> for more information on selecting VirtualMTAs. <a href="#pattern-list-directives">&lt;pattern-list&gt; Directives</a> describes pattern lists in greater detail.</li>
</ol>
<h3 id="passing-dkim-signing-options-in-a-header"><span class="header-section-number">10.6.3</span> Passing DKIM signing options in a header</h3>
<p>PowerMTA supports passing DKIM signing options in a header, overriding the configuration on a per message basis. To do so, enable the <code>&lt;source&gt;</code> directive process-X-DKIM-Options and add a <code>X-DKIM-Options</code> header before submitting the messages. The header uses a syntax similar to the semicolon-separated tags in DKIM-Signature and may be used to pass multiple options:</p>
<ul>
<li><p>s - selector  specifies the value of the s= tag in the signature, and requires that the domain-key have the given selector</p></li>
<li><p>d - domain  specifies the value of the d= tag in the signature, and requires that the domain-key have that exact domain (or the * wildcard)</p></li>
<li><p>i - identity  specifies the value for the i= tag in the signature. Also, if d isnt specified, requires that the domain-key have the same domain as or a parent domain of i (or the * wildcard)</p></li>
<li><p>q - query method  specifies the value for the q= tag in the signature</p></li>
<li><p>key-list  specifies that the domain key is to be picked from the given <a href="#domain-key-list">&lt;domain-key-list&gt;</a> section</p></li>
</ul>
<p>For example, with the following configuration:</p>
<pre><code>domain-key key1, example.com, c:\pmta\key1.example.com.pem
domain-key key2, example.com, c:\pmta\key2.example.com.pem
</code></pre>
<p>the X-DKIM-Options could be used to select the key to use:</p>
<p><code>X-DKIM-Options: s=key2</code></p>
<h3 id="second-dkim-signing-support"><span class="header-section-number">10.6.4</span> Second DKIM signing support</h3>
<p>PowerMTA supports adding a second DKIM-Signature header with different options from the first one. All <code>dkim-...</code> directives are supported with the prefix "second-" added:</p>
<pre><code>second-dkim-add-body-limit
second-dkim-add-timestamp
second-dkim-algorithm
second-dkim-body-canon
second-dkim-disallow-adding-headers
second-dkim-expire-after
second-dkim-headers
second-dkim-headers-canon
second-dkim-identity
second-dkim-identity-fallback
second-dkim-sign
second-dkim-query-method
</code></pre>
<p>In the example below, PowerMTA adds both a customer signature and an ESP signature to messages sent through VirtualMTA 12345. The customer signature is based on the domain of the <code>From</code> header (customer.com) while the ESP signature is based on the <code>second-dkim-identity</code> option defined (esp.com). PowerMTA would include gmail's required <code>Feedback-ID</code> header in both signatures for messages to gmail only.</p>
<pre><code>&lt;virtual-mta 12345&gt;
    domain-key 2017k1, esp.com, c:\pmta\keys\esp.esp.com.pem
    domain-key 2017-01, customer.com, c:\pmta\keys\2017-01.customer.com.pem
    &lt;domain gmail.com&gt;
        dkim-headers Feedback-ID
        second-dkim-headers Feedback-ID
    &lt;/domain&gt;
    &lt;domain *&gt;
        dkim-sign yes
        second-dkim-sign yes
        second-dkim-identity @esp.com
    &lt;/domain&gt;
&lt;/virtual-mta&gt;
</code></pre>
<p>Note: The <code>X-DKIM-Options</code> header method is not supported for the second signature, but still can be used for the first signature.</p>
<p>PowerMTA will still deliver the message if due to message attributes and configuration settings, there are no signatures to be applied, only one signature to be applied or both signatures are to be applied.</p>
<h3 id="ability-to-dkim-sign-with-the-private-key-given-in-the-message"><span class="header-section-number">10.6.5</span> Ability to DKIM sign with the private key given in the message</h3>
<p>PowerMTA supports the ability to extract a private key from a header in a message and use that private key for DKIM signing the message. This is an alternative to having the keys defined in the configuration file. To enable this feature, use the per-source <code>process-x-dkim-key</code> directive.</p>
<p>If set to true, PMTA will extract the private key specified in the header <code>X-DKIM-Key</code>, and use it for DKIM signing the message. For security reasons, the header will be removed from the message prior to transmission. Note that when using this feature, you have to specify the selector(the 's=' value) for the DKIM signing using the <code>X-DKIM-Options</code> header, otherwise the message cannot be signed. Processing of the <code>X-DKIM-Options</code> header should be enabled using the per-source <code>process-x-dkim-options</code> directive.</p>
<p>Also note that the content of the <code>X-DKIM-Key</code> will span multiple lines, so you need to fold the header in the body of the message as in the example below.</p>
<pre><code>Date: Mon, 8 Mar 2017 13:29:22 -0500
From: Test User &lt;test@port25.com&gt;
To: test@port25.com
Subject: help!
X-Dkim-Options: s=ball; d=some-esp.com;
X-Dkim-Key: -----BEGIN PRIVATE KEY-----
  MIICdQIBADANBgkqhkiG9w0BAQEFAASCAl8wggJbAgEAAoGBAL2/eGlUEGzYGMoN
  P8fdRRHF8BZ0/7+ani5IkZq5W84WDjSLtx8OryMYJNttOtdcIy3vb5YCsqziZncE
  a8ite5GiYct2SW+Such/KTWWNuJFEpyz7bjWjP46izuoktZ6JWErnmK+IiPCkc8/
  iSVJXZgafio5gBwr0mUi2YDGUX/RAgMBAAECgYBGYCSV1EL/S6ruDbnxNAUxEVv5
  yE0u0HcIrYurekItjoqYPJWfpD+a4ZKR+9JOG/NET0Dwv3Fro9DjJbWgSY/BkSKs
  ckypdEh2DECtAaqpZ18Bs7nmaHnsyhaFHaTvT/VKM/WVvBXfh+NlaHoJK05um9MS
  jVwiDkZHVeku6g+Y0QJBAO392X05FziwQYFS5Y6ldfyJfWQzRmGTsz8B1HGeS84N
  wuMtP4zjL/c5nwOkN5SO8inE7xZLy958WQQtZW9BW00CQQDMGxbwuK4HmBLejLZw
  R7g9SH8b/54bWWt+4BmiWjF1Dnbeq/5Co2ZHcXOQ50fopk/OsAsN/F0VZb5578lz
  nsyVAkAyhSieBHiBeCjvowFH/qfFLAqKMrhGDmyGe4T1eXzuCM3OG9TZu4B7Iqg2
  xa1mw9F0PHHkccKdQBhFYr2dmGohAkAJi6bKAUkaT9FqGRibLa9/JjnTnGPPkaIG
  YAKy5hb0C4YhqdeNVEj/RF4MQ9TIG6cV2oPZ1pif3I9I8p7wSlf1AkBznyYhKnML
  OdSR8QUfwVm8o5TtFz+kisDJ7fQc1kCruB5IyLXPnKxugUcetHBVnC4Y7O996N4R
  mkoEKsyfiQhk
  -----END PRIVATE KEY-----

HELP! How do I port25?
Thanks abunch,
.. Test
</code></pre>
<p>With the email above, you have to add the following directives to PMTA config to DKIM sign the message.</p>
<pre><code>&lt;source 0/0&gt;
    process-x-dkim-key yes
    process-x-dkim-options yes
&lt;/source&gt;

&lt;source {pickup}&gt;
    process-x-dkim-key yes
    process-x-dkim-options yes
&lt;/source&gt;

</code></pre>
<h2 id="warming-of-ips-with-cold-virtualmta"><span class="header-section-number">10.7</span> Warming of IPs with Cold VirtualMTA</h2>
<h3 id="overview-7"><span class="header-section-number">10.7.1</span> Overview</h3>
<p><strong>Note: This functionality is useful when you have at least one warm IP address. If you only have cold IP addresses then use rate limiting features of the VirtualMTAs to build up reputation for the cold IPs.</strong></p>
<p>When starting to send email from a new IP address, it is sometimes important to control the amount of traffic sent from that IP, so that reputation can be built properly. To facilitate this task, PowerMTA adds support for configuring separate queues and diverting part of the traffic to those queues.</p>
<p>The cold VirtualMTA functionality, at its core, is a rerouting feature. <strong>The first x messages for each domain submitted to the warm VirtualMTA each day are auto-rerouted to the cold VirtualMTA.</strong> The number that is rerouted for each domain per day is determined by the <code>max-cold-virtual-mta-msg</code> directive defined in the warm VirtualMTA for the domains. The rest of the messages submitted that day to the warm VirtualMTA stay in the warm VirtualMTA. The cold VirtualMTA rerouting counters are reset at midnight.</p>
<p>The messages routed to the cold VirtualMTA are handled/delivered based on the directives defined in the cold VirtualMTA. To this end it is important to configure the cold VirtualMTA as desired.</p>
<p><strong>Note: When MX rollup rules are also active in the configuration, PowerMTA will use the <code>max-cold-virtual-mta-msg</code> setting from the rollup queue instead of the individual queues that got rolled up.</strong></p>
<p>For example:</p>
<pre><code>&lt;virtual-mta vmta1&gt;
    smtp-source-host 1.2.3.4 vmta1.example.com
    cold-virtual-mta vmta2
    &lt;domain *&gt;
        max-cold-virtual-mta-msg 1000/day
    &lt;/domain&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta vmta2&gt;
    smtp-source-host 5.6.7.8 vmta2.example.com
    &lt;domain *&gt;
        max-msg-rate 100/h
    &lt;/domain&gt;
&lt;/virtual-mta&gt;
</code></pre>
<p>With these settings, the first 1000 messages submitted into the warm VirtualMTA vmta1 per day, for each domain, would be auto-rerouted to the cold VirtualMTA vmta2. Every message submitted after the first 1000 per day per domain to the warm VirtualMTA would stay in the warm VirtualMTA, with the daily rerouting counters resetting at midnight. Because <strong>max-cold-virtual-mta-msg setting is per domain</strong>, the first 1000 submitted for yahoo.com to vmta1 per day would be rerouted to vmta2, the first 1000 submitted for hotmail.com to vmta1 per day would be rerouted to vmta2, etc.</p>
<p>This is the count for each domain separately given that <code>max-cold-virtual-mta-msg 1000/day</code> is defined in <code>&lt;domain *&gt;</code> in the VirtualMTA in this example. If different counts per day for different domains are needed, define the different domain definitions in the VirtualMTA with the specific counts desired for each, along with a count for all other domains in <code>&lt;domain *&gt;</code>. Messages that are routed to the cold VirtualMTA are then handled based on the settings defined in the cold VirtualMTA.</p>
<p>The default setting for the max-cold-virtual-mta-msg directive is 0, which means "don't re-select a cold VirtualMTA". If max-cold-virtual-mta-msg is set globally but the VirtualMTA selected doesn't have a "cold-virtual-mta" directive configured, no re-selection takes place.</p>
<p>Since the cold VirtualMTA is just another VirtualMTA, this feature can also be used to route traffic from an old server to a new server. This is useful when moving server locations and the new server is getting new IPs that are not yet established with a good reputation. For example:</p>
<pre><code>&lt;virtual-mta vmta1&gt;
    smtp-source-host 1.2.3.4 vmta1.example.com
    cold-virtual-mta vmta2
    &lt;domain *&gt;
        max-cold-virtual-mta-msg 1000/day
    &lt;/domain&gt;
&lt;/virtual-mta&gt;

&lt;virtual-mta vmta2&gt;
    smtp-source-host 5.6.7.8 vmta2.example.com
    &lt;domain *&gt;
        queue-to route.queue
    &lt;/domain&gt;
    &lt;domain route.queue&gt;
        smtp-hosts [9.8.7.6]:25
    &lt;/domain&gt;
&lt;/virtual-mta&gt;
</code></pre>
<p>In the above example, the first 1000 messages per domain per day injected into vmta1 are routed to vmta2. At this point they are grouped into one large queue with the queue-to directive to help better manage the amount of outbound connections the messages will make.</p>
<p>Both the limits and the selection are persisted on disk, so that you can safely restart PowerMTA without resetting the current rates.</p>
<h2 id="use-of-bounce-category-patterns"><span class="header-section-number">10.8</span> Use of Bounce Category Patterns</h2>
<h3 id="overview-8"><span class="header-section-number">10.8.1</span> Overview</h3>
<p>This feature can be used to make the bounce categories used in CSV accounting files field customizable. A customer can specify the tag in the configuration file, in which case the patterns specified there take precedence over those defined in config-defaults file. The data in the <code>&lt;bounce-category-patterns&gt;</code> tag consist of two fields. The first field is the SMTP response on which to match, and the second field is the name of the category to be used. Custom category names are allowed. It should be entered in a <code>&lt;bounce-category-patterns&gt;</code> entry, like in:</p>
<pre><code>&lt;bounce-category-patterns&gt;
    /spam/ spam-related
    /no longer (valid|available)/ bad-mailbox
    /mailbox +(is +)?full/ quota-issues
    /banned/ policy-related
&lt;/bounce-category-patterns&gt;
</code></pre>
<p><code>&lt;bounce-category-patterns&gt;</code> uses pattern matching in the same method as does <code>&lt;pattern-list&gt;</code>. <a href="#smtp-pattern-list-directives">&lt;smtp-pattern-list&gt; Directives</a> describes SMTP pattern lists and pattern matching in greater detail.</p>
<h2 id="combining-several-domains-into-one-queue"><span class="header-section-number">10.9</span> Combining several domains into one queue</h2>
<h3 id="overview-9"><span class="header-section-number">10.9.1</span> Overview</h3>
<p>PowerMTA has the ability to group together different email domains into a single large queue. This can be useful for controlling the message stream across multiple domains. This includes any <code>&lt;domain&gt;</code> based controls such as <code>max-msg-rate</code>, <code>max-smtp-out</code>, and <code>max-connect-rate</code>.</p>
<p><strong>Note that you will need to manually define the <code>smtp-hosts</code> directive for the new queue if it is not resolvable through DNS.</strong></p>
<p>The directive to use is "queue-to", which is defined in the <code>&lt;domain&gt;</code> definitions that you want to group together. The parameter defined within the queue-to directive is the name of the "domain" that the other domains will be rolled up into. Use of the <code>smtp-hosts</code> directive is required.</p>
<p>For example:</p>
<pre><code>&lt;virtual-mta hotmail-queue&gt;
    &lt;domain hotmail.queue&gt;
        max-smtp-out 10
        smtp-hosts hotmail.com  # you must define this for the consolidated queue.
    &lt;/domain&gt;
    &lt;domain hotmail.com&gt;
        queue-to &quot;hotmail.queue&quot;
    &lt;/domain&gt;
    &lt;domain hotmail.co.uk&gt;
        queue-to &quot;hotmail.queue&quot;
    &lt;/domain&gt;
    &lt;domain live.com&gt;
        queue-to &quot;hotmail.queue&quot;
    &lt;/domain&gt;
&lt;/virtual-mta&gt;
</code></pre>
<p>With this, all messages queued for this VirtualMTA for any hotmail.com, hotmail.co.uk, or live.com domain will be put in one queue named "hotmail.queue", and treated as such.</p>
<p>Or:</p>
<pre><code>&lt;virtual-mta client-mta&gt;
    smtp-source-host 1.2.3.4 mail1.yourdomain.com
    &lt;domain *.psmtp.com&gt;
        queue-to &quot;psmtp.com&quot;
        max-smtp-out 20
        bounce-after 2d
        max-msg-per-connection 10
    &lt;/domain&gt;
&lt;/virtual-mta&gt;
</code></pre>
<p>With this, all messages queued for this VirtualMTA for any *.psmtp.com domain (e.g. mail9.psmtp.com, someone.psmtp.com, etc.) will be put in the one queue for psmtp.com, and treated as such. As a note, if you are using a cold VirtualMTA, the directive max-cold-virtual-mta is applied AFTER queue-to is applied.</p>
<h2 id="setting-recipient-priority"><span class="header-section-number">10.10</span> Setting recipient priority</h2>
<h3 id="overview-10"><span class="header-section-number">10.10.1</span> Overview</h3>
<p>It may be necessary to set a given recipient of set of recipients with a higher or lower priority (e.g. password reset vs. weekly newsletter). This can be done in PowerMTA in different ways. The first is via the <code>&lt;domain&gt;</code> directive queue-priority. The directive works in the following manner:</p>
<pre><code>&lt;domain someplace.com&gt;
    queue-priority 75
&lt;/domain&gt;

&lt;virtual-mta newsletter&gt;
    &lt;domain someplaceelse.com&gt;
        queue-priority 30
    &lt;/domain&gt;
&lt;/virtual-mta&gt;
</code></pre>
<p>With the above set, all messages going to someplace.com will get a queue-priority of 75 (the default is 50 with a range of 1-100, higher amounts being given higher priority). This will give this set of messages first priority in PowerMTA for connections and delivery. The messages for someplaceelse.com/newsletter will get a lower priority than the average mail, and will go out last.</p>
<p>Another method of setting the message priority is by using a <code>&lt;pattern-list&gt;</code>. The directive works in the following manner:</p>
<pre><code>&lt;pattern-list myList&gt;
    rcpt-to /password-reset@customer.com/ recipient-priority=100
    rcpt-to /special@customer.com/ virtual-mta=high, recipient-priority=60
    mail-from /newsletter/ recipient-priority=25
&lt;/pattern-list&gt;
</code></pre>
<p>In the above example, individual emails to <a href="mailto:password-reset@customer.com">password-reset@customer.com</a> will get the highest priority, generic emails to <a href="mailto:special@customer.com">special@customer.com</a> will get a slightly higher than normal priority, and any emails from anything containing newsletter will get a low priority.</p>
<p>If both <code>queue-priority</code> and <code>recipient-priority</code> are used, <code>queue-priority</code> takes precedence. <code>recipient-priority</code> is only used for determining which recipients in a queue are attempted first for delivery.</p>
<h2 id="snmp-support"><span class="header-section-number">10.11</span> SNMP Support</h2>
<h3 id="overview-11"><span class="header-section-number">10.11.1</span> Overview</h3>
<p>PowerMTA supports SNMP for monitoring basic status information.</p>
<p>Currently all the information from the <code>pmta show status</code> command is what is available for monitoring via SNMP.</p>
<p>PowerMTA SNMP support is included with the Windows installer. There is a separate package available for Linux from the PowerMTA download page. PowerMTA's SNMP daemon can be used in master mode or as an AgentX subagent (not available on Windows). It automatically detects whether there is a AgentX master running (e.g. Net-SNMP's snmpd). If so it registers itself as a subagent, otherwise it runs in master mode.</p>
<p>As a note, to allow Net-SNMP's snmpd to act as a AgentX master it is required to activate the AgentX support in snmpd (by having a line "master agentx" in snmpd.conf).</p>
<p>The default configuration for PowerMTA's SNMP daemon is located in:</p>
<p>Linux:</p>
<p><code>/etc/pmta/pmtasnmp.conf</code></p>
<p>Windows:</p>
<p><code>&lt;PowerMTA install directory&gt;\pmtasnmp.conf</code></p>
<p>This will allow anybody to read data from it with the "public" community string, which may or may not be appropriate. Since the SNMP daemon is based on Net-SNMP the configuration file is a standard Net-SNMP configuration file and documentation is available from:</p>
<p><a href="http://www.net-snmp.org/docs">http://www.net-snmp.org/docs</a></p>
<p>The data available through SNMP is described by the MIB which can be found at the following location:</p>
<p>Linux:</p>
<p><code>/usr/share/snmp/mibs/PowerMTA-MIB.txt</code></p>
<p>Windows:</p>
<p><code>&lt;PowerMTA install directory&gt;\mibs\PowerMTA-MIB.txt</code></p>
<p>To access the data via SNMP a third party solution is required.</p>
<p>On Linux you have the Net-SNMP utils installed you can test that it works (and see the data available) with the following command:</p>
<p><code>snmpwalk -v2c -c public localhost PowerMTA-MIB::mta</code></p>
<h2 id="high-availability-configuration"><span class="header-section-number">10.12</span> High Availability Configuration</h2>
<p>In "High Availability" deployment, two servers run PowerMTA service, and if one fails, new mail gets sent to the backup server by the feeding application. If the spool directory is recoverable, it is added as a second spool to the backup, and the service is restarted to pickup this spool, sending all new and old mail.</p>
<p>When the production server is backup and online, new mail is redirected back to the production server, and the hot backup is left running until all mail has been delivered or bounced. After the mail is delivered from the hot backup, it is put back into its original single spool state, and is kept idle until the next time it is needed.</p>
<h2 id="precached-domains-support"><span class="header-section-number">10.13</span> Precached domains support</h2>
<p>For senders that have DNS server issues when loading large amounts of domains into PowerMTA in a short period of time, or when maintaining large amounts of domains with short a short DNS TTL, PowerMTA offers the ability to precache a given subset of the DNS names to ensure the DNS name is always available. This feature is enabled by use of the new, global <code>&lt;dns&gt;</code> tag.</p>
<pre><code>&lt;dns&gt;
    precached-domains-file C:\pmta\precached-domains.txt
    precached-max-domains 500
    precached-refresh-interval 5m
&lt;/dns&gt;
</code></pre>
<p>The file <code>C:\pmta\precached-domains.txt</code> would contain a list of domains, each on a line by itself. For example,</p>
<pre><code>hotmail.com
yahoo.com
aol.com
gmail.com
</code></pre>
<p>PowerMTA would only precache the first 500 domains in the file, refreshing the DNS for these domains every 5 minutes.</p>
<h2 id="scheduled-delivery-control"><span class="header-section-number">10.14</span> Scheduled Delivery Control</h2>
<p>PowerMTA supports the ability to schedule deliveries via a header.</p>
<p>The format of the header is:</p>
<p><code>x-schedule: &lt;start time&gt;/&lt;end time&gt;, &lt;start time&gt;/&lt;end time&gt;</code></p>
<p>Here is an example:</p>
<p><code>x-schedule: 2015-05-29 17:01:11 / 2015-05-29 17:30:11, 2015-05-30 17:01:11 / 2015-05-30 17:30:11</code></p>
<p>You can add as many time intervals as needed.</p>
<p>The <code>bounce-after</code> does not apply to such recipients. The schedule overrides the <code>bounce-after</code> and the message is bounced when there are no more schedules to try. In addition, if the queue is in retry mode when the messages are injected, the message delivery will not start at the window start time, but rather message delivery attempts will start when the queue come out of retry mode.</p>
<h2 id="custom-retry-intervals"><span class="header-section-number">10.15</span> Custom retry intervals</h2>
<p><code>retry-after</code> and <code>backoff-retry-after</code> can also take a time interval in addition to the static, defined time. This allows for adding up to 30 different retry periods. This may be useful for domains in which the likelihood of messages being delivered decreases over time. The last defined interval is used until the message bounces. The interval resets on a restart of the PowerMTA server. An example usage would be:</p>
<pre><code>&lt;domain example.com&gt;
    retry-after 10m,10m,10m,10m,10m,10m,30m,30m,30m,30m,1h,1h,2h,2h,4h,4h,10h
&lt;/domain&gt;
</code></pre>
<p>In the above example the domain would be tried every 10 minutes for the 6 tries, every 30m for the next 4 tries, every hour for the 2 tries, every 4 hours for the next two tries, and finally, every 10 hours until the message is bounced.</p>
<h2 id="address-suppression-lists"><span class="header-section-number">10.16</span> Address Suppression Lists</h2>
<p>Lists can be defined with the new global <code>&lt;address-list listName&gt;</code> tag and one or more can be referenced within a <code>&lt;source&gt;</code> with the new "suppression-lists" directive. Addresses in the suppression list are rejected (or turned into bounces, depending on options) during submission. Multiple suppression lists may be used:</p>
<pre><code>&lt;address-list suppression1&gt;
    address foo # local part
    address foo@bar.com # email address
    address /foo/ # pattern
&lt;/address-list&gt;

&lt;address-list suppression2&gt;
    domain foo.com # domain
    address-file /etc/pmta/addresses # email addresses or local parts, 1/line
&lt;/address-list&gt;

&lt;source 0/0&gt;
    suppression-lists suppression1,suppression2
&lt;/source&gt;
</code></pre>
<p>NOTE: Defining more than 500 patterns within a single suppression list is not recommended.</p>
<p>If the <code>&lt;source&gt;</code> directive <code>accept-invalid-recipients</code> is set to "no", then the message is rejected at the time of submission (i.e., while processing the RCPT command).</p>
<p>If the <code>&lt;source&gt;</code> directive <code>accept-invalid-recipients</code> is set to "yes", then the message is queued and later bounced with generation of a bounce record with details such as:</p>
<pre><code>dsnStatus: 5.7.1 (delivery not authorized)
dsnDiag: smtp;550 5.7.1 recipient is in suppression list &quot;a1&quot;: &lt;foo@bar.com&gt;
</code></pre>
<p>For BSMTP pickup files, If XACK is set to "on", then the message is rejected while the file is picked up (i.e., while processing the RCPT command). This is logged in the PowerMTA log file just like any other pickup submission error. If XACK is set to "off", then the file is picked up and the message is later bounced with a bounce record that looks similar to SMTP submission case above.</p>
<p>For non-BSMTP pickup files, the message is rejected while the file is picked up (i.e., when processing the <code>x-receiver</code> header). This is logged in the PowerMTA log file just like any other pickup submission error.</p>
<h2 id="mx-rollup-list"><span class="header-section-number">10.17</span> MX Rollup List</h2>
<p>This feature allows one to define "rollup" queues based on the MX records of the recipient domain, in order to consolidate separate but related recipient domains into one queue. Messages moved into the roll up queue are handled as if they were one recipient domain with regards to rate limiting, connection caps, etc.... For example, since msn.com, live.com and hotmail.com are all handled by the same exact MXs/gateway, it makes sense to roll these up into one queue vs. being handled separately by PowerMTA. This feature works very well for the large mailbox providers that provide corporate hosting, for filtering/antispam cloud providers, or for large hosting providers in general that manage corporate email for tens or hundreds of thousands of various domains.</p>
<p><strong>Note: When MX rollup rules are also active in the configuration, PowerMTA will use the <code>max-cold-virtual-mta-msg</code> setting from the rollup queue instead of the individual queues that got rolled up.</strong></p>
<p>To configure this feature, you need to define the MX record that maps to each rollup queue name along with the name of the rollup queue, which <strong>must</strong> end in ".rollup". More than one MX can be mapped to the same rollup queue, for example:</p>
<pre><code>&lt;mx-rollup-list&gt;
    mx mx1.hotmail.com hotmail.rollup
    mx mx2.hotmail.com hotmail.rollup
    mx mx3.hotmail.com hotmail.rollup
    mx mx4.hotmail.com hotmail.rollup
    mx smtp.secureserver.net secureserver.net.rollup
&lt;/mx-rollup-list&gt;
</code></pre>
<p><strong>NOTE</strong> that only the lowest preference (highest priority) MX records should be defined with this feature.</p>
<p>Wildcards are also supported for the MX records, for example:</p>
<pre><code>&lt;mx-rollup-list&gt;
    mx *.hotmail.com hotmail.rollup
    mx *.mail.protection.outlook.com outlook.rollup rollup-by-ip
&lt;/mx-rollup-list&gt;
</code></pre>
<p>which would then automatically include all matching lowest preference MX records. Any recipient domain whose lowest preference MXs match the wildcard would be automatically placed in the hotmail.rollup queue, and which all messages would be treated as if to a single recipient domain.</p>
<p><em><strong>No match occurs when a rollup queue defined in the &lt;mx-rollup-list&gt; has more lowest preference MXs configured to it than what is returned by DNS.</strong></em></p>
<p>For rollup queues in which the MX records are explicitly defined (no wildcards) in the rollup list, PowerMTA will automatically use/look up the specific defined MXs in DNS for routing information for the domains in the rollup queue.</p>
<p>For rollup queues in which a wildcard is used, one <strong>must</strong> explicitly define the <code>smtp-hosts</code> directive within the domain definition for the rollup queue along with the appropriate MX or A records, since it is impossible for PowerMTA to infer the proper MXs to use for all domains in the rollup queue (in contrast to when they are explicitly defined).</p>
<p>For rollup queues in which a wildcard is used with the "rollup-by-ip" option, there is no need to configure "smtp-hosts" directive. PMTA will automatically set the "smtp-hosts" for such rollup queues to the hosts that the original domain resolved to. In order to perform the rollup action, PMTA will use the IP addresses that the MXes resolve to, not the MX name.</p>
<p>SparkPost recommends always explicitly defining the rollup queue within its own domain definition in order to explicitly set the delivery controls you want to achieve for the rollup queue.</p>
<p>For clarification, the table below provides various scenarios and end results based on the following MX rollup list definitions and defined DNS results.</p>
<p><strong>Configuration settings for MX Rollup list to be used for examples below:</strong></p>
<pre><code>&lt;mx-rollup-list&gt;
    mx mx1.domain.com domain.rollup
    mx mx2.domain.com domain.rollup
    mx mx1.domain2.com domain2.rollup
&lt;/mx-rollup-list&gt;
</code></pre>
<p>The below table lists various examples of how this would work. For all examples the recipient domain would be domain.com.</p>
<p><strong>Example 1</strong></p>
<blockquote>
<p><strong>DNS results for domain's MX lookup (MX name + preference)</strong></p>
</blockquote>
<pre><code>mx1.domain.com 10
mx2.domain.com 10
</code></pre>
<blockquote>
<p><strong>Rollup Queue Used</strong> <code>domain.rollup</code></p>
</blockquote>
<blockquote>
<p><strong>Destination MXes for the Rollup Queue</strong></p>
</blockquote>
<pre><code>mx1.domain.com
mx2.domain.com
</code></pre>
<blockquote>
<p><strong>Explanation</strong> MXs defined for rollup queue are present in domains DNS results.</p>
</blockquote>
<p><strong>Example 2</strong></p>
<blockquote>
<p><strong>DNS results for domain's MX lookup (MX name + preference)</strong></p>
</blockquote>
<pre><code>mx1.domain.com 10
mx2.domain.com 20
</code></pre>
<blockquote>
<p><strong>Rollup Queue Used</strong> <code>N/A  rollup would not take place</code></p>
</blockquote>
<blockquote>
<p><strong>Explanation</strong> Rollup queue has more lowest-preference MXs defined than what DNS returns.</p>
</blockquote>
<p><strong>Example 3</strong></p>
<blockquote>
<p><strong>DNS results for domain's MX lookup (MX name + preference)</strong></p>
</blockquote>
<pre><code>mx1.domain.com 10
mx2.domain.com 10
mx3.domain.com 10
</code></pre>
<blockquote>
<p><strong>Rollup Queue Used</strong> <code>domain.rollup</code></p>
</blockquote>
<blockquote>
<p><strong>Destination MXes for the Rollup Queue</strong></p>
</blockquote>
<pre><code>mx1.domain.com
mx2.domain.com
</code></pre>
<blockquote>
<p><strong>Explanation</strong> MXs defined for rollup queue are present in domains DNS results, mx3.domain.com is not used by PowerMTA for delivery.</p>
</blockquote>
<p><strong>Example 4</strong></p>
<blockquote>
<p><strong>DNS results for domain's MX lookup (MX name + preference)</strong></p>
</blockquote>
<pre><code>mx1.domain.com 10
</code></pre>
<blockquote>
<p><strong>Rollup Queue Used</strong> <code>N/A  rollup would not take place</code></p>
</blockquote>
<blockquote>
<p><strong>Explanation</strong> Rollup queue has more lowest preference MXs</p>
</blockquote>
<p><strong>Example 5</strong></p>
<blockquote>
<p><strong>DNS results for domain's MX lookup (MX name + preference)</strong></p>
</blockquote>
<pre><code>mx1.domain2.com 10
mx2.domain2.com 10
</code></pre>
<blockquote>
<p><strong>Rollup Queue Used</strong> <code>domain2.rollup</code></p>
</blockquote>
<blockquote>
<p><strong>Destination MXes for the Rollup Queue</strong></p>
</blockquote>
<pre><code>mx1.domain2.com
</code></pre>
<blockquote>
<p><strong>Explanation</strong> MXs defined for rollup queue are present in domains DNS results, mx2.domain2.com is not used by PowerMTA for delivery.</p>
</blockquote>
<p><strong>Example 6</strong></p>
<blockquote>
<p><strong>DNS results for domain's MX lookup (MX name + preference)</strong></p>
</blockquote>
<pre><code>mx1.domain2.com 10
mx1.domain2.com 20
</code></pre>
<blockquote>
<p><strong>Rollup Queue Used</strong> <code>domain2.rollup</code></p>
</blockquote>
<blockquote>
<p><strong>Destination MXes for the Rollup Queue</strong></p>
</blockquote>
<pre><code>mx1.domain2.com
</code></pre>
<blockquote>
<p><strong>Explanation</strong> MXs defined for rollup queue are present in domains DNS results.</p>
</blockquote>
<p><strong>Example 7</strong></p>
<blockquote>
<p><strong>DNS results for domain's MX lookup (MX name + preference)</strong></p>
</blockquote>
<pre><code>mx1.mail.domain.com 10
</code></pre>
<blockquote>
<p><strong>Rollup Queue Used</strong> <code>N/A  rollup would not take place</code></p>
</blockquote>
<blockquote>
<p><strong>Explanation</strong> DNS results do not match any defined rollup queue.</p>
</blockquote>
<h2 id="recipient-events"><span class="header-section-number">10.18</span> Recipient Events</h2>
<p>To aid in real-time queue diagnostics, PowerMTA shows the last 50 recipient delivery, bounce, and deferred events. This data is disabled by default, and can be enabled by setting:</p>
<pre><code>&lt;domain *&gt;
    track-recipient-events true
&lt;/domain&gt;
</code></pre>
<p>You can also enable this feature for only some of the domains instead of all.</p>
<p>The data is available in the output of the following commands in addition to being displayed on the individual queue detail page in the web monitor:</p>
<pre><code>pmta show queues
pmta show topqueues
pmta show queue domain[/vmta]
</code></pre>
<p>The information is held in memory as long as the queue has any recipients in it.</p>
<h2 id="http-transmissions-api"><span class="header-section-number">10.19</span> HTTP Transmissions API</h2>
<p>PowerMTA's HTTP Transmissions API allows you to submit email into PowerMTA through HTTP. Each API request can include single or several recipients. At present, there is no support for customizing the body of the message using mailmerge-like substitution syntax.</p>
<h3 id="setup"><span class="header-section-number">10.19.1</span> Setup</h3>
<p>To use the HTTP Transmissions API, you'll need to configure in <code>&lt;transmissions-api&gt;</code> and one or more <code>&lt;transmission-api-listener&gt;</code>s. Since the communication from clients actually uses HTTPS, you will need to specify a certificate to each listener.</p>
<p>Within <code>&lt;transmissions-api&gt;</code> you will also need to configure one or more <code>api-key</code>s, alphanumeric strings that connecting clients will use to authenticate themselves before being allowed to submit email. Clients pass such an API key using the <code>Authorization</code> HTTP header.</p>
<p>You can also set <code>&lt;source&gt;</code>-level properties for emails submitted via the Transmissions API using the named source <code>{transmissions-api}</code>. For example, you could set <code>process-x-virtual-mta yes</code> within that <code>&lt;source&gt;</code> to enable PowerMTA to process the <code>X-Virtual-Mta</code> header for emails submitted over HTTP Transmissions API.</p>
<p>Here is a sample configuration:</p>
<pre><code># Listener specific configuration here (TLS certificate, CA certificates/CRL, trusted certificates etc.)
&lt;transmissions-api-listener 1.2.3.4:8585&gt;
   # tls-certificate is required, other directives in this scope are optional
   tls-certificate /etc/pmta/transmissions-api-certificate.pem

   # other directives with &quot;tls-&quot; prefix are also valid here, such as
   # &quot;tls-trusted-certificate&quot; etc.
&lt;/transmissions-api-listener&gt;

# Transmissions API specific configuration
&lt;transmissions-api&gt;
   log-requests yes
   api-key 14ac5499cfdd2bb2859e4476d2e5b1d2bad079bf
   log-data no
   log-tls no
&lt;/transmissions-api&gt;

# add any source settings that affect messages received via HTTP API
&lt;source {transmissions-api}&gt;
    process-x-dkim-options yes
    process-x-virtual-mta yes
    process-x-job yes
&lt;/source&gt;
</code></pre>
<h3 id="creating-a-certificate"><span class="header-section-number">10.19.2</span> Creating a certificate</h3>
<p>You can use a self-signed certificate or a certificate signed by a certification authority (CA). A self-signed certificate is easy to create, while a CA signed certificate is more secure, but has the overhead of having the certificate signed.</p>
<p>You can create a self signed certificate using the <code>pmtakeytool</code> utility that comes with PowerMTA.</p>
<pre><code>pmtakeytool newcert &gt; /etc/pmta/transmissions-api-certificate.pem
</code></pre>
<p>You can also provide your own certificate obtained from a CA to the <code>tls-certificate</code> directive. If you were provided with a list of CA trust anchors, and/or CRLs, configure them in a separate file using the <code>tls-ca-file</code> directive within <code>&lt;transmissions-api&gt;</code> tag.</p>
<h3 id="api-keys"><span class="header-section-number">10.19.3</span> API Keys</h3>
<p>The syntax of the <code>api-key</code> directive is similar to the syntax of the <code>http-api-key</code> directive. The value for this directive must be a string of 32 to 128 characters, each character being alphanumeric ([a-zA-Z0-9]) or underscore (_). The key is case-sensitive.</p>
<p>You can use the <code>api-key</code> directive multiple times, specifying multiple keys, e.g., for different users. Transmissions API request can use any of the <code>api-key</code> values configured in <code>&lt;transmissions-api&gt;</code>.</p>
<h3 id="submitting-messages-to-pmta-using-the-transmissions-api"><span class="header-section-number">10.19.4</span> Submitting messages to PMTA using the Transmissions API</h3>
<p>To submit messages, make an HTTP <code>POST</code> request with its HTTP <code>Content-Type</code> header set to <code>application/json</code>. Here's an example request sent using the Unix command line tool <code>curl</code>.</p>
<p>It assumes the JSON encoded Transmissions API request is in the file named <code>msg.json</code> in the current directory, that <code>0f5019df4641c37a65212564980f5c320d9a5d84</code> is the value of an <code>api-key</code> configured in <code>&lt;transmissions-api&gt;</code>, and <code>&lt;transmissions-api-listener 127.0.0.1:8585&gt;</code> is defined in the configuration file. The --insecure option is only needed for self-signed certificates.</p>
<pre><code>curl -X POST --insecure \
    -H &quot;Content-Type: application/json&quot; \
    -H &quot;Authorization: 0f5019df4641c37a65212564980f5c320d9a5d84&quot; \
    --data @msg.json \
    https://127.0.0.1:8585/api/v1/transmissions
</code></pre>
<p>The msg.json file could look like this:</p>
<pre><code>{
   &quot;return_path&quot;: &quot;xyz@bounce.port25.com&quot;,

    &quot;campaign_id&quot;: &quot;xmas2018&quot;,
    &quot;options&quot; : {
        &quot;smtputf8&quot;: true
    },
    &quot;recipients&quot;: [

        {
           &quot;address&quot;: {
               &quot;email&quot;: &quot;fred@flintstone.com&quot;
           }

        },

        {
           &quot;address&quot;: &quot;wilma@flintstone.com&quot;,
           &quot;return_path&quot;: &quot;wilma@bounce.port25.com&quot;
        }

    ],
    &quot;content&quot;: {
       &quot;email_rfc822&quot;: &quot;From: \&quot;Xmas 2018\&quot; &lt;xmas2018@transmissions.port25.com&gt;\n Content-Type: text/plain\nTo: \&quot;Fred Flintstone\&quot; &lt;fred@flintstone.com&gt;\n \nHi Fred Flintstone,\nSave big this Christmas in your Bedrock area!\n Click http://www.mysite.com and get huge discount\nHurry, this offer is only to Platinum customers.\nBig Store Team\n&quot;
    }
}
</code></pre>
<p>The request body consists of exactly one JSON object (i.e., one email message). It can have multiple recipients and message metadata like the campaign ID (job ID).</p>
<p>Here are all the fields allowed within the JSON request object along with an explanation of the possible JSON fields. All field names are case-sensitive.</p>
<p><code>return_path</code></p>
<blockquote>
<p><strong>Type</strong>: string</p>
</blockquote>
<blockquote>
<p><strong>Description</strong>:Email address to use for envelope FROM. This field can be used at message level to set the originator address for all recipients in the email. It could also be specified at recipient level in the <code>recipient</code> object, which would override the per-message <code>return_path</code>. A <code>return_path</code> field must be specified at either message-level, or at recipient-level, else the API rejects the request as <code>400 Bad Request</code>.</p>
</blockquote>
<p><code>campaign_id</code></p>
<blockquote>
<p><strong>Type</strong>: string</p>
</blockquote>
<blockquote>
<p><strong>Description</strong>: The campaign ID for this request. This field can be used at message level to set the campaign ID for all recipients in the email. In PowerMTA, the equivalent of the term <code>campaign</code> is <code>job</code>. The content of this field is treated as the job ID of the message within PowerMTA. If present in the request, this field overrides the <code>x-job</code> header contained within the body of the message in case the <code>{transmissions-api}</code> source also contains <code>process-x-job yes</code> directive. The syntax rules for Campaign ID field are the same as the rules for <code>Job</code> in PowerMTA.</p>
</blockquote>
<p><code>options.smtputf8</code></p>
<blockquote>
<p><strong>Type</strong>: boolean</p>
</blockquote>
<blockquote>
<p><strong>Description</strong>: If the email is a SMTPUTF8 message (any or both of recipient and originator addresses have non-ASCII local parts), set the "smtputf8" option to true. If missing or set to false and any or both of recipient and originator addresses have non-ASCII local parts, the message is rejected as a bad request.</p>
</blockquote>
<p><strong>Note: If any other values in <code>options</code> as described in Sparkpost API documentation (<code>start_time</code> etc.) are present, the request is rejected since those are unsupported in PowerMTA at present.</strong></p>
<p><code>recipients</code></p>
<blockquote>
<p><strong>Type</strong>: array of JSON objects, each object representing a <code>recipient</code> object. See below for more description about <code>recipient</code> object.</p>
</blockquote>
<p><code>recipient</code></p>
<blockquote>
<p><strong>Type</strong>: Object</p>
</blockquote>
<blockquote>
<p><strong>Description</strong>: Represents a recipient object.</p>
</blockquote>
<p><code>recipient.address</code></p>
<blockquote>
<p><strong>Type</strong>: Object or string</p>
</blockquote>
<blockquote>
<p><strong>Description</strong>: If a string, it is interpreted as the email address. Otherwise, it must be an object with the following attributes.</p>
</blockquote>
<p><code>recipient.address.email</code></p>
<blockquote>
<p><strong>Type</strong>: string, required</p>
</blockquote>
<blockquote>
<p><strong>Description</strong>: The email address of the recipient.</p>
</blockquote>
<p><code>recipient.return_path</code></p>
<blockquote>
<p><strong>Type</strong>: string, optional</p>
</blockquote>
<blockquote>
<p><strong>Description</strong>: The optional, recipient-level FROM address for this recipient that overrides an per-message <code>return_path</code> in the request.</p>
</blockquote>
<p><code>content.email_rfc822</code></p>
<blockquote>
<p><strong>Type</strong>: string</p>
</blockquote>
<blockquote>
<p><strong>Description</strong>: Pre-built message with the format as described by the <code>message/rfc822</code> Content-Type.</p>
</blockquote>
<h3 id="responses"><span class="header-section-number">10.19.5</span> Responses</h3>
<p>If the HTTP request was accepted by PowerMTA, a <code>200 Ok</code> response is returned, along with the number of recipients in the message that were accepted.</p>
<pre><code>        HTTP/1.1 200 Ok
        Content-Type: application/json
        Content-Length: 73


        {
           &quot;results&quot;:
           {
             &quot;total_accepted_recipients&quot;:1,
             &quot;total_rejected_recipients&quot;:0
           }
        }
</code></pre>
<h3 id="errors"><span class="header-section-number">10.19.6</span> Errors</h3>
<p>In case of errors seen during the transmission, PowerMTA will return an appropriate HTTP error, along with data like the following in the body of the response.</p>
<pre><code>        HTTP/1.1 400 bad request
        Content-Type: application/json
        Content-Length: 118

        {
            &quot;errors&quot;: [
              {
                  &quot;message&quot;: &quot;some error&quot;,
                  &quot;description&quot;: &quot;more detail about the error&quot;
              }
           ]
        }
</code></pre>
<h3 id="list-of-http-errors-returned-by-the-api"><span class="header-section-number">10.19.7</span> List of HTTP errors returned by the API</h3>
<p>The following HTTP errors could be returned by the API</p>
<p><code>400 Bad Request</code></p>
<blockquote>
<p><strong>Description</strong>: In case of errors with the format of the request (if a required field was missing, a JSON field had invalid data type, if the request contained a Sparkpost Transmissions API field that is unsupported in PowerMTA Transmissions API etc.), PowerMTA will return <code>400 Bad Request</code> with the following data:</p>
</blockquote>
<pre><code>        HTTP/1.1 400 bad request
        Content-Type: application/json
        Content-Length: [0-9]+
        {
            &quot;errors&quot;: [
              {
                  &quot;message&quot;: &quot;bad request&quot;,
                  &quot;description&quot;: &quot;more detail about the request&quot;
              }
           ]
        }
</code></pre>
<p><code>403 Forbidden</code></p>
<blockquote>
<p><strong>Description</strong>: In case of invalid or missing <code>Authorization</code> header in the request.</p>
</blockquote>
<p><code>404 Not Found</code></p>
<blockquote>
<p><strong>Description</strong>: In case of the URI in the request was invalid.</p>
</blockquote>
<p><code>405 Method Not Allowed</code></p>
<blockquote>
<p><strong>Description</strong>: In case of the request used a HTTP method other than POST.</p>
</blockquote>
<p><code>500 Internal Server Error</code></p>
<blockquote>
<p><strong>Description</strong>: In case of the internal errors when attempting to process a valid HTTP API request.</p>
</blockquote>
<h2 id="http-delivery-webhooks"><span class="header-section-number">10.20</span> HTTP Delivery Webhooks.</h2>
<p>PowerMTA can be configured to deliver email from a queue to an HTTP endpoint. This can be useful, for example, to relay messages (such as feedback, or remote bounce reports) from a queue within PowerMTA to an external/internal service endpoint over HTTP(S) for additional processing.</p>
<p>To use HTTP delivery, you will need to configure the queue's type to be <code>http-delivery</code>, and configure the address of the HTTP endpoint that PowerMTA will deliver to using the <a href="#http-delivery-url">http-delivery-url</a> directive. You can also optionally configure PowerMTA to additionally include extra HTTP headers (such as <code>Authorization</code>) as part of the HTTP request when delivering email to the configured endpoint.</p>
<p>PowerMTA will assume that the message was delivered successfully only if the destination returns HTTP response code 200. All other HTTP responses from the destination codes are treated as temporary failures to deliver and the message is held back in the queue. The queue's <code>bounce-after</code> setting will determine when a message that couldn't be delivered from this queue will get bounced as expired.</p>
<p>Only one message is included within the body of an HTTP request from PowerMTA.</p>
<p>If the content of the message contains any non-7bit ASCII characters, PowerMTA will Base64 encode the entire content of the message before including it in the body of the HTTP request. A JSON field <code>email_rfc822_is_base64</code> will be set to <code>true</code> to indicate that the content is in Base64.</p>
<h3 id="example-configuration"><span class="header-section-number">10.20.1</span> Example Configuration</h3>
<pre><code>&lt;domain foo.com&gt;
    type http-delivery

    # Delivery URL.  Must be absolute, have http or https scheme and
    # not include userinfo, query-string or fragment components.
    http-delivery-url https://webhooks.endpoint.com:8181/api/v1/uri

    # (optional) HTTP headers to be included in the request during HTTP delivery,
    # for example, to add authentication headers.
    http-delivery-extra-headers /etc/pmta/http-delivery-headers.txt
&lt;/domain&gt;
</code></pre>
<p>Using the example configuration above, PowerMTA will start delivering messages from the queue <code>foo.com</code> to the destination host <code>webhooks.endpoint.com</code>, port 8181 using HTTPS.</p>
<h3 id="delivery-request-format"><span class="header-section-number">10.20.2</span> Delivery request format</h3>
<p>PowerMTA will deliver the messages from an <code>http-delivery</code> queue as a HTTP POST request with <code>Content-Type</code> set to <code>application/json</code>. The body of the request will be a JSON object with the following fields:</p>
<p><code>email_rfc822</code></p>
<blockquote>
<p><strong>Type</strong>: string</p>
</blockquote>
<blockquote>
<p>Raw MIME content for an email. If the Raw MIME content contains at least one non UTF-8 encoded character, the entire <code>email_rfc822</code> value will be base64 encoded and <code>email_rfc822_is_base64</code> will be set to true.</p>
</blockquote>
<p><code>email_rfc822_is_base64</code></p>
<blockquote>
<p><strong>Type</strong>: boolean</p>
</blockquote>
<blockquote>
<p>Whether the <code>email_rfc822</code> value is base64 encoded. Only included if it is <code>true</code>. If the field is missing, the <code>email_rfc822</code> can be assumed to be unencoded.</p>
</blockquote>
<p><code>msg_from</code></p>
<blockquote>
<p><strong>Type</strong>: string</p>
</blockquote>
<blockquote>
<p>SMTP envelope "MAIL FROM"</p>
</blockquote>
<p><code>rcpt_to</code></p>
<blockquote>
<p><strong>Type</strong>: string</p>
</blockquote>
<blockquote>
<p>SMTP envelope "RCPT TO"</p>
</blockquote>
<p><code>headers</code></p>
<blockquote>
<p><strong>Type</strong>: array of objects, each object representing a header extracted from the SMTP message being delivered, consisting of a single key/value pair of header name and its value.</p>
</blockquote>
<h3 id="sample-http-delivery-webhook"><span class="header-section-number">10.20.3</span> Sample HTTP Delivery Webhook</h3>
<pre><code>POST /api/v1/webhooks HTTP/1.0
Host: webhooks.endpoint.com
Content-Type: application/json
X-Header-One: Value-One
X-Header-Two: Value-Two
X-Header-Three: Value-Three
Content-Length: 523

{
&quot;msg_from&quot;:&quot;me@bounce.port25.com&quot;,
&quot;rcpt_to&quot;:&quot;a@port25.com&quot;,
&quot;content&quot;: {
    &quot;email_rfc822&quot;: &quot;Return-Path: &lt;me@here.com&gt;\r\nMIME-Version: 1.0\r\nFrom: me@here.com\r\nReceived: by 10.114.82.10 with HTTP; \r\n    Mon, 4 Jul 2016 07:53:14 -0700 \\(PDT\\)\r\nDate: Mon, 4 Jul 2016 15:53:14 \\+0100\r\nMessage-ID: &lt;484810298443-112311-xqxbby@mail.there.com&gt;\r\nSubject: Relay webhooks rawk!\r\nTo: you@there.com\r\nContent-Type: multipart/alternative; boundary=deaddeaffeedf00fall45dbhail980dhypnot0ad\r\n\r\n--deaddeaffeedf00fall45dbhail980dhypnot0ad\r\nContent-Type: text/plain; charset=UTF-8\r\nHi there Port25!.\r\n\r\n--deaddeaffeedf00fall45dbhail980dhypnot0ad\r\nContent-Type: text/html; charset=UTF-8\r\n\r\n&lt;p&gt;Hi there &lt;strong&gt;Port25!&lt;/strong&gt;&lt;/p&gt;\r\n\r\n--deaddeaffeedf00fall45dbhail980dhypnot0ad--\r\n&quot;,
    &quot;headers&quot;:[
        {
          &quot;Return-Path&quot;:&quot;&lt;me@here.com&gt;&quot;
        },
        {
          &quot;MIME-Version&quot;:&quot;1.0&quot;
        },
        {
          &quot;From&quot;:&quot;me@here.com&quot;
        },
        {
          &quot;Received&quot;:&quot;by 10.114.82.10 with HTTP; Mon, 4 Jul 2016 07:53:14 -0700 \\(PDT\\)&quot;
        },
        {
          &quot;Date&quot;:&quot;Mon, 4 Jul 2016 15:53:14 \\+0100&quot;
        },
        {
          &quot;Message-ID&quot;:&quot;&lt;484810298443-112311-xqxbby@mail.there.com&gt;&quot;
        },
        {
          &quot;Subject&quot;:&quot;Relay webhooks rawk!&quot;
        },
        {
          &quot;To&quot;:&quot;you@there.com&quot;
        },
        {
          &quot;Content-Type&quot;:&quot;multipart/alternative; boundary=deaddeaffeedf00fall45dbhail980dhypnot0ad&quot;
        }
    ]
  }
}
</code></pre>
<h2 id="dane"><span class="header-section-number">10.21</span> DANE</h2>
<p>DANE (DNS-Based Authentication of Named Entities) is a new standard for improving transport security. RFC 7672 describes the use of DANE for improving SMTP security between MTAs.</p>
<p>PowerMTA has supported STARTTLS for a long time. The use of STARTTLS for establishing channel security (encrypting the channel) can be achieved via the use of <a href="#use-starttls">use-starttls</a> directive. <code>use-starttls</code> works in an opportunistic way - if the remote side supports STARTTLS, PowerMTA will attempt to setup encryption using STARTTLS. If the remote side does not support STARTTLS, or if the attempt to setup STARTTLS fails for any reason, the SMTP STARTTLS protocol allows PowerMTA to downgrade to plain-text for the purpose of sending email. The downgrade happens silently without any notification to the user. PowerMTA also supports <a href="#require-starttls">require-starttls</a>, which disallows downgrading to plain text, but it's up to customers to configure the use of this directive (it is set to <code>false</code> by default, meaning that PowerMTA will automatically downgrade to plain-text if STARTTLS fails or is unsupported).</p>
<p>Even if STARTTLS were to be issued, the current STARTTLS standard does not enforce the use of Public Key Infrastructure(PKI) to verify the authenticity of the certificates. The remote site is allowed to present any certificate (whether self-signed, or issued by a certificate authority (CA) that is unknown to PowerMTA). It is up to PowerMTA customers to configure the CA certificates in PowerMTA that they trust and configure PowerMTA to verify the certificate chain presented by the remote site (via the use of <a href="#smtp-tls-ca-file-directive">smtp-tls-ca-file</a> directive).</p>
<p>DANE for SMTP security allows the remote side to enforce the use of STARTTLS whenever clients like PowerMTA connect to the site to transfer email. RFC 7672 describes various methods through which remote sites could advertise the availability of STARTTLS with them, and whether they require that connecting clients must always use STARTTLS when communicating with them. DANE requires that the DNS resolver support DNSSEC, a secure way of looking up DNS records. Google DNS (8.8.8.8) is an example of a DNS lookup service that supports DNSSEC.</p>
<p>PowerMTA 5.0 supports the use of DANE for enforcing SMTP security. It is strictly required that PowerMTA is to be configured with a DNS resolver that supports DNSSEC. If the new per-domain directive <a href="#use-dane">use-dane</a> is set to <code>true</code>, PowerMTA will lookup the remote site's STARTTLS preferences (through DNS resolution) and use that information to influence whether STARTTLS is established or not with the remote site prior to transferring email to it. If the remote site requires the use of STARTTLS, PowerMTA will only transfer email to the remote site if STARTTLS was successful in establishing an encrypted channel to the remote site. And, in accordance with the DANE standard, PowerMTA will attempt to verify the certificate presented by the remote host during STARTTLS based on the fingerprints it obtained through DNS DANE records. If the remote site is strict about the use of STARTTLS, and PowerMTA could not perform STARTTLS successfully (for e.g, PowerMTA failed to verify that the fingerprint of the certificate presented by the remote site matches the fingerprint of the certificate specified in the DANE DNS records), PowerMTA will not transfer email to the remote server. Email is held in the queue until PowerMTA can successfully establish STARTTLS successfully in accordance with DANE protocol with the remote site.</p>
<p>See RFC 7672 for more descriptions on how certificate matching is specified via the use of DNS records. Please contact Port25 support if you have any further questions about DANE protocol.</p>
<h1 id="accounting-files-and-statistics"><span class="header-section-number">11</span> Accounting Files and Statistics</h1>
<h2 id="introduction-1"><span class="header-section-number">11.1</span> Introduction</h2>
<p>The accounting file can be written in CSV format to a file or streamed to pipe.</p>
<h2 id="the-accounting-file"><span class="header-section-number">11.2</span> The Accounting File</h2>
<p>For efficiency and ease of use, PowerMTA writes accounting information to a separate file rather than to its logging file.</p>
<p>For ease of use, the accounting file is a CSV (Comma Separated Value) file.</p>
<p>There are 8 types of records available:</p>
<ul>
<li><p><em>Successful delivered</em> records which provide the data for all messages successfully transferred to the destination domain mail servers.</p></li>
<li><p><em>Bounced</em> records which provide the data for all reports PowerMTA generated and delivered, including bounces for messages that PowerMTA could not deliver.</p></li>
<li><p><em>Transient error</em> records which show each unsuccessful delivery attempt of an individual message. These errors are for individual recipients.</p></li>
<li><p><em>Transient queue error</em> records for queue-level errors.</p></li>
<li><p><em>Inbound recipients</em> records which show each successful submission of an individual message to PowerMTA.</p></li>
<li><p><em>Feedback loop</em> records can be logged if PowerMTA has been configured with a &lt;feedback-loop-processor&gt;</p></li>
<li><p><em>Remote bounce/status</em> records can be logged if PowerMTA has been configured with a &lt;bounce-processor&gt;</p></li>
</ul>
<p>All records are written to the accounting file at the time the message or report is delivered, so they will be ordered by delivery time.</p>
<hr />
<h3 id="accounting-records"><span class="header-section-number">11.2.1</span> Accounting records</h3>
<p>PowerMTA writes an accounting record per recipient delivered. These various records can be stored in all in one file, or in separate files by record type. The CSV field <code>type</code> is used to determine one of four possible values for the file. The various types are d for delivered, b for bounced, or t for transient, tq for transient-queue, and r for received, "f" for feedback loop records and "rb"/"rs" for remote bounce or remote status records. By default, only d and b records are recorded.</p>
<h3 id="successful-delivered-records"><span class="header-section-number">11.2.2</span> "Successful delivered" Records</h3>
<p>The following are all the available fields for the CSV file that can be configured with d or delivery record type.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">CSV Accounting File<br>(record-fields)</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>type</strong></td>
<td style="text-align: left;">Type of record (d or delivery) (Note: this field is always logged and cannot be disabled or changed).</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>timeLogged</strong></td>
<td style="text-align: left;">Time the record was delivered and logged to the accounting file</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>timeQueued</strong></td>
<td style="text-align: left;">Time message was queued to disk</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>totalSecondsQueued</strong></td>
<td style="text-align: left;">the total amount of time in seconds, between reception to delivery</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>orig</strong></td>
<td style="text-align: left;">originator (from <code>MAIL FROM:&lt;x&gt;</code>)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>rcpt</strong></td>
<td style="text-align: left;">recipient (<code>RCPT TO:&lt;x&gt;</code>) being reported</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>orcpt</strong></td>
<td style="text-align: left;">original recipient (from <code>RCPT TO:... ORCPT=x</code>), immediately following the recipient to which it refers</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>dsnAction</strong></td>
<td style="text-align: left;">DSN action for the recipient to which it refers (Relayed means the message was passed on to another MTA, one that doesn't support the DSN extensions. Delivered means the MTA that issued the report actually did the final delivery.)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>dsnStatus</strong></td>
<td style="text-align: left;">DSN status for the recipient to which it refers</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>dsnDiag</strong></td>
<td style="text-align: left;">DSN diagnostic string for the recipient to which it refers</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>dsnMta</strong></td>
<td style="text-align: left;">DSN remote MTA for the recipient to which it refers</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>bounceCat</strong></td>
<td style="text-align: left;">likely category of the bounce (see <a href="#bounce-categories-1">Bounce Categories</a>), following the recipient which it refers</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>srcType</strong></td>
<td style="text-align: left;">source type from which the message was received, either <code>api</code> or <code>smtp</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>srcMta</strong></td>
<td style="text-align: left;">source from which the message was received. the MTA name (from the HELO/EHLO command) for messages received through SMTP</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>dlvType</strong></td>
<td style="text-align: left;">delivery method, one of <code>smtp</code>, <code>pipe</code>, <code>discard</code>, or <code>file</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>dlvSourceIp</strong></td>
<td style="text-align: left;">local IP address PowerMTA used for delivery</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>dlvDestinationIp</strong></td>
<td style="text-align: left;">IP address of the mailer to which the report/message was delivered</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>dlvEsmtpAvailable</strong></td>
<td style="text-align: left;">SMTP extensions supported by receiving mailer</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>dlvSize</strong></td>
<td style="text-align: left;">report/message size in bytes</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>vmta</strong></td>
<td style="text-align: left;">VirtualMTA selected for this message, if any</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>jobId</strong></td>
<td style="text-align: left;">job ID for the message, if any</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>envId</strong></td>
<td style="text-align: left;">envelope Id, from <code>MAIL FROM:... ENVID=x</code> (present only if specified)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>queue</strong></td>
<td style="text-align: left;">domain/vmta used for delivery (remote status only)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>vmtaPool</strong></td>
<td style="text-align: left;">VirtualMTA pool selected for this message, if any (remote status only)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>header_XXX</strong></td>
<td style="text-align: left;">for each custom header included where XXX is the name of the header, if any</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>userString</strong></td>
<td style="text-align: left;">String added to accounting file as defined by the &lt;acct-file&gt; directive user-string.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>dlvTlsProtocol</strong></td>
<td style="text-align: left;">The TLS version that was negotiated with the remote end during STARTTLS</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>dlvTlsCipher</strong></td>
<td style="text-align: left;">The TLS cipher that was negotiated with the remote end during STARTTLS</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>rcvSmtpUser</strong></td>
<td style="text-align: left;">The SMTP authenticated user that submitted the message</td>
</tr>
</tbody>
</table>
<p>Sample accounting entry for a delivery record:</p>
<pre><code>d,2019-02-08 21:54:05+0000,2019-02-08 21:54:05+0000,AA-D=1181.com@bounce.bar.com,D@1181.com,,relayed,2.0.0 (success),smtp;250 DATA ok,foo.int.port25.com (10.1.2.3),,api,foo.int.port25.com (127.0.0.1),smtp,10.1.2.3,10.1.2.3,&quot;ENHANCEDSTATUSCODES,8BITMIME,SMTPUTF8&quot;,41159,vmta48,JoBID29546016861868,,1181.com/vmta48
</code></pre>
<h3 id="bounced-records"><span class="header-section-number">11.2.3</span> Bounced Records</h3>
<p>The following are all the available fields for the CSV file that can be configured with b or bounced record type.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">CSV Accounting File<br>(record-fields)</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>type</strong></td>
<td style="text-align: left;">Type of record (b or bounce) (Note: this field is always logged and cannot be disabled or changed).</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>timeLogged</strong></td>
<td style="text-align: left;">Time the record was delivered and logged to the accounting file</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>timeQueued</strong></td>
<td style="text-align: left;">Time message was queued to disk</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>totalSecondsQueued</strong></td>
<td style="text-align: left;">the total amount of time in seconds, between reception to delivery</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>orig</strong></td>
<td style="text-align: left;">originator (from <code>MAIL FROM:&lt;x&gt;</code>)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>rcpt</strong></td>
<td style="text-align: left;">recipient (<code>RCPT TO:&lt;x&gt;</code>) being reported</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>orcpt</strong></td>
<td style="text-align: left;">original recipient (from <code>RCPT TO:... ORCPT=x</code>), immediately following the recipient to which it refers</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>dsnAction</strong></td>
<td style="text-align: left;">DSN action for the recipient to which it refers</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>dsnStatus</strong></td>
<td style="text-align: left;">DSN status for the recipient to which it refers</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>dsnDiag</strong></td>
<td style="text-align: left;">DSN diagnostic string for the recipient to which it refers</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>dsnMta</strong></td>
<td style="text-align: left;">DSN remote MTA for the recipient to which it refers</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>bounceCat</strong></td>
<td style="text-align: left;">likely category of the bounce (see <a href="#bounce-categories-1">Bounce Categories</a>), following the recipient which it refers</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>srcType</strong></td>
<td style="text-align: left;">source type from which the message was received, either 'api' or 'smtp'</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>srcMta</strong></td>
<td style="text-align: left;">No data present in Bounce Record</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>dlvType</strong></td>
<td style="text-align: left;">No data present in Bounce Record</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>dlvSourceIp</strong></td>
<td style="text-align: left;">No data present in Bounce Record</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>dlvDestinationIp</strong></td>
<td style="text-align: left;">No data present in Bounce Record</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>dlvEsmtpAvailable</strong></td>
<td style="text-align: left;">No data present in Bounce Record</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>dlvSize</strong></td>
<td style="text-align: left;">Deprecated. No data present in Bounce Record</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>vmta</strong></td>
<td style="text-align: left;">VirtualMTA selected for this message, if any</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>jobId</strong></td>
<td style="text-align: left;">job ID for the message, if any</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>envId</strong></td>
<td style="text-align: left;">envelope Id, from <code>MAIL FROM:... ENVID=x</code> (present only if specified)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>queue</strong></td>
<td style="text-align: left;">domain/vmta used for delivery (remote status only)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>vmtaPool</strong></td>
<td style="text-align: left;">VirtualMTA pool selected for this message, if any (remote status only)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>header_XXX</strong></td>
<td style="text-align: left;">for each custom header included where XXX is the name of the header, if any</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>userString</strong></td>
<td style="text-align: left;">String added to accounting file as defined by the &lt;acct-file&gt; directive user-string.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>dlvTlsProtocol</strong></td>
<td style="text-align: left;">The TLS version that was negotiated with the remote end during STARTTLS</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>dlvTlsCipher</strong></td>
<td style="text-align: left;">The TLS cipher that was negotiated with the remote end during STARTTLS</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>rcvSmtpUser</strong></td>
<td style="text-align: left;">The SMTP authenticated user that submitted the message</td>
</tr>
</tbody>
</table>
<p>Sample accounting entry for a bounce record:</p>
<pre><code>b,2019-02-08 21:53:41+0000,2019-02-08 21:53:41+0000,CB-A=yahoo.com@bounce.bar.com,A@yahoo.com,,failed,5.7.1 (delivery not authorized),smtp;554 5.7.1 Denied - Spam Suspected - http://www.w357sfhsjhf873.net/services/spamwatch/blocked.php,foo.int.bar.com (10.1.2.3),spam-related,api,foo.int.bar.com (127.0.0.1),smtp,10.1.2.3,10.1.2.3,&quot;ENHANCEDSTATUSCODES,8BITMIME,SMTPUTF8&quot;,,vmta18,,,yahoo.rollup/vmta18
</code></pre>
<h3 id="transient-error-records"><span class="header-section-number">11.2.4</span> Transient error Records</h3>
<p>There are times when sending emails may fail. To help identify these issues, PowerMTA has the ability to show transient errors per message. This logging is handled with the record type t.</p>
<p>The following are all the available fields for the CSV file that can be configured with t or transient record type.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">CSV Accounting File<br>(record-fields)</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>type</strong></td>
<td style="text-align: left;">Type of record (t or transient) (Note: this field is always logged and cannot be disabled or changed).</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>timeLogged</strong></td>
<td style="text-align: left;">Time the record was delivered and logged to the accounting file</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>timeQueued</strong></td>
<td style="text-align: left;">Time message was queued to disk</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>totalSecondsQueued</strong></td>
<td style="text-align: left;">the total amount of time in seconds, between reception to delivery</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>orig</strong></td>
<td style="text-align: left;">originator (from <code>MAIL FROM:&lt;x&gt;</code>)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>rcpt</strong></td>
<td style="text-align: left;">recipient (<code>RCPT TO:&lt;x&gt;</code>) being reported</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>orcpt</strong></td>
<td style="text-align: left;">original recipient (from <code>RCPT TO:... ORCPT=x</code>), immediately following the recipient to which it refers</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>dsnAction</strong></td>
<td style="text-align: left;">DSN action for the recipient to which it refers</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>dsnStatus</strong></td>
<td style="text-align: left;">DSN status for the recipient to which it refers</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>dsnDiag</strong></td>
<td style="text-align: left;">DSN diagnostic string for the recipient to which it refers</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>dsnMta</strong></td>
<td style="text-align: left;">DSN remote MTA for the recipient to which it refers</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>bounceCat</strong></td>
<td style="text-align: left;">likely category of the bounce (see <a href="#bounce-categories-1">Bounce Categories</a>), following the recipient which it refers</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>srcType</strong></td>
<td style="text-align: left;">source type from which the message was received, either 'api' or 'smtp'</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>srcMta</strong></td>
<td style="text-align: left;">source from which the message was received. the MTA name (from the HELO/EHLO command) for messages received through SMTP</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>dlvType</strong></td>
<td style="text-align: left;">delivery method, one of smtp, pipe, discard, or file</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>dlvSourceIp</strong></td>
<td style="text-align: left;">local IP address PowerMTA used for delivery</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>dlvDestinationIp</strong></td>
<td style="text-align: left;">IP address of the mailer to which the report/message was delivered</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>dlvEsmtpAvailable</strong></td>
<td style="text-align: left;">SMTP extensions supported by receiving mailer</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>dlvSize</strong></td>
<td style="text-align: left;">Deprecated. report/message size in bytes</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>vmta</strong></td>
<td style="text-align: left;">VirtualMTA selected for this message, if any</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>jobId</strong></td>
<td style="text-align: left;">job ID for the message, if any</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>envId</strong></td>
<td style="text-align: left;">envelope Id, from <code>MAIL FROM:... ENVID=x</code> (present only if specified)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>queue</strong></td>
<td style="text-align: left;">domain/vmta used for delivery (remote status only)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>vmtaPool</strong></td>
<td style="text-align: left;">VirtualMTA pool selected for this message, if any (remote status only)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>header_XXX</strong></td>
<td style="text-align: left;">for each custom header included where XXX is the name of the header, if any</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>userString</strong></td>
<td style="text-align: left;">String added to accounting file as defined by the &lt;acct-file&gt; directive user-string.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>dlvTlsProtocol</strong></td>
<td style="text-align: left;">The TLS version that was negotiated with the remote end during STARTTLS</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>dlvTlsCipher</strong></td>
<td style="text-align: left;">The TLS cipher that was negotiated with the remote end during STARTTLS</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>rcvSmtpUser</strong></td>
<td style="text-align: left;">The SMTP authenticated user that submitted the message</td>
</tr>
</tbody>
</table>
<p>Sample accounting entry for a transient record:</p>
<pre><code>t,2019-02-08 21:53:54+0000,2019-02-08 21:53:54+0000,DB.AD.G.AA.AB-DA=yahoo.fr@bounce.bar.com,DA@yahoo.fr,,delayed,4.7.0 (other or undefined security status),smtp;421 4.7.0 mx002.roc2.bluetie.com Error: too many errors,foo.int.bar.com (10.1.2.165),policy-related,api,foo.int.bar.com (127.0.0.1),smtp,10.59.14.69,10.1.2.165,&quot;ENHANCEDSTATUSCODES,8BITMIME,SMTPUTF8&quot;,,vmta21,,,yahoo.rollup/vmta21,
</code></pre>
<h3 id="transient-queue-records"><span class="header-section-number">11.2.5</span> Transient Queue Records</h3>
<p>There are times when sending emails that an entire given queue may fail. It may be problems with a particular outbound IP address, or maybe one domain is currently offline. To help identify these issues, PowerMTA has not only the ability to show transient recipient errors per message, but also the same information on a per queue basis. This logging is handled with the record type tq. The records when using tq are slightly different than those mentioned above. The fields available are as follows:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">CSV Accounting File<br>(record-fields)</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>type</strong></td>
<td style="text-align: left;">Type of record (tq or transient queue) (Note: this field is always logged and cannot be disabled or changed).</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>timeLogged</strong></td>
<td style="text-align: left;">current time</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>queue</strong></td>
<td style="text-align: left;">queue name</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>vmta</strong></td>
<td style="text-align: left;">VirtualMTA name</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>dsnStatus</strong></td>
<td style="text-align: left;">DSN status code for failure</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>dsnDiag</strong></td>
<td style="text-align: left;">DSN diagnostic string for failure</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>dsnMta</strong></td>
<td style="text-align: left;">remote MTA, if applicable</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>dlvType</strong></td>
<td style="text-align: left;">delivery type</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>dlvSourceIp</strong></td>
<td style="text-align: left;">IP address from which the connection was made/attempted</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>dlvDestinationIp</strong></td>
<td style="text-align: left;">IP address to which the connection as made/attempted</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>userString</strong></td>
<td style="text-align: left;">String added to accounting file as defined by the <code>&lt;acct-file&gt;</code> directive user-string.</td>
</tr>
</tbody>
</table>
<p>Sample accounting entry for a transient queue record:</p>
<pre><code>tq,2019-02-08 21:53:39+0000,4.4.1 (no answer from host),,mx.xn--bcher-kva.de (87.98.150.101),smtp,0.0.0.0,87.98.150.101,vmta29,bcher.de/vmta29
</code></pre>
<h3 id="received-records"><span class="header-section-number">11.2.6</span> Received Records</h3>
<p>PowerMTA can log messages in the accounting file during the injection process. This logging is handled with the record type r. The fields available are as follows:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">CSV Accounting File<br>(record-fields)</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>type</strong></td>
<td style="text-align: left;">Type of record (r or received) (Note: this field is always logged and cannot be disabled or changed).</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>timeLogged</strong></td>
<td style="text-align: left;">current time</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>orig</strong></td>
<td style="text-align: left;">originator (from <code>MAIL FROM:&lt;x&gt;</code>)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>rcpt</strong></td>
<td style="text-align: left;">recipient (<code>RCPT TO:&lt;x&gt;</code>) being reported</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>orcpt</strong></td>
<td style="text-align: left;">original recipient (from <code>RCPT TO:... ORCPT=x</code>), immediately following the recipient to which it refers</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>srcType</strong></td>
<td style="text-align: left;">source type from which the message was received, either <code>api</code> or <code>smtp</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>srcMta</strong></td>
<td style="text-align: left;">source from which the message was received. the MTA name (from the HELO/EHLO command) for messages received through SMTP</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>rcvSourceIp</strong></td>
<td style="text-align: left;">IP address of the server connecting to PowerMTA</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>rcvDestinationIp</strong></td>
<td style="text-align: left;">IP address PowerMTA used to handle the connection</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>vmta</strong></td>
<td style="text-align: left;">VirtualMTA selected for this message, if any. If the message was submitted to a pool, this field will contain the pool name instead of the eventual virtual MTA (of that pool) that the message was placed into.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>vmtaPool</strong></td>
<td style="text-align: left;">VirtualMTA pool selected for this message, if any.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>jobId</strong></td>
<td style="text-align: left;">job ID for the message, if any</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>envId</strong></td>
<td style="text-align: left;">envelope Id, from <code>MAIL FROM:... ENVID=x</code> (present only if specified)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>header_XXX</strong></td>
<td style="text-align: left;">for each custom header included where XXX is the name of the header, if any</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>userString</strong></td>
<td style="text-align: left;">String added to accounting file as defined by the &lt;acct-file&gt; directive user-string.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>rcvSmtpUser</strong></td>
<td style="text-align: left;">The SMTP authenticated user that submitted the message</td>
</tr>
</tbody>
</table>
<p>Sample accounting entry for a received record:</p>
<pre><code>r,2010-04-17 16:19:57-0400,test@port25.com,test@port25.com,,smtp,tesFeeder (192.168.25.56),192.168.25.56,192.168.25.11,vmta1,job2,envid1234
</code></pre>
<h3 id="remote-bounce--remote-status-records"><span class="header-section-number">11.2.7</span> Remote Bounce &amp; Remote Status Records</h3>
<p>PowerMTA can log remote (asynchronous) bounces in the accounting file and remote status reports. This logging is handled with the record type rb for remote bounce and "rs" for reporting other kinds of remote status (used for DSN positive and "delayed" status notifications). The fields available are as follows:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">CSV Accounting File<br>(record-fields)</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>type</strong></td>
<td style="text-align: left;">Type of record rb or rs (Note: this field is always logged and cannot be disabled or changed).</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>timeLogged</strong></td>
<td style="text-align: left;">current time</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>orig</strong></td>
<td style="text-align: left;">originator address (of original email)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>rcpt</strong></td>
<td style="text-align: left;">recipient address (of original email)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>orcpt</strong></td>
<td style="text-align: left;">original recipient (from <code>RCPT TO:... ORCPT=x</code>), immediately following the recipient to which it refers</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>dsnAction</strong></td>
<td style="text-align: left;">DSN action (remote status only)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>dsnStatus</strong></td>
<td style="text-align: left;">DSN status</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>dsnDiag</strong></td>
<td style="text-align: left;">DSN diagnostic</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>dsnMta</strong></td>
<td style="text-align: left;">DSN remote MTA</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>dsnReportingMta</strong></td>
<td style="text-align: left;">DSN reporting MTA (remote bounce only)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>bounceCat</strong></td>
<td style="text-align: left;">bounce category</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>srcType</strong></td>
<td style="text-align: left;">source type from which the message was received, either <code>api</code> or <code>smtp</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>srcMta</strong></td>
<td style="text-align: left;">source from which the message was received. the MTA name (from the HELO/EHLO command) for messages received through SMTP</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>envId</strong></td>
<td style="text-align: left;">envelope Id</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>format</strong></td>
<td style="text-align: left;">either <code>dsn</code> or <code>qmail</code> or <code>mxl</code> or <code>brightmail</code> or <code>interscan</code>, or the name of the file containing the <code>body-pattern-file</code> pattern that matched this report</td>
</tr>
</tbody>
</table>
<p>Sample accounting entry for a remote bounce record:</p>
<pre><code>rb,2010-12-01 14:24:44-0500,bounce@bounce.com,lksjflkj@somedomain.com,,5.1.1 (bad destination mailbox address),&quot;smtp;550 5.1.1 no such local recipient: &lt;lksjflkj@somedomain.com&gt; in &quot;&quot;RCPT TO:&lt;lksjflkj@somedomain.com&gt;&quot;&quot;&quot;,mail.remotedomain.com (169.3.169.30),my.local.server.com,bad-mailbox,smtp,my.local.server.com
(192.168.0.150),
</code></pre>
<h3 id="feedback-loop-records"><span class="header-section-number">11.2.8</span> Feedback Loop Records</h3>
<p>PowerMTA can log feedback loop reports in the accounting file. This logging is handled with the record type f. The records when using f are slightly different than those mentioned above. The fields available are as follows:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">CSV Accounting File<br>(record-fields)</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>type</strong></td>
<td style="text-align: left;">Type of record f (Note: this field is always logged and cannot be disabled or changed).</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>timeLogged</strong></td>
<td style="text-align: left;">Current time</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>repSourceIp</strong></td>
<td style="text-align: left;">the IP of PowerMTA that received the message</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>feedbackType</strong></td>
<td style="text-align: left;">mapped to ARF's Feedback-Type field</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>format</strong></td>
<td style="text-align: left;"><code>arf</code> or <code>jmrp</code> or the name of the file containing the <code>body-pattern-file</code> pattern that matched this report</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>userAgent</strong></td>
<td style="text-align: left;">name &amp; version of the program that generated the report</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>envid</strong></td>
<td style="text-align: left;">envelope ID (of original email)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>orig</strong></td>
<td style="text-align: left;">originator address (of original email)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>rcpt</strong></td>
<td style="text-align: left;">recipient address (of original email)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>reportingMTA</strong></td>
<td style="text-align: left;">the name of the MTA generating this feedback report</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>dlvSourceIp</strong></td>
<td style="text-align: left;">address of MTA from which the message was received</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>reportedDomain</strong></td>
<td style="text-align: left;">the domain about which the feedback report was generated</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>header_&lt;name&gt;</strong></td>
<td style="text-align: left;">header extracted from original email</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>arf_&lt;name&gt;</strong></td>
<td style="text-align: left;">field from ARF feedback-report</td>
</tr>
</tbody>
</table>
<p>Sample accounting entry for a FBL record:</p>
<pre><code>f,2010-04-12 11:40:37-0400,arf,AOL SComp,,,,mail1.domain.com,169.63.151.30
</code></pre>
<h3 id="encoding"><span class="header-section-number">11.2.9</span> Encoding</h3>
<p>As much as possible, standard CSV encodings are used for all fields, with most characters being as-is in the output. Time stamps are normally formatted as MM/DD/YYYY HH:MM:SS+UTCoffset but can be changed to UNIX <code>time_t</code>, i.e. the number of seconds since midnight on January 1, 1970.</p>
<p>The format of the file is CSV (comma-separated values), UTF-8 encoded, as described in RFC 4180, with a header line at the beginning of the file describing what field is in which column. Here is the format from RFC 4180 in short: columns are separated by commas and records terminated with CRLF. Values may be quoted with double quotes (""), and must be quoted if its value contains a comma, a double quote or CRLF. A double quote occurring within double quotes is repeated, like in:</p>
<pre><code>two inches,&quot;2&quot;&quot;&quot;
</code></pre>
<p>To accommodate writing various record types in the same file, the first column is always the record type. If an accounting file is configured (or defaulted) to have multiple record types, all the possible columns from the selected records are included. For example, if a file was configured as:</p>
<pre><code>records d, b
record-fields delivery timeLogged,orig,rcpt,dlvSourceIp
record-fields bounce timeLogged,orig,rcpt,bounceCat
</code></pre>
<p>the resulting file (including a few record of each type) might look like:</p>
<pre><code>type,timeLogged,orig,rcpt,dlvSourceIp,bounceCat
d,1178807903,orig@port25.com,user1@domain.com,10.0.0.1,
d,1178807905,orig@port25.com,user2@domain.com,10.0.0.1,
b,1178807915,orig@port25.com,user3@domain.com,,policy-related
b,1178807915,orig@port25.com,user4@domain.com,,policy-related
</code></pre>
<p>Note that the <code>dlvSourceIp</code> field was omitted (empty field at the end) for the 'b' record, and that the <code>bounceCat</code> was omitted in the 'd' record, because they were not configured.</p>
<h2 id="configuring-the-accounting-file"><span class="header-section-number">11.3</span> Configuring the accounting file</h2>
<p>Use <code>&lt;acct-file&gt;</code> tag in the config file to enable accounting files. The tag takes one parameter - either the location of the CSV file or the location of the executable program to which PowerMTA should pipe the accounting records. If using pipe, the parameter should be preceded by by a |. It may be required to quote the acct file path if it contains spaces (like <code>&lt;acct-file "c:\my stuff\\acctproc.exe"&gt;</code>) or if arguments are passed (like <code>&lt;acct-file "/bin/foo.pl -x -a -z"&gt;</code>). See <a href="#examples">Examples</a> below.</p>
<p>In the current pipe implementation, if PowerMTA runs into a problem writing to the pipe, it gives up on it and won't retry either until the next <code>pmta reload</code> command is run, or after a certain predefined time limit. With this, it will be necessary for customers to configure PowerMTA to create a corresponding accounting data file as well, in order to have the data to recover, if there are problems with the customer's pipe application.</p>
<p>In the event of a broken pipe, PowerMTA writes:</p>
<pre><code>Error TYPE &quot;CMD&quot;: DETAILS
</code></pre>
<p>to the logging file, where TYPE is one of "starting", "writing to" or "executing", CMD is the configured command, and DETAILS is a string with details on what went wrong. Each time a pipe is started, the first line written to it is a headers line with the various fields (like in the CSV files). It is only re-started upon a <code>pmta reload</code>.</p>
<h3 id="examples"><span class="header-section-number">11.3.1</span> Examples</h3>
<p>The accounting file is configured with the <code>&lt;acct-file&gt;</code> type directive with the date added as part of the file name. For example <code>&lt;acct-file log/acct.csv&gt;</code> yields a file name like <code>/pmta/log/acct-2007-09-05-0000.csv</code>. By default on a new installation, the settings will look similar to the following:</p>
<pre><code>&lt;acct-file log\acct.csv&gt;
#  move-to c:\myapp\pmta-acct   # configure as fit for your application
   move-interval 1d
   max-size 250M   # MB
&lt;/acct-file&gt;
</code></pre>
<p>The data may also be written to pipe. This can be useful if a custom application is created in which the data would be written to a database in real time. PowerMTA instantiates the script only once at startup and then keeps passing data to the pipe as and when available. An example would look similar to the following:</p>
<pre><code>&lt;acct-file |C:\pmta\bin\customCode.exe --thisOption --thatOption&gt;
&lt;/acct-file&gt;
</code></pre>
<p>Multiple files can be used if needed. For example, it may be more convenient to have all bounces and deliveries in one file and transient reports in another file. An example of such would be similar to the following:</p>
<pre><code>&lt;acct-file log\acct-bd.csv&gt;
    records b,d
    record-fields d *,!orcpt,header_myCustomHeader
    record-fields b *,!orcpt
&lt;/acct-file&gt;

&lt;acct-file log\acct-t.csv&gt;
    records t,tq
&lt;/acct-file&gt;
</code></pre>
<h2 id="the-pmtastats-accounting-statistics-application"><span class="header-section-number">11.4</span> The <code>pmtastats</code> Accounting Statistics Application</h2>
<p>PowerMTA comes with an accounting file parsing application, <code>pmtastats</code>, that calculates delivery throughput and general traffic statistics both on a global basis and/or on a per campaign or mailing basis.</p>
<p>If you wish to run the parsing application over more than one accounting file (for example, if the accounting file was rotated while sending a campaign), simply specify the various files within the same command. For example:</p>
<pre><code>pmtastats [global options] [statistic [options] ..] acct.csv acct-1.csv
</code></pre>
<h3 id="pmtastats-options"><span class="header-section-number">11.4.1</span> <code>pmtastats</code> Options</h3>
<p><code>pmtastats</code> has the following options, as shown by the <code>--help</code> output:</p>
<pre><code>PowerMTA(TM) v5.0r1 statistics program
Copyright(c) 1999-2019, Port25 Solutions, Inc.  All Rights Reserved.

Usage: bin/pmtastats [global options] [statistic [options] ...] file ...

One or more statistics can be specified, each with its own options.  Use with
one or more files, in either binary, CSV or XML format.  &#39;-&#39; can be used for
reading from standard input.

examples:
     bin/pmtastats vmta-summary vmta-time-breakdown acct*
     bin/pmtastats bounce-categories --bounceCat all acct*
     bin/pmtastats --vmta vmta1 top-rates delivery-times acct*
     bin/pmtastats --output html vmta-time-breakdown acct* &gt; report.html

global options:
    --help
        display this help and exit
    --version
        display version information and exit
    --quiet
        do not display progress information
    --output &lt;format&gt;
        selects the output format (text, html; default: text)
    --envId &lt;id&gt;
    --from &lt;originator&gt;
    --toDomain &lt;domain&gt;
    --jobId &lt;id&gt;
    --vmta &lt;vmta&gt;
    --rcvSmtpUser &lt;username&gt;
    --header &lt;name&gt; &lt;content&gt;
        filter input: use only records whose envelope ID, originator,
        recipient domain, job ID, VirtualMTA, or the given header
        starts with the given string, respectively
        (default: no filtering)
    --last DdHhMmSs
        filter input: use only records written in the last D days, H hours,
        M minutes and S seconds.  Each part of the time specification can
        be omitted, such as in &quot;3h15m&quot; for 3 hours, 15 minutes.
        (default: no filtering)
    --byEnvId
    --byJobId
    --byFrom
    --byVmta
    --byHeader &lt;header&gt;
        statistics split by envelope ID, job ID, originator, VirtualMTA, or a
        given header, respectively.
        Only one of these can be used.
        For --byHeader, specify the header.
        (default: statistics not split)
    --splitLimit &lt;num&gt;
        set the maximum number of statistics a statistic can be split into
        (default: 5000)

    --topDomains &lt;num&gt;
        display top &lt;num&gt; domains (passed on to all statistics)

&quot;bounce-categories&quot; statistic
Shows most frequent bounce categories.
Options:
    --topCategories &lt;num&gt;
        display top &lt;num&gt; bounce categories (default: 10)
    --bounceCat &lt;option&gt;
        selects categories for detailed display.  Possible options are:
            &lt;num&gt; - top &lt;num&gt; categories
            &lt;category&gt; - category name
            &#39;all&#39; - all available categories
        (default: spam-related)
    --byDsn &lt;num&gt;
        display bounce category detail for the top &lt;num&gt; DSN codes (default: 10)
    --byDomain &lt;num&gt;
        display bounce category detail for the top &lt;num&gt; domains (default: 10)
    --byDsnAndDomain &lt;num&gt;
        display bounce category detail for the top &lt;num&gt; DSN code / domain
        combinations (default: 10)

&quot;delivery-times&quot; statistic
Shows times and recipients / time from queueing to delivery.
Options:
    (none)

&quot;message-counts&quot; statistic
Total counts of recipients and volume for messages and bounces.
Options:
    (none)

&quot;top-bounce&quot; statistic
Top bounce domains, aggregated by DSN code (reason).
Options:
    --topDomains &lt;num&gt;
        display bounce statistic for top &lt;num&gt; domains (default: 10)
    --topStatusCodes &lt;num&gt;
        display bounce statistics for top &lt;num&gt; status codes (default: 10)

&quot;top-domains&quot; statistic
Domains with the most recipients, bounces, and delivery times.
Options:
    --topDomains &lt;num&gt;
        display top &lt;num&gt; domains (default: 10)
    --noDeliveryTimes
        omits list of domains with the highest average delivery times
        (default: includes it)

&quot;top-rates&quot; statistic
Data transfer and recipient rates over time.
Options:
    (none)

&quot;vmta-summary&quot; statistic
High-level Virtual MTA traffic summary.
Options:
    --byDate
        split records by date (default: no splitting done)

&quot;vmta-time-breakdown&quot; statistic
Daily and hourly recipients and bounces for each Virtual MTA.
Options:
    --noHourly
        do not include hourly breakdown (default: include it)

&quot;vmta-top-bounce&quot; statistic
Bounces for individual Virtual MTAs.
Options:
    --topBounced &lt;num&gt;
        show top &lt;num&gt; domains by bounces (default: 20)
    --byDate
        split records by date (default: no splitting done)

shortcut options:
    --all
        create all available statistics with default options
    --acctstats
        create statistics similar to what acctstats did
</code></pre>
<p>Note: On Windows, you can also use the "/" character instead of "--" (but "--" works on all platforms).</p>
<p>The following is a list of the various fields available, and which reports return those fields.</p>
<table>
<thead>
<tr class="header">
<th></th>
<th>bounce-categories</th>
<th>delivery-times</th>
<th>just-delivery-times</th>
<th>message-counts</th>
<th>top-bounce</th>
<th>top-domains</th>
<th>top-rates</th>
<th>vmta-summary</th>
<th>vmta-time-breakdown</th>
<th>vmta-top-bounce</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>bounceCat</td>
<td>*</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>dlvSourceIp</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>*</td>
<td>*</td>
<td>*</td>
</tr>
<tr class="odd">
<td>dsnDiag</td>
<td>*</td>
<td></td>
<td></td>
<td>*</td>
<td>*</td>
<td></td>
<td></td>
<td>*</td>
<td>*</td>
<td>*</td>
</tr>
<tr class="even">
<td>dsnStatus</td>
<td>*</td>
<td></td>
<td></td>
<td></td>
<td>*</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>envId</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>header_&lt;xyz&gt;</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>jobId</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>nRcpt</td>
<td>*</td>
<td>*</td>
<td></td>
<td></td>
<td>*</td>
<td></td>
<td>*</td>
<td>*</td>
<td>*</td>
<td>*</td>
</tr>
<tr class="odd">
<td>orig</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>rcpt</td>
<td></td>
<td></td>
<td></td>
<td>*</td>
<td>*</td>
<td>*</td>
<td></td>
<td></td>
<td></td>
<td>*</td>
</tr>
<tr class="odd">
<td>size</td>
<td></td>
<td></td>
<td></td>
<td>*</td>
<td></td>
<td></td>
<td>*</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>timeLogged</td>
<td></td>
<td>*</td>
<td></td>
<td></td>
<td></td>
<td>*</td>
<td>*</td>
<td>*</td>
<td>*</td>
<td>*</td>
</tr>
<tr class="odd">
<td>timeQueued</td>
<td></td>
<td>*</td>
<td>*</td>
<td></td>
<td></td>
<td>*</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>vmta</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>*</td>
<td>*</td>
<td>*</td>
</tr>
</tbody>
</table>
<h3 id="pmtastats-report-breakdown"><span class="header-section-number">11.4.2</span> <code>pmtastats</code> Report Breakdown</h3>
<p>Given the various reports available, different data will or will not be included in each report based on the options used. Here is a sample of the reports available and their output. Multiple reports can be run at the same time.</p>
<h4 id="time-frame"><span class="header-section-number">11.4.2.1</span> Time Frame</h4>
<pre><code>   Time Frame:
                                       first                last
                                       -------------------  -------------------
                    received           2018-11-06 18:07:52  2018-11-06 19:29:33
                    delivered/bounced  2018-11-06 19:12:00  2018-11-06 19:29:33
</code></pre>
<p>This section is always generated for each report type, and shows the first and the last receipt time stamps and the first and the last delivery time stamps of the applicable messages. The scope of the output is based on the type of report specified, i.e., global or by originator or by envelope ID, and such can be used to calculate a campaign duration time. In this example, the mailing duration would be 13 hours 56 minutes and 35 seconds, which is the difference between when the first message was received (2007-01-15 14:19:11) and the last message was delivered (2007-01-17 03:15:46).</p>
<h4 id="bounce-categories"><span class="header-section-number">11.4.2.2</span> Bounce Categories</h4>
<pre><code>Total Bounce Breakdown By Category:

   Bounces (across 12 categories):

   total bounced  5.X.X bounces  4.X.X bounces
   -------------  -------------  -------------
           9,321          8,994            327

   bounced  %bounced  bounce category
   -------  --------  -------------------
     2,748     29.5%  spam-related
     1,978     21.2%  policy-related
     1,628     17.5%  bad-mailbox
       812      8.7%  quota-issues
       482      5.2%  other
       451      4.8%  invalid-sender
       366      3.9%  inactive-mailbox
       327      3.5%  no-answer-from-host
       259      2.8%  relaying-issues
       160      1.7%  protocol-errors

Bounce Category Detail (spam-related)

   bounce category  total bounced  5.X.X bounces  4.X.X bounces
   ---------------  -------------  -------------  -------------
   spam-related             2,748          2,748              0


   Sorted By DSN Code (Reason)

   bounced  % in category  dsn code (reason)
   -------  -------------  -----------------
        43           1.6%  5.7.1 (delivery not authorized); 554 5.7.1 Blacklisted by black.uribl.com Contact the postmaster of this domain for resolution.
        38           1.4%  5.7.1 (delivery not authorized); 554 5.7.1 Blacklisted by Contact the postmaster of this domain for resolution. This attempt has been logged.
        35           1.3%  5.7.1 (delivery not authorized); 554 5.7.1 Blacklisted by cim-10.net.multi.surbl.org Contact the postmaster of this domain for resolution. This attempt has been logged.
        32           1.2%  5.7.1 (delivery not authorized); 554 5.7.1 Denied - Spam Suspected - http://&lt;RCPT_SERVER&gt;/services/spamwatch/blocked.php
        32           1.2%  5.7.1 (delivery not authorized); 554 5.7.1 Rejected... Message identified as UBE (spam). If you feel you have received this message in error CALL the intended recipient and ask them to report the issue to support services.
        32           1.2%  5.7.1 (delivery not authorized); 554 5.7.1 Your message was rejected as spam
        32           1.2%  5.7.1 (delivery not authorized); 571 5.7.1 Message contains spam or virus : 1585:&lt;HEXDUMP&gt;|5439
        31           1.1%  5.7.1 (delivery not authorized); 554 5.7.1 Blacklisted by cim-10.net.black.uribl.com Contact the postmaster of this domain for resolution. This attempt has been logged.
        31           1.1%  5.7.1 (delivery not authorized); 554 5.7.1 Message blocked due to spam content in the message
        30           1.1%  5.7.1 (delivery not authorized); 554 5.7.1 &lt;SENDER_IPADDRESS&gt;: on real-time blacklist b.barracudacentral.org


   Sorted By Domain

   domain                              bounced  % in category
   ----------------------------------  -------  -------------
   yahoo.com                               149           5.4%
   hotmail.fr                               94           3.4%
   .                              91           3.3%
   hotmail.es                               71           2.6%
   bb.de                                   61           2.2%
   yahoo.fr                                 58           2.1%
   yahoo.es                                 56           2.0%
   blbrsyltety.gulbrandsen.priv.no       55           2.0%
   live.ca                                  46           1.7%
   live.nl                                  45           1.6%


   Sorted By DSN Code (Reason) By Domain

   domain                              bounced  % in category  dsn code (reason)
   ----------------------------------  -------  -------------  -----------------
   .                               7           0.3%  5.0.0 (undefined status); 553 5.0.0 We do not accept mail from spammers ([&lt;SENDER_IPADDRESS&gt;][&lt;SENDER_IPADDRESS&gt;])
   yahoo.com                                 7           0.3%  5.7.1 (delivery not authorized); 554 5.7.1 Message blocked due to spam content in the message
   yahoo.com                                 7           0.3%  5.7.1 (delivery not authorized); 571 5.7.1 Message contains spam or virus : 1585:&lt;HEXDUMP&gt;|5439
   blbrsyltety.gulbrandsen.priv.no        5           0.2%  5.0.0 (undefined status); 551 5.0.0 message classified as spam (RefID: str=0001.&lt;HEXDUMP&gt;.&lt;HEXDUMP&gt;.00C9,ss=4,fgs=0)
   hotmail.fr                                5           0.2%  5.7.1 (delivery not authorized); 554 5.7.1 Message rejected, SpamAssassin scored: 9.674 points TESTS=HTML_MESSAGE,IISDATED_4_25_2009,MIME_HTML_ONLY,NO_216_174_43CLASSC
   yahoo.com                                 5           0.2%  5.7.1 (delivery not authorized); 554 5.7.1 Rejected... Message identified as UBE (spam). If you feel you have received this message in error CALL the intended recipient and ask them to report the issue to support services.
   yahoo.es                                  4           0.1%  5.0.0 (undefined status); 553 5.0.0 We do not accept mail from spammers ([&lt;SENDER_IPADDRESS&gt;][&lt;SENDER_IPADDRESS&gt;])
   yahoo.fr                                  4           0.1%  5.3.0 (unknown mail system-related status); 553 5.3.0 &lt;&lt;RCPT_USER&gt;@&lt;yahoo.fr&gt;&gt;... Rejected by Iserv RBL. If this is an error, please contact our customer service department at 1-888-644-7378. - &lt;SENDER_IPADDRESS&gt;
   msn.com                                   4           0.1%  5.7.1 (delivery not authorized); 550 5.7.1 mail from &lt;SENDER_IPADDRESS&gt; rejected for spam/virus content
   blbrsyltety.gulbrandsen.priv.no        4           0.1%  5.7.1 (delivery not authorized); 550 5.7.1 rejected as confirmed spam
</code></pre>
<p>This report list the top level bounce information. The scope of the output is based on the type of report specified, and the above example is done using no additional options.</p>
<p>Note that the report is based only on the messages that have already been handled by PowerMTA. If the report is generated while PowerMTA is still attempting to deliver some of the messages, these will not be included in the report.</p>
<h4 id="delivery-times"><span class="header-section-number">11.4.2.3</span> Delivery Times</h4>
<pre><code>Delivery Times And Numbers (total queue time):

   Delivery times per percentage of recipients (successful deliveries only):

                                       recipients  avg. time  max. time  %rcpt.
                                       ----------  ---------  ---------  ------
                                           46,497    0:00:00    0:00:00     50%
                                           55,797    0:00:00    0:00:00     60%
                                           65,096    0:00:00    0:00:00     70%
                                           74,396    0:00:00    0:00:00     80%
                                           83,695    0:00:00    0:00:00     90%
                                           88,345    0:00:00    0:00:01     95%
                                           89,275    0:00:00    0:00:01     96%
                                           90,205    0:00:00    0:00:01     97%
                                           91,135    0:00:00    0:05:05     98%
                                           92,065    0:00:06    0:10:00     99%
                                           92,995    0:00:13    0:45:01    100%


   Deliveries per time increment (successful deliveries only):

               interval (between)  histogram                recipients   %rcpt.
               ------------------  -----------------------  -----------  ------
                0 -  5 seconds     **********************        90,691   97.5%
                6 - 30 seconds                                        0    0.0%
               31 - 60 seconds                                        0    0.0%
                1 -  2 minutes                                       48    0.1%
                2 -  5 minutes                                      394    0.4%
                5 - 10 minutes                                    1,222    1.3%
               10 - 30 minutes                                      626    0.7%
               30 - 60 minutes                                       14    0.0%
                1 -  2 hours                                          0    0.0%
                2 -  3 hours                                          0    0.0%
                3 -  4 hours                                          0    0.0%
                4 -  5 hours                                          0    0.0%
                5 -  6 hours                                          0    0.0%
                6 -  8 hours                                          0    0.0%
                8 - 10 hours                                          0    0.0%
               10 - 12 hours                                          0    0.0%
               after 12 hours                                         0    0.0%


   Cumulative deliveries per time increment (successful deliveries only):

                interval           histogram                recipients   %rcpt.
                -----------------  -----------------------  -----------  ------
                within 5 seconds   **********************        90,691   97.5%
                within 30 seconds  **********************        90,691   97.5%
                within 1 minute    **********************        90,691   97.5%
                within 2 minutes   **********************        90,739   97.6%
                within 5 minutes   **********************        91,133   98.0%
                within 10 minutes  **********************        92,355   99.3%
                within 30 minutes  ***********************       92,981  100.0%
                within 1 hour      ***********************       92,995  100.0%
                within 2 hours     ***********************       92,995  100.0%
                within 3 hours     ***********************       92,995  100.0%
                within 4 hours     ***********************       92,995  100.0%
                within 5 hours     ***********************       92,995  100.0%
                within 6 hours     ***********************       92,995  100.0%
                within 8 hours     ***********************       92,995  100.0%
                within 10 hours    ***********************       92,995  100.0%
                within 12 hours    ***********************       92,995  100.0%
                after 12 hours     ***********************       92,995  100.0%
</code></pre>
<p>This section and respective outputs are always generated and the scope of the outputs are based on the type of report specified, i.e., global or by originator/envelope ID. They also are primarily based on the difference between each message's queue timestamp and transfer timestamp for only the messages that were successfully delivered by PowerMTA.</p>
<p>As mentioned in <a href="#top-domains">Top Domains</a>, for the <code>avg. time</code> and <code>max. time</code> calculations, each recipient is counted by itself, even if a message is transferred in multi-recipient SMTP transactions.</p>
<p>The <code>avg. time</code> is calculated by adding together the fastest n% transfer times (transfer timestamp - queue timestamp) and then dividing this sum by the number of recipients that make up n% of the total deliveries. For example, in the 80% fastest delivery line in the top output, one would read that it took an average of 21 seconds for each message to each recipient to be delivered once each was queued, for the fastest 80% of all transfer times (or to 7,504,928 recipients).</p>
<p>The <code>max. time</code> is the longest transfer time (transfer timestamp - queue timestamp) for one message from all of the fastest transfer times for the number of recipients. In the 80% fastest delivery case, one would read that the longest it took for a message to be transferred, for the fastest 80% of all transfer times (or to 7,504,928 recipients), was 4 minutes and 24 seconds. Conversely, all of the 80% messages were transferred in equal or less time. Note that this does not show total campaign duration time since these figures are only based on each message's own transfer time.</p>
<h4 id="message-counts"><span class="header-section-number">11.4.2.4</span> Message Counts</h4>
<pre><code>Global Message Counts And Sizes:

   Message counts:

                                                        recipients       volume
                                                        ----------  -----------
                                            deliveries      92,995  18,532.1 kb
                                            bounces          9,321
                                            total          102,316  18,532.1 kb


   Message sizes:

                                                min. size  avg. size  max. size
                                                ---------  ---------  ---------
                                                   0.2 kb     0.2 kb     0.3 kb
</code></pre>
<p>This report list the basic numbers associated on the mailings being reported. Totals for delivered, bounced, and size of messages are included.</p>
<h4 id="top-bounce"><span class="header-section-number">11.4.2.5</span> Top Bounce</h4>
<pre><code>Top Bounce Domain Breakdowns:

                               domain  recipients  total bounced  5.X.X bounces  4.X.X bounces
   ----------------------------------  ----------  -------------  -------------  -------------
                            yahoo.com       2,620            458            458              0
                          .       1,577            342            342              0
                              noos.fr         257            257              0            257
                           hotmail.fr         846            232            232              0
                               bb.de       1,643            194            194              0
                             yahoo.fr         737            183            183              0
                             yahoo.es         580            177            177              0
                              msn.com         668            172            172              0
   blbrsyltety.gulbrandsen.priv.no         960            166            166              0
                           hotmail.es         614            160            160              0

...

   hotmail.fr

                domain  recipients  total bounced  5.X.X bounces  4.X.X bounces
            ----------  ----------  -------------  -------------  -------------
            hotmail.fr         846            232            232              0

   bounced  %bounced  dsn code (reason)
   -------  --------  -----------------
         5      2.2%  5.7.1 (delivery not authorized); 554 5.7.1 BRBL entry - see &lt;http://www.barracudanetworks.com/reputation/?pr=1&amp;ip=&lt;SENDER_IPADDRESS&gt;&gt;
         5      2.2%  5.7.1 (delivery not authorized); 554 5.7.1 Command rejected
         5      2.2%  5.7.1 (delivery not authorized); 554 5.7.1 Message rejected, SpamAssassin scored: 9.674 points TESTS=HTML_MESSAGE,IISDATED_4_25_2009,MIME_HTML_ONLY,NO_216_174_43CLASSC
         4      1.7%  5.7.1 (delivery not authorized); 554 5.7.1 &lt;END-OF-MESSAGE&gt;: End-of-data rejected: email account is over quota (&lt;HEXDUMP&gt;+&lt;HEXDUMP&gt;&gt;&lt;HEXDUMP&gt;)
         4      1.7%  5.7.1 (delivery not authorized); 554 5.7.1 Abusive connections. Please try again later.
         4      1.7%  5.7.1 (delivery not authorized); 554 5.7.1 Error: Mailbox over quota
         4      1.7%  5.7.1 (delivery not authorized); 554 5.7.1 Service unavailable; Sender address [&lt;ORIG&gt;] found on high spam probability list
         4      1.7%  5.7.1 (delivery not authorized); 554 5.7.1 Spam filter: Please Visit http://www.ncmail.net/rejectedemails.htm to resolve issues
         3      1.3%  5.0.0 (undefined status); 550 5.0.0 Rejected-This domain is a chronic spammer.Contact &lt;OTHER_USER&gt;@&lt;hotmail.fr&gt; via an alternate domain
         3      1.3%  5.1.1 (bad destination mailbox address); 550 5.1.1 &lt;&lt;RCPT_USER&gt;@&lt;hotmail.fr&gt;&gt;: Recipient address rejected: User unknown in virtual alias table

...

</code></pre>
<p>The top bounce domain breakdown shows detailed bounce reasons for the top domains. By default, the top 10 domains (in terms of bounces) are printed, but this can be changed with the --topDomains num option. Data was removed from the above output to save space in this document.</p>
<p>For each domain the top bounce reasons are given as absolute number of bounces and as percentage of the bounces. The DSN (delivery status notification) code gives the reason for that bounce, as received by the foreign mail server. As a trade-off between detail and usability the DSN reason is only slightly modified (for example, email addresses in bounce messages are also replaced by ...@...to be able to generalize the bounces into bounce categories).</p>
<p>So, while the total bounces breakdown provides an aggregated overview of the bounces, the top domains breakdown gives full detail on bounces grouped by domain.</p>
<h4 id="top-domains"><span class="header-section-number">11.4.2.6</span> Top Domains</h4>
<pre><code>Top Domains Breakdown:

   Domains with largest number of queued recipients:

                      domain  recipients  bounced  avg. time  max. time  %rcpt.
              --------------  ----------  -------  ---------  ---------  ------
                 hotmail.com      29,718       54    0:00:00    0:10:41    4.2%
                   yahoo.com      18,326    3,326    0:00:17    0:21:45    2.6%
                   gmail.com      14,181        0    0:00:00    0:00:03    2.0%
                  maana.com      12,021      908    0:00:06    0:20:00    1.7%
                 .      10,492    2,490    0:00:12    0:20:50    1.5%


   Domains with highest number of bounces:

                               domain  recipients  bounced  avg. time  max. time  %rcpt.
   ----------------------------------  ----------  -------  ---------  ---------  ------
                            yahoo.com      18,326    3,326    0:00:17    0:21:45    2.6%
                          .      10,492    2,490    0:00:12    0:20:50    1.5%
                              noos.fr       1,648    1,648        n/a        n/a    0.2%
                           hotmail.fr       5,637    1,440    0:00:34    0:21:01    0.8%
                             yahoo.fr       5,007    1,301    0:00:15    0:20:20    0.7%


   Domains with highest average delivery times:

                      domain  recipients  bounced  avg. time  max. time  %rcpt.
              --------------  ----------  -------  ---------  ---------  ------
               earthlink.net       1,940    1,119    0:31:43    1:00:59    0.3%
              mindspring.com         634      380    0:28:28    1:00:50    0.1%
                  freenet.de         507        0    0:10:50    0:45:01    0.1%
                    3363.com           3        1    0:10:00    0:20:00    0.0%
                    3471.com           1        0    0:10:00    0:10:00    0.0%
</code></pre>
<p>This report shows the counts and throughput for the top domains based on:</p>
<ul>
<li><p>the largest number of recipients initially submitted and queued for delivery,</p></li>
<li><p>the highest number of bounces handled by PowerMTA, and</p></li>
<li><p>the highest average delivery times.</p></li>
</ul>
<p>The scope of the outputs are based on the type of report specified, i.e., global or by originator, envelope ID, or virtual mail transfer agent.</p>
<p>For all three sections, the <code>recipients</code> column shows the total number of recipients submitted and queued for delivery for the domains, while the <code>bounced</code> column provides just the number of recipients that PowerMTA itself bounced (local bounces). Note that this is not a count of all of the bounces since any bounces happening after PowerMTA has transferred the message to an intermediate mailer count as successful transfers. The difference between the recipients and bounced columns is then the number of recipients that were successfully transferred by PowerMTA.</p>
<p>For all three sections, the <code>avg. time</code> and <code>max. time</code> calculations are based on the difference between each message's queue timestamp and transfer timestamp. Only messages that were successfully delivered are included; bounces and other delivery reports are not. Messages transferred in multi-recipient (multi-"RCPT TO") SMTP transactions are broken down and each recipient is counted as a separate "delivery", each with its own transfer rate equal to that of the whole transaction itself. This is not an issue with single RCPT TO messages since messages delivered already equals recipients delivered.</p>
<p>The <code>avg. time</code> is calculated by adding together all of the transfer times (transfer timestamp - queue timestamp) to the respective domain for each recipient, and then dividing this by the number of recipients to the domain. Using AOL as an example in the first output, one would read that it took an average of 2 seconds for each message for each recipient to be delivered, once each message was queued, for the 92,891 recipients at AOL.com.</p>
<p>The <code>max. time</code> is the longest transfer time (transfer timestamp - queue timestamp) for one message to the respective domain. In the AOL case, one would read that the longest it took for one message to be delivered to AOL was 1 minute and 23 seconds. Conversely, all other messages to AOL for the 92,891 recipients were transferred in equal or less time.</p>
<p>The <code>%rcpt</code> column provides the percentage of recipients submitted and queued for the domain to the total number of recipients across the scope of the report. For example, AOL's 92,891 queued recipients were 23.2% of the 400,761 total queued recipients.</p>
<h4 id="top-rates"><span class="header-section-number">11.4.2.7</span> Top Rates</h4>
<pre><code>Top Rates:

   Top recipient delivery rates:

                     measured over  rcpt./min.  recipients  beginning on
                     -------------  ----------  ----------  -------------------
                     one minute          6,458       6,458  2018-11-06 21:05:17
                     five minutes        5,495      27,479  2018-11-06 21:04:38
                     one hour            5,290     317,450  2018-11-06 20:09:36


   Top throughput rates:

             measured over  kbytes/s    kbytes  recipients  beginning on
             -------------  --------  --------  ----------  -------------------
             one minute         21.4   1,286.1       6,458  2018-11-06 21:05:17
             five minutes       18.3   5,485.4      27,469  2018-11-06 21:01:40
             one hour           17.6  63,229.6     317,401  2018-11-06 20:12:19
</code></pre>
<p>This report shows the top throughput rates realized per recipient and the top data transfer rates during a time interval of one and five minutes and one hour. The scope of the output is <em>always</em> global and such is always based on the total numbers in the whole accounting file. All messages, normal deliveries as well as reports (including bounces) are taken into account when calculating these rates.</p>
<p>The top recipient delivery rates are calculated for each time increment by sorting all accounting records by delivery time and then searching for the time interval during which the largest number of recipients were handled. This number is then entered in then <code>recipients</code> column. The <code>rcpt./min.</code> column provides a uniform recipient transfer measurement across the three time intervals, and is calculated by taking the numbers in the <code>recipients</code> column and dividing each by the number of minutes that make up each respective time interval (i.e. dividing the five minutes result by five and the one hour result by sixty). The <code>messages</code> column shows the corresponding number of messages that were actually sent (i.e., number of SMTP transactions) while handling these recipients. This information is important when comparing performance numbers, since delivering a single message to multiple recipients is a lot less resource intensive than delivering individual messages.</p>
<p>The top throughput rates are calculated in the same manner as the recipient delivery rates, however the top amount of data transferred per time interval is reported rather than the number of recipients. This transfer rate output is independent to the recipient delivery rate output, so they may or may not reflect the same messages. The <code>kbytes/s</code> column provides a uniform data transfer measurement across the three time increments, and is calculated by taking the numbers in the <code>kbytes</code> column and dividing each by the number of seconds that make up each respective time increment (i.e., dividing the five minutes result by 300 and the one hour result by 3600). The <code>messages</code> column shows the corresponding number of messages that were actually sent comprising the number of kilobytes shown.</p>
<h4 id="vmta-summary"><span class="header-section-number">11.4.2.8</span> VMTA Summary</h4>
<pre><code>VirtualMTA Traffic Summary:

   VirtualMTA  IP address   Recipients  Delivered  Bounced  Bounced%
   ----------  -----------  ----------  ---------  -------  --------
   vmta816     127.0.0.1           920        802      118     12.8%
   vmta76      127.0.0.1           824        742       82     10.0%
   vmta447     127.0.0.1           794        716       78      9.8%
   vmta489     127.0.0.1           792        706       86     10.9%
   vmta545     127.0.0.1           772        691       81     10.5%
   vmta77      127.0.0.1           770        691       79     10.3%
   vmta816     10.59.14.69         763        707       56      7.3%
   vmta688     127.0.0.1           758        677       81     10.7%
   vmta941     127.0.0.1           748        665       83     11.1%
   vmta603     127.0.0.1           743        664       79     10.6%
   vmta76      10.59.14.69         737        670       67      9.1%
   vmta632     127.0.0.1           726        653       73     10.1%
   vmta602     127.0.0.1           722        647       75     10.4%
   vmta567     127.0.0.1           719        655       64      8.9%
   vmta523     127.0.0.1           713        623       90     12.6%
   vmta960     127.0.0.1           711        656       55      7.7%
   vmta718     127.0.0.1           710        636       74     10.4%
   vmta134     127.0.0.1           708        628       80     11.3%
   vmta13      127.0.0.1           703        618       85     12.1%
   vmta5       127.0.0.1           701        628       73     10.4%
   vmta387     127.0.0.1           698        621       77     11.0%
   vmta723     127.0.0.1           698        641       57      8.2%
   vmta825     127.0.0.1           693        629       64      9.2%
   vmta62      127.0.0.1           690        624       66      9.6%
   vmta941     10.59.14.69         688        630       58      8.4%
   vmta794     127.0.0.1           688        621       67      9.7%
   vmta945     127.0.0.1           687        630       57      8.3%
   vmta124     127.0.0.1           681        599       82     12.0%
   vmta136     127.0.0.1           679        598       81     11.9%
   vmta695     127.0.0.1           678        597       81     11.9%
   vmta51      127.0.0.1           676        615       61      9.0%
   vmta286     127.0.0.1           672        587       85     12.6%
   vmta545     10.59.14.69         670        636       34      5.1%
   vmta400     127.0.0.1           665        600       65      9.8%
   vmta346     127.0.0.1           662        592       70     10.6%
   vmta357     127.0.0.1           661        585       76     11.5%
   vmta447     10.59.14.69         661        614       47      7.1%
   vmta456     127.0.0.1           660        591       69     10.5%
   vmta718     10.59.14.69         659        611       48      7.3%

   ...

   Total                       701,338    635,365   65,973      9.4%
</code></pre>
<p>VMTA Summary shows high level counters on the amount of messages that were sent to individual VirtualMTAs. This information includes a breakdown of deliveries, bounces, and percentage of bounces per VirtualMTA. The delivering IP is also included to help in determining if there is a reputation/sending issue with a given address.</p>
<h4 id="vmta-time-breakdown"><span class="header-section-number">11.4.2.9</span> VMTA Time Breakdown</h4>
<pre><code>VirtualMTA Traffic Breakdown By Time:

   VirtualMTA: vmta816, IP Address: 127.0.0.1

   Daily Breakdown:

   Date        Recipients  Delivered  Bounced  Bounced%
   ----------  ----------  ---------  -------  --------
   2018-11-06         920        802      118     12.8%

   Hourly Breakdown:

   ---------------------- 2018-11-06 ---------------------
   Interval       Recipients  Delivered  Bounced  Bounced%
   -------------  ----------  ---------  -------  --------
   00:00 - 00:59           0          0        0      0.0%
   01:00 - 01:59           0          0        0      0.0%
   02:00 - 02:59           0          0        0      0.0%
   03:00 - 03:59           0          0        0      0.0%
   04:00 - 04:59           0          0        0      0.0%
   05:00 - 05:59           0          0        0      0.0%
   06:00 - 06:59           0          0        0      0.0%
   07:00 - 07:59           0          0        0      0.0%
   08:00 - 08:59           0          0        0      0.0%
   09:00 - 09:59           0          0        0      0.0%
   10:00 - 10:59           0          0        0      0.0%
   11:00 - 11:59           0          0        0      0.0%
   12:00 - 12:59           0          0        0      0.0%
   13:00 - 13:59           0          0        0      0.0%
   14:00 - 14:59           0          0        0      0.0%
   15:00 - 15:59           0          0        0      0.0%
   16:00 - 16:59           0          0        0      0.0%
   17:00 - 17:59           0          0        0      0.0%
   18:00 - 18:59           0          0        0      0.0%
   19:00 - 19:59         424        368       56     13.2%
   20:00 - 20:59         390        344       46     11.8%
   21:00 - 21:59         106         90       16     15.1%
   22:00 - 22:59           0          0        0      0.0%
   23:00 - 23:59           0          0        0      0.0%

   ...
</code></pre>
<p>The VMTA time breakdown shows bounce counts for the top VirtualMTAs by time interval. By default all the VirtualMTAs are printed. For each VirtualMTA the bounce counts are given as absolute number of bounces and as percentage of the bounces for a given time period.</p>
<h4 id="vmta-top-bounces"><span class="header-section-number">11.4.2.10</span> VMTA Top Bounces</h4>
<pre><code>VirtualMTA Top Bounce Domains:

   VirtualMTA: vmta816, IP Address: 127.0.0.1

   Domain                              Recipients  Delivered  Bounced  Bounced%
   ----------------------------------  ----------  ---------  -------  --------
   blbrsyltety.gulbrandsen.priv.no          22         15        7     31.8%
   telefonica.net                              14          8        6     42.9%
   bb.de                                      19         14        5     26.3%
   centurytel.net                               6          1        5     83.3%
   .                                 19         15        4     21.1%
   windowslive.com                             11          7        4     36.4%
   live.nl                                      9          5        4     44.4%
   knology.net                                  5          1        4     80.0%
   orange.fr                                   17         14        3     17.6%
   voila.fr                                    10          7        3     30.0%
   live.com.au                                  9          6        3     33.3%
   att.net                                      8          5        3     37.5%
   gmx.de                                       5          2        3     60.0%
   gmx.fr                                       5          2        3     60.0%
   surewest.net                                 4          1        3     75.0%
   .cn                                    19         17        2     10.5%
   free.fr                                     12         10        2     16.7%
   wanadoo.fr                                  11          9        2     18.2%
   rocketmail.com                               9          7        2     22.2%
   wowway.com                                   6          4        2     33.3%

   ...

</code></pre>
<p>The VMTA Top Bounces report shows bounce counts for all the VirtualMTAs. By default, the top 20 domains (in terms of bounces) are printed, but this can be changed with the <code>--topBounced &lt;num&gt;</code> option.</p>
<p>For each domain the top bounce reasons are given as absolute number of bounces and as percentage of the bounces. So, while the top bounces report provides an aggregated overview of the bounces, the VMTA top bounces report gives high level data on bounces grouped by VirtualMTA.</p>
<h2 id="the-acctfind-accounting-reporting-application"><span class="header-section-number">11.5</span> The <code>acctfind</code> Accounting Reporting Application</h2>
<p><code>acctfind</code> is a powerful accounting file search and reporting tool. It can be found in the <code>\pmta\bin</code> directory on Windows, and in the <code>/usr/sbin</code> directory (named <code>pmtaacctfind</code>) on Unix.</p>
<p>The tool is not required for exporting data from the accounting file because the file is no longer in a proprietary binary format. With the CSV accounting file written by PowerMTA, reporting can be done without this tool. This tool, however, will still work with the CSV file format, and is provided to assist with extracting subsets of the data.</p>
<p><code>acctfind</code> allows one to search for records in the accounting file, as well as to produce a custom output based on specific fields in the matching records. For example, one can easily use <code>acctfind</code> to generate a list of all addresses that bounced with a persistent (5xx) error for a particular campaign, sorted by the bounce reason, in a tab separated output that contains the recipient address first, followed by the MAIL FROM/originator address, then the bounce code and reason.</p>
<p><code>acctfind</code> currently supports seven different output formats including standard, comma separated values, tab separated values, html, xml, "pretty" xml, and custom-defined outputs.</p>
<p>This Section provides a quick overview of the feature set and options, along with sample commands, however the more detailed help obtained by passing the --help option to <code>acctfind</code> itself should be referenced for further insight.</p>
<p>The general format for the command is</p>
<pre><code>acctfind [options] accounting files ...
</code></pre>
<p>The top level segmentation options are based on the record types, which include searching for matches in records for messages successfully delivered (<code>--delivered</code>), bounce reports delivered (<code>--bounced</code>), run status records (<code>--status</code>), and general mta information (<code>--mta</code>).</p>
<p>For example,</p>
<pre><code>acctfind --bounced acct.csv
</code></pre>
<p>would search for matching records only among the bounce report records. If none of these are specified in the command, the default is to search for matches in both message delivered records and bounce report records.</p>
<p>All of the fields in the accounting records (listed in <a href="#&quot;successful-delivered&quot;-records">"Successful delivered" Records</a> &amp; <a href="#transient-queue-records">"Transient Queue" Records</a>) are available for matching (with the <code>--match</code> option), and the match pattern can be either a perl regular expression (e.g., <code>m/^5\./</code>) or some string for case-independent string matching.</p>
<p>If you want to restrict the matching to some fields, you can do that by providing a list of fields to match enclosed in square brackets in front of the pattern (e.g. <code>--match [from,to]port25.com</code>).</p>
<p>Shortcut options for matching single fields are also available. For example, <code>--match [to]port25</code> is equivalent to <code>--to port25</code>. To further refine the output, more than one matching needle can be specified. For example, to get a listing of all <code>yahoo.com</code> addresses that bounced with a persistent (5xx) error, you would have the following option combinations in the command</p>
<pre><code>acctfind --bounced --dsnStatus m/^5\./ --to yahoo.com acct.csv
</code></pre>
<p>As mentioned, seven different output formats are supported. You choose the desired format using the <code>--output</code> option, along with the format and the fields desired to be outputted. For example,</p>
<pre><code>acctfind --delivered --to hotmail.com --output csv[to,from,envid,vmta,dstIp] acct.csv
</code></pre>
<p>would search all message delivered records for recipient addresses at hotmail.com and generate a comma separated output which lists, on each line,</p>
<ul>
<li>the hotmail recipient address,</li>
<li>the message originator address,</li>
<li>the envelope ID used for tracking the message,</li>
<li>the VirtualMTA used to deliver the message, and</li>
<li>the IP address of the Hotmail machine that accepted the message.</li>
</ul>
<p>To get an HTML output vs. csv output of the same, you would run</p>
<pre><code>acctfind --delivered --to hotmail.com --output html[to,from,envid,vmta,dstIp] acct.csv
</code></pre>
<p>A full detailed listing and description of all of the options available can be found in the help by running <code>acctfind --help</code>. Included below are a few sample commands and options to help better understand the formats and capabilities. Do not hesitate to contact us at <code>support@port25.com</code> with any questions or when seeking the proper command sequence for a desired result.</p>
<h3 id="examples-1"><span class="header-section-number">11.5.1</span> Examples</h3>
<ol>
<li><p>To generate a list of all addresses that bounced in a comma separated output, that contains the recipient address first, followed by the <code>MAIL FROM</code>/originator address, then VirtualMTA used, then the bounce codes and reason, sorted by the bounce reason (DSN Diagnostics):</p>
<pre><code>acctfind --bounced --sortBy dsnDiag --output tsv[to,from,vmta,dsnStatus,dsnDiag] acct.csv
</code></pre>
<p>Note that the <code>--sortBy</code> option is only supported on Unix at this time.</p></li>
<li><p>To generate a list of all addresses that bounced with a persistent (5xx) error, in a comma separated output that contains the recipient address first, followed by the <code>MAIL FROM</code>/originator address, envelope ID, then the bounce code and reason:</p>
<pre><code>acctfind --bounced --dsnStatus m/^5\./ --output csv[to,from,envId,dsnStatus,dsnDiag] acct
</code></pre></li>
<li><p>To generate a list of all hotmail.com addresses that bounced, in an HTML output that contains the recipient address, and bounce reasons:</p>
<pre><code>acctfind --bounced --to hotmail --output html[to,dsnStatus,dsnDiag] acct
</code></pre></li>
<li><p>To generate a list of all hotmail.com addresses that were successfully transferred, in a "pretty XML" output that contains the recipient addresses, VirtualMTA used to deliver the messages, the queue and transfer time stamps in ISO format, and the IP address of the hotmail machine that accepted the messages:</p>
<pre><code>acctfind --iso-times --delivered --to hotmail --output prettyxml[to,vmta,timeQueued,timeDelivered,dstIp] acct.csv
</code></pre></li>
<li><p>To search for a particular email address (<code>test@port25.com</code>) to see whether it was delivered or bounced, with a tsv output showing the address, whether the message failed, and the ISO-formatted queue time and delivery time:</p>
<pre><code>acctfind --iso-times --to test@port25.com --output tsv[to,dsnAction,timeQueued,timeDelivered] acct.csv
</code></pre></li>
<li><p>To search for a particular email address (<code>test@port25.com</code>) to see whether it was delivered or bounced, with the standard output:</p>
<pre><code>acctfind --iso-times --to support acct.csv
</code></pre></li>
<li><p>To search for a particular header that is being logged via the <code>acct-log-header</code> directive:</p>
<pre><code>acctfind --output csv[to,from,header:x-foobar] acct.csv
</code></pre></li>
</ol>
<h2 id="bounce-categories-1"><span class="header-section-number">11.6</span> Bounce Categories</h2>
<p>For easier classification of the actual reason for a bounce, <code>pmtastats</code> groups bounces in <em>bounce categories</em>. All bounces in a category have probably the same root cause, e.g. all messages in a category may be considered spam or another category may indicate the recipient is unknown. Using the various bounce codes and DSN reasons, <code>pmtastats</code> aggregates these message in likely bounce categories. This gives a good overview of why messages could not be delivered.</p>
<p>The categories are customizable using the <code>&lt;bounce-category-patterns&gt;</code> tag (see <a href="#use-of-bounce-category-patterns">Use of Bounce Category Patterns</a>). Any new or custom categories would be show in the pmtastats output as well as in the accounting file itself.</p>
<p>The bounce category is included in the accounting file (the <code>bounceCat</code> tag, see <a href="#&quot;successful-delivered&quot;-records">"Successful delivered" Records</a>). It can be obtained directly from the CSV file or be used in <code>acctfind</code>.</p>
<p>Currently, these bounce categories are defined:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">category</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>bad-configuration</strong></td>
<td style="text-align: left;">messages rejected due to configuration issues with remote host, 5.X.X error</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>bad-connection</strong></td>
<td style="text-align: left;">messages bounced due to bad connection issues with remote host, 4.X.X error</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>bad-domain</strong></td>
<td style="text-align: left;">messages bounced due to invalid or non-existing domains, 5.X.X error</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>bad-mailbox</strong></td>
<td style="text-align: left;">messages rejected due to bad, invalid, or non-existent recipient addresses, 5.X.X error</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>content-related</strong></td>
<td style="text-align: left;">messages refused or blocked due to content related reasons, 5.X.X error</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>inactive-mailbox</strong></td>
<td style="text-align: left;">messages rejected due to expired, inactive, or disabled recipient addresses, 5.X.X error</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>invalid-sender</strong></td>
<td style="text-align: left;">messages bounced due to invalid DNS or MX entry for sending domain</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>message-expired</strong></td>
<td style="text-align: left;">messages bounced due to not being delivered before the bounce-after, 4.X.X error</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>no-answer-from-host</strong></td>
<td style="text-align: left;">messages bounces due to receiving no response from remote host after connecting, 4.X.X or 5.X.X error</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>other</strong></td>
<td style="text-align: left;">messages rejected due to other reasons, 4.X.X or 5.X.X error</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>policy-related</strong></td>
<td style="text-align: left;">messages refused or blocked due to general policy reasons, 5.X.X error</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>protocol-errors</strong></td>
<td style="text-align: left;">messages rejected due to SMTP protocol syntax or sequence errors, 5.X.X error</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>quota-issues</strong></td>
<td style="text-align: left;">messages rejected or blocked due to mailbox quota issues, 4.X.X or 5.X.X error</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>relaying-issues</strong></td>
<td style="text-align: left;">messages refused or blocked due to remote mail server relaying issues, 5.X.X error</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>routing-errors</strong></td>
<td style="text-align: left;">messages bounced due to mail routing issues for recipient domain, 5.X.X error</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>spam-related</strong></td>
<td style="text-align: left;">messages refused or blocked due to spam related reasons, 5.X.X error</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>virus-related</strong></td>
<td style="text-align: left;">messages refused or blocked due to virus related reasons, 5.X.X error</td>
</tr>
</tbody>
</table>
<p>Note that this list and the classifications may be subject to change, since DSN status messages may vary.</p>
<h1 id="processing-inbound-email"><span class="header-section-number">12</span> Processing Inbound email</h1>
<h2 id="introduction-2"><span class="header-section-number">12.1</span> Introduction</h2>
<p>There may be times when PowerMTA needs to handle inbound mail outside of messages created by a submission (e.g. list manager, CRM, etc.) application. These messages may be remote (asynchronous) bounces, corporate mail, or any other type of email originating from outside an organizations infrastructure. In these cases, PowerMTA can accept the messages and do one of a few things with the messages. It can:</p>
<ul>
<li>Relay them to another mail server</li>
<li>Deliver them to file on the local system</li>
<li>Discard them (blackhole)</li>
<li>Deliver to pipe (local mail processing application)</li>
<li>Process as an asynchronous (remote) bounce</li>
<li>Process as a feedback loop email</li>
</ul>
<p>Any combination of these options may be used, and PowerMTA will create a subsequent delivery record in the accounting file for mail that is processed in one of these manners.</p>
<h2 id="relaying"><span class="header-section-number">12.2</span> Relaying</h2>
<p>To relay messages to another mail server, PowerMTA will need to be configured to accept the messages, and then deliver them to their final destination.</p>
<pre><code>relay-domain yourdomain.com
relay-domain otherdomain.com
relay-address bounce@bounces.yourdomain.com

&lt;domain bounces.yourdomain.com&gt;
    smtp-hosts [1.2.3.4]:25
&lt;/domain&gt;

&lt;domain otherdomain.com&gt;
    smtp-hosts [5.6.7.8]:2525
&lt;/domain&gt;
</code></pre>
<p>In the above example, messages for bounces.yourdomain.com are accepted for delivery and then forwarded to server 1.2.3.4 on port 25 and messages for otherdomain.com are forwarded to 5.6.7.8 on port 2525 and marked as such in the accounting file.</p>
<h2 id="deliver-to-file"><span class="header-section-number">12.3</span> Deliver to File</h2>
<p>To deliver messages to file, PowerMTA will need to be configured to accept the messages, and then deliver them to somewhere on the local disk system.</p>
<pre><code>relay-domain bounces.yourdomain.com
relay-domain otherdomain.com
relay-address bounce@bounces.yourdomain.com

&lt;domain bounces.yourdomain.com&gt;
    type file
    file-format append-mbox
    file-destination /etc/pmta/inbound/$domain
&lt;/domain&gt;

&lt;domain otherdomain.com&gt;
    type file
    file-format newfile-pickup
    file-destination /etc/pmta/inbound/$domain
&lt;/domain&gt;
</code></pre>
<p>In the above example, messages for bounces.yourdomain.com and otherdomain.com are accepted for delivery and then each message is delivered to the individual files (based on domain) on the local disk and marked as such in the accounting file.</p>
<h2 id="discarding"><span class="header-section-number">12.4</span> Discarding</h2>
<p>To discard (blackhole) the inbound messages, PowerMTA will need to be configured to accept the messages, and then discard them based on domain.</p>
<pre><code>relay-domain bounces.yourdomain.com
relay-domain otherdomain.com
relay-address bounce@bounces.yourdomain.com

&lt;domain bounces.yourdomain.com&gt;
    type discard
&lt;/domain&gt;

&lt;domain otherdomain.com&gt;
    type discard
&lt;/domain&gt;
</code></pre>
<p>In the above example, messages for bounces.yourdomain.com and otherdomain.com are accepted for delivery, then discarded and marked as such in the accounting file.</p>
<h2 id="delivering-to-local-application-pipe"><span class="header-section-number">12.5</span> Delivering to local application (pipe)</h2>
<p>To deliver messages to a local application via pipe, PowerMTA will need to be configured to accept the messages, and then deliver them based on domain.</p>
<pre><code>relay-domain bounces.yourdomain.com
relay-domain otherdomain.com
relay-address bounce@bounces.yourdomain.com

&lt;domain bounces.yourdomain.com&gt;
    type pipe
    command &quot;/my/bounce/processor --envid \&quot;$envid\&quot; \&quot;$user\&quot;&quot;
&lt;/domain&gt;

&lt;domain otherdomain.com&gt;
    type pipe
    command &quot;/my/bounce/processor --envid \&quot;$envid\&quot; \&quot;$user\&quot;&quot;
&lt;/domain&gt;
</code></pre>
<p>In the above example, messages for bounces.yourdomain.com and otherdomain.com are accepted for delivery, then piped to the custom application (with associated parameters) on the local file system and marked as such in the accounting file.</p>
<h2 id="processing-asynchronous-remote-bounces-and-remote-status-reports"><span class="header-section-number">12.6</span> Processing Asynchronous (Remote) Bounces and remote status reports</h2>
<p>Remote bounce processing works as a "filter" located after receipt of an email and before it is routed to a delivery queue. If PowerMTA recognizes the format and no errors occur while processing it, it writes a new type of accounting record ("rb" and "rs", see below). For any "filtered" emails you have the option of discarding the email at that point or letting it pass to regular delivery (e.g. see <code>deliver-matched-email</code>). Depending on these settings, or if an error occurs, it is passed to a delivery queue and delivered normally (by whatever method assigned to the domain -- usually 'file' or 'pipe').</p>
<p>The email address used should be unique for each email sent to allow for more detailed tracking. For example, instead of &lt;<a href="mailto:bounce@bounce.yourdomain.com">bounce@bounce.yourdomain.com</a>&gt; or an address starting with postmaster@ or abuse@, an address like the following should be considered:</p>
<p><a href="mailto:customer1-campaign563-uniqueID498294@bounce.yourdomain.com">customer1-campaign563-uniqueID498294@bounce.yourdomain.com</a></p>
<p><strong>Accounting Records</strong></p>
<p>There are two kinds of records for asynchronous bounces: "rb" for remote bounce and "rs" for reporting other kinds of remote status (used for DSN positive and "delayed" status notifications). Most people will only be interested in "rb" records. The following columns are available for these records:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>timeLogged</strong></td>
<td style="text-align: left;">current time</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>orig</strong></td>
<td style="text-align: left;">originator (taken from report's recipient address)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>rcpt</strong></td>
<td style="text-align: left;">(final) recipient</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>orcpt</strong></td>
<td style="text-align: left;">original recipient</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>dsnAction</strong></td>
<td style="text-align: left;">DSN action</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>dsnStatus</strong></td>
<td style="text-align: left;">DSN status</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>dsnDiag</strong></td>
<td style="text-align: left;">DSN diagnostic</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>dsnMta</strong></td>
<td style="text-align: left;">DSN remote MTA</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>dsnReportingMta</strong></td>
<td style="text-align: left;">DSN reporting MTA</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>bounceCat</strong></td>
<td style="text-align: left;">bounce category</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>srcType</strong></td>
<td style="text-align: left;">type of source from which the report was received</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>srcMta</strong></td>
<td style="text-align: left;">MTA from which the report was received</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>envId</strong></td>
<td style="text-align: left;">envelope ID</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>header_&lt;name&gt;</strong></td>
<td style="text-align: left;">header extracted from original email</td>
</tr>
</tbody>
</table>
<p><strong>Configuration</strong></p>
<p>You define a list of email addresses that are bounce addresses, i.e., original MAIL FROM addresses. Only email received for those addresses gets filtered/looked at looking for bounces. Use of the following requires a restart of the PowerMTA service. You can define entire domains which get filtered, or for more granular control you can use regular expressions to match entire addresses. There are also options to deliver filtered emails that are recognized (matched) or not recognized:</p>
<pre><code>&lt;bounce-processor&gt;
    deliver-unmatched-email yes            # default: yes
    deliver-matched-email yes              # default: no
    forward-unmatched-to auto-feedback@port25.com
    forward-errors-to auto-feedback@port25.com
    &lt;address-list&gt;
        domain domain.to.filter            # whole domain
        address /regex@domain.to.filter/   # regex
    &lt;/address-list&gt;
&lt;/bounce-processor&gt;
</code></pre>
<p>The accounting records are configured just like the other types in the configuration. The example below has both local (sync) and remote (async) bounces written to the same file, and includes a custom "x-id" header:</p>
<pre><code>&lt;acct-file /var/log/pmta/bounces.csv&gt;
    records b, rb
    record-fields b  *,header_x-id
    record-fields rb *,header_x-id
&lt;/acct-file&gt;

&lt;acct-file /var/log/pmta/status.csv&gt;
    records rs
    record-fields rs *,header_x-id
&lt;/acct-file&gt;
</code></pre>
<p>If you are having trouble, setting the following directive will log all filtered emails:</p>
<pre><code>&lt;domain {bounce}&gt;
    log-messages yes
&lt;/domain&gt;
</code></pre>
<h2 id="processing-feedback-loop-emails"><span class="header-section-number">12.7</span> Processing Feedback Loop Emails</h2>
<p>To enable feedback loop processing, you add something like:</p>
<pre><code>&lt;feedback-loop-processor&gt;
    deliver-unmatched-email no
    deliver-matched-email yes          # default: no
    forward-unmatched-to auto-feedback@port25.com
    forward-errors-to auto-feedback@port25.com
    &lt;address-list&gt;
        address /fbl@fbl.yourdomain.com/
    &lt;/address-list&gt;
&lt;/feedback-loop-processor&gt;
</code></pre>
<p>to the configuration file. The "forward-..." directives can be specified more than once to have email forward to multiple addresses. "&lt;address-list&gt;" accepts individual domains like <code>domain foo.com</code> and regular expressions like in the example above, so you have great flexibility in specifying the addresses for which we should attempt FBL processing. As with bounce processing, you have the option to continue to deliver the emails after processing (e.g., to save them all to a folder) or to have them end there. Failed emails always proceed to delivery.</p>
<p>The email address used should be something easy to parse. For example:</p>
<p><a href="mailto:fbl@fbl.yourdomain.com">fbl@fbl.yourdomain.com</a></p>
<p>PowerMTA should be the MX to handle these messages. If there are MTAs that handle the messages prior to being delivered to PowerMTA, PowerMTA may be unable to recognize the message as a FBL email.</p>
<p>Use of postmaster@ or abuse@ is discouraged.</p>
<p>To allow for more detailed tracking a custom header may be added to the email (assuming the remote mailer doesnt redact the header).</p>
<pre><code>x-tracker: customer1-campaign563-uniqueID498294
</code></pre>
<p>Custom headers are not included by default in the PowerMTA accounting file, so if the above header is needed in the accounting make sure to add it as a custom header.</p>
<p>Emails matching the address list go into a special <code>{feedbackLoop}</code> queue, where they are processed. You can configure an accounting file to receive the resulting data:</p>
<pre><code>&lt;acct-file /var/log/pmta/fbl.csv&gt;
    records feedback-loop
    record-fields f *,header_subject
&lt;/acct-file&gt;
</code></pre>
<p>"f" and "feedback-loop" can be used for the record name interchangeably. In the accounting file you actually see 'f'. The available columns (all of which, except for 'header', are included by default) are:</p>
<p>The following columns are available for f records:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>timeLogged</strong></td>
<td style="text-align: left;">current time</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>repSourceIp</strong></td>
<td style="text-align: left;">the IP of PowerMTA that received the message</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>format</strong></td>
<td style="text-align: left;"><code>arf</code> or <code>jmrp</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>userAgent</strong></td>
<td style="text-align: left;">name &amp; version of the program that generated the report</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>envId</strong></td>
<td style="text-align: left;">envelope ID</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>orig</strong></td>
<td style="text-align: left;">originator (taken from report's recipient address)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>rcpt</strong></td>
<td style="text-align: left;">(final) recipient</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>reportingMta</strong></td>
<td style="text-align: left;">the name of the MTA generating this feedback report</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>dlvSourceIp</strong></td>
<td style="text-align: left;">address of MTA from which the message was received</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>header_&lt;name&gt;</strong></td>
<td style="text-align: left;">header extracted from original email</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>arf_&lt;name&gt;</strong></td>
<td style="text-align: left;">field from ARF feedback-report</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>reportedDomain</strong></td>
<td style="text-align: left;">the domain about which the feedback report was generated</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>feedbackType</strong></td>
<td style="text-align: left;">mapped to ARF's Feedback-Type field</td>
</tr>
</tbody>
</table>
<p>'header_From', 'header_Return-Path', 'header_X-job' and 'header_Subject' are included by default.</p>
<p>If a feedback report includes multiple recipients, a separate 'f' record is written for each recipient, repeating any common fields. Since a field requested via 'arf_...' may occur multiple times in the report, the column may contain a (CSV-encoded) list of values.</p>
<h3 id="hotmail-feedback-loop-emails"><span class="header-section-number">12.7.1</span> Hotmail Feedback Loop Emails</h3>
<p>Hotmail does not follow the standard ARF format as the others. To get FBL emails to work for Hotmail messages, sign up for the RFC attachments option, since their "original" option does not include the key headers that PowerMTA parses on to indicate that it is an FBL, and the original format includes less info in general.</p>
<p>Because the RFC attachment option is still non-standard, the header fields from the original message will need to be extracted in contrast to standard ARF messages. Otherwise the RCPT field is empty by default in Hotmail JMRP accounting records.</p>
<p>In this case, PowerMTA will need to add the header "X-HmXmrOriginalRecipient" into the csv accounting file, which is where Hotmail includes the original recipient address that complained in the original message. To add custom headers to an acct record, add the header within the syntax "header_xxx" in the record-fields directive, for example:</p>
<pre><code>&lt;acct-file /var/log/pmta/fbl.csv&gt;
   records feedback-loop
   record-fields f *,header_X-HmXmrOriginalRecipient
&lt;/acct-file&gt;
</code></pre>
<p>Alternatively, the <code>map-header-to-field</code> feature can be used to cause the custom header "X-HmXmrOriginalRecipient" to be be mapped to a standard field. With this, the same field for all FBL emails will be used. To map this Hotmail specific header to the existing <code>rcpt</code> field use something like the following:</p>
<pre><code>&lt;acct-file /var/log/pmta/fbl.csv&gt;
   records feedback-loop
   record-fields f *
   map-header-to-field fbl header_X-HmXmrOriginalRecipient rcpt
&lt;/acct-file&gt;
</code></pre>
<p>Lastly, what many sites do instead is create a custom header in each message that obfuscates the recipient address, perhaps using a mailing or campaign ID as well, for example:</p>
<pre><code>x-rid: 12345-hdhgjkeuydfpdfldfd
</code></pre>
<p>and then have this header included in the FBL accounting file. When parsing the csv file just key on this header, since again, it is included in all FBLs sent back, which is the only thing consistent across the FBL generating sites.</p>
<h2 id="tracking-a-campaign-in-powermta-with-a-jobid"><span class="header-section-number">12.8</span> Tracking a campaign in PowerMTA with a JobID</h2>
<p>To track campaigns in PowerMTA it is best to use the <code>x-job</code> header. This will show as a JobID or a Job in PowerMTA and PowerMTA Management Console. For this to work properly the application feeding PowerMTA needs to set an x-job header. The value of this header should be unique to each campaign. For example:</p>
<pre><code>x-job: UniqueID-Date
</code></pre>
<p>With this set, PowerMTA needs to know to look for the header with a setting similar to the following:</p>
<pre><code>&lt;source 0/0&gt;
    process-x-job yes
&lt;/source&gt;
</code></pre>
<p>If needed, an alternate header may be used with something similar to the following:</p>
<pre><code>&lt;source 0/0&gt;
    jobid-header x-custom-header
    process-x-job yes
&lt;/source&gt;
</code></pre>
<p>In the above example x-custom-header will be used as the JobID in place of x-job.</p>
<p>Once the above is set, PowerMTA will log the JobID to the accounting file once a delivery or bounce has taken place. Information about messages still in the queue can be found on the <a href="#jobs-display">Jobs tab</a> of the PowerMTA web monitor or by using the <a href="#show-jobs">pmta show jobs</a> command.</p>
<p>When using a Job ID, it may become necessary during the course of a mailing to pause the job. Instances of when this would be needed might be to make sure the injected job was setup correctly, or that it is using the correct VirtualMTAs. The command to pause job Campaign1234 would be:</p>
<pre><code>pmta pause job Campaign1234
</code></pre>
<p>And to resume the job:</p>
<pre><code>pmta resume job Campaign1234
</code></pre>
<p>Lastly, additional information about current queue and historical reporting can be found in the PowerMTA Management Console dashboard, monitoring, and reporting sections.</p>
<h2 id="aliases--forwarding"><span class="header-section-number">12.9</span> Aliases / Forwarding</h2>
<p>There may be a need to use aliases or to forward emails. This directive allows a list of email addresses to be defined for which PowerMTA should forward messages to different addresses. For example, if a message is received by PowerMTA for <code>example@domain1abc.com</code>, then forward the message on to <code>support@port25.com</code>.</p>
<p>Alias expansion happens after a pattern list is applied and a VirtualMTA is selected, but before the message is added to the VirtualMTA. The same applies to messages injected using default-virtual-mta or an x-virtual-mta header.</p>
<p>Defining just the local part of the email address (the text to the left of the @) is also supported, however forwarding will only occur on addresses that have the matching local part and the domain of one of the local host names. Domain matching or regex pattern matching is not supported at this time.</p>
<p>The directives are applied on a global basis. The format is an email address (or local part of an address) followed by one or more than one comma separated email addresses. For example:</p>
<pre><code>host-name yourdomain.com
host-name yourotherdomain.com
relay-domain example.com
relay-address user@example.com
&lt;aliases&gt;
    alias example@yourdomain.com support@port25.com,info@port25.com
    alias jdoe someone@example.com
&lt;/aliases&gt;
</code></pre>
<p>In the above example emails sent to <code>example@yourdomain.com</code> will be forwarded to <code>support@port25.com</code> and <code>info@port25.com</code>. Emails sent to <code>jdoe@yourdomain.com</code> or <code>jdoe@yourotherdomain.com</code> will be forwarded to <code>someone@example.com</code>.</p>
<p>Multiple addresses can be defined with the same exact local part across different domains. For example:</p>
<pre><code>&lt;aliases&gt;
    alias newsletters@domain1abc.com support@port25.com
    alias newsletters@domain2def.com info@port25.com
    alias newsletters@domain3xyz.com support@port25.com,info@port25.com
&lt;/aliases&gt;
</code></pre>
<p>To forward all messages from a domain to a given address the following may be used:</p>
<pre><code>&lt;aliases&gt;
    alias *@domain1abc.com support@port25.com
&lt;/aliases&gt;
</code></pre>
<h2 id="handling-non-standard-dsnfbl-reports"><span class="header-section-number">12.10</span> Handling non-standard DSN/FBL reports</h2>
<p>While the major ISPs return FBL/DSN reports in standard format that PMTA can parse, some ISPs return these reports in non-standard formats.</p>
<p>Here's an example of such an email:</p>
<pre><code>From: &quot;ABC&quot; &lt;xyz@reports.spamcop.net&gt;
To: abuse@foobar.com
Subject: [SpamCop] Is your data safe?
Precedence: list
Message-ID: &lt;asdfkajsdfj&gt;
Date: Fri, 31 Mar 2017 06:11:38 -0400
X-Mailer: https://www.spamcop.net/ v4.8.6

[ SpamCop V4.8.6 ]
This message is brief for your comfort. Please use links below for details.

Email from 1.2.3.4 / Fri, 31 Mar 2017 06:11:38 -0400
https://www.spamcop.net/w3m?i=askdjfkasjsadjfajs

[ Offending message ]
&lt;the original email follows&gt;

</code></pre>
<p>The above feedback report is not in the standard ARF format. To handle such reports, PMTA allows you to define the patterns that can match the body of such emails and extract fields from them that can be written to accounting files.</p>
<p>For the email above, you would create a regexp from the relevant part of the body of the email in a file, say <code>/etc/pmta/report-pattern.txt</code> such as:</p>
<pre><code>Email from (?&lt;dlvSourceIp&gt;[0-9\\.]+)
</code></pre>
<p>The above pattern file is configured for use in PMTA using directives like the following:</p>
<pre><code>&lt;feedback-loop-processor&gt;
    &lt;email-patterns&gt;
        body-pattern-file /etc/pmta/report-pattern.txt
    &lt;/email-patterns&gt;
&lt;/feedback-loop-processor&gt;
</code></pre>
<pre><code>&lt;bounce-processor&gt;
    &lt;email-patterns&gt;
        body-pattern-file /etc/pmta/report-pattern.txt
        log-match-info true
    &lt;/email-patterns&gt;
&lt;/bounce-processor&gt;

</code></pre>
<p>Whenever PMTA receives such reports, it will process the email through this pattern, and extract the source IP address(1.2.3.4 in the example above) into a field named <code>dlvSourceIp</code> - the source IP that was originally used to deliver the message. The field is then written in an f record to the accounting file.</p>
<p>For feedback loop reports, you can extract the following fields from the body of the message:</p>
<ul>
<li><code>reportedDomainTo</code> - domain about which the feedback report was generated</li>
<li><code>reportedDomainFrom</code> - domain that generated the feedback report</li>
<li><code>dlvSourceIp</code> - IP address from which the connection was made/attempted</li>
<li><code>rcpt</code> - recipient</li>
<li><code>orig</code> - originator</li>
</ul>
<p>For DSN reports, you can extract the following fields from the body of the message:</p>
<ul>
<li><code>r</code> - recipient</li>
<li><code>or</code> - originator</li>
<li><code>orig</code> - Original Recipient</li>
<li><code>diag</code> - DSN diagnostic string for failure</li>
<li><code>action</code> - DSN action</li>
<li><code>repMta</code> - DSN reporting MTA</li>
<li><code>remMta</code> - DSN remote MTA</li>
</ul>
<p>Please contact <a href="mailto:support@port25.com">support@port25.com</a> if you have questions about the use of this feature, or for help with handling such reports.</p>
<h1 id="acknowledgments"><span class="header-section-number">13</span> Acknowledgments</h1>
<p>Regular expression support is provided by the <a href="http://www.pcre.org/">PCRE library package</a>, which is open source software, written by Philip Hazel, and copyright by the University of Cambridge, England. PCRE is available from <a href="ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/">ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/</a>.</p>
<p>PowerMTA uses, and may in its distribution kits include, <a href="http://www.openssl.org/">OpenSSL</a>. The OpenSSL license requires that we reproduce it here:</p>
<pre><code>/* ====================================================================
* Copyright (c) 1998-2006 The OpenSSL Project. All rights reserved.
*
* Redistribution and use in source and binary forms, with or without
* modification, are permitted provided that the following conditions
* are met:
*
* 1. Redistributions of source code must retain the above copyright
* notice, this list of conditions and the following disclaimer.
*
* 2. Redistributions in binary form must reproduce the above copyright
* notice, this list of conditions and the following disclaimer in
* the documentation and/or other materials provided with the
* distribution.
*
* 3. All advertising materials mentioning features or use of this
* software must display the following acknowledgment:
* &quot;This product includes software developed by the OpenSSL Project
* for use in the OpenSSL Toolkit. (http://www.openssl.org/)&quot;
*
* 4. The names &quot;OpenSSL Toolkit&quot; and &quot;OpenSSL Project&quot; must not be used to
* endorse or promote products derived from this software without
* prior written permission. For written permission, please contact
* openssl-core@openssl.org.
*
* 5. Products derived from this software may not be called &quot;OpenSSL&quot;
* nor may &quot;OpenSSL&quot; appear in their names without prior written
* permission of the OpenSSL Project.
*
* 6. Redistributions of any form whatsoever must retain the following
* acknowledgment:
* &quot;This product includes software developed by the OpenSSL Project
* for use in the OpenSSL Toolkit (http://www.openssl.org/)&quot;
*
* THIS SOFTWARE IS PROVIDED BY THE OpenSSL PROJECT ``AS IS&#39;&#39; AND ANY
* EXPRESSED OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
* IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
* PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE OpenSSL PROJECT OR
* ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
* SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
* NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
* LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
* HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
* STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
* ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
* OF THE POSSIBILITY OF SUCH DAMAGE.
* ====================================================================
*
* This product includes cryptographic software written by Eric Young
* (eay@cryptsoft.com). This product includes software written by Tim
* Hudson (tjh@cryptsoft.com).
*
*/

Original SSLeay License
-----------------------

/* Copyright (C) 1995-1998 Eric Young (eay@cryptsoft.com)
* All rights reserved.
*
* This package is an SSL implementation written
* by Eric Young (eay@cryptsoft.com).
* The implementation was written so as to conform with Netscapes SSL.
*
* This library is free for commercial and non-commercial use as long as
* the following conditions are aheared to. The following conditions
* apply to all code found in this distribution, be it the RC4, RSA,
* lhash, DES, etc., code; not just the SSL code. The SSL documentation
* included with this distribution is covered by the same copyright terms
* except that the holder is Tim Hudson (tjh@cryptsoft.com).
*
* Copyright remains Eric Young&#39;s, and as such any Copyright notices in
* the code are not to be removed.
* If this package is used in a product, Eric Young should be given attribution
* as the author of the parts of the library used.
* This can be in the form of a textual message at program startup or
* in documentation (online or textual) provided with the package.
*
* Redistribution and use in source and binary forms, with or without
* modification, are permitted provided that the following conditions
* are met:
* 1. Redistributions of source code must retain the copyright
* notice, this list of conditions and the following disclaimer.
* 2. Redistributions in binary form must reproduce the above copyright
* notice, this list of conditions and the following disclaimer in the
* documentation and/or other materials provided with the distribution.
* 3. All advertising materials mentioning features or use of this software
* must display the following acknowledgement:
* &quot;This product includes cryptographic software written by
* Eric Young (eay@cryptsoft.com)&quot;
* The word &#39;cryptographic&#39; can be left out if the rouines from the library
* being used are not cryptographic related :-).
* 4. If you include any Windows specific code (or a derivative thereof) from
* the apps directory (application code) you must include an acknowledgement:
* &quot;This product includes software written by Tim Hudson (tjh@cryptsoft.com)&quot;
*
* THIS SOFTWARE IS PROVIDED BY ERIC YOUNG ``AS IS&#39;&#39; AND
* ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
* IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
* ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
* FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
* OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
* HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
* LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
* OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
* SUCH DAMAGE.
*
* The licence and distribution terms for any publically available version or
* derivative of this code cannot be changed. i.e. this code cannot simply be
* copied and put under another distribution licence
* [including the GNU Public Licence.]
*/
</code></pre>
<p>PowerMTA uses, and may in its distribution kits include, <a href="http://site.icu-project.org/">ICU</a>. The ICU license requires that we reproduce it here:</p>
<pre><code>ICU License - ICU 1.8.1 and later

COPYRIGHT AND PERMISSION NOTICE

Copyright (c) 1995-2016 International Business Machines Corporation and others

All rights reserved.

Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
&quot;Software&quot;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, and/or sell copies of the Software, and to permit persons
to whom the Software is furnished to do so, provided that the above
copyright notice(s) and this permission notice appear in all copies of
the Software and that both the above copyright notice(s) and this
permission notice appear in supporting documentation.

THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT
OF THIRD PARTY RIGHTS. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR
HOLDERS INCLUDED IN THIS NOTICE BE LIABLE FOR ANY CLAIM, OR ANY
SPECIAL INDIRECT OR CONSEQUENTIAL DAMAGES, OR ANY DAMAGES WHATSOEVER
RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF
CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN
CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

Except as contained in this notice, the name of a copyright holder
shall not be used in advertising or otherwise to promote the sale, use
or other dealings in this Software without prior written authorization
of the copyright holder.


All trademarks and registered trademarks mentioned herein are the
property of their respective owners.

---------------------

Third-Party Software Licenses

This section contains third-party software notices and/or additional
terms for licensed third-party software components included within ICU
libraries.

1. Unicode Data Files and Software

COPYRIGHT AND PERMISSION NOTICE

Copyright  1991-2016 Unicode, Inc. All rights reserved.
Distributed under the Terms of Use in
http://www.unicode.org/copyright.html.

Permission is hereby granted, free of charge, to any person obtaining
a copy of the Unicode data files and any associated documentation
(the &quot;Data Files&quot;) or Unicode software and any associated documentation
(the &quot;Software&quot;) to deal in the Data Files or Software
without restriction, including without limitation the rights to use,
copy, modify, merge, publish, distribute, and/or sell copies of
the Data Files or Software, and to permit persons to whom the Data Files
or Software are furnished to do so, provided that
(a) this copyright and permission notice appear with all copies
of the Data Files or Software,
(b) this copyright and permission notice appear in associated
documentation, and
(c) there is clear notice in each modified Data File or in the Software
as well as in the documentation associated with the Data File(s) or
Software that the data or software has been modified.

THE DATA FILES AND SOFTWARE ARE PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF
ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT OF THIRD PARTY RIGHTS.
IN NO EVENT SHALL THE COPYRIGHT HOLDER OR HOLDERS INCLUDED IN THIS
NOTICE BE LIABLE FOR ANY CLAIM, OR ANY SPECIAL INDIRECT OR CONSEQUENTIAL
DAMAGES, OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE,
DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THE DATA FILES OR SOFTWARE.

Except as contained in this notice, the name of a copyright holder
shall not be used in advertising or otherwise to promote the sale,
use or other dealings in these Data Files or Software without prior
written authorization of the copyright holder.

2. Chinese/Japanese Word Break Dictionary Data (cjdict.txt)

 #     The Google Chrome software developed by Google is licensed under
 # the BSD license. Other software included in this distribution is
 # provided under other licenses, as set forth below.
 #
 #  The BSD License
 #  http://opensource.org/licenses/bsd-license.php
 #  Copyright (C) 2006-2008, Google Inc.
 #
 #  All rights reserved.
 #
 #  Redistribution and use in source and binary forms, with or without
 # modification, are permitted provided that the following conditions are met:
 #
 #  Redistributions of source code must retain the above copyright notice,
 # this list of conditions and the following disclaimer.
 #  Redistributions in binary form must reproduce the above
 # copyright notice, this list of conditions and the following
 # disclaimer in the documentation and/or other materials provided with
 # the distribution.
 #  Neither the name of  Google Inc. nor the names of its
 # contributors may be used to endorse or promote products derived from
 # this software without specific prior written permission.
 #
 #
 #  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND
 # CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES,
 # INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 # MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 # DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 # LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 # CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 # SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
 # BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 # LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 # NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 # SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 #
 #
 #  The word list in cjdict.txt are generated by combining three word lists
 # listed below with further processing for compound word breaking. The
 # frequency is generated with an iterative training against Google web
 # corpora.
 #
 #  * Libtabe (Chinese)
 #    - https://sourceforge.net/project/?group_id=1519
 #    - Its license terms and conditions are shown below.
 #
 #  * IPADIC (Japanese)
 #    - http://chasen.aist-nara.ac.jp/chasen/distribution.html
 #    - Its license terms and conditions are shown below.
 #
 #  ---------COPYING.libtabe ---- BEGIN--------------------
 #
 #  /*
 #   * Copyrighy (c) 1999 TaBE Project.
 #   * Copyright (c) 1999 Pai-Hsiang Hsiao.
 #   * All rights reserved.
 #   *
 #   * Redistribution and use in source and binary forms, with or without
 #   * modification, are permitted provided that the following conditions
 #   * are met:
 #   *
 #   * . Redistributions of source code must retain the above copyright
 #   *   notice, this list of conditions and the following disclaimer.
 #   * . Redistributions in binary form must reproduce the above copyright
 #   *   notice, this list of conditions and the following disclaimer in
 #   *   the documentation and/or other materials provided with the
 #   *   distribution.
 #   * . Neither the name of the TaBE Project nor the names of its
 #   *   contributors may be used to endorse or promote products derived
 #   *   from this software without specific prior written permission.
 #   *
 #   * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 #   * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 #   * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
 #   * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
 #   * REGENTS OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
 #   * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 #   * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 #   * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 #   * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
 #   * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 #   * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
 #   * OF THE POSSIBILITY OF SUCH DAMAGE.
 #   */
 #
 #  /*
 #   * Copyright (c) 1999 Computer Systems and Communication Lab,
 #   *                    Institute of Information Science, Academia
 #       *                    Sinica. All rights reserved.
 #   *
 #   * Redistribution and use in source and binary forms, with or without
 #   * modification, are permitted provided that the following conditions
 #   * are met:
 #   *
 #   * . Redistributions of source code must retain the above copyright
 #   *   notice, this list of conditions and the following disclaimer.
 #   * . Redistributions in binary form must reproduce the above copyright
 #   *   notice, this list of conditions and the following disclaimer in
 #   *   the documentation and/or other materials provided with the
 #   *   distribution.
 #   * . Neither the name of the Computer Systems and Communication Lab
 #   *   nor the names of its contributors may be used to endorse or
 #   *   promote products derived from this software without specific
 #   *   prior written permission.
 #   *
 #   * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 #   * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 #   * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
 #   * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
 #   * REGENTS OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
 #   * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 #   * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 #   * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 #   * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
 #   * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 #   * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
 #   * OF THE POSSIBILITY OF SUCH DAMAGE.
 #   */
 #
 #  Copyright 1996 Chih-Hao Tsai @ Beckman Institute,
 #      University of Illinois
 #  c-tsai4@uiuc.edu  http://casper.beckman.uiuc.edu/~c-tsai4
 #
 #  ---------------COPYING.libtabe-----END--------------------------------
 #
 #
 #  ---------------COPYING.ipadic-----BEGIN-------------------------------
 #
 #  Copyright 2000, 2001, 2002, 2003 Nara Institute of Science
 #  and Technology.  All Rights Reserved.
 #
 #  Use, reproduction, and distribution of this software is permitted.
 #  Any copy of this software, whether in its original form or modified,
 #  must include both the above copyright notice and the following
 #  paragraphs.
 #
 #  Nara Institute of Science and Technology (NAIST),
 #  the copyright holders, disclaims all warranties with regard to this
 #  software, including all implied warranties of merchantability and
 #  fitness, in no event shall NAIST be liable for
 #  any special, indirect or consequential damages or any damages
 #  whatsoever resulting from loss of use, data or profits, whether in an
 #  action of contract, negligence or other tortuous action, arising out
 #  of or in connection with the use or performance of this software.
 #
 #  A large portion of the dictionary entries
 #  originate from ICOT Free Software.  The following conditions for ICOT
 #  Free Software applies to the current dictionary as well.
 #
 #  Each User may also freely distribute the Program, whether in its
 #  original form or modified, to any third party or parties, PROVIDED
 #  that the provisions of Section 3 (&quot;NO WARRANTY&quot;) will ALWAYS appear
 #  on, or be attached to, the Program, which is distributed substantially
 #  in the same form as set out herein and that such intended
 #  distribution, if actually made, will neither violate or otherwise
 #  contravene any of the laws and regulations of the countries having
 #  jurisdiction over the User or the intended distribution itself.
 #
 #  NO WARRANTY
 #
 #  The program was produced on an experimental basis in the course of the
 #  research and development conducted during the project and is provided
 #  to users as so produced on an experimental basis.  Accordingly, the
 #  program is provided without any warranty whatsoever, whether express,
 #  implied, statutory or otherwise.  The term &quot;warranty&quot; used herein
 #  includes, but is not limited to, any warranty of the quality,
 #  performance, merchantability and fitness for a particular purpose of
 #  the program and the nonexistence of any infringement or violation of
 #  any right of any third party.
 #
 #  Each user of the program will agree and understand, and be deemed to
 #  have agreed and understood, that there is no warranty whatsoever for
 #  the program and, accordingly, the entire risk arising from or
 #  otherwise connected with the program is assumed by the user.
 #
 #  Therefore, neither ICOT, the copyright holder, or any other
 #  organization that participated in or was otherwise related to the
 #  development of the program and their respective officials, directors,
 #  officers and other employees shall be held liable for any and all
 #  damages, including, without limitation, general, special, incidental
 #  and consequential damages, arising out of or otherwise in connection
 #  with the use or inability to use the program or any product, material
 #  or result produced or otherwise obtained by using the program,
 #  regardless of whether they have been advised of, or otherwise had
 #  knowledge of, the possibility of such damages at any time during the
 #  project or thereafter.  Each user will be deemed to have agreed to the
 #  foregoing by his or her commencement of use of the program.  The term
 #  &quot;use&quot; as used herein includes, but is not limited to, the use,
 #  modification, copying and distribution of the program and the
 #  production of secondary products from the program.
 #
 #  In the case where the program, whether in its original form or
 #  modified, was distributed or delivered to or received by a user from
 #  any person, organization or entity other than ICOT, unless it makes or
 #  grants independently of ICOT any specific warranty to the user in
 #  writing, such person, organization or entity, will also be exempted
 #  from and not be held liable to the user for any such damages as noted
 #  above as far as the program is concerned.
 #
 #  ---------------COPYING.ipadic-----END----------------------------------

3. Lao Word Break Dictionary Data (laodict.txt)

 #  Copyright (c) 2013 International Business Machines Corporation
 #  and others. All Rights Reserved.
 #
 # Project: http://code.google.com/p/lao-dictionary/
 # Dictionary: http://lao-dictionary.googlecode.com/git/Lao-Dictionary.txt
 # License: http://lao-dictionary.googlecode.com/git/Lao-Dictionary-LICENSE.txt
 #              (copied below)
 #
 #  This file is derived from the above dictionary, with slight
 #  modifications.
 #  ----------------------------------------------------------------------
 #  Copyright (C) 2013 Brian Eugene Wilson, Robert Martin Campbell.
 #  All rights reserved.
 #
 #  Redistribution and use in source and binary forms, with or without
 #  modification,
 #  are permitted provided that the following conditions are met:
 #
 #
 # Redistributions of source code must retain the above copyright notice, this
 #  list of conditions and the following disclaimer. Redistributions in
 #  binary form must reproduce the above copyright notice, this list of
 #  conditions and the following disclaimer in the documentation and/or
 #  other materials provided with the distribution.
 #
 #
 # THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 # &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 # LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
 # FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
 # COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 # INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 # (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 # SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 # HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
 # STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 # ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
 # OF THE POSSIBILITY OF SUCH DAMAGE.
 #  --------------------------------------------------------------------------

4. Burmese Word Break Dictionary Data (burmesedict.txt)

 #  Copyright (c) 2014 International Business Machines Corporation
 #  and others. All Rights Reserved.
 #
 #  This list is part of a project hosted at:
 #    github.com/kanyawtech/myanmar-karen-word-lists
 #
 #  --------------------------------------------------------------------------
 #  Copyright (c) 2013, LeRoy Benjamin Sharon
 #  All rights reserved.
 #
 #  Redistribution and use in source and binary forms, with or without
 #  modification, are permitted provided that the following conditions
 #  are met: Redistributions of source code must retain the above
 #  copyright notice, this list of conditions and the following
 #  disclaimer.  Redistributions in binary form must reproduce the
 #  above copyright notice, this list of conditions and the following
 #  disclaimer in the documentation and/or other materials provided
 #  with the distribution.
 #
 #    Neither the name Myanmar Karen Word Lists, nor the names of its
 #    contributors may be used to endorse or promote products derived
 #    from this software without specific prior written permission.
 #
 #  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND
 #  CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES,
 #  INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 #  MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 #  DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS
 #  BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 #  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 #  TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 #  DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 #  ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR
 #  TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF
 #  THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 #  SUCH DAMAGE.
 #  --------------------------------------------------------------------------

5. Time Zone Database

  ICU uses the public domain data and code derived from Time Zone
Database for its time zone support. The ownership of the TZ database
is explained in BCP 175: Procedure for Maintaining the Time Zone
Database section 7.

 # 7.  Database Ownership
 #
 #    The TZ database itself is not an IETF Contribution or an IETF
 #    document.  Rather it is a pre-existing and regularly updated work
 #    that is in the public domain, and is intended to remain in the
 #    public domain.  Therefore, BCPs 78 [RFC5378] and 79 [RFC3979] do
 #    not apply to the TZ Database or contributions that individuals make
 #    to it.  Should any claims be made and substantiated against the TZ
 #    Database, the organization that is providing the IANA
 #    Considerations defined in this RFC, under the memorandum of
 #    understanding with the IETF, currently ICANN, may act in accordance
 #    with all competent court orders.  No ownership claims will be made
 #    by ICANN or the IETF Trust on the database or the code.  Any person
 #    making a contribution to the database or code waives all rights to
 #    future claims in that contribution or in the TZ Database.
</code></pre>
<h1 id="directives-index"><span class="header-section-number">14</span> Directives index</h1>
<ul style="list-style: none; padding: 0;">
<li><a href="#accept-invalid-recipients"> accept-invalid-recipients (&lt;source&gt;)</a></li>
<li><a href="#add-date-header"> add-date-header (&lt;source&gt;)</a></li>
<li><a href="#add-message-id-header"> add-message-id-header (&lt;source&gt;)</a></li>
<li><a href="#add-received-header"> add-received-header (&lt;source&gt;)</a></li>
<li><a href="#add-x-virtual-mta-header"> add-x-virtual-mta-header (&lt;source&gt;)</a></li>
<li><a href="#address"> address (&lt;address-list&gt;)</a></li>
<li><a href="#address-file"> address-file (&lt;address-list&gt;)</a></li>
<li><a href="#alias"> alias (Global)</a></li>
<li><a href="#allow-auth"> allow-auth (&lt;source&gt;)</a></li>
<li><a href="#allow-cancel-during-transfer"> allow-cancel-during-transfer (&lt;domain&gt;)</a></li>
<li><a href="#allow-chunking"> allow-chunking (&lt;source&gt;)</a></li>
<li><a href="#allow-empty-x-virtual-mta"> allow-empty-x-virtual-mta (&lt;source&gt;)</a></li>
<li><a href="#allow-mailmerge"> allow-mailmerge (&lt;source&gt;)</a></li>
<li><a href="#allow-priority-interruption"> allow-priority-interruption (&lt;domain&gt;)</a></li>
<li><a href="#allow-priority-interruption-during-transfer"> allow-priority-interruption-during-transfer (&lt;domain&gt;)</a></li>
<li><a href="#allow-smtputf8"> allow-smtputf8 (&lt;source&gt;)</a></li>
<li><a href="#allow-starttls"> allow-starttls (&lt;source&gt;)</a></li>
<li><a href="#allow-unencrypted-plain-auth"> allow-unencrypted-plain-auth (&lt;source&gt;)</a></li>
<li><a href="#always-allow-api-submission"> always-allow-api-submission (&lt;source&gt;)</a></li>
<li><a href="#always-allow-relaying"> always-allow-relaying (Relaying Control)</a></li>
<li><a href="#api-key"> api-key (&lt;transmissions-api&gt;)</a></li>
<li><a href="#api-key-1"> api-key (&lt;signals&gt;)</a></li>
<li><a href="#assume-delivery-upon-data-termination-timeout"> assume-delivery-upon-data-termination-timeout (&lt;domain&gt;)</a></li>
<li><a href="#auth-password"> auth-password (&lt;domain&gt;)</a></li>
<li><a href="#auth-username"> auth-username (&lt;domain&gt;)</a></li>
<li><a href="#authentication-method"> authentication-method (&lt;smtp-user&gt;)</a></li>
<li><a href="#auto-qualify-domain"> auto-qualify-domain (&lt;source&gt;)</a></li>
<li><a href="#await-slot"> await-slot (&lt;smtp-listener&gt;)</a></li>
<li><a href="#backoff-max-connect-rate"> backoff-max-connect-rate (&lt;domain&gt;)</a></li>
<li><a href="#backoff-max-data-volume-rate"> backoff-max-data-volume-rate (&lt;domain&gt;)</a></li>
<li><a href="#backoff-max-msg-per-hour"> backoff-max-msg-per-hour (&lt;domain&gt;)</a></li>
<li><a href="#backoff-max-msg-rate"> backoff-max-msg-rate (&lt;domain&gt;)</a></li>
<li><a href="#backoff-max-smtp-out"> backoff-max-smtp-out (&lt;domain&gt;)</a></li>
<li><a href="#backoff-notify"> backoff-notify (&lt;domain&gt;)</a></li>
<li><a href="#backoff-reroute-to-virtual-mta"> backoff-reroute-to-virtual-mta (&lt;domain&gt;)</a></li>
<li><a href="#backoff-retry-after"> backoff-retry-after (&lt;domain&gt;)</a></li>
<li><a href="#backoff-to-normal-after"> backoff-to-normal-after (&lt;domain&gt;)</a></li>
<li><a href="#backoff-to-normal-after-delivery"> backoff-to-normal-after-delivery (&lt;domain&gt;)</a></li>
<li><a href="#backoff-upon-all-sources-disabled"> backoff-upon-all-sources-disabled (&lt;domain&gt;)</a></li>
<li><a href="#bcc"> bcc (&lt;source&gt;)</a></li>
<li><a href="#bcc-upon-delivery"> bcc-upon-delivery (&lt;domain&gt;)</a></li>
<li><a href="#body-pattern-file"> body-pattern-file (&lt;email-patterns&gt;)</a></li>
<li><a href="#bounce-after"> bounce-after (&lt;domain&gt;)</a></li>
<li><a href="#bounce-upon-5xx-greeting"> bounce-upon-5xx-greeting (&lt;domain&gt;)</a></li>
<li><a href="#bounce-upon-no-mx"> bounce-upon-no-mx (&lt;domain&gt;)</a></li>
<li><a href="#bounce-upon-pix-transfer-failure"> bounce-upon-pix-transfer-failure (&lt;domain&gt;)</a></li>
<li><a href="#bounce-upon-transfer-failure"> bounce-upon-transfer-failure (&lt;domain&gt;)</a></li>
<li><a href="#broken-auth-clients"> broken-auth-clients (&lt;source&gt;)</a></li>
<li><a href="#check-dkim-inbound"> check-dkim-inbound (&lt;source&gt;)</a></li>
<li><a href="#check-iprev-inbound"> check-iprev-inbound (&lt;source&gt;)</a></li>
<li><a href="#check-spf-inbound"> check-spf-inbound (&lt;source&gt;)</a></li>
<li><a href="#check-spf-inbound-best-guess"> check-spf-inbound-best-guess (&lt;source&gt;)</a></li>
<li><a href="#check-spf-inbound-max-void-lookups"> check-spf-inbound-max-void-lookups (&lt;source&gt;)</a></li>
<li><a href="#check-spf-outbound"> check-spf-outbound (&lt;domain&gt;)</a></li>
<li><a href="#cold-virtual-mta"> cold-virtual-mta (&lt;virtual-mta&gt;)</a></li>
<li><a href="#command"> command (Pipe Delivery)</a></li>
<li><a href="#connect-timeout"> connect-timeout (&lt;domain&gt;)</a></li>
<li><a href="#connection-idle-timeout"> connection-idle-timeout (&lt;domain&gt;)</a></li>
<li><a href="#count-moved-records"> count-moved-records (&lt;acct-file&gt;)</a></li>
<li><a href="#custom-dsn-from-header"> custom-dsn-from-header (Global)</a></li>
<li><a href="#custom-message-id-header"> custom-message-id-header (&lt;signals&gt;)</a></li>
<li><a href="#data-send-timeout"> data-send-timeout (&lt;domain&gt;)</a></li>
<li><a href="#date-header-time"> date-header-time (&lt;source&gt;)</a></li>
<li><a href="#default-smtp-port"> default-smtp-port (&lt;domain&gt;)</a></li>
<li><a href="#default-virtual-mta"> default-virtual-mta (&lt;source&gt;)</a></li>
<li><a href="#delete-after"> delete-after (&lt;acct-file&gt;)</a></li>
<li><a href="#delete-file-holders"> delete-file-holders (&lt;spool&gt;)</a></li>
<li><a href="#deliver-email"> deliver-email (&lt;bounce-processor&gt;)</a></li>
<li><a href="#deliver-email-1"> deliver-email (&lt;feedback-loop-processor&gt;)</a></li>
<li><a href="#deliver-local-dsn"> deliver-local-dsn (&lt;domain&gt;)</a></li>
<li><a href="#deliver-matched-email"> deliver-matched-email (&lt;bounce-processor&gt;)</a></li>
<li><a href="#deliver-matched-email-1"> deliver-matched-email (&lt;feedback-loop-processor&gt;)</a></li>
<li><a href="#deliver-only"> deliver-only (&lt;spool&gt;)</a></li>
<li><a href="#deliver-unmatched-email"> deliver-unmatched-email (&lt;bounce-processor&gt;)</a></li>
<li><a href="#deliver-unmatched-email-1"> deliver-unmatched-email (&lt;feedback-loop-processor&gt;)</a></li>
<li><a href="#delivery-priority"> delivery-priority (&lt;domain&gt;)</a></li>
<li><a href="#disable-acct-records"> disable-acct-records (&lt;domain&gt;)</a></li>
<li><a href="#disable-mx-rollup"> disable-mx-rollup (&lt;domain&gt;)</a></li>
<li><a href="#disabled-source-ip-notify"> disabled-source-ip-notify (&lt;domain&gt;)</a></li>
<li><a href="#discard-as-bounce"> discard-as-bounce (Discard Delivery)</a></li>
<li><a href="#disconnect-on-transient-error"> disconnect-on-transient-error (&lt;source&gt;)</a></li>
<li><a href="#dkim-add-body-limit"> dkim-add-body-limit (&lt;domain&gt;)</a></li>
<li><a href="#dkim-add-timestamp"> dkim-add-timestamp (&lt;domain&gt;)</a></li>
<li><a href="#dkim-algorithm"> dkim-algorithm (&lt;domain&gt;)</a></li>
<li><a href="#dkim-body-canon"> dkim-body-canon (&lt;domain&gt;)</a></li>
<li><a href="#dkim-disallow-adding-headers"> dkim-disallow-adding-headers (&lt;domain&gt;)</a></li>
<li><a href="#dkim-expire-after"> dkim-expire-after (&lt;domain&gt;)</a></li>
<li><a href="#dkim-headers"> dkim-headers (&lt;domain&gt;)</a></li>
<li><a href="#dkim-headers-canon"> dkim-headers-canon (&lt;domain&gt;)</a></li>
<li><a href="#dkim-identity"> dkim-identity (&lt;domain&gt;)</a></li>
<li><a href="#dkim-identity-fallback"> dkim-identity-fallback (&lt;domain&gt;)</a></li>
<li><a href="#dkim-query-method"> dkim-query-method (&lt;domain&gt;)</a></li>
<li><a href="#dkim-sign"> dkim-sign (&lt;domain&gt;)</a></li>
<li><a href="#domain"> domain (&lt;address-list&gt;)</a></li>
<li><a href="#domain-1"> domain (&lt;virtual-mta-pool&gt;)</a></li>
<li><a href="#domain-key"> domain-key (General Queueing and Delivery)</a></li>
<li><a href="#domain-key-1"> domain-key (&lt;virtual-mta&gt;)</a></li>
<li><a href="#domain-key-2"> domain-key (&lt;virtual-mta-pool&gt;)</a></li>
<li><a href="#domain-key-3"> domain-key (&lt;domain-key-list&gt;)</a></li>
<li><a href="#domain-macro"> domain-macro (General Queueing and Delivery)</a></li>
<li><a href="#domain-suffix"> domain-suffix (Global)</a></li>
<li><a href="#dsn-format"> dsn-format (&lt;domain&gt;)</a></li>
<li><a href="#dsn-return-default"> dsn-return-default (&lt;source&gt;)</a></li>
<li><a href="#dummy-smtp-await-slot"> dummy-smtp-await-slot (Dummy SMTP ("blackholing"))</a></li>
<li><a href="#dummy-smtp-has-chunking"> dummy-smtp-has-chunking (Dummy SMTP ("blackholing"))</a></li>
<li><a href="#dummy-smtp-has-pipelining"> dummy-smtp-has-pipelining (Dummy SMTP ("blackholing"))</a></li>
<li><a href="#dummy-smtp-has-verp"> dummy-smtp-has-verp (Dummy SMTP ("blackholing"))</a></li>
<li><a href="#dummy-smtp-ip"> dummy-smtp-ip (Dummy SMTP ("blackholing"))</a></li>
<li><a href="#dummy-smtp-latency"> dummy-smtp-latency (Dummy SMTP ("blackholing"))</a></li>
<li><a href="#dummy-smtp-port"> dummy-smtp-port (Dummy SMTP ("blackholing"))</a></li>
<li><a href="#dummy-smtp-update-stats"> dummy-smtp-update-stats (Dummy SMTP ("blackholing"))</a></li>
<li><a href="#enable-signals"> enable-signals (Global)</a></li>
<li><a href="#engagement-tracking"> engagement-tracking (&lt;signals&gt;)</a></li>
<li><a href="#file-destination"> file-destination (File Delivery)</a></li>
<li><a href="#file-format"> file-format (File Delivery)</a></li>
<li><a href="#forward-errors-to"> forward-errors-to (&lt;bounce-processor&gt;)</a></li>
<li><a href="#forward-errors-to-1"> forward-errors-to (&lt;feedback-loop-processor&gt;)</a></li>
<li><a href="#forward-unmatched-to"> forward-unmatched-to (&lt;bounce-processor&gt;)</a></li>
<li><a href="#forward-unmatched-to-1"> forward-unmatched-to (&lt;feedback-loop-processor&gt;)</a></li>
<li><a href="#from-domain"> from-domain (&lt;rewrite-list&gt;)</a></li>
<li><a href="#header"> header (&lt;pattern-list&gt;)</a></li>
<li><a href="#hide-message-source"> hide-message-source (&lt;source&gt;)</a></li>
<li><a href="#host-id"> host-id (Global)</a></li>
<li><a href="#host-name"> host-name (Global)</a></li>
<li><a href="#host-name-1"> host-name (&lt;virtual-mta&gt;)</a></li>
<li><a href="#http-access"> http-access (Web-Based Monitor)</a></li>
<li><a href="#http-api-key"> http-api-key (Web-Based Monitor)</a></li>
<li><a href="#http-csrf-protection"> http-csrf-protection (Web-Based Monitor)</a></li>
<li><a href="#http-default-max-items"> http-default-max-items (Web-Based Monitor)</a></li>
<li><a href="#http-default-sort-order"> http-default-sort-order (Web-Based Monitor)</a></li>
<li><a href="#http-delivery-extra-headers"> http-delivery-extra-headers (HTTP Delivery)</a></li>
<li><a href="#http-delivery-url"> http-delivery-url (HTTP Delivery)</a></li>
<li><a href="#http-log-data"> http-log-data (Web-Based Monitor)</a></li>
<li><a href="#http-log-requests"> http-log-requests (Web-Based Monitor)</a></li>
<li><a href="#http-log-tls"> http-log-tls (Web-Based Monitor)</a></li>
<li><a href="#http-mgmt-port"> http-mgmt-port (Web-Based Monitor)</a></li>
<li><a href="#http-mgmt-source--no-http-mgmt-source"> http-mgmt-source &amp; no-http-mgmt-source (Web-Based Monitor)</a></li>
<li><a href="#http-redirect-to-https"> http-redirect-to-https (Web-Based Monitor)</a></li>
<li><a href="#http-strict-transport-security-max-age"> http-strict-transport-security-max-age (Web-Based Monitor)</a></li>
<li><a href="#http-tls-allow-sslv3"> http-tls-allow-sslv3 (Web-Based Monitor)</a></li>
<li><a href="#http-tls-allow-tlsv1"> http-tls-allow-tlsv1 (Web-Based Monitor)</a></li>
<li><a href="#http-tls-allow-tlsv11"> http-tls-allow-tlsv1.1 (Web-Based Monitor)</a></li>
<li><a href="#http-tls-allow-tlsv12"> http-tls-allow-tlsv1.2 (Web-Based Monitor)</a></li>
<li><a href="#http-tls-ca-file"> http-tls-ca-file (Web-Based Monitor)</a></li>
<li><a href="#http-tls-ciphers"> http-tls-ciphers (Web-Based Monitor)</a></li>
<li><a href="#ignore-8bitmime"> ignore-8bitmime (&lt;domain&gt;)</a></li>
<li><a href="#ignore-chunking"> ignore-chunking (&lt;domain&gt;)</a></li>
<li><a href="#ignore-dsn"> ignore-dsn (&lt;domain&gt;)</a></li>
<li><a href="#ignore-pipelining"> ignore-pipelining (&lt;domain&gt;)</a></li>
<li><a href="#immediate-tls"> immediate-tls (&lt;smtp-listener&gt;)</a></li>
<li><a href="#include"> include (Global)</a></li>
<li><a href="#include-1"> include (&lt;source&gt;)</a></li>
<li><a href="#include-2"> include (&lt;domain&gt;)</a></li>
<li><a href="#include-3"> include (&lt;virtual-mta&gt;)</a></li>
<li><a href="#include-4"> include (&lt;smtp-pattern-list&gt;)</a></li>
<li><a href="#include-headers-from"> include-headers-from (General Queueing and Delivery)</a></li>
<li><a href="#include-headers-from-1"> include-headers-from (&lt;virtual-mta&gt;)</a></li>
<li><a href="#include-headers-from-2"> include-headers-from (&lt;virtual-mta-pool&gt;)</a></li>
<li><a href="#invalid-virtual-mta-fallback"> invalid-virtual-mta-fallback (General Queueing and Delivery)</a></li>
<li><a href="#ip-connection-limit"> ip-connection-limit (MX and IP Connection Limit)</a></li>
<li><a href="#iso-times"> iso-times (&lt;acct-file&gt;)</a></li>
<li><a href="#jobid-header"> jobid-header (&lt;source&gt;)</a></li>
<li><a href="#jobid-prefix"> jobid-prefix (&lt;source&gt;)</a></li>
<li><a href="#log-auto-rotation"> log-auto-rotation (Logging)</a></li>
<li><a href="#log-commands"> log-commands (&lt;source&gt;)</a></li>
<li><a href="#log-connections"> log-connections (&lt;source&gt;)</a></li>
<li><a href="#log-data"> log-data (&lt;source&gt;)</a></li>
<li><a href="#log-data-1"> log-data (&lt;transmissions-api&gt;)</a></li>
<li><a href="#log-disabled-ips"> log-disabled-ips (&lt;domain&gt;)</a></li>
<li><a href="#log-file"> log-file (Logging)</a></li>
<li><a href="#log-file-world-readable"> log-file-world-readable (Logging)</a></li>
<li><a href="#log-match-info"> log-match-info (&lt;email-patterns&gt;)</a></li>
<li><a href="#log-requests"> log-requests (&lt;transmissions-api&gt;)</a></li>
<li><a href="#log-resolution"> log-resolution (&lt;domain&gt;)</a></li>
<li><a href="#log-resolution-1"> log-resolution (&lt;domain&gt;)</a></li>
<li><a href="#log-rotate"> log-rotate (Logging)</a></li>
<li><a href="#log-tls"> log-tls (&lt;source&gt;)</a></li>
<li><a href="#log-tls-1"> log-tls (SSL/TLS)</a></li>
<li><a href="#log-tls-2"> log-tls (&lt;transmissions-api&gt;)</a></li>
<li><a href="#log-transfer-failures"> log-transfer-failures (&lt;domain&gt;)</a></li>
<li><a href="#log-verbose"> log-verbose (&lt;signals&gt;)</a></li>
<li><a href="#macro-variables-preserve-case"> macro-variables-preserve-case (Pipe Delivery)</a></li>
<li><a href="#mail-from"> mail-from (&lt;pattern-list&gt;)</a></li>
<li><a href="#mail-from-1"> mail-from (&lt;rewrite-list&gt;)</a></li>
<li><a href="#mailmerge-expands-undefined-variables"> mailmerge-expands-undefined-variables (Global)</a></li>
<li><a href="#map-header-to-field"> map-header-to-field (&lt;acct-file&gt;)</a></li>
<li><a href="#max-cold-virtual-mta-msg"> max-cold-virtual-mta-msg (&lt;domain&gt;)</a></li>
<li><a href="#max-connect-rate"> max-connect-rate (&lt;domain&gt;)</a></li>
<li><a href="#max-data-volume-rate"> max-data-volume-rate (&lt;domain&gt;)</a></li>
<li><a href="#max-errors-per-connection"> max-errors-per-connection (&lt;domain&gt;)</a></li>
<li><a href="#max-events-recorded"> max-events-recorded (&lt;domain&gt;)</a></li>
<li><a href="#max-message-hops"> max-message-hops (&lt;source&gt;)</a></li>
<li><a href="#max-message-size"> max-message-size (&lt;source&gt;)</a></li>
<li><a href="#max-msg-per-connection"> max-msg-per-connection (&lt;domain&gt;)</a></li>
<li><a href="#max-msg-per-hour"> max-msg-per-hour (&lt;domain&gt;)</a></li>
<li><a href="#max-msg-rate"> max-msg-rate (&lt;domain&gt;)</a></li>
<li><a href="#max-rcpt-per-message"> max-rcpt-per-message (&lt;source&gt;)</a></li>
<li><a href="#max-rcpt-per-message-1"> max-rcpt-per-message (&lt;domain&gt;)</a></li>
<li><a href="#max-rcpt-per-transaction"> max-rcpt-per-transaction (&lt;domain&gt;)</a></li>
<li><a href="#max-size"> max-size (&lt;acct-file&gt;)</a></li>
<li><a href="#max-smtp-data-volume-rate"> max-smtp-data-volume-rate (&lt;virtual-mta&gt;)</a></li>
<li><a href="#max-smtp-data-volume-rate-1"> max-smtp-data-volume-rate (&lt;virtual-mta-pool&gt;)</a></li>
<li><a href="#max-smtp-in"> max-smtp-in (&lt;source-group&gt;)</a></li>
<li><a href="#max-smtp-msg-rate"> max-smtp-msg-rate (&lt;virtual-mta&gt;)</a></li>
<li><a href="#max-smtp-msg-rate-1"> max-smtp-msg-rate (&lt;virtual-mta-pool&gt;)</a></li>
<li><a href="#max-smtp-out"> max-smtp-out (&lt;domain&gt;)</a></li>
<li><a href="#max-smtp-out-1"> max-smtp-out (&lt;virtual-mta&gt;)</a></li>
<li><a href="#max-smtp-out-2"> max-smtp-out (&lt;virtual-mta-pool&gt;)</a></li>
<li><a href="#max-smtp-out-per-source-ip"> max-smtp-out-per-source-ip (&lt;domain&gt;)</a></li>
<li><a href="#min-free-space"> min-free-space (&lt;spool&gt;)</a></li>
<li><a href="#min-free-space-1"> min-free-space (&lt;signals&gt;)</a></li>
<li><a href="#move-interval"> move-interval (&lt;acct-file&gt;)</a></li>
<li><a href="#move-to"> move-to (&lt;acct-file&gt;)</a></li>
<li><a href="#mx-connection-limit"> mx-connection-limit (MX and IP Connection Limit)</a></li>
<li><a href="#name-server"> name-server (Global)</a></li>
<li><a href="#notify-of-delay-every"> notify-of-delay-every (&lt;domain&gt;)</a></li>
<li><a href="#password"> password (&lt;smtp-user&gt;)</a></li>
<li><a href="#pattern-list"> pattern-list (&lt;source&gt;)</a></li>
<li><a href="#pickup"> pickup (Pickup)</a></li>
<li><a href="#pickup-remove-dot"> pickup-remove-dot (Pickup)</a></li>
<li><a href="#pickup-retry-interval"> pickup-retry-interval (Pickup)</a></li>
<li><a href="#pix-bug-workaround"> pix-bug-workaround (&lt;domain&gt;)</a></li>
<li><a href="#pmc-acct-min-free-space"> pmc-acct-min-free-space (Global)</a></li>
<li><a href="#postmaster"> postmaster (Global)</a></li>
<li><a href="#precached-domains-file"> precached-domains-file (&lt;dns&gt;)</a></li>
<li><a href="#precached-max-domains"> precached-max-domains (&lt;dns&gt;)</a></li>
<li><a href="#precached-refresh-interval"> precached-refresh-interval (&lt;dns&gt;)</a></li>
<li><a href="#priority"> priority (&lt;spool&gt;)</a></li>
<li><a href="#privacy-policy"> privacy-policy (&lt;acct-file&gt;)</a></li>
<li><a href="#privacy-policy-1"> privacy-policy (&lt;signals&gt;)</a></li>
<li><a href="#process-x-dkim-key"> process-x-dkim-key (&lt;source&gt;)</a></li>
<li><a href="#process-x-dkim-options"> process-x-dkim-options (&lt;source&gt;)</a></li>
<li><a href="#process-x-envid"> process-x-envid (&lt;source&gt;)</a></li>
<li><a href="#process-x-job"> process-x-job (&lt;source&gt;)</a></li>
<li><a href="#process-x-schedule"> process-x-schedule (&lt;source&gt;)</a></li>
<li><a href="#process-x-sp-subaccount-id"> process-x-sp-subaccount-id (&lt;signals&gt;)</a></li>
<li><a href="#process-x-virtual-mta"> process-x-virtual-mta (&lt;source&gt;)</a></li>
<li><a href="#queue-filter"> queue-filter (&lt;acct-file&gt;)</a></li>
<li><a href="#queue-priority"> queue-priority (&lt;domain&gt;)</a></li>
<li><a href="#queue-to"> queue-to (&lt;domain&gt;)</a></li>
<li><a href="#rcpt-to"> rcpt-to (&lt;pattern-list&gt;)</a></li>
<li><a href="#record-fields"> record-fields (&lt;acct-file&gt;)</a></li>
<li><a href="#records"> records (&lt;acct-file&gt;)</a></li>
<li><a href="#reenable-source-ip-after"> reenable-source-ip-after (&lt;domain&gt;)</a></li>
<li><a href="#reject-invalid-virtual-mta"> reject-invalid-virtual-mta (&lt;source&gt;)</a></li>
<li><a href="#reject-iprev-check-fail"> reject-iprev-check-fail (&lt;source&gt;)</a></li>
<li><a href="#reject-iprev-check-permerror"> reject-iprev-check-permerror (&lt;source&gt;)</a></li>
<li><a href="#reject-iprev-check-temperror"> reject-iprev-check-temperror (&lt;source&gt;)</a></li>
<li><a href="#reject-spf-check-fail"> reject-spf-check-fail (&lt;source&gt;)</a></li>
<li><a href="#reject-spf-check-permerror"> reject-spf-check-permerror (&lt;source&gt;)</a></li>
<li><a href="#reject-spf-check-temperror"> reject-spf-check-temperror (&lt;source&gt;)</a></li>
<li><a href="#relay-address"> relay-address (Relaying Control)</a></li>
<li><a href="#relay-debug"> relay-debug (Relaying Control)</a></li>
<li><a href="#relay-domain"> relay-domain (Relaying Control)</a></li>
<li><a href="#remove-header"> remove-header (&lt;source&gt;)</a></li>
<li><a href="#replace-smtp-421-service-response"> replace-smtp-421-service-response (&lt;domain&gt;)</a></li>
<li><a href="#require-auth"> require-auth (&lt;source&gt;)</a></li>
<li><a href="#require-starttls"> require-starttls (SSL/TLS)</a></li>
<li><a href="#require-starttls-before-auth"> require-starttls-before-auth (&lt;source&gt;)</a></li>
<li><a href="#reroute-to-virtual-mta"> reroute-to-virtual-mta (&lt;domain&gt;)</a></li>
<li><a href="#reserved-smtp-in"> reserved-smtp-in (&lt;source-group&gt;)</a></li>
<li><a href="#retain-x-dkim-key"> retain-x-dkim-key (&lt;source&gt;)</a></li>
<li><a href="#retain-x-dkim-options"> retain-x-dkim-options (&lt;source&gt;)</a></li>
<li><a href="#retain-x-job"> retain-x-job (&lt;source&gt;)</a></li>
<li><a href="#retain-x-schedule"> retain-x-schedule (&lt;source&gt;)</a></li>
<li><a href="#retain-x-sp-subaccount-id"> retain-x-sp-subaccount-id (&lt;signals&gt;)</a></li>
<li><a href="#retain-x-virtual-mta"> retain-x-virtual-mta (&lt;source&gt;)</a></li>
<li><a href="#retry-after"> retry-after (&lt;domain&gt;)</a></li>
<li><a href="#retry-interval"> retry-interval (&lt;acct-file&gt;)</a></li>
<li><a href="#retry-recipients-after"> retry-recipients-after (&lt;domain&gt;)</a></li>
<li><a href="#retry-upon-new-mail"> retry-upon-new-mail (&lt;domain&gt;)</a></li>
<li><a href="#reuse-ssl-session"> reuse-ssl-session (SSL/TLS)</a></li>
<li><a href="#rewrite-list"> rewrite-list (&lt;virtual-mta&gt;)</a></li>
<li><a href="#rewrite-list-1"> rewrite-list (&lt;virtual-mta-pool&gt;)</a></li>
<li><a href="#route"> route (&lt;domain&gt;)</a></li>
<li><a href="#run-as-root"> run-as-root (Global)</a></li>
<li><a href="#sender-or-from"> sender-or-from (&lt;signals-filter&gt;)</a></li>
<li><a href="#smtp-421-means-mx-unavailable"> smtp-421-means-mx-unavailable (&lt;domain&gt;)</a></li>
<li><a href="#smtp-553-means-invalid-mailbox"> smtp-553-means-invalid-mailbox (&lt;domain&gt;)</a></li>
<li><a href="#smtp-await-slot"> smtp-await-slot (Global)</a></li>
<li><a href="#smtp-command-timeout"> smtp-command-timeout (&lt;source&gt;)</a></li>
<li><a href="#smtp-data-termination-timeout"> smtp-data-termination-timeout (&lt;domain&gt;)</a></li>
<li><a href="#smtp-data-timeout"> smtp-data-timeout (&lt;source&gt;)</a></li>
<li><a href="#smtp-greeting-timeout"> smtp-greeting-timeout (&lt;domain&gt;)</a></li>
<li><a href="#smtp-hosts"> smtp-hosts (&lt;domain&gt;)</a></li>
<li><a href="#smtp-ip"> smtp-ip (Global)</a></li>
<li><a href="#smtp-listener"> smtp-listener (Global)</a></li>
<li><a href="#smtp-max-auth-failure-rate"> smtp-max-auth-failure-rate (&lt;source&gt;)</a></li>
<li><a href="#smtp-out-rampup-interval"> smtp-out-rampup-interval (&lt;domain&gt;)</a></li>
<li><a href="#smtp-pattern-list"> smtp-pattern-list (&lt;domain&gt;)</a></li>
<li><a href="#smtp-port"> smtp-port (Global)</a></li>
<li><a href="#smtp-server-tls-allow-sslv3"> smtp-server-tls-allow-sslv3 (Global)</a></li>
<li><a href="#smtp-server-tls-allow-tlsv1"> smtp-server-tls-allow-tlsv1 (Global)</a></li>
<li><a href="#smtp-server-tls-allow-tlsv11"> smtp-server-tls-allow-tlsv1.1 (Global)</a></li>
<li><a href="#smtp-server-tls-allow-tlsv12"> smtp-server-tls-allow-tlsv1.2 (Global)</a></li>
<li><a href="#smtp-server-tls-ca-file"> smtp-server-tls-ca-file (Global)</a></li>
<li><a href="#smtp-server-tls-certificate"> smtp-server-tls-certificate (Global)</a></li>
<li><a href="#smtp-server-tls-ciphers"> smtp-server-tls-ciphers (Global)</a></li>
<li><a href="#smtp-service"> smtp-service (&lt;source&gt;)</a></li>
<li><a href="#smtp-source-host"> smtp-source-host (Global)</a></li>
<li><a href="#smtp-tls-allow-sslv3"> smtp-tls-allow-sslv3 (SSL/TLS)</a></li>
<li><a href="#smtp-tls-allow-tlsv1"> smtp-tls-allow-tlsv1 (SSL/TLS)</a></li>
<li><a href="#smtp-tls-allow-tlsv11"> smtp-tls-allow-tlsv1.1 (SSL/TLS)</a></li>
<li><a href="#smtp-tls-allow-tlsv12"> smtp-tls-allow-tlsv1.2 (SSL/TLS)</a></li>
<li><a href="#smtp-tls-ca-file-directive"> smtp-tls-ca-file directive (SSL/TLS)</a></li>
<li><a href="#smtp-tls-ciphers"> smtp-tls-ciphers (SSL/TLS)</a></li>
<li><a href="#source"> source (&lt;smtp-user&gt;)</a></li>
<li><a href="#source-1"> source (&lt;smtp-listener&gt;)</a></li>
<li><a href="#source-group"> source-group (&lt;source&gt;)</a></li>
<li><a href="#source-ip-max-connect-rate"> source-ip-max-connect-rate (&lt;domain&gt;)</a></li>
<li><a href="#source-ip-max-data-volume-rate"> source-ip-max-data-volume-rate (&lt;domain&gt;)</a></li>
<li><a href="#source-ip-max-msg-rate"> source-ip-max-msg-rate (&lt;domain&gt;)</a></li>
<li><a href="#source-ip-max-msg-rate-1"> source-ip-max-msg-rate (&lt;domain&gt;)</a></li>
<li><a href="#source-ip-max-smtp-out"> source-ip-max-smtp-out (&lt;domain&gt;)</a></li>
<li><a href="#spool"> spool (Global)</a></li>
<li><a href="#spool-delete-corrupted"> spool-delete-corrupted (Global)</a></li>
<li><a href="#spool-max-recipients"> spool-max-recipients (Global)</a></li>
<li><a href="#spool-min-free-space"> spool-min-free-space (Global)</a></li>
<li><a href="#suppress-local-dsn"> suppress-local-dsn (&lt;source&gt;)</a></li>
<li><a href="#suppression-lists"> suppression-lists (&lt;source&gt;)</a></li>
<li><a href="#sync"> sync (&lt;acct-file&gt;)</a></li>
<li><a href="#thread-min-priority-thread-max-priority"> thread-min-priority, thread-max-priority (Global)</a></li>
<li><a href="#thread-reuse"> thread-reuse (Global)</a></li>
<li><a href="#tls-allow-sslv3"> tls-allow-sslv3 (&lt;smtp-listener&gt;)</a></li>
<li><a href="#tls-allow-sslv3-1"> tls-allow-sslv3 (&lt;transmissions-api-listener&gt;)</a></li>
<li><a href="#tls-allow-tlsv1"> tls-allow-tlsv1 (&lt;smtp-listener&gt;)</a></li>
<li><a href="#tls-allow-tlsv1-1"> tls-allow-tlsv1 (&lt;transmissions-api-listener&gt;)</a></li>
<li><a href="#tls-allow-tlsv11"> tls-allow-tlsv1.1 (&lt;smtp-listener&gt;)</a></li>
<li><a href="#tls-allow-tlsv11-1"> tls-allow-tlsv1.1 (&lt;transmissions-api-listener&gt;)</a></li>
<li><a href="#tls-allow-tlsv12"> tls-allow-tlsv1.2 (&lt;smtp-listener&gt;)</a></li>
<li><a href="#tls-allow-tlsv12-1"> tls-allow-tlsv1.2 (&lt;transmissions-api-listener&gt;)</a></li>
<li><a href="#tls-ca-file"> tls-ca-file (&lt;smtp-listener&gt;)</a></li>
<li><a href="#tls-ca-file-1"> tls-ca-file (&lt;transmissions-api-listener&gt;)</a></li>
<li><a href="#tls-certificate"> tls-certificate (&lt;smtp-user&gt;)</a></li>
<li><a href="#tls-certificate-1"> tls-certificate (&lt;smtp-listener&gt;)</a></li>
<li><a href="#tls-certificate-2"> tls-certificate (&lt;transmissions-api-listener&gt;)</a></li>
<li><a href="#tls-ciphers"> tls-ciphers (&lt;smtp-listener&gt;)</a></li>
<li><a href="#tls-ciphers-1"> tls-ciphers (&lt;transmissions-api-listener&gt;)</a></li>
<li><a href="#too-many-rcpts-fails-message"> too-many-rcpts-fails-message (&lt;source&gt;)</a></li>
<li><a href="#total-max-smtp-in"> total-max-smtp-in (Global)</a></li>
<li><a href="#total-max-smtp-out"> total-max-smtp-out (Global)</a></li>
<li><a href="#trace-dkim-check"> trace-dkim-check (&lt;source&gt;)</a></li>
<li><a href="#trace-iprev-check"> trace-iprev-check (&lt;source&gt;)</a></li>
<li><a href="#trace-spf-check"> trace-spf-check (&lt;source&gt;)</a></li>
<li><a href="#track-recipient-events"> track-recipient-events (&lt;domain&gt;)</a></li>
<li><a href="#type"> type (&lt;domain&gt;)</a></li>
<li><a href="#upload-url"> upload-url (&lt;signals&gt;)</a></li>
<li><a href="#use-dane"> use-dane (SSL/TLS)</a></li>
<li><a href="#use-proxy-1"> use-proxy (&lt;virtual-mta&gt;)</a></li>
<li><a href="#use-starttls"> use-starttls (SSL/TLS)</a></li>
<li><a href="#use-unencrypted-plain-auth"> use-unencrypted-plain-auth (&lt;domain&gt;)</a></li>
<li><a href="#user-string"> user-string (&lt;acct-file&gt;)</a></li>
<li><a href="#verp-default"> verp-default (&lt;source&gt;)</a></li>
<li><a href="#virtual-mta"> virtual-mta (&lt;virtual-mta-pool&gt;)</a></li>
<li><a href="#world-readable"> world-readable (&lt;acct-file&gt;)</a></li>
<li><a href="#write-timeout"> write-timeout (&lt;acct-file&gt;)</a></li>
</ul>
</div>
</body>
</html>
